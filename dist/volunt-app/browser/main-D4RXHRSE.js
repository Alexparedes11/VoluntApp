var Rj=Object.create;var Yx=Object.defineProperty,Oj=Object.defineProperties,Fj=Object.getOwnPropertyDescriptor,kj=Object.getOwnPropertyDescriptors,Lj=Object.getOwnPropertyNames,Um=Object.getOwnPropertySymbols,Nj=Object.getPrototypeOf,Kx=Object.prototype.hasOwnProperty,IA=Object.prototype.propertyIsEnumerable;var TA=(s,a,d)=>a in s?Yx(s,a,{enumerable:!0,configurable:!0,writable:!0,value:d}):s[a]=d,rt=(s,a)=>{for(var d in a||={})Kx.call(a,d)&&TA(s,d,a[d]);if(Um)for(var d of Um(a))IA.call(a,d)&&TA(s,d,a[d]);return s},Qn=(s,a)=>Oj(s,kj(a));var Jx=(s,a)=>{var d={};for(var c in s)Kx.call(s,c)&&a.indexOf(c)<0&&(d[c]=s[c]);if(s!=null&&Um)for(var c of Um(s))a.indexOf(c)<0&&IA.call(s,c)&&(d[c]=s[c]);return d};var zj=(s,a)=>()=>(a||s((a={exports:{}}).exports,a),a.exports);var Bj=(s,a,d,c)=>{if(a&&typeof a=="object"||typeof a=="function")for(let f of Lj(a))!Kx.call(s,f)&&f!==d&&Yx(s,f,{get:()=>a[f],enumerable:!(c=Fj(a,f))||c.enumerable});return s};var Vj=(s,a,d)=>(d=s!=null?Rj(Nj(s)):{},Bj(a||!s||!s.__esModule?Yx(d,"default",{value:s,enumerable:!0}):d,s));var Jk=zj((wC,CC)=>{"use strict";(function(s,a){typeof wC=="object"&&typeof CC<"u"?CC.exports=a():typeof define=="function"&&define.amd?define(a):(s=typeof globalThis<"u"?globalThis:s||self,s.mapboxgl=a())})(wC,function(){"use strict";var s,a,d;function c(g,x){if(!s)s=x;else if(!a)a=x;else{var T="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+s+")(sharedChunk); ("+a+")(sharedChunk); self.onerror = null;",P={};s(P),d=x(P),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(d.workerUrl=window.URL.createObjectURL(new Blob([T],{type:"text/javascript"})))}}c(["exports"],function(g){"use strict";var x=typeof self<"u"?self:{},T="3.1.2";let P,O={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(P==null){let t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{P=process.env.API_URL_REGEX!=null?new RegExp(process.env.API_URL_REGEX):t}catch{P=t}}return P},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!O.API_URL)return null;try{let t=new URL(O.API_URL);return t.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":t.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},Z={supported:!1,testSupport:function(t){!Ee&&ce&&(Ze?Vt(t):ee=t)}},ee,ce,Ee=!1,Ze=!1;function Vt(t){let e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,ce),t.isContextLost())return;Z.supported=!0}catch{}t.deleteTexture(e),Ee=!0}x.document&&(ce=x.document.createElement("img"),ce.onload=function(){ee&&Vt(ee),ee=null,Ze=!0},ce.onerror=function(){Ee=!0,ee=null},ce.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");let dt="01";function tt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Ln=ri;function ri(t,e,n,i){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(i-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=n,this.p2y=i}ri.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(e===void 0&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,i=0;i<8;i++){var r=this.sampleCurveX(n)-t;if(Math.abs(r)<e)return n;var o=this.sampleCurveDerivativeX(n);if(Math.abs(o)<1e-6)break;n-=r/o}var l=0,u=1;for(n=t,i=0;i<20&&(r=this.sampleCurveX(n),!(Math.abs(r-t)<e));i++)t>r?l=n:u=n,n=.5*(u-l)+l;return n},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var bn=tt(Ln),Pi=Si;function Si(t,e){this.x=t,this.y=e}Si.prototype={clone:function(){return new Si(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),i=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=i,this},_rotateAround:function(t,e){var n=Math.cos(t),i=Math.sin(t),r=e.y+i*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-i*(this.y-e.y),this.y=r,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Si.convert=function(t){return t instanceof Si?t:Array.isArray(t)?new Si(t[0],t[1]):t};var Q=tt(Pi);function Wt(t,e){if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!Wt(t[n],e[n]))return!1;return!0}if(typeof t=="object"&&t!==null&&e!==null){if(typeof e!="object"||Object.keys(t).length!==Object.keys(e).length)return!1;for(let n in t)if(!Wt(t[n],e[n]))return!1;return!0}return t===e}let sd=Math.PI/180,gl=180/Math.PI;function Tt(t){return t*sd}function ji(t){return t*gl}let ly=[[0,0],[1,0],[1,1],[0,1]];function vc(t){if(t<=0)return 0;if(t>=1)return 1;let e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}function cy(t){let e=1/0,n=1/0,i=-1/0,r=-1/0;for(let o of t)e=Math.min(e,o.x),n=Math.min(n,o.y),i=Math.max(i,o.x),r=Math.max(r,o.y);return{min:new Q(e,n),max:new Q(i,r)}}function _l(t,e,n=0,i=!0){let r=new Q(n,n),o=t.sub(r),l=e.add(r),u=[o,new Q(l.x,o.y),l,new Q(o.x,l.y)];return i&&u.push(o.clone()),u}function yl(t,e,n,i){let r=new bn(t,e,n,i);return function(o){return r.solve(o)}}let vo=yl(.25,.1,.25,1);function We(t,e,n){return Math.min(n,Math.max(e,t))}function ds(t,e,n){return(n=We((n-t)/(e-t),0,1))*n*(3-2*n)}function hs(t,e,n){let i=n-e,r=((t-e)%i+i)%i+e;return r===e?n:r}function vl(t,e,n){if(!t.length)return n(null,[]);let i=t.length,r=new Array(t.length),o=null;t.forEach((l,u)=>{e(l,(h,p)=>{h&&(o=h),r[u]=p,--i==0&&n(o,r)})})}function xl(t){let e=[];for(let n in t)e.push(t[n]);return e}function $e(t,...e){for(let n of e)for(let i in n)t[i]=n[i];return t}function Nr(t,e){let n={};for(let i=0;i<e.length;i++){let r=e[i];r in t&&(n[r]=t[r])}return n}let uy=1;function xc(){return uy++}function Tf(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function If(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Mf(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function Ri(t,e){t.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function bc(t,e){return t.indexOf(e,t.length-e.length)!==-1}function wc(t,e,n){let i={};for(let r in t)i[r]=e.call(n||this,t[r],r,t);return i}function Te(t,e,n){let i={};for(let r in t)e.call(n||this,t[r],r,t)&&(i[r]=t[r]);return i}function V(t){return Array.isArray(t)?t.map(V):typeof t=="object"&&t?wc(t,V):t}let H={};function J(t){H[t]||(typeof console<"u"&&console.warn(t),H[t]=!0)}function _e(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function ve(t){let e=0;for(let n,i,r=0,o=t.length,l=o-1;r<o;l=r++)n=t[r],i=t[l],e+=(i.x-n.x)*(n.y+i.y);return e}function Ve([t,e,n]){let i=Tt(e+90),r=Tt(n);return{x:t*Math.cos(i)*Math.sin(r),y:t*Math.sin(i)*Math.sin(r),z:t*Math.cos(r),azimuthal:e,polar:n}}function Ke(t,e,n){let i=Math.sqrt(t*t+e*e+n*n),r=i>0?Math.acos(n/i)*gl:0,o=t!==0||e!==0?Math.atan2(-e,-t)*gl+90:0;return o<0&&(o+=360),[i,o,r]}function xe(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function nt(t){let e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,i,r,o)=>{let l=r||o;return e[i]=!l||l.toLowerCase(),""}),e["max-age"]){let n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let ht=null;function _t(){return!!x.document.fullscreenElement||!!x.document.webkitFullscreenElement}function An(t){try{let e=x[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function ei(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}function Ui(t,e,n){t[4*e+0]=n[0],t[4*e+1]=n[1],t[4*e+2]=n[2],t[4*e+3]=n[3]}function ti(t,e){return[Math.pow(t[0],2.2)*e,Math.pow(t[1],2.2)*e,Math.pow(t[2],2.2)*e]}function di(t){return[Math.pow(t[0],1/2.2),Math.pow(t[1],1/2.2),Math.pow(t[2],1/2.2)]}let Nn="mapbox-tiles",cr=500,Mr=50,Dr,Go;function Cc(){try{return x.caches}catch{}}function zr(){Cc()&&!Dr&&(Dr=x.caches.open(Nn))}function zs(t){let e=t.indexOf("?");if(e<0)return t;let n=function(r){let o=r.indexOf("?");return o>0?r.slice(o+1).split("&"):[]}(t),i=n.filter(r=>{let o=r.split("=");return o[0]==="language"||o[0]==="worldview"});return i.length?`${t.slice(0,e)}?${i.join("&")}`:t.slice(0,e)}let ba=1/0;function Ec(t){ba++,ba>Mr&&(t.getActor().send("enforceCacheSizeLimit",cr),ba=0)}let fe={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(fe);class me extends Error{constructor(e,n,i){n===401&&ni(i)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=i}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}let we=xe()?()=>self.worker&&self.worker.referrer:()=>(x.location.protocol==="blob:"?x.parent:x).location.href,Ie=function(t,e){if(!(/^file:/.test(n=t.url)||/^file:/.test(we())&&!/^\w+:/.test(n))){if(x.fetch&&x.Request&&x.AbortController&&x.Request.prototype.hasOwnProperty("signal"))return function(i,r){let o=new x.AbortController,l=new x.Request(i.url,{method:i.method||"GET",body:i.body,credentials:i.credentials,headers:i.headers,referrer:we(),referrerPolicy:i.referrerPolicy,signal:o.signal}),u=!1,h=!1,p=(m=l.url).indexOf("sku=")>0&&ni(m);var m;i.type==="json"&&l.headers.set("Accept","application/json");let _=(v,b,w)=>{if(h)return;if(v&&v.message!=="SecurityError"&&J(v.toString()),b&&w)return y(b);let C=Date.now();x.fetch(l).then(E=>{if(E.ok){let I=p?E.clone():null;return y(E,I,C)}return r(new me(E.statusText,E.status,i.url))}).catch(E=>{E.name!=="AbortError"&&r(new Error(`${E.message} ${i.url}`))})},y=(v,b,w)=>{(i.type==="arrayBuffer"?v.arrayBuffer():i.type==="json"?v.json():v.text()).then(C=>{h||(b&&w&&function(E,I,D){if(zr(),!Dr)return;let S={status:I.status,statusText:I.statusText,headers:new x.Headers};I.headers.forEach((R,F)=>S.headers.set(F,R));let M=nt(I.headers.get("Cache-Control")||"");if(M["no-store"])return;M["max-age"]&&S.headers.set("Expires",new Date(D+1e3*M["max-age"]).toUTCString());let A=S.headers.get("Expires");A&&(new Date(A).getTime()-D<42e4||function(R,F){if(Go===void 0)try{new Response(new ReadableStream),Go=!0}catch{Go=!1}Go?F(R.body):R.blob().then(F)}(I,R=>{let F=new x.Response(R,S);zr(),Dr&&Dr.then(k=>k.put(zs(E.url),F)).catch(k=>J(k.message))}))}(l,b,w),u=!0,r(null,C,v.headers.get("Cache-Control"),v.headers.get("Expires")))}).catch(C=>{h||r(new Error(C.message))})};return p?function(v,b){if(zr(),!Dr)return b(null);let w=zs(v.url);Dr.then(C=>{C.match(w).then(E=>{let I=function(D){if(!D)return!1;let S=new Date(D.headers.get("Expires")||0),M=nt(D.headers.get("Cache-Control")||"");return S>Date.now()&&!M["no-cache"]}(E);C.delete(w),I&&C.put(w,E.clone()),b(null,E,I)}).catch(b)}).catch(b)}(l,_):_(null,null),{cancel:()=>{h=!0,u||o.abort()}}}(t,e);if(xe()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var n;return function(i,r){let o=new x.XMLHttpRequest;o.open(i.method||"GET",i.url,!0),i.type==="arrayBuffer"&&(o.responseType="arraybuffer");for(let l in i.headers)o.setRequestHeader(l,i.headers[l]);return i.type==="json"&&(o.responseType="text",o.setRequestHeader("Accept","application/json")),o.withCredentials=i.credentials==="include",o.onerror=()=>{r(new Error(o.statusText))},o.onload=()=>{if((o.status>=200&&o.status<300||o.status===0)&&o.response!==null){let l=o.response;if(i.type==="json")try{l=JSON.parse(o.response)}catch(u){return r(u)}r(null,l,o.getResponseHeader("Cache-Control"),o.getResponseHeader("Expires"))}else r(new me(o.statusText,o.status,i.url))},o.send(i.body),{cancel:()=>o.abort()}}(t,e)},Me=function(t,e){return Ie($e(t,{type:"json"}),e)},Oe=function(t,e){return Ie($e(t,{type:"arrayBuffer"}),e)};function Le(t){let e=x.document.createElement("a");return e.href=t,e.protocol===x.document.location.protocol&&e.host===x.document.location.host}let Se="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=",He,Fe;He=[],Fe=0;let St=function(t,e){if(Z.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Fe>=O.MAX_PARALLEL_IMAGE_REQUESTS){let o={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return He.push(o),o}Fe++;let n=!1,i=()=>{if(!n)for(n=!0,Fe--;He.length&&Fe<O.MAX_PARALLEL_IMAGE_REQUESTS;){let o=He.shift(),{requestParameters:l,callback:u,cancelled:h}=o;h||(o.cancel=St(l,u).cancel)}},r=Oe(t,(o,l,u,h)=>{i(),o?e(o):l&&(x.createImageBitmap?function(p,m){let _=new x.Blob([new Uint8Array(p)],{type:"image/png"});x.createImageBitmap(_).then(y=>{m(null,y)}).catch(y=>{m(new Error(`Could not load image because of ${y.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(l,(p,m)=>e(p,m,u,h)):function(p,m){let _=new x.Image,y=x.URL;_.onload=()=>{m(null,_),y.revokeObjectURL(_.src),_.onload=null,x.requestAnimationFrame(()=>{_.src=Se})},_.onerror=()=>m(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));let v=new x.Blob([new Uint8Array(p)],{type:"image/png"});_.src=p.byteLength?y.createObjectURL(v):Se}(l,(p,m)=>e(p,m,u,h)))});return{cancel:()=>{r.cancel(),i()}}},wn="NO_ACCESS_TOKEN";class it{constructor(e,n,i){this._transformRequestFn=e,this._customAccessToken=n,this._silenceAuthErrors=!!i,this._createSkuToken()}_createSkuToken(){let e=function(){let n="";for(let i=0;i<10;i++)n+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",dt,n].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(e,n){return this._transformRequestFn&&this._transformRequestFn(e,n)||{url:e}}normalizeStyleURL(e,n){if(!gn(e))return e;let i=Oi(e);return i.params.push(`sdk=js-${T}`),i.path=`/styles/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||n)}normalizeGlyphsURL(e,n){if(!gn(e))return e;let i=Oi(e);return i.path=`/fonts/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||n)}normalizeModelURL(e,n){if(!gn(e))return e;let i=Oi(e);return i.path=`/models/v1${i.path}`,this._makeAPIURL(i,this._customAccessToken||n)}normalizeSourceURL(e,n,i,r){if(!gn(e))return e;let o=Oi(e);return o.path=`/v4/${o.authority}.json`,o.params.push("secure"),i&&o.params.push(`language=${i}`),r&&o.params.push(`worldview=${r}`),this._makeAPIURL(o,this._customAccessToken||n)}normalizeSpriteURL(e,n,i,r){let o=Oi(e);return gn(e)?(o.path=`/styles/v1${o.path}/sprite${n}${i}`,this._makeAPIURL(o,this._customAccessToken||r)):(o.path+=`${n}${i}`,Sr(o))}normalizeTileURL(e,n,i){if(this._isSkuTokenExpired()&&this._createSkuToken(),e&&!gn(e))return e;let r=Oi(e);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${n||i&&r.authority!=="raster"&&i===512?"@2x":""}${Z.supported?".webp":"$1"}`),r.authority==="raster"?r.path=`/${O.RASTER_URL_PREFIX}${r.path}`:(r.path=r.path.replace(/^.+\/v4\//,"/"),r.path=`/${O.TILE_URL_VERSION}${r.path}`);let o=this._customAccessToken||function(l){for(let u of l){let h=u.match(/^access_token=(.*)$/);if(h)return h[1]}return null}(r.params)||O.ACCESS_TOKEN;return O.REQUIRE_ACCESS_TOKEN&&o&&this._skuToken&&r.params.push(`sku=${this._skuToken}`),this._makeAPIURL(r,o)}canonicalizeTileURL(e,n){let i=Oi(e);if(!i.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!i.path.match(/\.[\w]+$/))return e;let r="mapbox://";i.path.match(/^\/raster\/v1\//)?r+=`raster/${i.path.replace(`/${O.RASTER_URL_PREFIX}/`,"")}`:r+=`tiles/${i.path.replace(`/${O.TILE_URL_VERSION}/`,"")}`;let o=i.params;return n&&(o=o.filter(l=>!l.match(/^access_token=/))),o.length&&(r+=`?${o.join("&")}`),r}canonicalizeTileset(e,n){let i=!!n&&gn(n),r=[];for(let o of e.tiles||[])ni(o)?r.push(this.canonicalizeTileURL(o,i)):r.push(o);return r}_makeAPIURL(e,n){let i="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",r=Oi(O.API_URL);if(e.protocol=r.protocol,e.authority=r.authority,e.protocol==="http"){let o=e.params.indexOf("secure");o>=0&&e.params.splice(o,1)}if(r.path!=="/"&&(e.path=`${r.path}${e.path}`),!O.REQUIRE_ACCESS_TOKEN)return Sr(e);if(n=n||O.ACCESS_TOKEN,!this._silenceAuthErrors){if(!n)throw new Error(`An API access token is required to use Mapbox GL. ${i}`);if(n[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${i}`)}return e.params=e.params.filter(o=>o.indexOf("access_token")===-1),e.params.push(`access_token=${n||""}`),Sr(e)}}function gn(t){return t.indexOf("mapbox:")===0}function ni(t){return O.API_URL_REGEX.test(t)}function hi(t){return O.API_CDN_URL_REGEX.test(t)}function Ei(t){return O.API_STYLE_REGEX.test(t)&&!ur(t)}function ur(t){return O.API_SPRITE_REGEX.test(t)}let xo=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Oi(t){let e=t.match(xo);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Sr(t){let e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}let dr="mapbox.eventData";function Tc(t){if(!t)return null;let e=t.split(".");if(!e||e.length!==3)return null;try{return JSON.parse(decodeURIComponent(x.atob(e[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class wa{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){let n=Tc(O.ACCESS_TOKEN),i="";return i=n&&n.u?x.btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(r,o)=>String.fromCharCode(+("0x"+o)))):O.ACCESS_TOKEN||"",e?`${dr}.${e}:${i}`:`${dr}:${i}`}fetchEventData(){let e=An("localStorage"),n=this.getStorageKey(),i=this.getStorageKey("uuid");if(e)try{let r=x.localStorage.getItem(n);r&&(this.eventData=JSON.parse(r));let o=x.localStorage.getItem(i);o&&(this.anonId=o)}catch{J("Unable to read from LocalStorage")}}saveEventData(){let e=An("localStorage"),n=this.getStorageKey(),i=this.getStorageKey("uuid");if(e)try{x.localStorage.setItem(i,this.anonId),Object.keys(this.eventData).length>=1&&x.localStorage.setItem(n,JSON.stringify(this.eventData))}catch{J("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,n,i,r){if(!O.EVENTS_URL)return;let o=Oi(O.EVENTS_URL);o.params.push(`access_token=${r||O.ACCESS_TOKEN||""}`);let l={event:this.type,created:new Date(e).toISOString()},u=n?$e(l,n):l,h={url:Sr(o),headers:{"Content-Type":"text/plain"},body:JSON.stringify([u])};this.pendingRequest=function(p,m){return Ie($e(p,{method:"POST"}),m)}(h,p=>{this.pendingRequest=null,i(p),this.saveEventData(),this.processRequests(r)})}queueRequest(e,n){this.queue.push(e),this.processRequests(n)}}let Ic=new class extends wa{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){O.EVENTS_URL&&O.ACCESS_TOKEN&&Array.isArray(t)&&t.some(n=>gn(n)||ni(n))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();let e=Tc(O.ACCESS_TOKEN),n=e?e.u:O.ACCESS_TOKEN,i=n!==this.eventData.tokenU;Mf(this.anonId)||(this.anonId=Tf(),i=!0);let r=this.queue.shift();if(this.eventData.lastSuccess){let o=new Date(this.eventData.lastSuccess),l=new Date(r),u=(r-this.eventData.lastSuccess)/864e5;i=i||u>=1||u<-1||o.getDate()!==l.getDate()}else i=!0;i?this.postEvent(r,{sdkIdentifier:"mapbox-gl-js",sdkVersion:T,skuId:dt,"enabled.telemetry":!1,userId:this.anonId},o=>{o||(this.eventData.lastSuccess=r,this.eventData.tokenU=n)},t):this.processRequests()}},dy=Ic.postTurnstileEvent.bind(Ic),EC=new class extends wa{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,n,i){this.skuToken=e,this.errorCb=i,O.EVENTS_URL&&(n||O.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(wn)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Mf(this.anonId)||(this.anonId=Tf()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:T,skuId:dt,skuToken:this.skuToken,userId:this.anonId},i=>{i?this.errorCb(i):e&&(this.success[e]=!0)},t))}},pL=EC.postMapLoadEvent.bind(EC),TC=new class extends wa{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){O.EVENTS_URL&&(t||O.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{timestamp:e,performanceData:n}=this.queue.shift(),i=function(r){let o=x.performance.getEntriesByType("resource"),l=x.performance.getEntriesByType("mark"),u=function(y){let v={};if(y){for(let b in y)if(b!=="other")for(let w of y[b]){let C=`${b}ResolveRangeMin`,E=`${b}ResolveRangeMax`,I=`${b}RequestCount`,D=`${b}RequestCachedCount`;v[C]=Math.min(v[C]||1/0,w.startTime),v[E]=Math.max(v[E]||-1/0,w.responseEnd);let S=M=>{v[M]===void 0&&(v[M]=0),++v[M]};w.transferSize!==void 0&&w.transferSize===0&&S(D),S(I)}}return v}(function(y,v){let b={};if(y)for(let w of y){let C=v(w);b[C]===void 0&&(b[C]=[]),b[C].push(w)}return b}(o,_L)),h=x.devicePixelRatio,p=x.navigator.connection||x.navigator.mozConnection||x.navigator.webkitConnection,m={counters:[],metadata:[],attributes:[]},_=(y,v,b)=>{b!=null&&y.push({name:v,value:b.toString()})};for(let y in u)_(m.counters,y,u[y]);if(r.interactionRange[0]!==1/0&&r.interactionRange[1]!==-1/0&&(_(m.counters,"interactionRangeMin",r.interactionRange[0]),_(m.counters,"interactionRangeMax",r.interactionRange[1])),l)for(let y of Object.keys(Sf)){let v=Sf[y],b=l.find(w=>w.name===v);b&&_(m.counters,v,b.startTime)}return _(m.counters,"visibilityHidden",r.visibilityHidden),_(m.attributes,"style",function(y){if(y)for(let v of y){let b=v.name.split("?")[0];if(Ei(b)){let w=b.split("/").slice(-2);if(w.length===2)return`mapbox://styles/${w[0]}/${w[1]}`}}}(o)),_(m.attributes,"terrainEnabled",r.terrainEnabled?"true":"false"),_(m.attributes,"fogEnabled",r.fogEnabled?"true":"false"),_(m.attributes,"projection",r.projection),_(m.attributes,"zoom",r.zoom),_(m.metadata,"devicePixelRatio",h),_(m.metadata,"connectionEffectiveType",p?p.effectiveType:void 0),_(m.metadata,"navigatorUserAgent",x.navigator.userAgent),_(m.metadata,"screenWidth",x.screen.width),_(m.metadata,"screenHeight",x.screen.height),_(m.metadata,"windowWidth",x.innerWidth),_(m.metadata,"windowHeight",x.innerHeight),_(m.metadata,"mapWidth",r.width/h),_(m.metadata,"mapHeight",r.height/h),_(m.metadata,"webglRenderer",r.renderer),_(m.metadata,"webglVendor",r.vendor),_(m.metadata,"sdkVersion",T),_(m.metadata,"sdkIdentifier","mapbox-gl-js"),m}(n);for(let r of i.metadata);for(let r of i.counters);for(let r of i.attributes);this.postEvent(e,i,()=>{},t)}},mL=TC.postPerformanceEvent.bind(TC),IC=new class extends wa{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,n,i){if(!O.API_URL||!O.SESSION_PATH)return;let r=Oi(O.API_URL+O.SESSION_PATH);r.params.push(`sku=${e||""}`),r.params.push(`access_token=${i||O.ACCESS_TOKEN||""}`);let o={url:Sr(r),headers:{"Content-Type":"text/plain"}};this.pendingRequest=function(l,u){return Ie($e(l,{method:"GET"}),u)}(o,l=>{this.pendingRequest=null,n(l),this.saveEventData(),this.processRequests(i)})}getSessionAPI(t,e,n,i){this.skuToken=e,this.errorCb=i,O.SESSION_PATH&&O.API_URL&&(n||O.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(wn)))}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;let{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,i=>{i?this.errorCb(i):e&&(this.success[e]=!0)},t)}},gL=IC.getSessionAPI.bind(IC),Df=new Set;function MC(t,e){e?Df.add(t):Df.delete(t)}let Sf={create:"create",load:"load",fullLoad:"fullLoad"},DC={mark(t){x.performance.mark(t)},measure(t,e,n){x.performance.measure(t,e,n)}};function _L(t){let e=t.name.split("?")[0];return hi(e)&&e.includes("mapbox-gl.js")?"javascript":hi(e)&&e.includes("mapbox-gl.css")?"css":function(n){return O.API_FONTS_REGEX.test(n)}(e)?"fontRange":ur(e)?"sprite":Ei(e)?"style":function(n){return O.API_TILEJSON_REGEX.test(n)}(e)?"tilejson":"other"}let yL=x.performance;function SC(t){let e=t?t.url.toString():void 0;return yL.getEntriesByName(e)}var AC=hy;function hy(t){return!function(e){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var i,r,o=new Blob([""],{type:"text/javascript"}),l=URL.createObjectURL(o);try{r=new Worker(l),i=!0}catch{i=!1}return r&&r.terminate(),URL.revokeObjectURL(l),i}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var i=document.createElement("canvas");i.width=i.height=1;var r=i.getContext("2d");if(!r)return!1;var o=r.getImageData(0,0,1,1);return o&&o.width===i.width}()?(fy[n=e&&e.failIfMajorPerformanceCaveat]===void 0&&(fy[n]=function(i){var r,o=function(l){var u=document.createElement("canvas"),h=Object.create(hy.webGLContextAttributes);return h.failIfMajorPerformanceCaveat=l,u.getContext("webgl",h)||u.getContext("experimental-webgl",h)}(i);if(!o)return!1;try{r=o.createShader(o.VERTEX_SHADER)}catch{return!1}return!(!r||o.isContextLost())&&(o.shaderSource(r,"void main() {}"),o.compileShader(r),o.getShaderParameter(r,o.COMPILE_STATUS)===!0)}(n)),fy[n]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var n}(t)}var fy={};let py,Af,my,Pf,bl;function PC(){return py==null&&(py=x.OffscreenCanvas&&new x.OffscreenCanvas(1,1).getContext("2d")&&typeof x.createImageBitmap=="function"),py}hy.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};let yt={now:()=>Pf!==void 0?Pf:x.performance.now(),setNow(t){Pf=t},restoreNow(){Pf=void 0},frame(t){let e=x.requestAnimationFrame(t);return{cancel:()=>x.cancelAnimationFrame(e)}},getImageData(t,e=0){let{width:n,height:i}=t;bl||(bl=x.document.createElement("canvas"));let r=bl.getContext("2d",{willReadFrequently:!0});if(!r)throw new Error("failed to create canvas 2d context");return(n>bl.width||i>bl.height)&&(bl.width=n,bl.height=i),r.clearRect(-e,-e,n+2*e,i+2*e),r.drawImage(t,0,0,n,i),r.getImageData(-e,-e,n+2*e,i+2*e)},resolveURL:t=>(Af||(Af=x.document.createElement("a")),Af.href=t,Af.href),get devicePixelRatio(){return x.devicePixelRatio},get prefersReducedMotion(){return!!x.matchMedia&&(my==null&&(my=x.matchMedia("(prefers-reduced-motion: reduce)")),my.matches)},hasCanvasFingerprintNoise(){if(!PC())return!1;let t=new x.OffscreenCanvas(85,1),e=t.getContext("2d",{willReadFrequently:!0}),n=0;for(let r=0;r<t.width;++r)e.fillStyle=`rgba(${n++},${n++},${n++}, 255)`,e.fillRect(r,0,1,1);let i=e.getImageData(0,0,t.width,t.height);n=0;for(let r=0;r<i.data.length;++r)if(r%4!=3&&n++!==i.data[r])return!0;return!1}};function Sn(t,e,n){let i=x.document.createElement(t);return e!==void 0&&(i.className=e),n&&n.appendChild(i),i}function Bs(t,e,n){let i=x.document.createElementNS("http://www.w3.org/2000/svg",t);for(let r of Object.keys(e))i.setAttributeNS(null,r,e[r]);return n&&n.appendChild(i),i}let wl=x.document&&x.document.documentElement.style,ad=wl&&wl.userSelect!==void 0?"userSelect":"WebkitUserSelect",RC;function OC(){wl&&ad&&(RC=wl[ad],wl[ad]="none")}function FC(){wl&&ad&&(wl[ad]=RC)}function gy(t){t.preventDefault(),t.stopPropagation(),x.removeEventListener("click",gy,!0)}function _y(){x.addEventListener("click",gy,!0),x.setTimeout(()=>{x.removeEventListener("click",gy,!0)},0)}function ld(t,e){let n=t.getBoundingClientRect();return LC(t,n,e)}function Rf(t,e){let n=t.getBoundingClientRect(),i=[];for(let r=0;r<e.length;r++)i.push(LC(t,n,e[r]));return i}function kC(t){return x.InstallTrigger!==void 0&&t.button===2&&t.ctrlKey&&x.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:t.button}function LC(t,e,n){let i=t.offsetWidth===e.width?1:t.offsetWidth/e.width;return new Q((n.clientX-e.left)*i,(n.clientY-e.top)*i)}function NC(t,e,n){n[t]&&n[t].indexOf(e)!==-1||(n[t]=n[t]||[],n[t].push(e))}function yy(t,e,n){if(n&&n[t]){let i=n[t].indexOf(e);i!==-1&&n[t].splice(i,1)}}class Ce{constructor(e,n={}){$e(this,n),this.type=e}}class mt extends Ce{constructor(e,n={}){super("error",$e({error:e},n))}}class yi{on(e,n){return this._listeners=this._listeners||{},NC(e,n,this._listeners),this}off(e,n){return yy(e,n,this._listeners),yy(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},NC(e,n,this._oneTimeListeners),this):new Promise(i=>this.once(e,i))}fire(e,n){typeof e=="string"&&(e=new Ce(e,n||{}));let i=e.type;if(this.listens(i)){e.target=this;let r=this._listeners&&this._listeners[i]?this._listeners[i].slice():[];for(let u of r)u.call(this,e);let o=this._oneTimeListeners&&this._oneTimeListeners[i]?this._oneTimeListeners[i].slice():[];for(let u of o)yy(i,u,this._oneTimeListeners),u.call(this,e);let l=this._eventedParent;l&&($e(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),l.fire(e))}else e instanceof mt&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var ie=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"required":false,"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"camera":{"type":"camera"},"imports":{"type":"array","value":"import"},"schema":{"type":"schema"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"},"models":{"type":"models"}},"model":{"type":"string","required":true},"import":{"id":{"type":"string","required":true},"url":{"type":"string","required":true},"config":{"type":"config"},"data":{"type":"$root"}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","required":true},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string","required":true},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false,"expression":{},"property-type":"data-constant"},"shadow-intensity":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"required":true,"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":1}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":1}},"url":{"required":false,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"required":true,"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{},"property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective","property-type":"data-constant"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"property-type":"data-constant","expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"property-type":"data-constant","type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"property-type":"data-constant","type":"color","default":"#ffffff","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"property-type":"data-constant","type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"property-type":"data-constant","type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"property-type":"data-constant","type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"property-type":"data-constant","type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"property-type":"constant"},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"line-border-width":{"type":"number","private":true,"default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","private":true,"default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-image-cross-fade":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"transition":true},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"icon-color-saturation":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-color":{"type":"color","expression":{"interpolated":true,"parameters":["raster-value"]},"property-type":"color-ramp"},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","default":[0,1],"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"raster-array-band":{"type":"string","required":false,"property-type":"data-constant"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d","property-type":"data-constant"},"model-cast-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-receive-shadows":{"type":"boolean","default":true,"expression":{},"property-type":"data-constant"},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant","transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');class Ue{constructor(e,n,i,r){this.message=(e?`${e}: `:"")+i,r&&(this.identifier=r),n!=null&&n.__line__&&(this.line=n.__line__)}}class Cl extends Ue{}function Vs(t,...e){for(let n of e)for(let i in n)t[i]=n[i];return t}function Ti(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function js(t){if(Array.isArray(t))return t.map(js);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){let e={};for(let n in t)e[n]=js(t[n]);return e}return Ti(t)}class vL extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}var fs=vL;class vy{constructor(e,n=[]){this.parent=e,this.bindings={};for(let[i,r]of n)this.bindings[i]=r}concat(e){return new vy(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var xL=vy;let Mc={kind:"null"},ze={kind:"number"},Kt={kind:"string"},an={kind:"boolean"},bo={kind:"color"},Dc={kind:"object"},Qt={kind:"value"},Of={kind:"collator"},cd={kind:"formatted"},ud={kind:"resolvedImage"};function Br(t,e){return{kind:"array",itemType:t,N:e}}function vi(t){if(t.kind==="array"){let e=vi(t.itemType);return typeof t.N=="number"?`array<${e}, ${t.N}>`:t.itemType.kind==="value"?"array":`array<${e}>`}return t.kind}let bL=[Mc,ze,Kt,an,bo,cd,Dc,Br(Qt),ud];function dd(t,e){if(e.kind==="error")return null;if(t.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!dd(t.itemType,e.itemType))&&(typeof t.N!="number"||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if(t.kind==="value"){for(let n of bL)if(!dd(n,e))return null}}return`Expected ${vi(t)} but found ${vi(e)} instead.`}function xy(t,e){return e.some(n=>n.kind===t.kind)}function hd(t,e){return e.some(n=>n==="null"?t===null:n==="array"?Array.isArray(t):n==="object"?t&&!Array.isArray(t)&&typeof t=="object":n===typeof t)}var by,zC={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function Ff(t){return(t=Math.round(t))<0?0:t>255?255:t}function wy(t){return Ff(t[t.length-1]==="%"?parseFloat(t)/100*255:parseInt(t))}function kf(t){return(e=t[t.length-1]==="%"?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function Cy(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{by={}.parseCSSColor=function(t){var e,n=t.replace(/ /g,"").toLowerCase();if(n in zC)return zC[n].slice();if(n[0]==="#")return n.length===4?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:n.length===7&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var i=n.indexOf("("),r=n.indexOf(")");if(i!==-1&&r+1===n.length){var o=n.substr(0,i),l=n.substr(i+1,r-(i+1)).split(","),u=1;switch(o){case"rgba":if(l.length!==4)return null;u=kf(l.pop());case"rgb":return l.length!==3?null:[wy(l[0]),wy(l[1]),wy(l[2]),u];case"hsla":if(l.length!==4)return null;u=kf(l.pop());case"hsl":if(l.length!==3)return null;var h=(parseFloat(l[0])%360+360)%360/360,p=kf(l[1]),m=kf(l[2]),_=m<=.5?m*(p+1):m+p-m*p,y=2*m-_;return[Ff(255*Cy(y,_,h+1/3)),Ff(255*Cy(y,_,h)),Ff(255*Cy(y,_,h-1/3)),u];default:return null}}return null}}catch{}class Vr{constructor(e,n,i,r=1){this.r=e,this.g=n,this.b=i,this.a=r}static parse(e){if(!e)return;if(e instanceof Vr)return e;if(typeof e!="string")return;let n=by(e);return n?new Vr(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){let[e,n,i,r]=this.toArray();return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(i)},${r})`}toArray(){let{r:e,g:n,b:i,a:r}=this;return r===0?[0,0,0,0]:[255*e/r,255*n/r,255*i/r,r]}toArray01(){let{r:e,g:n,b:i,a:r}=this;return r===0?[0,0,0,0]:[e/r,n/r,i/r,r]}toArray01Scaled(e){let{r:n,g:i,b:r,a:o}=this;return o===0?[0,0,0]:[n/o*e,i/o*e,r/o*e]}toArray01PremultipliedAlpha(){let{r:e,g:n,b:i,a:r}=this;return[e,n,i,r]}toArray01Linear(){let{r:e,g:n,b:i,a:r}=this;return r===0?[0,0,0,0]:[Math.pow(e/r,2.2),Math.pow(n/r,2.2),Math.pow(i/r,2.2),r]}}Vr.black=new Vr(0,0,0,1),Vr.white=new Vr(1,1,1,1),Vr.transparent=new Vr(0,0,0,0),Vr.red=new Vr(1,0,0,1),Vr.blue=new Vr(0,0,1,1);var Rt=Vr;class Ey{constructor(e,n,i){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=i,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ty{constructor(e,n,i,r,o){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=i,this.fontStack=r,this.textColor=o}}class jr{constructor(e){this.sections=e}static fromString(e){return new jr([new Ty(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.namePrimary.length!==0)}static factory(e){return e instanceof jr?e:jr.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){let e=["format"];for(let n of this.sections){if(n.image){e.push(["image",n.image.namePrimary]);continue}e.push(n.text);let i={};n.fontStack&&(i["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(i["font-scale"]=n.scale),n.textColor&&(i["text-color"]=["rgba"].concat(n.textColor.toArray())),e.push(i)}return e}}class wo{constructor(e){this.namePrimary=e.namePrimary,e.nameSecondary&&(this.nameSecondary=e.nameSecondary),this.available=e.available}toString(){return this.nameSecondary?`[${this.namePrimary},${this.nameSecondary}]`:this.namePrimary}static fromString(e,n){return e?new wo({namePrimary:e,nameSecondary:n,available:!1}):null}serialize(){return this.nameSecondary?["image",this.namePrimary,this.nameSecondary]:["image",this.namePrimary]}}function BC(t,e,n,i){return typeof t=="number"&&t>=0&&t<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof n=="number"&&n>=0&&n<=255?i===void 0||typeof i=="number"&&i>=0&&i<=1?null:`Invalid rgba value [${[t,e,n,i].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof i=="number"?[t,e,n,i]:[t,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Sc(t){if(t===null||typeof t=="string"||typeof t=="boolean"||typeof t=="number"||t instanceof Rt||t instanceof Ey||t instanceof jr||t instanceof wo)return!0;if(Array.isArray(t)){for(let e of t)if(!Sc(e))return!1;return!0}if(typeof t=="object"){for(let e in t)if(!Sc(t[e]))return!1;return!0}return!1}function Fi(t){if(t===null)return Mc;if(typeof t=="string")return Kt;if(typeof t=="boolean")return an;if(typeof t=="number")return ze;if(t instanceof Rt)return bo;if(t instanceof Ey)return Of;if(t instanceof jr)return cd;if(t instanceof wo)return ud;if(Array.isArray(t)){let e=t.length,n;for(let i of t){let r=Fi(i);if(n){if(n===r)continue;n=Qt;break}n=r}return Br(n||Qt,e)}return Dc}function fd(t){let e=typeof t;return t===null?"":e==="string"||e==="number"||e==="boolean"?String(t):t instanceof Rt||t instanceof jr||t instanceof wo?t.toString():JSON.stringify(t)}class Iy{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(e.length!==2)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Sc(e[1]))return n.error("invalid value");let i=e[1],r=Fi(i),o=n.expectedType;return r.kind!=="array"||r.N!==0||!o||o.kind!=="array"||typeof o.N=="number"&&o.N!==0||(r=o),new Iy(r,i)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Rt?["rgba"].concat(this.value.toArray()):this.value instanceof jr?this.value.serialize():this.value}}var pd=Iy,$i=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};let My={string:Kt,number:ze,boolean:an,object:Dc};class Dy{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let i,r=1,o=e[0];if(o==="array"){let u,h;if(e.length>2){let p=e[1];if(typeof p!="string"||!(p in My)||p==="object")return n.error('The item type argument of "array" must be one of string, number, boolean',1);u=My[p],r++}else u=Qt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);h=e[2],r++}i=Br(u,h)}else i=My[o];let l=[];for(;r<e.length;r++){let u=n.parse(e[r],r,Qt);if(!u)return null;l.push(u)}return new Dy(i,l)}evaluate(e){for(let n=0;n<this.args.length;n++){let i=this.args[n].evaluate(e);if(!dd(this.type,Fi(i)))return i;if(n===this.args.length-1)throw new $i(`Expected value to be of type ${vi(this.type)}, but found ${vi(Fi(i))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=this.type,n=[e.kind];if(e.kind==="array"){let i=e.itemType;if(i.kind==="string"||i.kind==="number"||i.kind==="boolean"){n.push(i.kind);let r=e.N;(typeof r=="number"||this.args.length>1)&&n.push(r)}}return n.concat(this.args.map(i=>i.serialize()))}}var Us=Dy;class md{constructor(e){this.type=cd,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let i=e[1];if(!Array.isArray(i)&&typeof i=="object")return n.error("First argument must be an image or text section.");let r=[],o=!1;for(let l=1;l<=e.length-1;++l){let u=e[l];if(o&&typeof u=="object"&&!Array.isArray(u)){o=!1;let h=null;if(u["font-scale"]&&(h=n.parse(u["font-scale"],1,ze),!h))return null;let p=null;if(u["text-font"]&&(p=n.parse(u["text-font"],1,Br(Kt)),!p))return null;let m=null;if(u["text-color"]&&(m=n.parse(u["text-color"],1,bo),!m))return null;let _=r[r.length-1];_.scale=h,_.font=p,_.textColor=m}else{let h=n.parse(e[l],1,Qt);if(!h)return null;let p=h.type.kind;if(p!=="string"&&p!=="value"&&p!=="null"&&p!=="resolvedImage")return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");o=!0,r.push({content:h,scale:null,font:null,textColor:null})}}return new md(r)}evaluate(e){return new jr(this.sections.map(n=>{let i=n.content.evaluate(e);return Fi(i)===ud?new Ty("",i,null,null,null):new Ty(fd(i),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(let n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){let e=["format"];for(let n of this.sections){e.push(n.content.serialize());let i={};n.scale&&(i["font-scale"]=n.scale.serialize()),n.font&&(i["text-font"]=n.font.serialize()),n.textColor&&(i["text-color"]=n.textColor.serialize()),e.push(i)}return e}}class gd{constructor(e,n){this.type=ud,this.inputPrimary=e,this.inputSecondary=n}static parse(e,n){if(e.length<2)return n.error("Expected two or more arguments.");let i=n.parse(e[1],1,Kt);if(!i)return n.error("No image name provided.");if(e.length===2)return new gd(i);let r=n.parse(e[2],1,Kt);return r?new gd(i,r):n.error("Secondary image variant is not a string.")}evaluate(e){let n=wo.fromString(this.inputPrimary.evaluate(e),this.inputSecondary?this.inputSecondary.evaluate(e):void 0);return n&&e.availableImages&&(n.available=e.availableImages.indexOf(n.namePrimary)>-1,n.nameSecondary&&n.available&&e.availableImages&&(n.available=e.availableImages.indexOf(n.nameSecondary)>-1)),n}eachChild(e){e(this.inputPrimary),this.inputSecondary&&e(this.inputSecondary)}outputDefined(){return!1}serialize(){return this.inputSecondary?["image",this.inputPrimary.serialize(),this.inputSecondary.serialize()]:["image",this.inputPrimary.serialize()]}}function _n(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":t===null?"null":typeof t}let wL={"to-boolean":an,"to-color":bo,"to-number":ze,"to-string":Kt};class Sy{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let i=e[0],r=[],o=Mc;if(i==="to-array"){if(!Array.isArray(e[1]))return null;let l=e[1].length;if(n.expectedType){if(n.expectedType.kind!=="array")return n.error(`Expected ${n.expectedType.kind} but found array.`);o=Br(n.expectedType.itemType,l)}else{if(!(l>0&&Sc(e[1][0])))return null;o=Br(Fi(e[1][0]),l)}for(let u=0;u<l;u++){let h=e[1][u],p;if(_n(h)==="array")p=n.parse(h,void 0,o.itemType);else{let m=_n(h);if(m!==o.itemType.kind)return n.error(`Expected ${o.itemType.kind} but found ${m}.`);p=n.registry.literal.parse(["literal",h===void 0?null:h],n)}if(!p)return null;r.push(p)}}else{if((i==="to-boolean"||i==="to-string")&&e.length!==2)return n.error("Expected one argument.");o=wL[i];for(let l=1;l<e.length;l++){let u=n.parse(e[l],l,Qt);if(!u)return null;r.push(u)}}return new Sy(o,r)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let n,i;for(let r of this.args){if(n=r.evaluate(e),i=null,n instanceof Rt)return n;if(typeof n=="string"){let o=e.parseColor(n);if(o)return o}else if(Array.isArray(n)&&(i=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:BC(n[0],n[1],n[2],n[3]),!i))return new Rt(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new $i(i||`Could not parse color from value '${typeof n=="string"?n:String(JSON.stringify(n))}'`)}if(this.type.kind==="number"){let n=null;for(let i of this.args){if(n=i.evaluate(e),n===null)return 0;let r=Number(n);if(!isNaN(r))return r}throw new $i(`Could not convert ${JSON.stringify(n)} to number.`)}return this.type.kind==="formatted"?jr.fromString(fd(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?wo.fromString(fd(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(n=>n.evaluate(e)):fd(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new md([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new gd(this.args[0]).serialize();let e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}var El=Sy;let CL=["Unknown","Point","LineString","Polygon"];var VC=class{constructor(t){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.options=t}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?CL[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(t){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){let t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:n,y:i}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*e-t[0])+this.featureDistanceData.bearing[1]*(i*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=Rt.parse(t)),e}getConfig(t){return this.options?this.options.get(t):null}};class Tl{constructor(e,n,i,r,o){this.name=e,this.type=n,this._evaluate=i,this.args=r,this._overloadIndex=o}evaluate(e){if(!this._evaluate){let n=Tl.definitions[this.name];this._evaluate=Array.isArray(n)?n[2]:n.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){let i=e[0],r=Tl.definitions[i];if(!r)return n.error(`Unknown expression "${i}". If you wanted a literal array, use ["literal", [...]].`,0);let o=Array.isArray(r)?r[0]:r.type,l=Array.isArray(r)?[[r[1],r[2]]]:r.overloads,u=[],h=null,p=-1;for(let[m,_]of l){if(Array.isArray(m)&&m.length!==e.length-1)continue;u.push(m),p++,h=new iE(n.registry,n.path,null,n.scope,void 0,n.options);let y=[],v=!1;for(let b=1;b<e.length;b++){let w=e[b],C=Array.isArray(m)?m[b-1]:m.type,E=h.parse(w,1+y.length,C);if(!E){v=!0;break}y.push(E)}if(!v)if(Array.isArray(m)&&m.length!==y.length)h.error(`Expected ${m.length} arguments, but found ${y.length} instead.`);else{for(let b=0;b<y.length;b++){let w=Array.isArray(m)?m[b]:m.type,C=y[b];h.concat(b+1).checkSubtype(w,C.type)}if(h.errors.length===0)return new Tl(i,o,_,y,p)}}if(u.length===1)n.errors.push(...h.errors);else{let m=(u.length?u:l.map(([y])=>y)).map(EL).join(" | "),_=[];for(let y=1;y<e.length;y++){let v=n.parse(e[y],1+_.length);if(!v)return null;_.push(vi(v.type))}n.error(`Expected arguments of type ${m}, but found (${_.join(", ")}) instead.`)}return null}static register(e,n){Tl.definitions=n;for(let i in n)e[i]=Tl}}function EL(t){return Array.isArray(t)?`(${t.map(vi).join(", ")})`:`(${vi(t.type)}...)`}var ps=Tl;class Lf{constructor(e,n,i){this.type=Of,this.locale=i,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(e.length!==2)return n.error("Expected one argument.");let i=e[1];if(typeof i!="object"||Array.isArray(i))return n.error("Collator options argument must be an object.");let r=n.parse(i["case-sensitive"]!==void 0&&i["case-sensitive"],1,an);if(!r)return null;let o=n.parse(i["diacritic-sensitive"]!==void 0&&i["diacritic-sensitive"],1,an);if(!o)return null;let l=null;return i.locale&&(l=n.parse(i.locale,1,Kt),!l)?null:new Lf(r,o,l)}evaluate(e){return new Ey(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){let e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}var jC={exports:{}};jC.exports=function(){function t(i,r,o,l,u){for(;l>o;){if(l-o>600){var h=l-o+1,p=r-o+1,m=Math.log(h),_=.5*Math.exp(2*m/3),y=.5*Math.sqrt(m*_*(h-_)/h)*(p-h/2<0?-1:1);t(i,r,Math.max(o,Math.floor(r-p*_/h+y)),Math.min(l,Math.floor(r+(h-p)*_/h+y)),u)}var v=i[r],b=o,w=l;for(e(i,o,r),u(i[l],v)>0&&e(i,o,l);b<w;){for(e(i,b,w),b++,w--;u(i[b],v)<0;)b++;for(;u(i[w],v)>0;)w--}u(i[o],v)===0?e(i,o,w):e(i,++w,l),w<=r&&(o=w+1),r<=w&&(l=w-1)}}function e(i,r,o){var l=i[r];i[r]=i[o],i[o]=l}function n(i,r){return i<r?-1:i>r?1:0}return function(i,r,o,l,u){t(i,r,o||0,l||i.length-1,u||n)}}();var TL=tt(jC.exports);function IL(t){let e=0;for(let n,i,r=0,o=t.length,l=o-1;r<o;l=r++)n=t[r],i=t[l],e+=(i.x-n.x)*(n.y+i.y);return e}function _d(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function yd(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function ML(t,e,n){let i=t[0]-e[0],r=t[1]-e[1],o=t[0]-n[0],l=t[1]-n[1];return i*l-o*r==0&&i*o<=0&&r*l<=0}function Ac(t,e,n=!1){let i=!1;for(let u=0,h=e.length;u<h;u++){let p=e[u];for(let m=0,_=p.length,y=_-1;m<_;y=m++){let v=p[y],b=p[m];if(ML(t,v,b))return n;(o=v)[1]>(r=t)[1]!=(l=b)[1]>r[1]&&r[0]<(l[0]-o[0])*(r[1]-o[1])/(l[1]-o[1])+o[0]&&(i=!i)}}var r,o,l;return i}function UC(t,e,n,i){let r=i[0]-n[0],o=i[1]-n[1],l=(t[0]-n[0])*o-r*(t[1]-n[1]),u=(e[0]-n[0])*o-r*(e[1]-n[1]);return l>0&&u<0||l<0&&u>0}function Nf(t,e,n,i){return(r=[i[0]-n[0],i[1]-n[1]])[0]*(o=[e[0]-t[0],e[1]-t[1]])[1]-r[1]*o[0]!=0&&!(!UC(t,e,n,i)||!UC(n,i,t,e));var r,o}let Ca=8192;function DL(t,e){let n=(180+t[0])/360,i=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,r=Math.pow(2,e.z);return[Math.round(n*r*Ca),Math.round(i*r*Ca)]}function SL(t,e){for(let n=0;n<e.length;n++)if(Ac(t,e[n]))return!0;return!1}function AL(t,e,n){for(let i of n)for(let r=0,o=i.length,l=o-1;r<o;l=r++)if(Nf(t,e,i[l],i[r]))return!0;return!1}function $C(t,e){for(let n=0;n<t.length;++n)if(!Ac(t[n],e))return!1;for(let n=0;n<t.length-1;++n)if(AL(t[n],t[n+1],e))return!1;return!0}function PL(t,e){for(let n=0;n<e.length;n++)if($C(t,e[n]))return!0;return!1}function Ay(t,e,n){let i=[];for(let r=0;r<t.length;r++){let o=[];for(let l=0;l<t[r].length;l++){let u=DL(t[r][l],n);_d(e,u),o.push(u)}i.push(o)}return i}function GC(t,e,n){let i=[];for(let r=0;r<t.length;r++){let o=Ay(t[r],e,n);i.push(o)}return i}function HC(t,e,n,i){if(t[0]<n[0]||t[0]>n[2]){let r=.5*i,o=t[0]-n[0]>r?-i:n[0]-t[0]>r?i:0;o===0&&(o=t[0]-n[2]>r?-i:n[2]-t[0]>r?i:0),t[0]+=o}_d(e,t)}function qC(t,e,n,i){let r=Math.pow(2,i.z)*Ca,o=[i.x*Ca,i.y*Ca],l=[];if(!t)return l;for(let u of t)for(let h of u){let p=[h.x+o[0],h.y+o[1]];HC(p,e,n,r),l.push(p)}return l}function WC(t,e,n,i){let r=Math.pow(2,i.z)*Ca,o=[i.x*Ca,i.y*Ca],l=[];if(!t)return l;for(let h of t){let p=[];for(let m of h){let _=[m.x+o[0],m.y+o[1]];_d(e,_),p.push(_)}l.push(p)}if(e[2]-e[0]<=r/2){(u=e)[0]=u[1]=1/0,u[2]=u[3]=-1/0;for(let h of l)for(let p of h)HC(p,e,n,r)}var u;return l}class vd{constructor(e,n){this.type=an,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Sc(e[1])){let i=e[1];if(i.type==="FeatureCollection")for(let r=0;r<i.features.length;++r){let o=i.features[r].geometry.type;if(o==="Polygon"||o==="MultiPolygon")return new vd(i,i.features[r].geometry)}else if(i.type==="Feature"){let r=i.geometry.type;if(r==="Polygon"||r==="MultiPolygon")return new vd(i,i.geometry)}else if(i.type==="Polygon"||i.type==="MultiPolygon")return new vd(i,i)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(n,i){let r=[1/0,1/0,-1/0,-1/0],o=[1/0,1/0,-1/0,-1/0],l=n.canonicalID();if(!l)return!1;if(i.type==="Polygon"){let u=Ay(i.coordinates,o,l),h=qC(n.geometry(),r,o,l);if(!yd(r,o))return!1;for(let p of h)if(!Ac(p,u))return!1}if(i.type==="MultiPolygon"){let u=GC(i.coordinates,o,l),h=qC(n.geometry(),r,o,l);if(!yd(r,o))return!1;for(let p of h)if(!SL(p,u))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(n,i){let r=[1/0,1/0,-1/0,-1/0],o=[1/0,1/0,-1/0,-1/0],l=n.canonicalID();if(!l)return!1;if(i.type==="Polygon"){let u=Ay(i.coordinates,o,l),h=WC(n.geometry(),r,o,l);if(!yd(r,o))return!1;for(let p of h)if(!$C(p,u))return!1}if(i.type==="MultiPolygon"){let u=GC(i.coordinates,o,l),h=WC(n.geometry(),r,o,l);if(!yd(r,o))return!1;for(let p of h)if(!PL(p,u))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Py=vd,ZC={exports:{}};ZC.exports=function(){var t={kilometers:1,miles:.621371192237334,nauticalmiles:.5399568034557235,meters:1e3,metres:1e3,yards:1093.6132983377079,feet:3280.839895013123,inches:39370.078740157485},e=1/298.257223563,n=e*(2-e),i=Math.PI/180,r=function(p,m){if(p===void 0)throw new Error("No latitude given.");if(m&&!t[m])throw new Error("Unknown unit "+m+". Use one of: "+Object.keys(t).join(", "));var _=6378.137*i*(m?t[m]:1),y=Math.cos(p*i),v=1/(1-n*(1-y*y)),b=Math.sqrt(v);this.kx=_*b*y,this.ky=_*b*v*(1-n)},o={units:{configurable:!0}};function l(p,m){return p[0]===m[0]&&p[1]===m[1]}function u(p,m,_){var y=h(m[0]-p[0]);return[p[0]+y*_,p[1]+(m[1]-p[1])*_]}function h(p){for(;p<-180;)p+=360;for(;p>180;)p-=360;return p}return r.fromTile=function(p,m,_){var y=Math.PI*(1-2*(p+.5)/Math.pow(2,m)),v=Math.atan(.5*(Math.exp(y)-Math.exp(-y)))/i;return new r(v,_)},o.units.get=function(){return t},r.prototype.distance=function(p,m){var _=h(p[0]-m[0])*this.kx,y=(p[1]-m[1])*this.ky;return Math.sqrt(_*_+y*y)},r.prototype.bearing=function(p,m){var _=h(m[0]-p[0])*this.kx;return Math.atan2(_,(m[1]-p[1])*this.ky)/i},r.prototype.destination=function(p,m,_){var y=_*i;return this.offset(p,Math.sin(y)*m,Math.cos(y)*m)},r.prototype.offset=function(p,m,_){return[p[0]+m/this.kx,p[1]+_/this.ky]},r.prototype.lineDistance=function(p){for(var m=0,_=0;_<p.length-1;_++)m+=this.distance(p[_],p[_+1]);return m},r.prototype.area=function(p){for(var m=0,_=0;_<p.length;_++)for(var y=p[_],v=0,b=y.length,w=b-1;v<b;w=v++)m+=h(y[v][0]-y[w][0])*(y[v][1]+y[w][1])*(_?-1:1);return Math.abs(m)/2*this.kx*this.ky},r.prototype.along=function(p,m){var _=0;if(m<=0)return p[0];for(var y=0;y<p.length-1;y++){var v=p[y],b=p[y+1],w=this.distance(v,b);if((_+=w)>m)return u(v,b,(m-(_-w))/w)}return p[p.length-1]},r.prototype.pointToSegmentDistance=function(p,m,_){var y=m[0],v=m[1],b=h(_[0]-y)*this.kx,w=(_[1]-v)*this.ky,C=0;return b===0&&w===0||((C=(h(p[0]-y)*this.kx*b+(p[1]-v)*this.ky*w)/(b*b+w*w))>1?(y=_[0],v=_[1]):C>0&&(y+=b/this.kx*C,v+=w/this.ky*C)),b=h(p[0]-y)*this.kx,w=(p[1]-v)*this.ky,Math.sqrt(b*b+w*w)},r.prototype.pointOnLine=function(p,m){for(var _,y,v,b,w=1/0,C=0;C<p.length-1;C++){var E=p[C][0],I=p[C][1],D=h(p[C+1][0]-E)*this.kx,S=(p[C+1][1]-I)*this.ky,M=0;D===0&&S===0||((M=(h(m[0]-E)*this.kx*D+(m[1]-I)*this.ky*S)/(D*D+S*S))>1?(E=p[C+1][0],I=p[C+1][1]):M>0&&(E+=D/this.kx*M,I+=S/this.ky*M));var A=(D=h(m[0]-E)*this.kx)*D+(S=(m[1]-I)*this.ky)*S;A<w&&(w=A,_=E,y=I,v=C,b=M)}return{point:[_,y],index:v,t:Math.max(0,Math.min(1,b))}},r.prototype.lineSlice=function(p,m,_){var y=this.pointOnLine(_,p),v=this.pointOnLine(_,m);if(y.index>v.index||y.index===v.index&&y.t>v.t){var b=y;y=v,v=b}var w=[y.point],C=y.index+1,E=v.index;!l(_[C],w[0])&&C<=E&&w.push(_[C]);for(var I=C+1;I<=E;I++)w.push(_[I]);return l(_[E],v.point)||w.push(v.point),w},r.prototype.lineSliceAlong=function(p,m,_){for(var y=0,v=[],b=0;b<_.length-1;b++){var w=_[b],C=_[b+1],E=this.distance(w,C);if((y+=E)>p&&v.length===0&&v.push(u(w,C,(p-(y-E))/E)),y>=m)return v.push(u(w,C,(m-(y-E))/E)),v;y>p&&v.push(C)}return v},r.prototype.bufferPoint=function(p,m){var _=m/this.ky,y=m/this.kx;return[p[0]-y,p[1]-_,p[0]+y,p[1]+_]},r.prototype.bufferBBox=function(p,m){var _=m/this.ky,y=m/this.kx;return[p[0]-y,p[1]-_,p[2]+y,p[3]+_]},r.prototype.insideBBox=function(p,m){return h(p[0]-m[0])>=0&&h(p[0]-m[2])<=0&&p[1]>=m[1]&&p[1]<=m[3]},Object.defineProperties(r,o),r}();var Ry=tt(ZC.exports),XC={exports:{}};XC.exports=function(){var t=function(n,i){if(n===void 0&&(n=[]),i===void 0&&(i=e),this.data=n,this.length=this.data.length,this.compare=i,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r)};function e(n,i){return n<i?-1:n>i?1:0}return t.prototype.push=function(n){this.data.push(n),this.length++,this._up(this.length-1)},t.prototype.pop=function(){if(this.length!==0){var n=this.data[0],i=this.data.pop();return this.length--,this.length>0&&(this.data[0]=i,this._down(0)),n}},t.prototype.peek=function(){return this.data[0]},t.prototype._up=function(n){for(var i=this.data,r=this.compare,o=i[n];n>0;){var l=n-1>>1,u=i[l];if(r(o,u)>=0)break;i[n]=u,n=l}i[n]=o},t.prototype._down=function(n){for(var i=this.data,r=this.compare,o=this.length>>1,l=i[n];n<o;){var u=1+(n<<1),h=i[u],p=u+1;if(p<this.length&&r(i[p],h)<0&&(u=p,h=i[p]),r(h,l)>=0)break;i[n]=h,n=u}i[n]=l},t}();var Oy=tt(XC.exports),le=8192;function YC(t,e){return e.dist-t.dist}let Fy=100,ky=50;function KC(t){let e=[1/0,1/0,-1/0,-1/0];if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function zf(t){return t[1]-t[0]+1}function $s(t,e){let n=t[1]>=t[0]&&t[1]<e;return n||console.warn("Distance Expression: Index is out of range"),n}function Ly(t,e){if(t[0]>t[1])return[null,null];let n=zf(t);if(e){if(n===2)return[t,null];let i=Math.floor(n/2);return[[t[0],t[0]+i],[t[0]+i,t[1]]]}{if(n===1)return[t,null];let i=Math.floor(n/2)-1;return[[t[0],t[0]+i],[t[0]+i+1,t[1]]]}}function Il(t,e){let n=[1/0,1/0,-1/0,-1/0];if(!$s(e,t.length))return n;for(let i=e[0];i<=e[1];++i)_d(n,t[i]);return n}function Bf(t){let e=[1/0,1/0,-1/0,-1/0];for(let n=0;n<t.length;++n)for(let i=0;i<t[n].length;++i)_d(e,t[n][i]);return e}function Pc(t,e,n){if(KC(t)||KC(e))return NaN;let i=0,r=0;return t[2]<e[0]&&(i=e[0]-t[2]),t[0]>e[2]&&(i=t[0]-e[2]),t[1]>e[3]&&(r=t[1]-e[3]),t[3]<e[1]&&(r=e[1]-t[3]),n.distance([0,0],[i,r])}function Ny(t,e){let n=Math.pow(2,e.z);return[(r=(t.x/le+e.x)/n,360*r-180),(i=(t.y/le+e.y)/n,360/Math.PI*Math.atan(Math.exp((180-360*i)*Math.PI/180))-90)];var i,r}function RL(t,e){let n=[];for(let i=0;i<t.length;++i)n.push(Ny(t[i],e));return n}function JC(t,e,n){let i=n.pointOnLine(e,t).point;return n.distance(t,i)}function QC(t,e,n,i,r){let o=n.slice(i[0],i[1]+1),l=1/0;for(let u=e[0];u<=e[1];++u)if((l=Math.min(l,JC(t[u],o,r)))===0)return 0;return l}function zy(t,e,n,i,r){let o=Math.min(r.pointToSegmentDistance(t,n,i),r.pointToSegmentDistance(e,n,i)),l=Math.min(r.pointToSegmentDistance(n,t,e),r.pointToSegmentDistance(i,t,e));return Math.min(o,l)}function OL(t,e,n,i,r){if(!$s(e,t.length)||!$s(i,n.length))return NaN;let o=1/0;for(let l=e[0];l<e[1];++l)for(let u=i[0];u<i[1];++u){if(Nf(t[l],t[l+1],n[u],n[u+1]))return 0;o=Math.min(o,zy(t[l],t[l+1],n[u],n[u+1],r))}return o}function FL(t,e,n,i,r){if(!$s(e,t.length)||!$s(i,n.length))return NaN;let o=1/0;for(let l=e[0];l<=e[1];++l)for(let u=i[0];u<=i[1];++u)if((o=Math.min(o,r.distance(t[l],n[u])))===0)return o;return o}function kL(t,e,n){if(Ac(t,e,!0))return 0;let i=1/0;for(let r of e){let o=r.length;if(o<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(r[0]!==r[o-1]&&(i=Math.min(i,n.pointToSegmentDistance(t,r[o-1],r[0])))===0||(i=Math.min(i,JC(t,r,n)))===0)return i}return i}function LL(t,e,n,i){if(!$s(e,t.length))return NaN;for(let o=e[0];o<=e[1];++o)if(Ac(t[o],n,!0))return 0;let r=1/0;for(let o=e[0];o<e[1];++o)for(let l of n)for(let u=0,h=l.length,p=h-1;u<h;p=u++){if(Nf(t[o],t[o+1],l[p],l[u]))return 0;r=Math.min(r,zy(t[o],t[o+1],l[p],l[u],i))}return r}function eE(t,e){for(let n of t)for(let i=0;i<=n.length-1;++i)if(Ac(n[i],e,!0))return!0;return!1}function NL(t,e,n,i=1/0){let r=Bf(t),o=Bf(e);if(i!==1/0&&Pc(r,o,n)>=i)return i;if(yd(r,o)){if(eE(t,e))return 0}else if(eE(e,t))return 0;let l=i;for(let u of t)for(let h=0,p=u.length,m=p-1;h<p;m=h++)for(let _ of e)for(let y=0,v=_.length,b=v-1;y<v;b=y++){if(Nf(u[m],u[h],_[b],_[y]))return 0;l=Math.min(l,zy(u[m],u[h],_[b],_[y],n))}return l}function Vf(t,e,n,i,r,o,l){if(o===null||l===null)return;let u=Pc(Il(i,o),Il(r,l),n);u<e&&t.push({dist:u,range1:o,range2:l})}function zL(t,e,n,i,r=1/0){let o=Math.min(i.distance(t[0],n[0][0]),r);if(o===0)return o;let l=new Oy([{dist:0,range1:[0,t.length-1],range2:[0,0]}],YC),u=e?ky:Fy,h=Bf(n);for(;l.length;){let p=l.pop();if(p.dist>=o)continue;let m=p.range1;if(zf(m)<=u){if(!$s(m,t.length))return NaN;if(e){let _=LL(t,m,n,i);if((o=Math.min(o,_))===0)return o}else for(let _=m[0];_<=m[1];++_){let y=kL(t[_],n,i);if((o=Math.min(o,y))===0)return o}}else{let _=Ly(m,e);if(_[0]!==null){let y=Pc(Il(t,_[0]),h,i);y<o&&l.push({dist:y,range1:_[0],range2:[0,0]})}if(_[1]!==null){let y=Pc(Il(t,_[1]),h,i);y<o&&l.push({dist:y,range1:_[1],range2:[0,0]})}}}return o}function tE(t,e,n,i,r,o=1/0){let l=Math.min(o,r.distance(t[0],n[0]));if(l===0)return l;let u=new Oy([{dist:0,range1:[0,t.length-1],range2:[0,n.length-1]}],YC),h=e?ky:Fy,p=i?ky:Fy;for(;u.length;){let m=u.pop();if(m.dist>=l)continue;let _=m.range1,y=m.range2;if(zf(_)<=h&&zf(y)<=p){if(!$s(_,t.length)||!$s(y,n.length))return NaN;if(e&&i?l=Math.min(l,OL(t,_,n,y,r)):e||i?e&&!i?l=Math.min(l,QC(n,y,t,_,r)):!e&&i&&(l=Math.min(l,QC(t,_,n,y,r))):l=Math.min(l,FL(t,_,n,y,r)),l===0)return l}else{let v=Ly(_,e),b=Ly(y,i);Vf(u,l,r,t,n,v[0],b[0]),Vf(u,l,r,t,n,v[0],b[1]),Vf(u,l,r,t,n,v[1],b[0]),Vf(u,l,r,t,n,v[1],b[1])}}return l}function By(t,e,n,i,r=1/0){let o=r,l=Il(t,[0,t.length-1]);for(let u of n)if(!(o!==1/0&&Pc(l,Il(u,[0,u.length-1]),i)>=o)&&(o=Math.min(o,tE(t,e,u,!0,i,o)),o===0))return o;return o}function jf(t,e,n,i,r=1/0){let o=r,l=Il(t,[0,t.length-1]);for(let u of n){if(o!==1/0&&Pc(l,Bf(u),i)>=o)continue;let h=zL(t,e,u,i,o);if(isNaN(h))return h;if((o=Math.min(o,h))===0)return o}return o}function Vy(t){return t==="Point"||t==="MultiPoint"||t==="LineString"||t==="MultiLineString"||t==="Polygon"||t==="MultiPolygon"}class xd{constructor(e,n){this.type=ze,this.geojson=e,this.geometries=n}static parse(e,n){if(e.length!==2)return n.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(Sc(e[1])){let i=e[1];if(i.type==="FeatureCollection"){for(let r=0;r<i.features.length;++r)if(Vy(i.features[r].geometry.type))return new xd(i,i.features[r].geometry)}else if(i.type==="Feature"){if(Vy(i.geometry.type))return new xd(i,i.geometry)}else if(Vy(i.type))return new xd(i,i)}return n.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){let n=e.geometry(),i=e.canonicalID();if(n!=null&&i!=null){if(e.geometryType()==="Point")return function(r,o,l){let u=[];for(let p of r)for(let m of p)u.push(Ny(m,o));let h=new Ry(u[0][1],"meters");return l.type==="Point"||l.type==="MultiPoint"||l.type==="LineString"?tE(u,!1,l.type==="Point"?[l.coordinates]:l.coordinates,l.type==="LineString",h):l.type==="MultiLineString"?By(u,!1,l.coordinates,h):l.type==="Polygon"||l.type==="MultiPolygon"?jf(u,!1,l.type==="Polygon"?[l.coordinates]:l.coordinates,h):null}(n,i,this.geometries);if(e.geometryType()==="LineString")return function(r,o,l){let u=[];for(let p of r){let m=[];for(let _ of p)m.push(Ny(_,o));u.push(m)}let h=new Ry(u[0][0][1],"meters");if(l.type==="Point"||l.type==="MultiPoint"||l.type==="LineString")return By(l.type==="Point"?[l.coordinates]:l.coordinates,l.type==="LineString",u,h);if(l.type==="MultiLineString"){let p=1/0;for(let m=0;m<l.coordinates.length;m++){let _=By(l.coordinates[m],!0,u,h,p);if(isNaN(_))return _;if((p=Math.min(p,_))===0)return p}return p}if(l.type==="Polygon"||l.type==="MultiPolygon"){let p=1/0;for(let m=0;m<u.length;m++){let _=jf(u[m],!0,l.type==="Polygon"?[l.coordinates]:l.coordinates,h,p);if(isNaN(_))return _;if((p=Math.min(p,_))===0)return p}return p}return null}(n,i,this.geometries);if(e.geometryType()==="Polygon")return function(r,o,l){let u=[];for(let p of function(m,_){let y=m.length;if(y<=1)return[m];let v=[],b,w;for(let C=0;C<y;C++){let E=IL(m[C]);E!==0&&(m[C].area=Math.abs(E),w===void 0&&(w=E<0),w===E<0?(b&&v.push(b),b=[m[C]]):b.push(m[C]))}return b&&v.push(b),v}(r)){let m=[];for(let _=0;_<p.length;++_)m.push(RL(p[_],o));u.push(m)}let h=new Ry(u[0][0][0][1],"meters");if(l.type==="Point"||l.type==="MultiPoint"||l.type==="LineString")return jf(l.type==="Point"?[l.coordinates]:l.coordinates,l.type==="LineString",u,h);if(l.type==="MultiLineString"){let p=1/0;for(let m=0;m<l.coordinates.length;m++){let _=jf(l.coordinates[m],!0,u,h,p);if(isNaN(_))return _;if((p=Math.min(p,_))===0)return p}return p}return l.type==="Polygon"||l.type==="MultiPolygon"?function(p,m,_){let y=1/0;for(let v of p)for(let b of m){let w=NL(v,b,_,y);if(isNaN(w))return w;if((y=Math.min(y,w))===0)return y}return y}(l.type==="Polygon"?[l.coordinates]:l.coordinates,u,h):null}(n,i,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}var jy=xd;function Rc(t){if(t instanceof ps&&(t.name==="get"&&t.args.length===1||t.name==="feature-state"||t.name==="has"&&t.args.length===1||t.name==="properties"||t.name==="geometry-type"||t.name==="id"||/^filter-/.test(t.name))||t instanceof Py||t instanceof jy)return!1;let e=!0;return t.eachChild(n=>{e&&!Rc(n)&&(e=!1)}),e}function bd(t){if(t instanceof ps&&t.name==="feature-state")return!1;let e=!0;return t.eachChild(n=>{e&&!bd(n)&&(e=!1)}),e}function Uy(t){if(t instanceof ps&&t.name==="config")return!1;let e=!0;return t.eachChild(n=>{e&&!Uy(n)&&(e=!1)}),e}function Oc(t,e){if(t instanceof ps&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild(i=>{n&&!Oc(i,e)&&(n=!1)}),n}class $y{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(e.length!==2||typeof e[1]!="string")return n.error("'var' expression requires exactly one string literal argument.");let i=e[1];return n.scope.has(i)?new $y(i,n.scope.get(i)):n.error(`Unknown variable "${i}". Make sure "${i}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var nE=$y;class Gy{constructor(e,n=[],i,r=new xL,o=[],l){this.registry=e,this.path=n,this.key=n.map(u=>`[${u}]`).join(""),this.scope=r,this.errors=o,this.expectedType=i,this.options=l}parse(e,n,i,r,o={}){return n||i?this.concat(n,i,r)._parse(e,o):this._parse(e,o)}_parse(e,n){function i(r,o,l){return l==="assert"?new Us(o,[r]):l==="coerce"?new El(o,[r]):r}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');let r=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(r){let o=r.parse(e,this);if(!o)return null;if(this.expectedType){let l=this.expectedType,u=o.type;if(l.kind!=="string"&&l.kind!=="number"&&l.kind!=="boolean"&&l.kind!=="object"&&l.kind!=="array"||u.kind!=="value")if(l.kind!=="color"&&l.kind!=="formatted"&&l.kind!=="resolvedImage"||u.kind!=="value"&&u.kind!=="string"){if(this.checkSubtype(l,u))return null}else o=i(o,l,n.typeAnnotation||"coerce");else o=i(o,l,n.typeAnnotation||"assert")}if(!(o instanceof pd)&&o.type.kind!=="resolvedImage"&&Hy(o)){let l=new VC(this.options);try{o=new pd(o.type,o.evaluate(l))}catch(u){return this.error(u.message),null}}return o}return El.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,i){let r=typeof e=="number"?this.path.concat(e):this.path,o=i?this.scope.concat(i):this.scope;return new Gy(this.registry,r,n||null,o,this.errors,this.options)}error(e,...n){let i=`${this.key}${n.map(r=>`[${r}]`).join("")}`;this.errors.push(new fs(i,e))}checkSubtype(e,n){let i=dd(e,n);return i&&this.error(i),i}}var iE=Gy;function Hy(t){if(t instanceof nE)return Hy(t.boundExpression);if(t instanceof ps&&t.name==="error"||t instanceof ps&&t.name==="config"||t instanceof Lf||t instanceof Py||t instanceof jy)return!1;let e=t instanceof El||t instanceof Us,n=!0;return t.eachChild(i=>{n=e?n&&Hy(i):n&&i instanceof pd}),!!n&&Rc(t)&&Oc(t,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light"])}function Uf(t,e){let n=t.length-1,i,r,o=0,l=n,u=0;for(;o<=l;)if(u=Math.floor((o+l)/2),i=t[u],r=t[u+1],i<=e){if(u===n||e<r)return u;o=u+1}else{if(!(i>e))throw new $i("Input is not a number.");l=u-1}return 0}class qy{constructor(e,n,i){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(let[r,o]of i)this.labels.push(r),this.outputs.push(o)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");let i=n.parse(e[1],1,ze);if(!i)return null;let r=[],o=null;n.expectedType&&n.expectedType.kind!=="value"&&(o=n.expectedType);for(let l=1;l<e.length;l+=2){let u=l===1?-1/0:e[l],h=e[l+1],p=l,m=l+1;if(typeof u!="number")return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',p);if(r.length&&r[r.length-1][0]>=u)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',p);let _=n.parse(h,m,o);if(!_)return null;o=o||_.type,r.push([u,_])}return new qy(o,i,r)}evaluate(e){let n=this.labels,i=this.outputs;if(n.length===1)return i[0].evaluate(e);let r=this.input.evaluate(e);if(r<=n[0])return i[0].evaluate(e);let o=n.length;return r>=n[o-1]?i[o-1].evaluate(e):i[Uf(n,r)].evaluate(e)}eachChild(e){e(this.input);for(let n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}var Wy=qy;function ft(t,e,n){return t*(1-n)+e*n}function rE(t,e,n){return t.map((i,r)=>ft(i,e[r],n))}var $f=Object.freeze({__proto__:null,array:rE,color:function(t,e,n){return new Rt(ft(t.r,e.r,n),ft(t.g,e.g,n),ft(t.b,e.b,n),ft(t.a,e.a,n))},number:ft});let oE=.95047,sE=1.08883,aE=4/29,Fc=6/29,lE=3*Fc*Fc,BL=Fc*Fc*Fc,VL=Math.PI/180,jL=180/Math.PI;function Zy(t){return t>BL?Math.pow(t,1/3):t/lE+aE}function Xy(t){return t>Fc?t*t*t:lE*(t-aE)}function Yy(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Ky(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function cE(t){let e=Ky(t.r),n=Ky(t.g),i=Ky(t.b),r=Zy((.4124564*e+.3575761*n+.1804375*i)/oE),o=Zy((.2126729*e+.7151522*n+.072175*i)/1);return{l:116*o-16,a:500*(r-o),b:200*(o-Zy((.0193339*e+.119192*n+.9503041*i)/sE)),alpha:t.a}}function uE(t){let e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,i=isNaN(t.b)?e:e-t.b/200;return e=1*Xy(e),n=oE*Xy(n),i=sE*Xy(i),new Rt(Yy(3.2404542*n-1.5371385*e-.4985314*i),Yy(-.969266*n+1.8760108*e+.041556*i),Yy(.0556434*n-.2040259*e+1.0572252*i),t.alpha)}function UL(t,e,n){let i=e-t;return t+n*(i>180||i<-180?i-360*Math.round(i/360):i)}let wd={forward:cE,reverse:uE,interpolate:function(t,e,n){return{l:ft(t.l,e.l,n),a:ft(t.a,e.a,n),b:ft(t.b,e.b,n),alpha:ft(t.alpha,e.alpha,n)}}},Cd={forward:function(t){let{l:e,a:n,b:i}=cE(t),r=Math.atan2(i,n)*jL;return{h:r<0?r+360:r,c:Math.sqrt(n*n+i*i),l:e,alpha:t.a}},reverse:function(t){let e=t.h*VL,n=t.c;return uE({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:UL(t.h,e.h,n),c:ft(t.c,e.c,n),l:ft(t.l,e.l,n),alpha:ft(t.alpha,e.alpha,n)}}};var dE=Object.freeze({__proto__:null,hcl:Cd,lab:wd});class Gf{constructor(e,n,i,r,o){this.type=e,this.operator=n,this.interpolation=i,this.input=r,this.labels=[],this.outputs=[];for(let[l,u]of o)this.labels.push(l),this.outputs.push(u)}static interpolationFactor(e,n,i,r){let o=0;if(e.name==="exponential")o=Jy(n,e.base,i,r);else if(e.name==="linear")o=Jy(n,1,i,r);else if(e.name==="cubic-bezier"){let l=e.controlPoints;o=new bn(l[0],l[1],l[2],l[3]).solve(Jy(n,1,i,r))}return o}static parse(e,n){let[i,r,o,...l]=e;if(!Array.isArray(r)||r.length===0)return n.error("Expected an interpolation type expression.",1);if(r[0]==="linear")r={name:"linear"};else if(r[0]==="exponential"){let p=r[1];if(typeof p!="number")return n.error("Exponential interpolation requires a numeric base.",1,1);r={name:"exponential",base:p}}else{if(r[0]!=="cubic-bezier")return n.error(`Unknown interpolation type ${String(r[0])}`,1,0);{let p=r.slice(1);if(p.length!==4||p.some(m=>typeof m!="number"||m<0||m>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);r={name:"cubic-bezier",controlPoints:p}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(o=n.parse(o,2,ze),!o)return null;let u=[],h=null;i==="interpolate-hcl"||i==="interpolate-lab"?h=bo:n.expectedType&&n.expectedType.kind!=="value"&&(h=n.expectedType);for(let p=0;p<l.length;p+=2){let m=l[p],_=l[p+1],y=p+3,v=p+4;if(typeof m!="number")return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',y);if(u.length&&u[u.length-1][0]>=m)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',y);let b=n.parse(_,v,h);if(!b)return null;h=h||b.type,u.push([m,b])}return h.kind==="number"||h.kind==="color"||h.kind==="array"&&h.itemType.kind==="number"&&typeof h.N=="number"?new Gf(h,i,r,o,u):n.error(`Type ${vi(h)} is not interpolatable.`)}evaluate(e){let n=this.labels,i=this.outputs;if(n.length===1)return i[0].evaluate(e);let r=this.input.evaluate(e);if(r<=n[0])return i[0].evaluate(e);let o=n.length;if(r>=n[o-1])return i[o-1].evaluate(e);let l=Uf(n,r),u=Gf.interpolationFactor(this.interpolation,r,n[l],n[l+1]),h=i[l].evaluate(e),p=i[l+1].evaluate(e);return this.operator==="interpolate"?$f[this.type.kind.toLowerCase()](h,p,u):this.operator==="interpolate-hcl"?Cd.reverse(Cd.interpolate(Cd.forward(h),Cd.forward(p),u)):wd.reverse(wd.interpolate(wd.forward(h),wd.forward(p),u))}eachChild(e){e(this.input);for(let n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);let n=[this.operator,e,this.input.serialize()];for(let i=0;i<this.labels.length;i++)n.push(this.labels[i],this.outputs[i].serialize());return n}}function Jy(t,e,n,i){let r=i-n,o=t-n;return r===0?0:e===1?o/r:(Math.pow(e,o)-1)/(Math.pow(e,r)-1)}var ms=Gf;class Qy{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let i=null,r=n.expectedType;r&&r.kind!=="value"&&(i=r);let o=[];for(let u of e.slice(1)){let h=n.parse(u,1+o.length,i,void 0,{typeAnnotation:"omit"});if(!h)return null;i=i||h.type,o.push(h)}let l=r&&o.some(u=>dd(r,u.type));return new Qy(l?Qt:i,o)}evaluate(e){let n,i=null,r=0;for(let o of this.args){if(r++,i=o.evaluate(e),i&&i instanceof wo&&!i.available&&(n||(n=i),i=null,r===this.args.length))return n;if(i!==null)break}return i}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){let e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var hE=Qy;class e0{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(let n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);let i=[];for(let o=1;o<e.length-1;o+=2){let l=e[o];if(typeof l!="string")return n.error(`Expected string, but found ${typeof l} instead.`,o);if(/[^a-zA-Z0-9_]/.test(l))return n.error("Variable names must contain only alphanumeric characters or '_'.",o);let u=n.parse(e[o+1],o+1);if(!u)return null;i.push([l,u])}let r=n.parse(e[e.length-1],e.length-1,n.expectedType,i);return r?new e0(i,r):null}outputDefined(){return this.result.outputDefined()}serialize(){let e=["let"];for(let[n,i]of this.bindings)e.push(n,i.serialize());return e.push(this.result.serialize()),e}}var fE=e0;class t0{constructor(e,n,i){this.type=e,this.index=n,this.input=i}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let i=n.parse(e[1],1,ze),r=n.parse(e[2],2,Br(n.expectedType||Qt));return i&&r?new t0(r.type.itemType,i,r):null}evaluate(e){let n=this.index.evaluate(e),i=this.input.evaluate(e);if(n<0)throw new $i(`Array index out of bounds: ${n} < 0.`);if(n>=i.length)throw new $i(`Array index out of bounds: ${n} > ${i.length-1}.`);if(n!==Math.floor(n))throw new $i(`Array index must be an integer, but found ${n} instead.`);return i[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var $L=t0;class n0{constructor(e,n){this.type=an,this.needle=e,this.haystack=n}static parse(e,n){if(e.length!==3)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);let i=n.parse(e[1],1,Qt),r=n.parse(e[2],2,Qt);return i&&r?xy(i.type,[an,Kt,ze,Mc,Qt])?new n0(i,r):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${vi(i.type)} instead`):null}evaluate(e){let n=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(i==null)return!1;if(!hd(n,["boolean","string","number","null"]))throw new $i(`Expected first argument to be of type boolean, string, number or null, but found ${vi(Fi(n))} instead.`);if(!hd(i,["string","array"]))throw new $i(`Expected second argument to be of type array or string, but found ${vi(Fi(i))} instead.`);return i.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var GL=n0;class Hf{constructor(e,n,i){this.type=ze,this.needle=e,this.haystack=n,this.fromIndex=i}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let i=n.parse(e[1],1,Qt),r=n.parse(e[2],2,Qt);if(!i||!r)return null;if(!xy(i.type,[an,Kt,ze,Mc,Qt]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${vi(i.type)} instead`);if(e.length===4){let o=n.parse(e[3],3,ze);return o?new Hf(i,r,o):null}return new Hf(i,r)}evaluate(e){let n=this.needle.evaluate(e),i=this.haystack.evaluate(e);if(!hd(n,["boolean","string","number","null"]))throw new $i(`Expected first argument to be of type boolean, string, number or null, but found ${vi(Fi(n))} instead.`);if(!hd(i,["string","array"]))throw new $i(`Expected second argument to be of type array or string, but found ${vi(Fi(i))} instead.`);if(this.fromIndex){let r=this.fromIndex.evaluate(e);return i.indexOf(n,r)}return i.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){let e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var HL=Hf;class i0{constructor(e,n,i,r,o,l){this.inputType=e,this.type=n,this.input=i,this.cases=r,this.outputs=o,this.otherwise=l}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let i,r;n.expectedType&&n.expectedType.kind!=="value"&&(r=n.expectedType);let o={},l=[];for(let p=2;p<e.length-1;p+=2){let m=e[p],_=e[p+1];Array.isArray(m)||(m=[m]);let y=n.concat(p);if(m.length===0)return y.error("Expected at least one branch label.");for(let b of m){if(typeof b!="number"&&typeof b!="string")return y.error("Branch labels must be numbers or strings.");if(typeof b=="number"&&Math.abs(b)>Number.MAX_SAFE_INTEGER)return y.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof b=="number"&&Math.floor(b)!==b)return y.error("Numeric branch labels must be integer values.");if(i){if(y.checkSubtype(i,Fi(b)))return null}else i=Fi(b);if(o[String(b)]!==void 0)return y.error("Branch labels must be unique.");o[String(b)]=l.length}let v=n.parse(_,p,r);if(!v)return null;r=r||v.type,l.push(v)}let u=n.parse(e[1],1,Qt);if(!u)return null;let h=n.parse(e[e.length-1],e.length-1,r);return h?u.type.kind!=="value"&&n.concat(1).checkSubtype(i,u.type)?null:new i0(i,r,u,o,l,h):null}evaluate(e){let n=this.input.evaluate(e);return(Fi(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),i=[],r={};for(let l of n){let u=r[this.cases[l]];u===void 0?(r[this.cases[l]]=i.length,i.push([this.cases[l],[l]])):i[u][1].push(l)}let o=l=>this.inputType.kind==="number"?Number(l):l;for(let[l,u]of i)e.push(u.length===1?o(u[0]):u.map(o)),e.push(this.outputs[l].serialize());return e.push(this.otherwise.serialize()),e}}var qL=i0;class r0{constructor(e,n,i){this.type=e,this.branches=n,this.otherwise=i}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let i;n.expectedType&&n.expectedType.kind!=="value"&&(i=n.expectedType);let r=[];for(let l=1;l<e.length-1;l+=2){let u=n.parse(e[l],l,an);if(!u)return null;let h=n.parse(e[l+1],l+1,i);if(!h)return null;r.push([u,h]),i=i||h.type}let o=n.parse(e[e.length-1],e.length-1,i);return o?new r0(i,r,o):null}evaluate(e){for(let[n,i]of this.branches)if(n.evaluate(e))return i.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(let[n,i]of this.branches)e(n),e(i);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){let e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var WL=r0;class qf{constructor(e,n,i,r){this.type=e,this.input=n,this.beginIndex=i,this.endIndex=r}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);let i=n.parse(e[1],1,Qt),r=n.parse(e[2],2,ze);if(!i||!r)return null;if(!xy(i.type,[Br(Qt),Kt,Qt]))return n.error(`Expected first argument to be of type array or string, but found ${vi(i.type)} instead`);if(e.length===4){let o=n.parse(e[3],3,ze);return o?new qf(i.type,i,r,o):null}return new qf(i.type,i,r)}evaluate(e){let n=this.input.evaluate(e),i=this.beginIndex.evaluate(e);if(!hd(n,["string","array"]))throw new $i(`Expected first argument to be of type array or string, but found ${vi(Fi(n))} instead.`);if(this.endIndex){let r=this.endIndex.evaluate(e);return n.slice(i,r)}return n.slice(i)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){let e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var ZL=qf;function pE(t,e){return t==="=="||t==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function mE(t,e,n,i){return i.compare(e,n)===0}function kc(t,e,n){let i=t!=="=="&&t!=="!=";return class Kk{constructor(o,l,u){this.type=an,this.lhs=o,this.rhs=l,this.collator=u,this.hasUntypedArgument=o.type.kind==="value"||l.type.kind==="value"}static parse(o,l){if(o.length!==3&&o.length!==4)return l.error("Expected two or three arguments.");let u=o[0],h=l.parse(o[1],1,Qt);if(!h)return null;if(!pE(u,h.type))return l.concat(1).error(`"${u}" comparisons are not supported for type '${vi(h.type)}'.`);let p=l.parse(o[2],2,Qt);if(!p)return null;if(!pE(u,p.type))return l.concat(2).error(`"${u}" comparisons are not supported for type '${vi(p.type)}'.`);if(h.type.kind!==p.type.kind&&h.type.kind!=="value"&&p.type.kind!=="value")return l.error(`Cannot compare types '${vi(h.type)}' and '${vi(p.type)}'.`);i&&(h.type.kind==="value"&&p.type.kind!=="value"?h=new Us(p.type,[h]):h.type.kind!=="value"&&p.type.kind==="value"&&(p=new Us(h.type,[p])));let m=null;if(o.length===4){if(h.type.kind!=="string"&&p.type.kind!=="string"&&h.type.kind!=="value"&&p.type.kind!=="value")return l.error("Cannot use collator to compare non-string types.");if(m=l.parse(o[3],3,Of),!m)return null}return new Kk(h,p,m)}evaluate(o){let l=this.lhs.evaluate(o),u=this.rhs.evaluate(o);if(i&&this.hasUntypedArgument){let h=Fi(l),p=Fi(u);if(h.kind!==p.kind||h.kind!=="string"&&h.kind!=="number")throw new $i(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${h.kind}, ${p.kind}) instead.`)}if(this.collator&&!i&&this.hasUntypedArgument){let h=Fi(l),p=Fi(u);if(h.kind!=="string"||p.kind!=="string")return e(o,l,u)}return this.collator?n(o,l,u,this.collator.evaluate(o)):e(o,l,u)}eachChild(o){o(this.lhs),o(this.rhs),this.collator&&o(this.collator)}outputDefined(){return!0}serialize(){let o=[t];return this.eachChild(l=>{o.push(l.serialize())}),o}}}let XL=kc("==",function(t,e,n){return e===n},mE),YL=kc("!=",function(t,e,n){return e!==n},function(t,e,n,i){return!mE(0,e,n,i)}),KL=kc("<",function(t,e,n){return e<n},function(t,e,n,i){return i.compare(e,n)<0}),JL=kc(">",function(t,e,n){return e>n},function(t,e,n,i){return i.compare(e,n)>0}),QL=kc("<=",function(t,e,n){return e<=n},function(t,e,n,i){return i.compare(e,n)<=0}),e3=kc(">=",function(t,e,n){return e>=n},function(t,e,n,i){return i.compare(e,n)>=0});class o0{constructor(e,n,i,r,o,l){this.type=Kt,this.number=e,this.locale=n,this.currency=i,this.unit=r,this.minFractionDigits=o,this.maxFractionDigits=l}static parse(e,n){if(e.length!==3)return n.error("Expected two arguments.");let i=n.parse(e[1],1,ze);if(!i)return null;let r=e[2];if(typeof r!="object"||Array.isArray(r))return n.error("NumberFormat options argument must be an object.");let o=null;if(r.locale&&(o=n.parse(r.locale,1,Kt),!o))return null;let l=null;if(r.currency&&(l=n.parse(r.currency,1,Kt),!l))return null;let u=null;if(r.unit&&(u=n.parse(r.unit,1,Kt),!u))return null;let h=null;if(r["min-fraction-digits"]&&(h=n.parse(r["min-fraction-digits"],1,ze),!h))return null;let p=null;return r["max-fraction-digits"]&&(p=n.parse(r["max-fraction-digits"],1,ze),!p)?null:new o0(i,o,l,u,h,p)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){let e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class s0{constructor(e){this.type=ze,this.input=e}static parse(e,n){if(e.length!==2)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);let i=n.parse(e[1],1);return i?i.type.kind!=="array"&&i.type.kind!=="string"&&i.type.kind!=="value"?n.error(`Expected argument of type string or array, but found ${vi(i.type)} instead.`):new s0(i):null}evaluate(e){let n=this.input.evaluate(e);if(typeof n=="string"||Array.isArray(n))return n.length;throw new $i(`Expected value to be of type string or array, but found ${vi(Fi(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){let e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}function a0(t){return function(){t=1831565813+(t|=0)|0;let e=Math.imul(t^t>>>15,1|t);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}let gE={"==":XL,"!=":YL,">":JL,"<":KL,">=":e3,"<=":QL,array:Us,at:$L,boolean:Us,case:WL,coalesce:hE,collator:Lf,format:md,image:gd,in:GL,"index-of":HL,interpolate:ms,"interpolate-hcl":ms,"interpolate-lab":ms,length:s0,let:fE,literal:pd,match:qL,number:Us,"number-format":o0,object:Us,slice:ZL,step:Wy,string:Us,"to-boolean":El,"to-color":El,"to-number":El,"to-string":El,var:nE,within:Py,distance:jy};function _E(t,[e,n,i,r]){e=e.evaluate(t),n=n.evaluate(t),i=i.evaluate(t);let o=r?r.evaluate(t):1,l=BC(e,n,i,o);if(l)throw new $i(l);return new Rt(e/255*o,n/255*o,i/255*o,o)}function yE(t,[e,n,i,r]){e=e.evaluate(t),n=n.evaluate(t),i=i.evaluate(t);let o=r?r.evaluate(t):1,l=function(p,m,_,y){return typeof p=="number"&&p>=0&&p<=360?typeof m=="number"&&m>=0&&m<=100&&typeof _=="number"&&_>=0&&_<=100?y===void 0||typeof y=="number"&&y>=0&&y<=1?null:`Invalid hsla value [${[p,m,_,y].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof y=="number"?[p,m,_,y]:[p,m,_]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof y=="number"?[p,m,_,y]:[p,m,_]).join(", ")}]: 'h' must be between 0 and 360.`}(e,n,i,o);if(l)throw new $i(l);let u=`hsla(${e}, ${n}%, ${i}%, ${o})`,h=Rt.parse(u);if(!h)throw new $i(`Failed to parse HSLA color: ${u}`);return h}function vE(t,e){return t in e}function l0(t,e){let n=e[t];return n===void 0?null:n}function xE(t,e){switch(t){case"string":return String(e);case"number":return+e;case"boolean":return!!e;case"color":return Rt.parse(e)}return e}function bE(t,e,n,i){return i!==void 0&&(t=i*Math.round(t/i)),e!==void 0&&t<e&&(t=e),n!==void 0&&t>n&&(t=n),t}function wE(t,e,n){n.length&&(e+=`${n}`);let i=t.getConfig(e);if(!i)return null;let{type:r,value:o,values:l,minValue:u,maxValue:h,stepValue:p}=i,m=i.default.evaluate(t),_=o?o.evaluate(t):m;return r&&(_=xE(r,_)),o!==void 0&&_!==void 0&&l&&!l.includes(_)&&(_=m,r&&(_=xE(r,_))),_===void 0||u===void 0&&h===void 0&&p===void 0||(typeof _=="number"?_=bE(_,u,h,p):Array.isArray(_)&&(_=_.map(y=>typeof y=="number"?bE(y,u,h,p):y))),_}function Ml(t){return{type:t}}ps.register(gE,{error:[{kind:"error"},[Kt],(t,[e])=>{throw new $i(e.evaluate(t))}],typeof:[Kt,[Qt],(t,[e])=>vi(Fi(e.evaluate(t)))],"to-rgba":[Br(ze,4),[bo],(t,[e])=>e.evaluate(t).toArray()],rgb:[bo,[ze,ze,ze],_E],rgba:[bo,[ze,ze,ze,ze],_E],hsl:[bo,[ze,ze,ze],yE],hsla:[bo,[ze,ze,ze,ze],yE],has:{type:an,overloads:[[[Kt],(t,[e])=>vE(e.evaluate(t),t.properties())],[[Kt,Dc],(t,[e,n])=>vE(e.evaluate(t),n.evaluate(t))]]},get:{type:Qt,overloads:[[[Kt],(t,[e])=>l0(e.evaluate(t),t.properties())],[[Kt,Dc],(t,[e,n])=>l0(e.evaluate(t),n.evaluate(t))]]},config:{type:Qt,overloads:[[[Kt],(t,[e])=>wE(t,e.evaluate(t),"")],[[Kt,Kt],(t,[e,n])=>wE(t,e.evaluate(t),n.evaluate(t))]]},"feature-state":[Qt,[Kt],(t,[e])=>l0(e.evaluate(t),t.featureState||{})],properties:[Dc,[],t=>t.properties()],"geometry-type":[Kt,[],t=>t.geometryType()],id:[Qt,[],t=>t.id()],zoom:[ze,[],t=>t.globals.zoom],pitch:[ze,[],t=>t.globals.pitch||0],"distance-from-center":[ze,[],t=>t.distanceFromCenter()],"measure-light":[ze,[Kt],(t,[e])=>t.measureLight(e.evaluate(t))],"heatmap-density":[ze,[],t=>t.globals.heatmapDensity||0],"line-progress":[ze,[],t=>t.globals.lineProgress||0],"raster-value":[ze,[],t=>t.globals.rasterValue||0],"sky-radial-progress":[ze,[],t=>t.globals.skyRadialProgress||0],accumulated:[Qt,[],t=>t.globals.accumulated===void 0?null:t.globals.accumulated],"+":[ze,Ml(ze),(t,e)=>{let n=0;for(let i of e)n+=i.evaluate(t);return n}],"*":[ze,Ml(ze),(t,e)=>{let n=1;for(let i of e)n*=i.evaluate(t);return n}],"-":{type:ze,overloads:[[[ze,ze],(t,[e,n])=>e.evaluate(t)-n.evaluate(t)],[[ze],(t,[e])=>-e.evaluate(t)]]},"/":[ze,[ze,ze],(t,[e,n])=>e.evaluate(t)/n.evaluate(t)],"%":[ze,[ze,ze],(t,[e,n])=>e.evaluate(t)%n.evaluate(t)],ln2:[ze,[],()=>Math.LN2],pi:[ze,[],()=>Math.PI],e:[ze,[],()=>Math.E],"^":[ze,[ze,ze],(t,[e,n])=>Math.pow(e.evaluate(t),n.evaluate(t))],sqrt:[ze,[ze],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[ze,[ze],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[ze,[ze],(t,[e])=>Math.log(e.evaluate(t))],log2:[ze,[ze],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[ze,[ze],(t,[e])=>Math.sin(e.evaluate(t))],cos:[ze,[ze],(t,[e])=>Math.cos(e.evaluate(t))],tan:[ze,[ze],(t,[e])=>Math.tan(e.evaluate(t))],asin:[ze,[ze],(t,[e])=>Math.asin(e.evaluate(t))],acos:[ze,[ze],(t,[e])=>Math.acos(e.evaluate(t))],atan:[ze,[ze],(t,[e])=>Math.atan(e.evaluate(t))],min:[ze,Ml(ze),(t,e)=>Math.min(...e.map(n=>n.evaluate(t)))],max:[ze,Ml(ze),(t,e)=>Math.max(...e.map(n=>n.evaluate(t)))],abs:[ze,[ze],(t,[e])=>Math.abs(e.evaluate(t))],round:[ze,[ze],(t,[e])=>{let n=e.evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[ze,[ze],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[ze,[ze],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[an,[Kt,Qt],(t,[e,n])=>t.properties()[e.value]===n.value],"filter-id-==":[an,[Qt],(t,[e])=>t.id()===e.value],"filter-type-==":[an,[Kt],(t,[e])=>t.geometryType()===e.value],"filter-<":[an,[Kt,Qt],(t,[e,n])=>{let i=t.properties()[e.value],r=n.value;return typeof i==typeof r&&i<r}],"filter-id-<":[an,[Qt],(t,[e])=>{let n=t.id(),i=e.value;return typeof n==typeof i&&n<i}],"filter->":[an,[Kt,Qt],(t,[e,n])=>{let i=t.properties()[e.value],r=n.value;return typeof i==typeof r&&i>r}],"filter-id->":[an,[Qt],(t,[e])=>{let n=t.id(),i=e.value;return typeof n==typeof i&&n>i}],"filter-<=":[an,[Kt,Qt],(t,[e,n])=>{let i=t.properties()[e.value],r=n.value;return typeof i==typeof r&&i<=r}],"filter-id-<=":[an,[Qt],(t,[e])=>{let n=t.id(),i=e.value;return typeof n==typeof i&&n<=i}],"filter->=":[an,[Kt,Qt],(t,[e,n])=>{let i=t.properties()[e.value],r=n.value;return typeof i==typeof r&&i>=r}],"filter-id->=":[an,[Qt],(t,[e])=>{let n=t.id(),i=e.value;return typeof n==typeof i&&n>=i}],"filter-has":[an,[Qt],(t,[e])=>e.value in t.properties()],"filter-has-id":[an,[],t=>t.id()!==null&&t.id()!==void 0],"filter-type-in":[an,[Br(Kt)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[an,[Br(Qt)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[an,[Kt,Br(Qt)],(t,[e,n])=>n.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[an,[Kt,Br(Qt)],(t,[e,n])=>function(i,r,o,l){for(;o<=l;){let u=o+l>>1;if(r[u]===i)return!0;r[u]>i?l=u-1:o=u+1}return!1}(t.properties()[e.value],n.value,0,n.value.length-1)],all:{type:an,overloads:[[[an,an],(t,[e,n])=>e.evaluate(t)&&n.evaluate(t)],[Ml(an),(t,e)=>{for(let n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:an,overloads:[[[an,an],(t,[e,n])=>e.evaluate(t)||n.evaluate(t)],[Ml(an),(t,e)=>{for(let n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[an,[an],(t,[e])=>!e.evaluate(t)],"is-supported-script":[an,[Kt],(t,[e])=>{let n=t.globals&&t.globals.isSupportedScript;return!n||n(e.evaluate(t))}],upcase:[Kt,[Kt],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Kt,[Kt],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Kt,Ml(Qt),(t,e)=>e.map(n=>fd(n.evaluate(t))).join("")],"resolved-locale":[Kt,[Of],(t,[e])=>e.evaluate(t).resolvedLocale()],random:[ze,[ze,ze,Qt],(t,e)=>{let[n,i,r]=e.map(l=>l.evaluate(t));if(n>i||n===i)return n;let o;if(typeof r=="string")o=function(l){let u=0;if(l.length===0)return u;for(let h=0;h<l.length;h++)u=(u<<5)-u+l.charCodeAt(h),u&=u;return u}(r);else{if(typeof r!="number")throw new $i(`Invalid seed input: ${r}`);o=r}return n+a0(o)()*(i-n)}]});var Ed=gE;function CE(t){return{result:"success",value:t}}function Dl(t){return{result:"error",value:t}}function EE(t,e){return!!t&&!!t.parameters&&t.parameters.indexOf(e)>-1}function Sl(t){return t["property-type"]==="data-driven"}function TE(t){return EE(t.expression,"measure-light")}function c0(t){return EE(t.expression,"zoom")}function u0(t){return!!t.expression&&t.expression.interpolated}function Wf(t){return typeof t=="object"&&t!==null&&!Array.isArray(t)}function t3(t){return t}function IE(t,e){let n=e.type==="color",i=t.stops&&typeof t.stops[0][0]=="object",r=i||!(i||t.property!==void 0),o=t.type||(u0(e)?"exponential":"interval");if(n&&((t=Vs({},t)).stops&&(t.stops=t.stops.map(p=>[p[0],Rt.parse(p[1])])),t.default=Rt.parse(t.default?t.default:e.default)),t.colorSpace&&t.colorSpace!=="rgb"&&!dE[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let l,u,h;if(o==="exponential")l=ME;else if(o==="interval")l=i3;else if(o==="categorical"){l=n3,u=Object.create(null);for(let p of t.stops)u[p[0]]=p[1];h=typeof t.stops[0][0]}else{if(o!=="identity")throw new Error(`Unknown function type "${o}"`);l=r3}if(i){let p={},m=[];for(let v=0;v<t.stops.length;v++){let b=t.stops[v],w=b[0].zoom;p[w]===void 0&&(p[w]={zoom:w,type:t.type,property:t.property,default:t.default,stops:[]},m.push(w)),p[w].stops.push([b[0].value,b[1]])}let _=[];for(let v of m)_.push([p[v].zoom,IE(p[v],e)]);let y={name:"linear"};return{kind:"composite",interpolationType:y,interpolationFactor:ms.interpolationFactor.bind(void 0,y),zoomStops:_.map(v=>v[0]),evaluate:({zoom:v},b)=>ME({stops:_,base:t.base},e,v).evaluate(v,b)}}if(r){let p=o==="exponential"?{name:"exponential",base:t.base!==void 0?t.base:1}:null;return{kind:"camera",interpolationType:p,interpolationFactor:ms.interpolationFactor.bind(void 0,p),zoomStops:t.stops.map(m=>m[0]),evaluate:({zoom:m})=>l(t,e,m,u,h)}}return{kind:"source",evaluate(p,m){let _=m&&m.properties?m.properties[t.property]:void 0;return _===void 0?Td(t.default,e.default):l(t,e,_,u,h)}}}function Td(t,e,n){return t!==void 0?t:e!==void 0?e:n!==void 0?n:void 0}function n3(t,e,n,i,r){return Td(typeof n===r?i[n]:void 0,t.default,e.default)}function i3(t,e,n){if(_n(n)!=="number")return Td(t.default,e.default);let i=t.stops.length;if(i===1||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[i-1][0])return t.stops[i-1][1];let r=Uf(t.stops.map(o=>o[0]),n);return t.stops[r][1]}function ME(t,e,n){let i=t.base!==void 0?t.base:1;if(_n(n)!=="number")return Td(t.default,e.default);let r=t.stops.length;if(r===1||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[r-1][0])return t.stops[r-1][1];let o=Uf(t.stops.map(m=>m[0]),n),l=function(m,_,y,v){let b=v-y,w=m-y;return b===0?0:_===1?w/b:(Math.pow(_,w)-1)/(Math.pow(_,b)-1)}(n,i,t.stops[o][0],t.stops[o+1][0]),u=t.stops[o][1],h=t.stops[o+1][1],p=$f[e.type]||t3;if(t.colorSpace&&t.colorSpace!=="rgb"){let m=dE[t.colorSpace];p=(_,y)=>m.reverse(m.interpolate(m.forward(_),m.forward(y),l))}return typeof u.evaluate=="function"?{evaluate(...m){let _=u.evaluate.apply(void 0,m),y=h.evaluate.apply(void 0,m);if(_!==void 0&&y!==void 0)return p(_,y,l)}}:p(u,h,l)}function r3(t,e,n){return e.type==="color"?n=Rt.parse(n):e.type==="formatted"?n=jr.fromString(n.toString()):e.type==="resolvedImage"?n=wo.fromString(n.toString()):_n(n)===e.type||e.type==="enum"&&e.values[n]||(n=void 0),Td(n,t.default,e.default)}class d0{constructor(e,n,i){this.expression=e,this._warningHistory={},this._evaluator=new VC(i),this._defaultValue=n?function(r){return r.type==="color"&&(Wf(r.default)||Array.isArray(r.default))?new Rt(0,0,0,0):r.type==="color"?Rt.parse(r.default)||null:r.default===void 0?null:r.default}(n):null,this._enumValues=n&&n.type==="enum"?n.values:null}evaluateWithoutErrorHandling(e,n,i,r,o,l,u,h){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=i,this._evaluator.canonical=r||null,this._evaluator.availableImages=o||null,this._evaluator.formattedSection=l,this._evaluator.featureTileCoord=u||null,this._evaluator.featureDistanceData=h||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,i,r,o,l,u,h){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=i||null,this._evaluator.canonical=r||null,this._evaluator.availableImages=o||null,this._evaluator.formattedSection=l||null,this._evaluator.featureTileCoord=u||null,this._evaluator.featureDistanceData=h||null;try{let p=this.expression.evaluate(this._evaluator);if(p==null||typeof p=="number"&&p!=p)return this._defaultValue;if(this._enumValues&&!(p in this._enumValues))throw new $i(`Expected value to be one of ${Object.keys(this._enumValues).map(m=>JSON.stringify(m)).join(", ")}, but found ${JSON.stringify(p)} instead.`);return p}catch(p){return this._warningHistory[p.message]||(this._warningHistory[p.message]=!0,typeof console<"u"&&console.warn(p.message)),this._defaultValue}}}function Zf(t){return Array.isArray(t)&&t.length>0&&typeof t[0]=="string"&&t[0]in Ed}function Ea(t,e,n){let i=new iE(Ed,[],e?function(o){let l={color:bo,string:Kt,number:ze,enum:Kt,boolean:an,formatted:cd,resolvedImage:ud};return o.type==="array"?Br(l[o.value]||Qt,o.length):l[o.type]}(e):void 0,void 0,void 0,n),r=i.parse(t,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return r?CE(new d0(r,e,n)):Dl(i.errors)}class h0{constructor(e,n,i){this.kind=e,this._styleExpression=n,this.isLightConstant=i,this.isStateDependent=e!=="constant"&&!bd(n.expression),this.isConfigDependent=!Uy(n.expression)}evaluateWithoutErrorHandling(e,n,i,r,o,l){return this._styleExpression.evaluateWithoutErrorHandling(e,n,i,r,o,l)}evaluate(e,n,i,r,o,l){return this._styleExpression.evaluate(e,n,i,r,o,l)}}class Ta{constructor(e,n,i,r,o){this.kind=e,this.zoomStops=i,this._styleExpression=n,this.isStateDependent=e!=="camera"&&!bd(n.expression),this.isLightConstant=o,this.isConfigDependent=!Uy(n.expression),this.interpolationType=r}evaluateWithoutErrorHandling(e,n,i,r,o,l){return this._styleExpression.evaluateWithoutErrorHandling(e,n,i,r,o,l)}evaluate(e,n,i,r,o,l){return this._styleExpression.evaluate(e,n,i,r,o,l)}interpolationFactor(e,n,i){return this.interpolationType?ms.interpolationFactor(this.interpolationType,e,n,i):0}}function f0(t,e,n){if((t=Ea(t,e,n)).result==="error")return t;let i=t.value.expression,r=Rc(i);if(!r&&!Sl(e))return Dl([new fs("","data expressions not supported")]);let o=Oc(i,["zoom","pitch","distance-from-center"]);if(!o&&!c0(e))return Dl([new fs("","zoom expressions not supported")]);let l=Oc(i,["measure-light"]);if(!l&&!TE(e))return Dl([new fs("","measure-light expression not supported")]);let u=e.expression&&e.expression.relaxZoomRestriction,h=Yf(i);return h||o||u?h instanceof fs?Dl([h]):h instanceof ms&&!u0(e)?Dl([new fs("",'"interpolate" expressions cannot be used with this property')]):CE(h?new Ta(r?"camera":"composite",t.value,h.labels,h instanceof ms?h.interpolation:void 0,l):new h0(r?"constant":"source",t.value,l)):Dl([new fs("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Xf{constructor(e,n){this._parameters=e,this._specification=n,Vs(this,IE(this._parameters,this._specification))}static deserialize(e){return new Xf(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Yf(t){let e=null;if(t instanceof fE)e=Yf(t.result);else if(t instanceof hE){for(let n of t.args)if(e=Yf(n),e)break}else(t instanceof Wy||t instanceof ms)&&t.input instanceof ps&&t.input.name==="zoom"&&(e=t);return e instanceof fs||t.eachChild(n=>{let i=Yf(n);i instanceof fs?e=i:e&&i&&e!==i&&(e=new fs("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Co(t){let e=t.key,n=t.value,i=t.valueSpec||{},r=t.objectElementValidators||{},o=t.style,l=t.styleSpec,u=[],h=_n(n);if(h!=="object")return[new Ue(e,n,`object expected, ${h} found`)];for(let p in n){let m=p.split(".")[0],_;r[m]?_=r[m]:i[m]?_=Zi:r["*"]?_=r["*"]:i["*"]&&(_=Zi),_?u=u.concat(_({key:(e&&`${e}.`)+p,value:n[p],valueSpec:i[m]||i["*"],style:o,styleSpec:l,object:n,objectKey:p},n)):u.push(new Cl(e,n[p],`unknown property "${p}"`))}for(let p in i)r[p]||i[p].required&&i[p].default===void 0&&n[p]===void 0&&u.push(new Ue(e,n,`missing required property "${p}"`));return u}function DE(t){let e=t.value,n=t.valueSpec,i=t.style,r=t.styleSpec,o=t.key,l=t.arrayElementValidator||Zi;if(_n(e)!=="array")return[new Ue(o,e,`array expected, ${_n(e)} found`)];if(n.length&&e.length!==n.length)return[new Ue(o,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new Ue(o,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let u={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};r.$version<7&&(u.function=n.function),_n(n.value)==="object"&&(u=n.value);let h=[];for(let p=0;p<e.length;p++)h=h.concat(l({array:e,arrayIndex:p,value:e[p],valueSpec:u,style:i,styleSpec:r,key:`${o}[${p}]`},!0));return h}function SE(t){let e=t.key,n=t.value,i=t.valueSpec,r=_n(n);if(r==="number"&&n!=n&&(r="NaN"),r!=="number")return[new Ue(e,n,`number expected, ${r} found`)];if("minimum"in i){let o=i.minimum;if(_n(i.minimum)==="array"&&(o=i.minimum[t.arrayIndex]),n<o)return[new Ue(e,n,`${n} is less than the minimum value ${o}`)]}if("maximum"in i){let o=i.maximum;if(_n(i.maximum)==="array"&&(o=i.maximum[t.arrayIndex]),n>o)return[new Ue(e,n,`${n} is greater than the maximum value ${o}`)]}return[]}function AE(t){let e=t.valueSpec,n=Ti(t.value.type),i,r,o,l={},u=n!=="categorical"&&t.value.property===void 0,h=!u,p=_n(t.value.stops)==="array"&&_n(t.value.stops[0])==="array"&&_n(t.value.stops[0][0])==="object",m=Co({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(v){if(n==="identity")return[new Ue(v.key,v.value,'identity function may not have a "stops" property')];let b=[],w=v.value;return b=b.concat(DE({key:v.key,value:w,valueSpec:v.valueSpec,style:v.style,styleSpec:v.styleSpec,arrayElementValidator:_})),_n(w)==="array"&&w.length===0&&b.push(new Ue(v.key,w,"array must have at least one stop")),b},default:function(v){return Zi({key:v.key,value:v.value,valueSpec:e,style:v.style,styleSpec:v.styleSpec})}}});return n==="identity"&&u&&m.push(new Ue(t.key,t.value,'missing required property "property"')),n==="identity"||t.value.stops||m.push(new Ue(t.key,t.value,'missing required property "stops"')),n==="exponential"&&t.valueSpec.expression&&!u0(t.valueSpec)&&m.push(new Ue(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(h&&!Sl(t.valueSpec)?m.push(new Ue(t.key,t.value,"property functions not supported")):u&&!c0(t.valueSpec)&&m.push(new Ue(t.key,t.value,"zoom functions not supported"))),n!=="categorical"&&!p||t.value.property!==void 0||m.push(new Ue(t.key,t.value,'"property" property is required')),m;function _(v){let b=[],w=v.value,C=v.key;if(_n(w)!=="array")return[new Ue(C,w,`array expected, ${_n(w)} found`)];if(w.length!==2)return[new Ue(C,w,`array length 2 expected, length ${w.length} found`)];if(p){if(_n(w[0])!=="object")return[new Ue(C,w,`object expected, ${_n(w[0])} found`)];if(w[0].zoom===void 0)return[new Ue(C,w,"object stop key must have zoom")];if(w[0].value===void 0)return[new Ue(C,w,"object stop key must have value")];let E=Ti(w[0].zoom);if(typeof E!="number")return[new Ue(C,w[0].zoom,"stop zoom values must be numbers")];if(o&&o>E)return[new Ue(C,w[0].zoom,"stop zoom values must appear in ascending order")];E!==o&&(o=E,r=void 0,l={}),b=b.concat(Co({key:`${C}[0]`,value:w[0],valueSpec:{zoom:{}},style:v.style,styleSpec:v.styleSpec,objectElementValidators:{zoom:SE,value:y}}))}else b=b.concat(y({key:`${C}[0]`,value:w[0],valueSpec:{},style:v.style,styleSpec:v.styleSpec},w));return Zf(js(w[1]))?b.concat([new Ue(`${C}[1]`,w[1],"expressions are not allowed in function stops.")]):b.concat(Zi({key:`${C}[1]`,value:w[1],valueSpec:e,style:v.style,styleSpec:v.styleSpec}))}function y(v,b){let w=_n(v.value),C=Ti(v.value),E=v.value!==null?v.value:b;if(i){if(w!==i)return[new Ue(v.key,E,`${w} stop domain type must match previous stop domain type ${i}`)]}else i=w;if(w!=="number"&&w!=="string"&&w!=="boolean"&&typeof C!="number"&&typeof C!="string"&&typeof C!="boolean")return[new Ue(v.key,E,"stop domain value must be a number, string, or boolean")];if(w!=="number"&&n!=="categorical"){let I=`number expected, ${w} found`;return Sl(e)&&n===void 0&&(I+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Ue(v.key,E,I)]}return n!=="categorical"||w!=="number"||typeof C=="number"&&isFinite(C)&&Math.floor(C)===C?n!=="categorical"&&w==="number"&&typeof C=="number"&&typeof r=="number"&&r!==void 0&&C<r?[new Ue(v.key,E,"stop domain values must appear in ascending order")]:(r=C,n==="categorical"&&C in l?[new Ue(v.key,E,"stop domain values must be unique")]:(l[C]=!0,[])):[new Ue(v.key,E,`integer expected, found ${String(C)}`)]}}function Al(t){let e=(t.expressionContext==="property"?f0:Ea)(js(t.value),t.valueSpec);if(e.result==="error")return e.value.map(i=>new Ue(`${t.key}${i.key}`,t.value,i.message));let n=e.value.expression||e.value._styleExpression.expression;if(t.expressionContext==="property"&&t.propertyKey==="text-font"&&!n.outputDefined())return[new Ue(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if(t.expressionContext==="property"&&t.propertyType==="layout"&&!bd(n))return[new Ue(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if(t.expressionContext==="filter")return PE(n,t);if(t.expressionContext&&t.expressionContext.indexOf("cluster")===0){if(!Oc(n,["zoom","feature-state"]))return[new Ue(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(t.expressionContext==="cluster-initial"&&!Rc(n))return[new Ue(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function PE(t,e){let n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(let r of e.valueSpec.expression.parameters)n.delete(r);if(n.size===0)return[];let i=[];return t instanceof ps&&n.has(t.name)?[new Ue(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild(r=>{i.push(...PE(r,e))}),i)}function Kf(t){let e=t.key,n=t.value,i=t.valueSpec,r=[];return Array.isArray(i.values)?i.values.indexOf(Ti(n))===-1&&r.push(new Ue(e,n,`expected one of [${i.values.join(", ")}], ${JSON.stringify(n)} found`)):Object.keys(i.values).indexOf(Ti(n))===-1&&r.push(new Ue(e,n,`expected one of [${Object.keys(i.values).join(", ")}], ${JSON.stringify(n)} found`)),r}function p0(t){if(t===!0||t===!1)return!0;if(!Array.isArray(t)||t.length===0)return!1;switch(t[0]){case"has":return t.length>=2&&t[1]!=="$id"&&t[1]!=="$type";case"in":return t.length>=3&&(typeof t[1]!="string"||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return t.length!==3||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(let e of t.slice(1))if(!p0(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Jf(t,e="fill"){if(t==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};p0(t)||(t=Qf(t));let n=t,i=!0;try{i=function(p){if(!Lc(p))return p;let m=js(p);return OE(m),m=RE(m),m}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(n,null,2)}
        `)}let r=ie[`filter_${e}`],o=Ea(i,r),l=null;if(o.result==="error")throw new Error(o.value.map(p=>`${p.key}: ${p.message}`).join(", "));l=(p,m,_)=>o.value.evaluate(p,m,{},_);let u=null,h=null;if(i!==n){let p=Ea(n,r);if(p.result==="error")throw new Error(p.value.map(m=>`${m.key}: ${m.message}`).join(", "));u=(m,_,y,v,b)=>p.value.evaluate(m,_,{},y,void 0,void 0,v,b),h=!Rc(p.value.expression)}return{filter:l,dynamicFilter:u||void 0,needGeometry:FE(i),needFeature:!!h}}function RE(t){if(!Array.isArray(t))return t;let e=function(n){if(o3.has(n[0])){for(let i=1;i<n.length;i++)if(Lc(n[i]))return!0}return n}(t);return e===!0?e:e.map(n=>RE(n))}function OE(t){let e=!1,n=[];if(t[0]==="case"){for(let i=1;i<t.length-1;i+=2)e=e||Lc(t[i]),n.push(t[i+1]);n.push(t[t.length-1])}else if(t[0]==="match"){e=e||Lc(t[1]);for(let i=2;i<t.length-1;i+=2)n.push(t[i+1]);n.push(t[t.length-1])}else if(t[0]==="step"){e=e||Lc(t[1]);for(let i=1;i<t.length-1;i+=2)n.push(t[i+1])}e&&(t.length=0,t.push("any",...n));for(let i=1;i<t.length;i++)OE(t[i])}function Lc(t){if(!Array.isArray(t))return!1;if((e=t[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let n=1;n<t.length;n++)if(Lc(t[n]))return!0;return!1}let o3=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function s3(t,e){return t<e?-1:t>e?1:0}function FE(t){if(!Array.isArray(t))return!1;if(t[0]==="within"||t[0]==="distance")return!0;for(let e=1;e<t.length;e++)if(FE(t[e]))return!0;return!1}function Qf(t){if(!t)return!0;let e=t[0];return t.length<=1?e!=="any":e==="=="?m0(t[1],t[2],"=="):e==="!="?ep(m0(t[1],t[2],"==")):e==="<"||e===">"||e==="<="||e===">="?m0(t[1],t[2],e):e==="any"?(n=t.slice(1),["any"].concat(n.map(Qf))):e==="all"?["all"].concat(t.slice(1).map(Qf)):e==="none"?["all"].concat(t.slice(1).map(Qf).map(ep)):e==="in"?kE(t[1],t.slice(2)):e==="!in"?ep(kE(t[1],t.slice(2))):e==="has"?LE(t[1]):e!=="!has"||ep(LE(t[1]));var n}function m0(t,e,n){switch(t){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,t,e]}}function kE(t,e){if(e.length===0)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",t,["literal",e.sort(s3)]]:["filter-in-small",t,["literal",e]]}}function LE(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function ep(t){return["!",t]}function g0(t){return p0(js(t.value))?Al(Vs({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):NE(t)}function NE(t){let e=t.value,n=t.key;if(_n(e)!=="array")return[new Ue(n,e,`array expected, ${_n(e)} found`)];let i=t.styleSpec,r,o=[];if(e.length<1)return[new Ue(n,e,"filter array must have at least 1 element")];switch(o=o.concat(Kf({key:`${n}[0]`,value:e[0],valueSpec:i.filter_operator,style:t.style,styleSpec:t.styleSpec})),Ti(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&Ti(e[1])==="$type"&&o.push(new Ue(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&o.push(new Ue(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(r=_n(e[1]),r!=="string"&&o.push(new Ue(`${n}[1]`,e[1],`string expected, ${r} found`)));for(let l=2;l<e.length;l++)r=_n(e[l]),Ti(e[1])==="$type"?o=o.concat(Kf({key:`${n}[${l}]`,value:e[l],valueSpec:i.geometry_type,style:t.style,styleSpec:t.styleSpec})):r!=="string"&&r!=="number"&&r!=="boolean"&&o.push(new Ue(`${n}[${l}]`,e[l],`string, number, or boolean expected, ${r} found`));break;case"any":case"all":case"none":for(let l=1;l<e.length;l++)o=o.concat(NE({key:`${n}[${l}]`,value:e[l],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":r=_n(e[1]),e.length!==2?o.push(new Ue(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):r!=="string"&&o.push(new Ue(`${n}[1]`,e[1],`string expected, ${r} found`))}return o}function zE(t,e){let n=t.key,i=t.style,r=t.layer,o=t.styleSpec,l=t.value,u=t.objectKey,h=o[`${e}_${t.layerType}`];if(!h)return[];let p=u.match(/^(.*)-transition$/);if(e==="paint"&&p&&h[p[1]]&&h[p[1]].transition)return Zi({key:n,value:l,valueSpec:o.transition,style:i,styleSpec:o});let m=t.valueSpec||h[u];if(!m)return[new Cl(n,l,`unknown property "${u}"`)];let _;if(_n(l)==="string"&&Sl(m)&&!m.tokens&&(_=/^{([^}]+)}$/.exec(l))){let v=`\`{ "type": "identity", "property": ${_?JSON.stringify(_[1]):'"_"'} }\``;return[new Ue(n,l,`"${u}" does not support interpolation syntax
Use an identity property function instead: ${v}.`)]}let y=[];if(t.layerType==="symbol")u!=="text-field"||!i||i.glyphs||i.imports||y.push(new Ue(n,l,'use of "text-field" requires a style "glyphs" property')),u==="text-font"&&Wf(js(l))&&Ti(l.type)==="identity"&&y.push(new Ue(n,l,'"text-font" does not support identity functions'));else if(t.layerType==="model"&&e==="paint"&&r&&r.layout&&r.layout.hasOwnProperty("model-id")&&Sl(m)&&(TE(m)||c0(m))){let v=f0(js(l),m),b=v.value.expression||v.value._styleExpression.expression;b&&!Oc(b,["measure-light"])&&(u==="model-emissive-strength"&&Rc(b)&&bd(b)||y.push(new Ue(n,l,`${u} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return y.concat(Zi({key:t.key,value:l,valueSpec:m,style:i,styleSpec:o,expressionContext:"property",propertyType:e,propertyKey:u}))}function BE(t){return zE(t,"paint")}function VE(t){return zE(t,"layout")}function jE(t){let e=[],n=t.value,i=t.key,r=t.style,o=t.styleSpec;n.type||n.ref||e.push(new Ue(i,n,'either "type" or "ref" is required'));let l=Ti(n.type),u=Ti(n.ref);if(n.id){let h=Ti(n.id);for(let p=0;p<t.arrayIndex;p++){let m=r.layers[p];Ti(m.id)===h&&e.push(new Ue(i,n.id,`duplicate layer id "${n.id}", previously used at line ${m.id.__line__}`))}}if("ref"in n){let h;["type","source","source-layer","filter","layout"].forEach(p=>{p in n&&e.push(new Ue(i,n[p],`"${p}" is prohibited for ref layers`))}),r.layers.forEach(p=>{Ti(p.id)===u&&(h=p)}),h?h.ref?e.push(new Ue(i,n.ref,"ref cannot reference another ref layer")):l=Ti(h.type):typeof u=="string"&&e.push(new Ue(i,n.ref,`ref layer "${u}" not found`))}else if(l!=="background"&&l!=="sky"&&l!=="slot")if(n.source){let h=r.sources&&r.sources[n.source],p=h&&Ti(h.type);h?p==="vector"&&l==="raster"?e.push(new Ue(i,n.source,`layer "${n.id}" requires a raster source`)):p==="raster"&&l!=="raster"?e.push(new Ue(i,n.source,`layer "${n.id}" requires a vector source`)):p!=="vector"||n["source-layer"]?p==="raster-dem"&&l!=="hillshade"?e.push(new Ue(i,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):l!=="line"||!n.paint||!n.paint["line-gradient"]&&!n.paint["line-trim-offset"]||p==="geojson"&&h.lineMetrics||e.push(new Ue(i,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Ue(i,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new Ue(i,n.source,`source "${n.source}" not found`))}else e.push(new Ue(i,n,'missing required property "source"'));return e=e.concat(Co({key:i,value:n,valueSpec:o.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Zi({key:`${i}.type`,value:n.type,valueSpec:o.layer.type,style:t.style,styleSpec:t.styleSpec,object:n,objectKey:"type"}),filter:h=>g0(Vs({layerType:l},h)),layout:h=>Co({layer:n,key:h.key,value:h.value,valueSpec:{},style:h.style,styleSpec:h.styleSpec,objectElementValidators:{"*":p=>VE(Vs({layerType:l},p))}}),paint:h=>Co({layer:n,key:h.key,value:h.value,valueSpec:{},style:h.style,styleSpec:h.styleSpec,objectElementValidators:{"*":p=>BE(Vs({layerType:l,layer:n},p))}})}})),e}function Nc(t){let e=t.value,n=t.key,i=_n(e);return i!=="string"?[new Ue(n,e,`string expected, ${i} found`)]:[]}let UE={promoteId:function({key:t,value:e}){if(_n(e)==="string")return Nc({key:t,value:e});{let n=[];for(let i in e)n.push(...Nc({key:`${t}.${i}`,value:e[i]}));return n}}};function $E(t){let e=t.value,n=t.key,i=t.styleSpec,r=t.style;if(!e.type)return[new Ue(n,e,'"type" is required')];let o=Ti(e.type),l=[];switch(["vector","raster","raster-dem"].includes(o)&&(e.url||e.tiles||l.push(new Ue(n,e,'Either "url" or "tiles" is required.'))),o){case"vector":case"raster":case"raster-dem":return l=l.concat(Co({key:n,value:e,valueSpec:i[`source_${o.replace("-","_")}`],style:t.style,styleSpec:i,objectElementValidators:UE})),l;case"geojson":if(l=Co({key:n,value:e,valueSpec:i.source_geojson,style:r,styleSpec:i,objectElementValidators:UE}),e.cluster)for(let u in e.clusterProperties){let[h,p]=e.clusterProperties[u],m=typeof h=="string"?[h,["accumulated"],["get",u]]:h;l.push(...Al({key:`${n}.${u}.map`,value:p,expressionContext:"cluster-map"})),l.push(...Al({key:`${n}.${u}.reduce`,value:m,expressionContext:"cluster-reduce"}))}return l;case"video":return Co({key:n,value:e,valueSpec:i.source_video,style:r,styleSpec:i});case"image":return Co({key:n,value:e,valueSpec:i.source_image,style:r,styleSpec:i});case"canvas":return[new Ue(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Kf({key:`${n}.type`,value:e.type,valueSpec:{values:a3(i)},style:r,styleSpec:i})}}function a3(t){return t.source.reduce((e,n)=>{let i=t[n];return i.type.type==="enum"&&(e=e.concat(Object.keys(i.type.values))),e},[])}function GE(t){let e=t.value,n=[];if(!e)return n;let i=_n(e);return i!=="string"?(n=n.concat([new Ue(t.key,e,`string expected, "${i}" found`)]),n):(function(r){let o=r.indexOf("://")===-1;try{return new URL(r,o?"http://example.com":void 0),!0}catch{return!1}}(e)||(n=n.concat([new Ue(t.key,e,`invalid url "${e}"`)])),n)}function HE(t){let e=t.value,n=t.styleSpec,i=n.light,r=t.style,o=[],l=_n(e);if(e===void 0)return o;if(l!=="object")return o=o.concat([new Ue("light",e,`object expected, ${l} found`)]),o;for(let u in e){let h=u.match(/^(.*)-transition$/);o=o.concat(h&&i[h[1]]&&i[h[1]].transition?Zi({key:u,value:e[u],valueSpec:n.transition,style:r,styleSpec:n}):i[u]?Zi({key:u,value:e[u],valueSpec:i[u],style:r,styleSpec:n}):[new Ue(u,e[u],`unknown property "${u}"`)])}return o}function qE(t){let e=t.value,n=[];if(!e)return n;let i=_n(e);if(i!=="object")return n=n.concat([new Ue("light-3d",e,`object expected, ${i} found`)]),n;let r=t.styleSpec,o=r["light-3d"],l=t.key,u=t.style,h=t.style.lights;for(let _ of["type","id"])if(!(_ in e))return n=n.concat([new Ue("light-3d",e,`missing property ${_} on light`)]),n;if(e.type&&h)for(let _=0;_<t.arrayIndex;_++){let y=Ti(e.type),v=h[_];Ti(v.type)===y&&n.push(new Ue(l,e.id,`duplicate light type "${e.type}", previously defined at line ${v.id.__line__}`))}let p=`properties_light_${e.type}`;if(!(p in r))return n=n.concat([new Ue("light-3d",e,`Invalid light type ${e.type}`)]),n;let m=r[p];for(let _ in e)if(_==="properties"){let y=e[_],v=_n(y);if(v!=="object")return n=n.concat([new Ue("properties",y,`object expected, ${v} found`)]),n;for(let b in y)n=n.concat(m[b]?Zi({key:b,value:y[b],valueSpec:m[b],style:u,styleSpec:r}):[new Cl(t.key,y[b],`unknown property "${b}"`)])}else{let y=_.match(/^(.*)-transition$/);n=n.concat(y&&o[y[1]]&&o[y[1]].transition?Zi({key:_,value:e[_],valueSpec:r.transition,style:u,styleSpec:r}):o[_]?Zi({key:_,value:e[_],valueSpec:o[_],style:u,styleSpec:r}):[new Cl(_,e[_],`unknown property "${_}"`)])}return n}function WE(t){let e=t.value,n=t.key,i=t.style,r=t.styleSpec,o=r.terrain,l=[],u=_n(e);if(e===void 0||u==="null")return l;if(u!=="object")return l=l.concat([new Ue("terrain",e,`object expected, ${u} found`)]),l;for(let h in e){let p=h.match(/^(.*)-transition$/);l=l.concat(p&&o[p[1]]&&o[p[1]].transition?Zi({key:h,value:e[h],valueSpec:r.transition,style:i,styleSpec:r}):o[h]?Zi({key:h,value:e[h],valueSpec:o[h],style:i,styleSpec:r}):[new Cl(h,e[h],`unknown property "${h}"`)])}if(e.source){let h=i.sources&&i.sources[e.source],p=h&&Ti(h.type);h?p!=="raster-dem"&&l.push(new Ue(n,e.source,`terrain cannot be used with a source of type ${String(p)}, it only be used with a "raster-dem" source type`)):l.push(new Ue(n,e.source,`source "${e.source}" not found`))}else l.push(new Ue(n,e,'terrain is missing required property "source"'));return l}function ZE(t){let e=t.value,n=t.style,i=t.styleSpec,r=i.fog,o=[],l=_n(e);if(e===void 0)return o;if(l!=="object")return o=o.concat([new Ue("fog",e,`object expected, ${l} found`)]),o;for(let u in e){let h=u.match(/^(.*)-transition$/);o=o.concat(h&&r[h[1]]&&r[h[1]].transition?Zi({key:u,value:e[u],valueSpec:i.transition,style:n,styleSpec:i}):r[u]?Zi({key:u,value:e[u],valueSpec:r[u],style:n,styleSpec:i}):[new Cl(u,e[u],`unknown property "${u}"`)])}return o}let XE={"*":()=>[],array:DE,boolean:function(t){let e=t.value,n=t.key,i=_n(e);return i!=="boolean"?[new Ue(n,e,`boolean expected, ${i} found`)]:[]},number:SE,color:function(t){let e=t.key,n=t.value,i=_n(n);return i!=="string"?[new Ue(e,n,`color expected, ${i} found`)]:by(n)===null?[new Ue(e,n,`color expected, "${n}" found`)]:[]},enum:Kf,filter:g0,function:AE,layer:jE,object:Co,source:$E,model:GE,light:HE,"light-3d":qE,terrain:WE,fog:ZE,string:Nc,formatted:function(t){return Nc(t).length===0?[]:Al(t)},resolvedImage:function(t){return Nc(t).length===0?[]:Al(t)},projection:function(t){let e=t.value,n=t.styleSpec,i=n.projection,r=t.style,o=[],l=_n(e);if(l==="object")for(let u in e)o=o.concat(Zi({key:u,value:e[u],valueSpec:i[u],style:r,styleSpec:n}));else l!=="string"&&(o=o.concat([new Ue("projection",e,`object or string expected, ${l} found`)]));return o},import:function(t){let{value:e,styleSpec:n}=t,l=e,{data:i}=l,r=Jx(l,["data"]);Object.defineProperty(r,"__line__",{value:e.__line__,enumerable:!1});let o=Co(Vs({},t,{value:r,valueSpec:n.import}));return Ti(r.id)===""&&o.push(new Ue(`${t.key}.id`,r,"import id can't be an empty string")),i&&(o=o.concat(YE(i,n,{key:`${t.key}.data`}))),o}};function Zi(t,e=!1){let n=t.value,i=t.valueSpec,r=t.styleSpec;if(i.expression&&Wf(Ti(n)))return AE(t);if(i.expression&&Zf(js(n)))return Al(t);if(i.type&&XE[i.type]){let o=XE[i.type](t);return e===!0&&o.length>0&&_n(t.value)==="array"?Al(t):o}return Co(Vs({},t,{valueSpec:i.type?r[i.type]:i}))}function l3(t){let e=t.value,n=t.key,i=Nc(t);return i.length||(e.indexOf("{fontstack}")===-1&&i.push(new Ue(n,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&i.push(new Ue(n,e,'"glyphs" url must include a "{range}" token'))),i}function YE(t,e=ie,n={}){return Zi({key:n.key||"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:l3,"*":()=>[]}})}function zc(t,e=ie){return Ho(YE(t,e))}let c3=t=>Ho($E(t)),u3=t=>Ho(HE(t)),d3=t=>Ho(qE(t)),h3=t=>Ho(WE(t)),f3=t=>Ho(ZE(t)),p3=t=>Ho(jE(t)),_0=t=>Ho(g0(t)),m3=t=>Ho(BE(t)),g3=t=>Ho(VE(t)),_3=t=>Ho(GE(t));function Ho(t){return t.slice().sort((e,n)=>e.line&&n.line?e.line-n.line:0)}function tp(t,e){let n=!1;if(e&&e.length)for(let i of e)i instanceof Cl?J(i.message):(t.fire(new mt(new Error(i.message))),n=!0);return n}var y3=gs,Ia=3;function gs(t,e,n){var i=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var r=new Int32Array(this.arrayBuffer);t=r[0],this.d=(e=r[1])+2*(n=r[2]);for(var o=0;o<this.d*this.d;o++){var l=r[Ia+o],u=r[Ia+o+1];i.push(l===u?null:r.subarray(l,u))}var h=r[Ia+i.length+1];this.keys=r.subarray(r[Ia+i.length],h),this.bboxes=r.subarray(h),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var p=0;p<this.d*this.d;p++)i.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var m=n/e*t;this.min=-m,this.max=t+m}gs.prototype.insert=function(t,e,n,i,r){this._forEachCell(e,n,i,r,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(r)},gs.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},gs.prototype._insertCell=function(t,e,n,i,r,o){this.cells[r].push(o)},gs.prototype.query=function(t,e,n,i,r){var o=this.min,l=this.max;if(t<=o&&e<=o&&l<=n&&l<=i&&!r)return Array.prototype.slice.call(this.keys);var u=[];return this._forEachCell(t,e,n,i,this._queryCell,u,{},r),u},gs.prototype._queryCell=function(t,e,n,i,r,o,l,u){var h=this.cells[r];if(h!==null)for(var p=this.keys,m=this.bboxes,_=0;_<h.length;_++){var y=h[_];if(l[y]===void 0){var v=4*y;(u?u(m[v+0],m[v+1],m[v+2],m[v+3]):t<=m[v+2]&&e<=m[v+3]&&n>=m[v+0]&&i>=m[v+1])?(l[y]=!0,o.push(p[y])):l[y]=!1}}},gs.prototype._forEachCell=function(t,e,n,i,r,o,l,u){for(var h=this._convertToCellCoord(t),p=this._convertToCellCoord(e),m=this._convertToCellCoord(n),_=this._convertToCellCoord(i),y=h;y<=m;y++)for(var v=p;v<=_;v++){var b=this.d*v+y;if((!u||u(this._convertFromCellCoord(y),this._convertFromCellCoord(v),this._convertFromCellCoord(y+1),this._convertFromCellCoord(v+1)))&&r.call(this,t,e,n,i,b,o,l,u))return}},gs.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},gs.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},gs.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=Ia+this.cells.length+1+1,n=0,i=0;i<this.cells.length;i++)n+=this.cells[i].length;var r=new Int32Array(e+n+this.keys.length+this.bboxes.length);r[0]=this.extent,r[1]=this.n,r[2]=this.padding;for(var o=e,l=0;l<t.length;l++){var u=t[l];r[Ia+l]=o,r.set(u,o),o+=u.length}return r[Ia+t.length]=o,r.set(this.keys,o),r[Ia+t.length+1]=o+=this.keys.length,r.set(this.bboxes,o),o+=this.bboxes.length,r.buffer};var Bc=tt(y3);let np={};function Ge(t,e,n={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),np[e]={klass:t,omit:n.omit||[]}}Ge(Object,"Object"),Bc.serialize=function(t,e){let n=t.toArrayBuffer();return e&&e.add(n),{buffer:n}},Bc.deserialize=function(t){return new Bc(t.buffer)},Object.defineProperty(Bc,"name",{value:"Grid"}),Ge(Bc,"Grid"),Ge(Rt,"Color"),Ge(Error,"Error"),Ge(me,"AJAXError"),Ge(wo,"ResolvedImage"),Ge(Xf,"StylePropertyFunction"),Ge(d0,"StyleExpression",{omit:["_evaluator"]}),Ge(Ta,"ZoomDependentExpression"),Ge(h0,"ZoomConstantExpression"),Ge(ps,"CompoundExpression",{omit:["_evaluate"]});for(let t in Ed)np[Ed[t]._classRegistryKey]||Ge(Ed[t],`Expression${t}`);function KE(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&t.constructor.name==="ArrayBuffer")}function JE(t){return x.ImageBitmap&&t instanceof x.ImageBitmap}function Vc(t,e){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(KE(t)||JE(t))return e&&e.add(t),t;if(ArrayBuffer.isView(t)){let n=t;return e&&e.add(n.buffer),n}if(t instanceof x.ImageData)return e&&e.add(t.data.buffer),t;if(Array.isArray(t)){let n=[];for(let i of t)n.push(Vc(i,e));return n}if(t instanceof Map){let n={$name:"Map"};for(let[i,r]of t.entries())n[i]=Vc(r);return n}if(typeof t=="object"){let n=t.constructor,i=n._classRegistryKey;if(!i)throw new Error(`can't serialize object of unregistered class ${i}`);let r=n.serialize?n.serialize(t,e):{};if(!n.serialize){for(let o in t)t.hasOwnProperty(o)&&(np[i].omit.indexOf(o)>=0||(r[o]=Vc(t[o],e)));t instanceof Error&&(r.message=t.message)}if(r.$name)throw new Error("$name property is reserved for worker serialization logic.");return i!=="Object"&&(r.$name=i),r}throw new Error("can't serialize object of type "+typeof t)}function jc(t){if(t==null||typeof t=="boolean"||typeof t=="number"||typeof t=="string"||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||KE(t)||JE(t)||ArrayBuffer.isView(t)||t instanceof x.ImageData)return t;if(Array.isArray(t))return t.map(jc);if(typeof t=="object"){let e=t.$name||"Object";if(e==="Map"){let r=new Map;for(let o of Object.keys(t))o!=="$name"&&r.set(o,jc(t[o]));return r}let{klass:n}=np[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(t);let i=Object.create(n.prototype);for(let r of Object.keys(t))r!=="$name"&&(i[r]=jc(t[r]));return i}throw new Error("can't deserialize object of type "+typeof t)}let Xe={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519,"CJK Unified Ideographs Extension B":t=>t>=131072&&t<=173791};function y0(t){for(let e of t)if(v0(e.charCodeAt(0)))return!0;return!1}function v3(t){for(let e of t)if(!x3(e.charCodeAt(0)))return!1;return!0}function x3(t){return!(Xe.Arabic(t)||Xe["Arabic Supplement"](t)||Xe["Arabic Extended-A"](t)||Xe["Arabic Presentation Forms-A"](t)||Xe["Arabic Presentation Forms-B"](t))}function v0(t){return!(t!==746&&t!==747&&(t<4352||!(Xe["Bopomofo Extended"](t)||Xe.Bopomofo(t)||Xe["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Xe["CJK Compatibility Ideographs"](t)||Xe["CJK Compatibility"](t)||Xe["CJK Radicals Supplement"](t)||Xe["CJK Strokes"](t)||!(!Xe["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||t===12336)||Xe["CJK Unified Ideographs Extension A"](t)||Xe["CJK Unified Ideographs"](t)||Xe["Enclosed CJK Letters and Months"](t)||Xe["Hangul Compatibility Jamo"](t)||Xe["Hangul Jamo Extended-A"](t)||Xe["Hangul Jamo Extended-B"](t)||Xe["Hangul Jamo"](t)||Xe["Hangul Syllables"](t)||Xe.Hiragana(t)||Xe["Ideographic Description Characters"](t)||Xe.Kanbun(t)||Xe["Kangxi Radicals"](t)||Xe["Katakana Phonetic Extensions"](t)||Xe.Katakana(t)&&t!==12540||!(!Xe["Halfwidth and Fullwidth Forms"](t)||t===65288||t===65289||t===65293||t>=65306&&t<=65310||t===65339||t===65341||t===65343||t>=65371&&t<=65503||t===65507||t>=65512&&t<=65519)||!(!Xe["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Xe["Unified Canadian Aboriginal Syllabics"](t)||Xe["Unified Canadian Aboriginal Syllabics Extended"](t)||Xe["Vertical Forms"](t)||Xe["Yijing Hexagram Symbols"](t)||Xe["Yi Syllables"](t)||Xe["Yi Radicals"](t))))}function QE(t){return!(v0(t)||function(e){return!!(Xe["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Xe["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Xe["Letterlike Symbols"](e)||Xe["Number Forms"](e)||Xe["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Xe["Control Pictures"](e)&&e!==9251||Xe["Optical Character Recognition"](e)||Xe["Enclosed Alphanumerics"](e)||Xe["Geometric Shapes"](e)||Xe["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Xe["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Xe["CJK Symbols and Punctuation"](e)||Xe.Katakana(e)||Xe["Private Use Area"](e)||Xe["CJK Compatibility Forms"](e)||Xe["Small Form Variants"](e)||Xe["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(t))}function eT(t){return t>=1424&&t<=2303||Xe["Arabic Presentation Forms-A"](t)||Xe["Arabic Presentation Forms-B"](t)}function b3(t,e){return!(!e&&eT(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Xe.Khmer(t))}function w3(t){for(let e of t)if(eT(e.charCodeAt(0)))return!0;return!1}let x0="deferred",b0="loading",w0="loaded",C0=null,Ur="unavailable",Ma=null,tT=function(t){t&&typeof t=="string"&&t.indexOf("NetworkError")>-1&&(Ur="error"),C0&&C0(t)};function E0(){T0.fire(new Ce("pluginStateChange",{pluginStatus:Ur,pluginURL:Ma}))}let T0=new yi,I0=function(){return Ur},nT=function(){if(Ur!==x0||!Ma)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Ur=b0,E0(),Ma&&Oe({url:Ma},t=>{t?tT(t):(Ur=w0,E0())})},Eo={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Ur===w0||Eo.applyArabicShaping!=null,isLoading:()=>Ur===b0,setState(t){Ur=t.pluginStatus,Ma=t.pluginURL},isParsed:()=>Eo.applyArabicShaping!=null&&Eo.processBidirectionalText!=null&&Eo.processStyledBidirectionalText!=null,getPluginURL:()=>Ma};class Hn{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch,this.brightness=n.brightness):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(n,i){for(let r of n)if(!b3(r.charCodeAt(0),i))return!1;return!0}(e,Eo.isLoaded())}}class ip{constructor(e,n,i){this.property=e,this.value=n,this.expression=function(r,o,l){if(Wf(r))return new Xf(r,o);if(Zf(r)||Array.isArray(r)&&r.length>0){let u=f0(r,o,l);if(u.result==="error")throw new Error(u.value.map(h=>`${h.key}: ${h.message}`).join(", "));return u.value}{let u=r;return typeof r=="string"&&o.type==="color"&&(u=Rt.parse(r)),{kind:"constant",isConfigDependent:!1,evaluate:()=>u}}}(n===void 0?e.specification.default:n,e.specification,i)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,n,i){return this.property.possiblyEvaluate(this,e,n,i)}}class M0{constructor(e,n){this.property=e,this.value=new ip(e,void 0,n)}transitioned(e,n){return new iT(this.property,this.value,n,$e({},e.transition,this.transition),e.now)}untransitioned(){return new iT(this.property,this.value,null,{},0)}}class Id{constructor(e,n){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._options=n,this.isConfigDependent=!1}getValue(e){return V(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new M0(this._values[e].property,this._options)),this._values[e].value=new ip(this._values[e].property,n===null?void 0:V(n),this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].value.expression.isConfigDependent}setTransitionOrValue(e,n){n&&(this._options=n);let i=this._properties.properties;if(e)for(let r in e){let o=e[r];if(bc(r,"-transition")){let l=r.slice(0,-11);i[l]&&this.setTransition(l,o)}else i[r]&&this.setValue(r,o)}}getTransition(e){return V(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new M0(this._values[e].property)),this._values[e].transition=V(n)||void 0}serialize(){let e={};for(let n of Object.keys(this._values)){let i=this.getValue(n);i!==void 0&&(e[n]=i);let r=this.getTransition(n);r!==void 0&&(e[`${n}-transition`]=r)}return e}transitioned(e,n){let i=new rT(this._properties);for(let r of Object.keys(this._values))i._values[r]=this._values[r].transitioned(e,n._values[r]);return i}untransitioned(){let e=new rT(this._properties);for(let n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class iT{constructor(e,n,i,r,o){let l=r.delay||0,u=r.duration||0;o=o||0,this.property=e,this.value=n,this.begin=o+l,this.end=this.begin+u,e.specification.transition&&(r.delay||r.duration)&&(this.prior=i)}possiblyEvaluate(e,n,i){let r=e.now||0,o=this.value.possiblyEvaluate(e,n,i),l=this.prior;if(l){if(r>this.end)return this.prior=null,o;if(this.value.isDataDriven())return this.prior=null,o;if(r<this.begin)return l.possiblyEvaluate(e,n,i);{let u=(r-this.begin)/(this.end-this.begin);return this.property.interpolate(l.possiblyEvaluate(e,n,i),o,vc(u))}}return o}}class rT{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,i){let r=new Md(this._properties);for(let o of Object.keys(this._values))r._values[o]=this._values[o].possiblyEvaluate(e,n,i);return r}hasTransition(){for(let e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class C3{constructor(e,n){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._options=n,this.isConfigDependent=!1}getValue(e){return V(this._values[e].value)}setValue(e,n){this._values[e]=new ip(this._values[e].property,n===null?void 0:V(n),this._options),this.isConfigDependent=this.isConfigDependent||this._values[e].expression.isConfigDependent}serialize(){let e={};for(let n of Object.keys(this._values)){let i=this.getValue(n);i!==void 0&&(e[n]=i)}return e}possiblyEvaluate(e,n,i){let r=new Md(this._properties);for(let o of Object.keys(this._values))r._values[o]=this._values[o].possiblyEvaluate(e,n,i);return r}}class Uc{constructor(e,n,i){this.property=e,this.value=n,this.parameters=i}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,n,i,r){return this.property.evaluate(this.value,this.parameters,e,n,i,r)}}class Md{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class be{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,i){let r=$f[this.specification.type];return r?r(e,n,i):e}}class et{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,i,r){return new Uc(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(n,null,{},i,r)}:e.expression,n)}interpolate(e,n,i){if(e.value.kind!=="constant"||n.value.kind!=="constant")return e;if(e.value.value===void 0||n.value.value===void 0)return new Uc(this,{kind:"constant",value:void 0},e.parameters);let r=$f[this.specification.type];return r?new Uc(this,{kind:"constant",value:r(e.value.value,n.value.value,i)},e.parameters):e}evaluate(e,n,i,r,o,l){return e.kind==="constant"?e.value:e.evaluate(n,i,r,o,l)}}class Dd{constructor(e){this.specification=e}possiblyEvaluate(e,n,i,r){return!!e.expression.evaluate(n,null,{},i,r)}interpolate(){return!1}}class ii{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];let n=new Hn(0,{});for(let i in e){let r=e[i];r.specification.overridable&&this.overridableProperties.push(i);let o=this.defaultPropertyValues[i]=new ip(r,void 0),l=this.defaultTransitionablePropertyValues[i]=new M0(r);this.defaultTransitioningPropertyValues[i]=l.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=o.possiblyEvaluate(n)}}}Ge(et,"DataDrivenProperty"),Ge(be,"DataConstantProperty"),Ge(Dd,"ColorRampProperty");let rp="";function oT(t){return t.indexOf(rp)>=0}function hr(t,e){return e?`${t}${rp}${e}`:t}function op(t){let e=t.indexOf(rp);return e>=0?t.slice(0,e):t}let sT="-transition";class io extends yi{constructor(e,n,i){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.isConfigDependent=!1,e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),this.options=i,e.slot&&(this.slot=e.slot),n.layout&&(this._unevaluatedLayout=new C3(n.layout,i),this.isConfigDependent=this.isConfigDependent||this._unevaluatedLayout.isConfigDependent),n.paint)){this._transitionablePaint=new Id(n.paint,i);for(let r in e.paint)this.setPaintProperty(r,e.paint[r],{validate:!1});for(let r in e.layout)this.setLayoutProperty(r,e.layout[r],{validate:!1});this.isConfigDependent=this.isConfigDependent||this._transitionablePaint.isConfigDependent,this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Md(n.paint)}}setScope(e){this.scope=e,this.fqid=hr(this.id,e)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n,i={}){if(n!=null&&this._validate(g3,`layers.${this.id}.layout.${e}`,e,n,i))return;if(this.type==="custom"&&e==="visibility")return void(this.visibility=n);let r=this._unevaluatedLayout;r._properties.properties[e]&&(r.setValue(e,n),this.isConfigDependent=this.isConfigDependent||r.isConfigDependent,e==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0})}getPaintProperty(e){return bc(e,sT)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,i={}){if(n!=null&&this._validate(m3,`layers.${this.id}.paint.${e}`,e,n,i))return!1;let r=this._transitionablePaint,o=r._properties.properties;if(bc(e,sT)){let y=e.slice(0,-11);return o[y]&&r.setTransition(y,n||void 0),!1}if(!o[e])return!1;let l=r._values[e],u=l.value.isDataDriven(),h=l.value;r.setValue(e,n),this.isConfigDependent=this.isConfigDependent||r.isConfigDependent,this._handleSpecialPaintPropertyUpdate(e);let p=r._values[e].value,m=p.isDataDriven(),_=bc(e,"pattern")||e==="line-dasharray";return m||u||_||this._handleOverridablePaintPropertyUpdate(e,h,p)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,n){return null}_handleOverridablePaintPropertyUpdate(e,n,i){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){return Te({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(e,n)=>!(e===void 0||n==="layout"&&!Object.keys(e).length||n==="paint"&&!Object.keys(e).length))}_validate(e,n,i,r,o={}){return(!o||o.validate!==!1)&&tp(this,e.call(zc,{key:n,layerType:this.type,objectKey:i,value:r,styleSpec:ie,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}resize(){}isStateDependent(){for(let e in this.paint._values){let n=this.paint.get(e);if(n instanceof Uc&&Sl(n.property.specification)&&(n.value.kind==="source"||n.value.kind==="composite")&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Jf(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(){this._stats&&(this._stats.numRenderedVerticesInShadowPass=0,this._stats.numRenderedVerticesInTransparentPass=0)}}class E3{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages=new Set}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(e,n){this._updatedSourceCaches[e]=n,this.setDirty()}discardSourceCacheUpdate(e){delete this._updatedSourceCaches[e]}updateLayer(e){let n=e.scope;this._updatedLayers[n]=this._updatedLayers[n]||new Set,this._updatedLayers[n].add(e.id),this.setDirty()}removeLayer(e){let n=e.scope;this._removedLayers[n]=this._removedLayers[n]||{},this._updatedLayers[n]=this._updatedLayers[n]||new Set,this._removedLayers[n][e.id]=e,this._updatedLayers[n].delete(e.id),this._updatedPaintProps.delete(e.fqid),this.setDirty()}getRemovedLayer(e){return this._removedLayers[e.scope]?this._removedLayers[e.scope][e.id]:null}discardLayerRemoval(e){this._removedLayers[e.scope]&&delete this._removedLayers[e.scope][e.id]}getLayerUpdatesByScope(){let e={};for(let n in this._updatedLayers)e[n]=e[n]||{},e[n].updatedIds=Array.from(this._updatedLayers[n].values());for(let n in this._removedLayers)e[n]=e[n]||{},e[n].removedIds=Object.keys(this._removedLayers[n]);return e}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(e){this._updatedPaintProps.add(e.fqid),this.setDirty()}getUpdatedImages(){return Array.from(this._updatedImages.values())}updateImage(e){this._updatedImages.add(e),this.setDirty()}resetUpdatedImages(){this._updatedImages.clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages.clear()}}let T3={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class sp{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class qn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.add(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){let n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);let n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function ln(t,e=1){let n=0,i=0;return{members:t.map(r=>{let o=T3[r.type].BYTES_PER_ELEMENT,l=n=aT(n,Math.max(e,o)),u=r.components||1;return i=Math.max(i,o),n+=o*u,{name:r.name,type:r.type,components:u,offset:l}}),size:aT(n,Math.max(i,e)),alignment:e}}function aT(t,e){return Math.ceil(t/e)*e}class $r extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){let i=this.length;return this.resize(i+1),this.emplace(i,e,n)}emplace(e,n,i){let r=2*e;return this.int16[r+0]=n,this.int16[r+1]=i,e}}$r.prototype.bytesPerElement=4,Ge($r,"StructArrayLayout2i4");class ap extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,i){let r=this.length;return this.resize(r+1),this.emplace(r,e,n,i)}emplace(e,n,i,r){let o=3*e;return this.int16[o+0]=n,this.int16[o+1]=i,this.int16[o+2]=r,e}}ap.prototype.bytesPerElement=6,Ge(ap,"StructArrayLayout3i6");class Pl extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,i,r){let o=this.length;return this.resize(o+1),this.emplace(o,e,n,i,r)}emplace(e,n,i,r,o){let l=4*e;return this.int16[l+0]=n,this.int16[l+1]=i,this.int16[l+2]=r,this.int16[l+3]=o,e}}Pl.prototype.bytesPerElement=8,Ge(Pl,"StructArrayLayout4i8");class D0 extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,i,r,o){let l=this.length;return this.resize(l+1),this.emplace(l,e,n,i,r,o)}emplace(e,n,i,r,o,l){let u=5*e;return this.int16[u+0]=n,this.int16[u+1]=i,this.int16[u+2]=r,this.int16[u+3]=o,this.int16[u+4]=l,e}}D0.prototype.bytesPerElement=10,Ge(D0,"StructArrayLayout5i10");class S0 extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,r,o,l,u){let h=this.length;return this.resize(h+1),this.emplace(h,e,n,i,r,o,l,u)}emplace(e,n,i,r,o,l,u,h){let p=6*e,m=12*e,_=3*e;return this.int16[p+0]=n,this.int16[p+1]=i,this.uint8[m+4]=r,this.uint8[m+5]=o,this.uint8[m+6]=l,this.uint8[m+7]=u,this.float32[_+2]=h,e}}S0.prototype.bytesPerElement=12,Ge(S0,"StructArrayLayout2i4ub1f12");class Gs extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,r){let o=this.length;return this.resize(o+1),this.emplace(o,e,n,i,r)}emplace(e,n,i,r,o){let l=4*e;return this.float32[l+0]=n,this.float32[l+1]=i,this.float32[l+2]=r,this.float32[l+3]=o,e}}Gs.prototype.bytesPerElement=16,Ge(Gs,"StructArrayLayout4f16");class Da extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,r,o){let l=this.length;return this.resize(l+1),this.emplace(l,e,n,i,r,o)}emplace(e,n,i,r,o,l){let u=6*e,h=3*e;return this.uint16[u+0]=n,this.uint16[u+1]=i,this.uint16[u+2]=r,this.uint16[u+3]=o,this.float32[h+2]=l,e}}Da.prototype.bytesPerElement=12,Ge(Da,"StructArrayLayout4ui1f12");class lp extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,i,r){let o=this.length;return this.resize(o+1),this.emplace(o,e,n,i,r)}emplace(e,n,i,r,o){let l=4*e;return this.uint16[l+0]=n,this.uint16[l+1]=i,this.uint16[l+2]=r,this.uint16[l+3]=o,e}}lp.prototype.bytesPerElement=8,Ge(lp,"StructArrayLayout4ui8");class cp extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,i,r,o,l){let u=this.length;return this.resize(u+1),this.emplace(u,e,n,i,r,o,l)}emplace(e,n,i,r,o,l,u){let h=6*e;return this.int16[h+0]=n,this.int16[h+1]=i,this.int16[h+2]=r,this.int16[h+3]=o,this.int16[h+4]=l,this.int16[h+5]=u,e}}cp.prototype.bytesPerElement=12,Ge(cp,"StructArrayLayout6i12");class A0 extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,i,r,o,l,u,h,p,m,_,y){let v=this.length;return this.resize(v+1),this.emplace(v,e,n,i,r,o,l,u,h,p,m,_,y)}emplace(e,n,i,r,o,l,u,h,p,m,_,y,v){let b=12*e;return this.int16[b+0]=n,this.int16[b+1]=i,this.int16[b+2]=r,this.int16[b+3]=o,this.uint16[b+4]=l,this.uint16[b+5]=u,this.uint16[b+6]=h,this.uint16[b+7]=p,this.int16[b+8]=m,this.int16[b+9]=_,this.int16[b+10]=y,this.int16[b+11]=v,e}}A0.prototype.bytesPerElement=24,Ge(A0,"StructArrayLayout4i4ui4i24");class P0 extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,r,o,l){let u=this.length;return this.resize(u+1),this.emplace(u,e,n,i,r,o,l)}emplace(e,n,i,r,o,l,u){let h=10*e,p=5*e;return this.int16[h+0]=n,this.int16[h+1]=i,this.int16[h+2]=r,this.float32[p+2]=o,this.float32[p+3]=l,this.float32[p+4]=u,e}}P0.prototype.bytesPerElement=20,Ge(P0,"StructArrayLayout3i3f20");class R0 extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}R0.prototype.bytesPerElement=4,Ge(R0,"StructArrayLayout1ul4");class Sa extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){let i=this.length;return this.resize(i+1),this.emplace(i,e,n)}emplace(e,n,i){let r=2*e;return this.uint16[r+0]=n,this.uint16[r+1]=i,e}}Sa.prototype.bytesPerElement=4,Ge(Sa,"StructArrayLayout2ui4");class O0 extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,i,r,o,l,u,h,p,m,_,y,v){let b=this.length;return this.resize(b+1),this.emplace(b,e,n,i,r,o,l,u,h,p,m,_,y,v)}emplace(e,n,i,r,o,l,u,h,p,m,_,y,v,b){let w=20*e,C=10*e;return this.int16[w+0]=n,this.int16[w+1]=i,this.int16[w+2]=r,this.int16[w+3]=o,this.int16[w+4]=l,this.float32[C+3]=u,this.float32[C+4]=h,this.float32[C+5]=p,this.float32[C+6]=m,this.int16[w+14]=_,this.uint32[C+8]=y,this.uint16[w+18]=v,this.uint16[w+19]=b,e}}O0.prototype.bytesPerElement=40,Ge(O0,"StructArrayLayout5i4f1i1ul2ui40");class up extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,i,r,o,l,u){let h=this.length;return this.resize(h+1),this.emplace(h,e,n,i,r,o,l,u)}emplace(e,n,i,r,o,l,u,h){let p=8*e;return this.int16[p+0]=n,this.int16[p+1]=i,this.int16[p+2]=r,this.int16[p+4]=o,this.int16[p+5]=l,this.int16[p+6]=u,this.int16[p+7]=h,e}}up.prototype.bytesPerElement=16,Ge(up,"StructArrayLayout3i2i2i16");class F0 extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,i,r,o){let l=this.length;return this.resize(l+1),this.emplace(l,e,n,i,r,o)}emplace(e,n,i,r,o,l){let u=4*e,h=8*e;return this.float32[u+0]=n,this.float32[u+1]=i,this.float32[u+2]=r,this.int16[h+6]=o,this.int16[h+7]=l,e}}F0.prototype.bytesPerElement=16,Ge(F0,"StructArrayLayout2f1f2i16");class k0 extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,r){let o=this.length;return this.resize(o+1),this.emplace(o,e,n,i,r)}emplace(e,n,i,r,o){let l=12*e,u=3*e;return this.uint8[l+0]=n,this.uint8[l+1]=i,this.float32[u+1]=r,this.float32[u+2]=o,e}}k0.prototype.bytesPerElement=12,Ge(k0,"StructArrayLayout2ub2f12");class xi extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,i){let r=this.length;return this.resize(r+1),this.emplace(r,e,n,i)}emplace(e,n,i,r){let o=3*e;return this.uint16[o+0]=n,this.uint16[o+1]=i,this.uint16[o+2]=r,e}}xi.prototype.bytesPerElement=6,Ge(xi,"StructArrayLayout3ui6");class L0 extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,i,r,o,l,u,h,p,m,_,y,v,b,w,C,E,I,D,S,M){let A=this.length;return this.resize(A+1),this.emplace(A,e,n,i,r,o,l,u,h,p,m,_,y,v,b,w,C,E,I,D,S,M)}emplace(e,n,i,r,o,l,u,h,p,m,_,y,v,b,w,C,E,I,D,S,M,A){let R=30*e,F=15*e,k=60*e;return this.int16[R+0]=n,this.int16[R+1]=i,this.int16[R+2]=r,this.float32[F+2]=o,this.float32[F+3]=l,this.uint16[R+8]=u,this.uint16[R+9]=h,this.uint32[F+5]=p,this.uint32[F+6]=m,this.uint32[F+7]=_,this.uint16[R+16]=y,this.uint16[R+17]=v,this.uint16[R+18]=b,this.float32[F+10]=w,this.float32[F+11]=C,this.uint8[k+48]=E,this.uint8[k+49]=I,this.uint8[k+50]=D,this.uint32[F+13]=S,this.int16[R+28]=M,this.uint8[k+58]=A,e}}L0.prototype.bytesPerElement=60,Ge(L0,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class N0 extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,i,r,o,l,u,h,p,m,_,y,v,b,w,C,E,I,D,S,M,A,R,F,k,L,z,B,G,N,W,Y){let te=this.length;return this.resize(te+1),this.emplace(te,e,n,i,r,o,l,u,h,p,m,_,y,v,b,w,C,E,I,D,S,M,A,R,F,k,L,z,B,G,N,W,Y)}emplace(e,n,i,r,o,l,u,h,p,m,_,y,v,b,w,C,E,I,D,S,M,A,R,F,k,L,z,B,G,N,W,Y,te){let q=20*e,X=40*e,re=80*e;return this.float32[q+0]=n,this.float32[q+1]=i,this.int16[X+4]=r,this.int16[X+5]=o,this.int16[X+6]=l,this.int16[X+7]=u,this.int16[X+8]=h,this.int16[X+9]=p,this.int16[X+10]=m,this.int16[X+11]=_,this.int16[X+12]=y,this.uint16[X+13]=v,this.uint16[X+14]=b,this.uint16[X+15]=w,this.uint16[X+16]=C,this.uint16[X+17]=E,this.uint16[X+18]=I,this.uint16[X+19]=D,this.uint16[X+20]=S,this.uint16[X+21]=M,this.uint16[X+22]=A,this.uint16[X+23]=R,this.uint16[X+24]=F,this.uint16[X+25]=k,this.uint16[X+26]=L,this.uint16[X+27]=z,this.uint32[q+14]=B,this.float32[q+15]=G,this.float32[q+16]=N,this.float32[q+17]=W,this.float32[q+18]=Y,this.uint8[re+76]=te,e}}N0.prototype.bytesPerElement=80,Ge(N0,"StructArrayLayout2f9i15ui1ul4f1ub80");class Sd extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}Sd.prototype.bytesPerElement=4,Ge(Sd,"StructArrayLayout1f4");class Rl extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,r,o){let l=this.length;return this.resize(l+1),this.emplace(l,e,n,i,r,o)}emplace(e,n,i,r,o,l){let u=5*e;return this.float32[u+0]=n,this.float32[u+1]=i,this.float32[u+2]=r,this.float32[u+3]=o,this.float32[u+4]=l,e}}Rl.prototype.bytesPerElement=20,Ge(Rl,"StructArrayLayout5f20");class z0 extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,r,o,l,u){let h=this.length;return this.resize(h+1),this.emplace(h,e,n,i,r,o,l,u)}emplace(e,n,i,r,o,l,u,h){let p=7*e;return this.float32[p+0]=n,this.float32[p+1]=i,this.float32[p+2]=r,this.float32[p+3]=o,this.float32[p+4]=l,this.float32[p+5]=u,this.float32[p+6]=h,e}}z0.prototype.bytesPerElement=28,Ge(z0,"StructArrayLayout7f28");class B0 extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,i,r){let o=this.length;return this.resize(o+1),this.emplace(o,e,n,i,r)}emplace(e,n,i,r,o){let l=6*e;return this.uint32[3*e+0]=n,this.uint16[l+2]=i,this.uint16[l+3]=r,this.uint16[l+4]=o,e}}B0.prototype.bytesPerElement=12,Ge(B0,"StructArrayLayout1ul3ui12");class Ad extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}Ad.prototype.bytesPerElement=2,Ge(Ad,"StructArrayLayout1ui2");class Ol extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i){let r=this.length;return this.resize(r+1),this.emplace(r,e,n,i)}emplace(e,n,i,r){let o=3*e;return this.float32[o+0]=n,this.float32[o+1]=i,this.float32[o+2]=r,e}}Ol.prototype.bytesPerElement=12,Ge(Ol,"StructArrayLayout3f12");class Pd extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){let i=this.length;return this.resize(i+1),this.emplace(i,e,n)}emplace(e,n,i){let r=2*e;return this.float32[r+0]=n,this.float32[r+1]=i,e}}Pd.prototype.bytesPerElement=8,Ge(Pd,"StructArrayLayout2f8");class V0 extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,r,o,l,u,h,p,m,_,y,v,b,w,C){let E=this.length;return this.resize(E+1),this.emplace(E,e,n,i,r,o,l,u,h,p,m,_,y,v,b,w,C)}emplace(e,n,i,r,o,l,u,h,p,m,_,y,v,b,w,C,E){let I=16*e;return this.float32[I+0]=n,this.float32[I+1]=i,this.float32[I+2]=r,this.float32[I+3]=o,this.float32[I+4]=l,this.float32[I+5]=u,this.float32[I+6]=h,this.float32[I+7]=p,this.float32[I+8]=m,this.float32[I+9]=_,this.float32[I+10]=y,this.float32[I+11]=v,this.float32[I+12]=b,this.float32[I+13]=w,this.float32[I+14]=C,this.float32[I+15]=E,e}}V0.prototype.bytesPerElement=64,Ge(V0,"StructArrayLayout16f64");class dp extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,i,r,o,l,u){let h=this.length;return this.resize(h+1),this.emplace(h,e,n,i,r,o,l,u)}emplace(e,n,i,r,o,l,u,h){let p=10*e,m=5*e;return this.uint16[p+0]=n,this.uint16[p+1]=i,this.uint16[p+2]=r,this.uint16[p+3]=o,this.float32[m+2]=l,this.float32[m+3]=u,this.float32[m+4]=h,e}}dp.prototype.bytesPerElement=20,Ge(dp,"StructArrayLayout4ui3f20");class j0 extends qn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){let n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint8[1*e+0]=n,e}}j0.prototype.bytesPerElement=1,Ge(j0,"StructArrayLayout1ub1");class lT extends sp{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}lT.prototype.size=40;class U0 extends O0{get(e){return new lT(this,e)}}Ge(U0,"CollisionBoxArray");class cT extends sp{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}cT.prototype.size=60;class uT extends L0{get(e){return new cT(this,e)}}Ge(uT,"PlacedSymbolArray");class dT extends sp{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}}dT.prototype.size=80;class hT extends N0{get(e){return new dT(this,e)}}Ge(hT,"SymbolInstanceArray");class fT extends Sd{getoffsetX(e){return this.float32[1*e+0]}}Ge(fT,"GlyphOffsetArray");class pT extends $r{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Ge(pT,"SymbolLineVertexArray");class mT extends sp{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}mT.prototype.size=12;class gT extends B0{get(e){return new mT(this,e)}}Ge(gT,"FeatureIndexArray");class _T extends Sa{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Ge(_T,"FillExtrusionCentroidArray");let I3=ln([{name:"a_pos",components:2,type:"Int16"}],4),M3=ln([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class yn{constructor(e=[]){this.segments=e}_prepareSegment(e,n,i,r){let o=this.segments[this.segments.length-1];return e>yn.MAX_VERTEX_ARRAY_LENGTH&&J(`Max vertices per segment is ${yn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!o||o.vertexLength+e>yn.MAX_VERTEX_ARRAY_LENGTH||o.sortKey!==r)&&(o={vertexOffset:n,primitiveOffset:i,vertexLength:0,primitiveLength:0},r!==void 0&&(o.sortKey=r),this.segments.push(o)),o}prepareSegment(e,n,i,r){return this._prepareSegment(e,n.length,i.length,r)}get(){return this.segments}destroy(){for(let e of this.segments)for(let n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,i,r){return new yn([{vertexOffset:e,primitiveOffset:n,vertexLength:i,primitiveLength:r,vaos:{},sortKey:0}])}}function yT(t,e){return 256*(t=We(Math.floor(t),0,255))+We(Math.floor(e),0,255)}yn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ge(yn,"SegmentVector");let D3=ln([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),S3=ln([{name:"a_dash",components:4,type:"Uint16"}]);var hp={exports:{}},vT={exports:{}};(function(t){t.exports=function(e,n){var i,r,o,l,u,h,p,m;for(r=e.length-(i=3&e.length),o=n,u=3432918353,h=461845907,m=0;m<r;)p=255&e.charCodeAt(m)|(255&e.charCodeAt(++m))<<8|(255&e.charCodeAt(++m))<<16|(255&e.charCodeAt(++m))<<24,++m,o=27492+(65535&(l=5*(65535&(o=(o^=p=(65535&(p=(p=(65535&p)*u+(((p>>>16)*u&65535)<<16)&4294967295)<<15|p>>>17))*h+(((p>>>16)*h&65535)<<16)&4294967295)<<13|o>>>19))+((5*(o>>>16)&65535)<<16)&4294967295))+((58964+(l>>>16)&65535)<<16);switch(p=0,i){case 3:p^=(255&e.charCodeAt(m+2))<<16;case 2:p^=(255&e.charCodeAt(m+1))<<8;case 1:o^=p=(65535&(p=(p=(65535&(p^=255&e.charCodeAt(m)))*u+(((p>>>16)*u&65535)<<16)&4294967295)<<15|p>>>17))*h+(((p>>>16)*h&65535)<<16)&4294967295}return o^=e.length,o=2246822507*(65535&(o^=o>>>16))+((2246822507*(o>>>16)&65535)<<16)&4294967295,o=3266489909*(65535&(o^=o>>>13))+((3266489909*(o>>>16)&65535)<<16)&4294967295,(o^=o>>>16)>>>0}})(vT);var A3=vT.exports,xT={exports:{}};(function(t){t.exports=function(e,n){for(var i,r=e.length,o=n^r,l=0;r>=4;)i=1540483477*(65535&(i=255&e.charCodeAt(l)|(255&e.charCodeAt(++l))<<8|(255&e.charCodeAt(++l))<<16|(255&e.charCodeAt(++l))<<24))+((1540483477*(i>>>16)&65535)<<16),o=1540483477*(65535&o)+((1540483477*(o>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),r-=4,++l;switch(r){case 3:o^=(255&e.charCodeAt(l+2))<<16;case 2:o^=(255&e.charCodeAt(l+1))<<8;case 1:o=1540483477*(65535&(o^=255&e.charCodeAt(l)))+((1540483477*(o>>>16)&65535)<<16)}return o=1540483477*(65535&(o^=o>>>13))+((1540483477*(o>>>16)&65535)<<16),(o^=o>>>15)>>>0}})(xT);var bT=A3,P3=xT.exports;hp.exports=bT,hp.exports.murmur3=bT,hp.exports.murmur2=P3;var $0=tt(hp.exports);class Rd{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,n,i,r){this.ids.push(wT(e)),this.positions.push(n,i,r)}eachPosition(e,n){let i=wT(e),r=0,o=this.ids.length-1;for(;r<o;){let l=r+o>>1;this.ids[l]>=i?o=l:r=l+1}for(;this.ids[r]===i;)n(this.positions[3*r],this.positions[3*r+1],this.positions[3*r+2]),r++}static serialize(e,n){let i=new Float64Array(e.ids),r=new Uint32Array(e.positions);return G0(i,r,0,i.length-1),n&&(n.add(i.buffer),n.add(r.buffer)),{ids:i,positions:r}}static deserialize(e){let n=new Rd,i;n.ids=e.ids,n.positions=e.positions;for(let r of n.ids)r!==i&&n.uniqueIds.push(r),i=r;return n.indexed=!0,n}}function wT(t){let e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:$0(String(t))}function G0(t,e,n,i){for(;n<i;){let r=t[n+i>>1],o=n-1,l=i+1;for(;;){do o++;while(t[o]<r);do l--;while(t[l]>r);if(o>=l)break;fp(t,o,l),fp(e,3*o,3*l),fp(e,3*o+1,3*l+1),fp(e,3*o+2,3*l+2)}l-n<i-l?(G0(t,e,n,l),n=l+1):(G0(t,e,l+1,i),i=l)}}function fp(t,e,n){let i=t[e];t[e]=t[n],t[n]=i}Ge(Rd,"FeaturePositionMap");class Hs{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}}class Lt extends Hs{constructor(e){super(e),this.current=0}set(e,n,i){this.fetchUniformLocation(e,n)&&this.current!==i&&(this.current=i,this.gl.uniform1i(this.location,i))}}class ye extends Hs{constructor(e){super(e),this.current=0}set(e,n,i){this.fetchUniformLocation(e,n)&&this.current!==i&&(this.current=i,this.gl.uniform1f(this.location,i))}}class Nt extends Hs{constructor(e){super(e),this.current=[0,0]}set(e,n,i){this.fetchUniformLocation(e,n)&&(i[0]===this.current[0]&&i[1]===this.current[1]||(this.current=i,this.gl.uniform2f(this.location,i[0],i[1])))}}class It extends Hs{constructor(e){super(e),this.current=[0,0,0]}set(e,n,i){this.fetchUniformLocation(e,n)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]||(this.current=i,this.gl.uniform3f(this.location,i[0],i[1],i[2])))}}class Gr extends Hs{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,i){this.fetchUniformLocation(e,n)&&(i[0]===this.current[0]&&i[1]===this.current[1]&&i[2]===this.current[2]&&i[3]===this.current[3]||(this.current=i,this.gl.uniform4f(this.location,i[0],i[1],i[2],i[3])))}}class $c extends Hs{constructor(e){super(e),this.current=Rt.transparent}set(e,n,i){this.fetchUniformLocation(e,n)&&(i.r===this.current.r&&i.g===this.current.g&&i.b===this.current.b&&i.a===this.current.a||(this.current=i,this.gl.uniform4f(this.location,i.r,i.g,i.b,i.a)))}}let R3=new Float32Array(16);class Ct extends Hs{constructor(e){super(e),this.current=R3}set(e,n,i){if(this.fetchUniformLocation(e,n)){if(i[12]!==this.current[12]||i[0]!==this.current[0])return this.current=i,void this.gl.uniformMatrix4fv(this.location,!1,i);for(let r=1;r<16;r++)if(i[r]!==this.current[r]){this.current=i,this.gl.uniformMatrix4fv(this.location,!1,i);break}}}}let O3=new Float32Array(9);class H0 extends Hs{constructor(e){super(e),this.current=O3}set(e,n,i){if(this.fetchUniformLocation(e,n)){for(let r=0;r<9;r++)if(i[r]!==this.current[r]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}}let F3=new Float32Array(4);class q0 extends Hs{constructor(e){super(e),this.current=F3}set(e,n,i){if(this.fetchUniformLocation(e,n)){for(let r=0;r<4;r++)if(i[r]!==this.current[r]){this.current=i,this.gl.uniformMatrix2fv(this.location,!1,i);break}}}}function W0(t){return[yT(255*t.r,255*t.g),yT(255*t.b,255*t.a)]}class Od{constructor(e,n,i){this.value=e,this.uniformNames=n.map(r=>`u_${r}`),this.type=i}setUniform(e,n,i,r,o){n.set(e,o,r.constantOr(this.value))}getBinding(e,n){return this.type==="color"?new $c(e):new ye(e)}}class Gc{constructor(e,n){this.uniformNames=n.map(i=>`u_${i}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,n,i,r,o){let l=o==="u_pattern"||o==="u_dash"?this.pattern:o==="u_pixel_ratio"?this.pixelRatio:null;l&&n.set(e,o,l)}getBinding(e,n){return n==="u_pattern"||n==="u_dash"?new Gr(e):new ye(e)}}class qs{constructor(e,n,i,r){this.expression=e,this.type=i,this.maxValue=0,this.paintVertexAttributes=n.map(o=>({name:`a_${o}`,type:"Float32",components:i==="color"?2:1,offset:0})),this.paintVertexArray=new r}populatePaintArray(e,n,i,r,o,l,u){let h=this.paintVertexArray.length,p=this.expression.evaluate(new Hn(0,{brightness:l}),n,{},o,r,u);this.paintVertexArray.resize(e),this._setPaintValue(h,e,p)}updatePaintArray(e,n,i,r,o,l,u){let h=this.expression.evaluate({zoom:0,brightness:u},i,r,void 0,o);this._setPaintValue(e,n,h)}_setPaintValue(e,n,i){if(this.type==="color"){let r=W0(i);for(let o=e;o<n;o++)this.paintVertexArray.emplace(o,r[0],r[1])}else{for(let r=e;r<n;r++)this.paintVertexArray.emplace(r,i);this.maxValue=Math.max(this.maxValue,Math.abs(i))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class qo{constructor(e,n,i,r,o,l){this.expression=e,this.uniformNames=n.map(u=>`u_${u}_t`),this.type=i,this.useIntegerZoom=r,this.zoom=o,this.maxValue=0,this.paintVertexAttributes=n.map(u=>({name:`a_${u}`,type:"Float32",components:i==="color"?4:2,offset:0})),this.paintVertexArray=new l}populatePaintArray(e,n,i,r,o,l,u){let h=this.expression.evaluate(new Hn(this.zoom,{brightness:l}),n,{},o,r,u),p=this.expression.evaluate(new Hn(this.zoom+1,{brightness:l}),n,{},o,r,u),m=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(m,e,h,p)}updatePaintArray(e,n,i,r,o,l,u){let h=this.expression.evaluate({zoom:this.zoom,brightness:u},i,r,void 0,o),p=this.expression.evaluate({zoom:this.zoom+1,brightness:u},i,r,void 0,o);this._setPaintValue(e,n,h,p)}_setPaintValue(e,n,i,r){if(this.type==="color"){let o=W0(i),l=W0(r);for(let u=e;u<n;u++)this.paintVertexArray.emplace(u,o[0],o[1],l[0],l[1])}else{for(let o=e;o<n;o++)this.paintVertexArray.emplace(o,i,r);this.maxValue=Math.max(this.maxValue,Math.abs(i),Math.abs(r))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,i,r,o){let l=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,u=We(this.expression.interpolationFactor(l,this.zoom,this.zoom+1),0,1);n.set(e,o,u)}getBinding(e,n){return new ye(e)}}class Aa{constructor(e,n,i,r,o){this.expression=e,this.layerId=o,this.paintVertexAttributes=(i==="array"?S3:D3).members;for(let l=0;l<n.length;++l);this.paintVertexArray=new r}populatePaintArray(e,n,i){let r=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(r,e,n.patterns&&n.patterns[this.layerId],i)}updatePaintArray(e,n,i,r,o,l,u){this._setPaintValues(e,n,i.patterns&&i.patterns[this.layerId],l)}_setPaintValues(e,n,i,r){if(!r||!i)return;let o=r[i];if(!o)return;let{tl:l,br:u,pixelRatio:h}=o;for(let p=e;p<n;p++)this.paintVertexArray.emplace(p,l[0],l[1],u[0],u[1],h)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Fl{constructor(e,n,i=()=>!0){this.binders={},this._buffers=[];let r=[];for(let o in e.paint._values){let l=e.paint.get(o);if(!i(o)||!(l instanceof Uc&&Sl(l.property.specification)))continue;let u=L3(o,e.type),h=l.value,p=l.property.specification.type,m=!!l.property.useIntegerZoom,_=o==="line-dasharray"||o.endsWith("pattern"),y=o==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant";if(h.kind!=="constant"||y)if(h.kind==="source"||y||_){let v=CT(o,p,"source");this.binders[o]=_?new Aa(h,u,p,v,e.id):new qs(h,u,p,v),r.push(`/a_${o}`)}else{let v=CT(o,p,"composite");this.binders[o]=new qo(h,u,p,m,n,v),r.push(`/z_${o}`)}else this.binders[o]=_?new Gc(h.value,u):new Od(h.value,u,p),r.push(`/u_${o}`)}this.cacheKey=r.sort().join("")}getMaxValue(e){let n=this.binders[e];return n instanceof qs||n instanceof qo?n.maxValue:0}populatePaintArrays(e,n,i,r,o,l,u){for(let h in this.binders){let p=this.binders[h];(p instanceof qs||p instanceof qo||p instanceof Aa)&&p.populatePaintArray(e,n,i,r,o,l,u)}}setConstantPatternPositions(e){for(let n in this.binders){let i=this.binders[n];i instanceof Gc&&i.setConstantPatternPositions(e)}}updatePaintArrays(e,n,i,r,o,l,u,h){let p=!1,m=Object.keys(e),_=m.length!==0,y=_?m:n.uniqueIds;for(let v in this.binders){let b=this.binders[v];if((b instanceof qs||b instanceof qo||b instanceof Aa)&&(b.expression.isStateDependent===!0||b.expression.isLightConstant===!1)){let w=o.paint.get(v);b.expression=w.value;for(let C of y){let E=e[C.toString()];n.eachPosition(C,(I,D,S)=>{let M=r.feature(I);b.updatePaintArray(D,S,M,E,l,u,h)})}if(!_)for(let C of i.uniqueIds){let E=e[C.toString()];i.eachPosition(C,(I,D,S)=>{let M=r.feature(I);b.updatePaintArray(D,S,M,E,l,u,h)})}p=!0}}return p}defines(){let e=[];for(let n in this.binders){let i=this.binders[n];(i instanceof Od||i instanceof Gc)&&e.push(...i.uniformNames.map(r=>`#define HAS_UNIFORM_${r}`))}return e}getBinderAttributes(){let e=[];for(let n in this.binders){let i=this.binders[n];if(i instanceof qs||i instanceof qo||i instanceof Aa)for(let r=0;r<i.paintVertexAttributes.length;r++)e.push(i.paintVertexAttributes[r].name)}return e}getBinderUniforms(){let e=[];for(let n in this.binders){let i=this.binders[n];if(i instanceof Od||i instanceof Gc||i instanceof qo)for(let r of i.uniformNames)e.push(r)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){let n=[];for(let i in this.binders){let r=this.binders[i];if(r instanceof Od||r instanceof Gc||r instanceof qo)for(let o of r.uniformNames)n.push({name:o,property:i,binding:r.getBinding(e,o)})}return n}setUniforms(e,n,i,r,o){for(let{name:l,property:u,binding:h}of i)this.binders[u].setUniform(e,h,o,r.get(u),l)}updatePaintBuffers(){this._buffers=[];for(let e in this.binders){let n=this.binders[e];(n instanceof qs||n instanceof qo||n instanceof Aa)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(let n in this.binders){let i=this.binders[n];(i instanceof qs||i instanceof qo||i instanceof Aa)&&i.upload(e)}this.updatePaintBuffers()}destroy(){for(let e in this.binders){let n=this.binders[e];(n instanceof qs||n instanceof qo||n instanceof Aa)&&n.destroy()}}}class Pa{constructor(e,n,i=()=>!0){this.programConfigurations={};for(let r of e)this.programConfigurations[r.id]=new Fl(r,n,i);this.needsUpload=!1,this._featureMap=new Rd,this._featureMapWithoutIds=new Rd,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,n,i,r,o,l,u,h){for(let p in this.programConfigurations)this.programConfigurations[p].populatePaintArrays(e,n,r,o,l,u,h);n.id!==void 0?this._featureMap.add(n.id,i,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,i,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,i,r,o,l){for(let u of i)this.needsUpload=this.programConfigurations[u.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,n,u,r,o,l||0)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(let n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(let e in this.programConfigurations)this.programConfigurations[e].destroy()}}let k3={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function L3(t,e){return k3[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}let N3={"line-pattern":{source:Da,composite:Da},"fill-pattern":{source:Da,composite:Da},"fill-extrusion-pattern":{source:Da,composite:Da},"line-dasharray":{source:lp,composite:lp}},z3={color:{source:Pd,composite:Gs},number:{source:Sd,composite:Pd}};function CT(t,e,n){let i=N3[t];return i&&i[n]||z3[e][n]}Ge(Od,"ConstantBinder"),Ge(Gc,"PatternConstantBinder"),Ge(qs,"SourceExpressionBinder"),Ge(Aa,"PatternCompositeBinder"),Ge(qo,"CompositeExpressionBinder"),Ge(Fl,"ProgramConfiguration",{omit:["_buffers"]}),Ge(Pa,"ProgramConfigurationSet");class Hr{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof pt?new pt(e.lng,e.lat):pt.convert(e),this}setSouthWest(e){return this._sw=e instanceof pt?new pt(e.lng,e.lat):pt.convert(e),this}extend(e){let n=this._sw,i=this._ne,r,o;if(e instanceof pt)r=e,o=e;else{if(!(e instanceof Hr))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Hr.convert(e)):this.extend(pt.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(pt.convert(e)):this;if(r=e._sw,o=e._ne,!r||!o)return this}return n||i?(n.lng=Math.min(r.lng,n.lng),n.lat=Math.min(r.lat,n.lat),i.lng=Math.max(o.lng,i.lng),i.lat=Math.max(o.lat,i.lat)):(this._sw=new pt(r.lng,r.lat),this._ne=new pt(o.lng,o.lat)),this}getCenter(){return new pt((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new pt(this.getWest(),this.getNorth())}getSouthEast(){return new pt(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){let{lng:n,lat:i}=pt.convert(e),r=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(r=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=i&&i<=this._ne.lat&&r}static convert(e){return!e||e instanceof Hr?e:new Hr(e)}}var ki={},Li={};Object.defineProperty(Li,"__esModule",{value:!0}),Li.setMatrixArrayType=function(t){Li.ARRAY_TYPE=TT=t},Li.toRadian=function(t){return t*V3},Li.equals=function(t,e){return Math.abs(t-e)<=ET*Math.max(1,Math.abs(t),Math.abs(e))},Li.RANDOM=Li.ARRAY_TYPE=Li.EPSILON=void 0;var ET=1e-6;Li.EPSILON=ET;var TT=typeof Float32Array<"u"?Float32Array:Array;Li.ARRAY_TYPE=TT;var B3=Math.random;Li.RANDOM=B3;var V3=Math.PI/180;Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Wn={};function Z0(t){return Z0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Z0(t)}Object.defineProperty(Wn,"__esModule",{value:!0}),Wn.create=function(){var t=new Ra.ARRAY_TYPE(4);return Ra.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},Wn.clone=function(t){var e=new Ra.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},Wn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},Wn.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t},Wn.fromValues=function(t,e,n,i){var r=new Ra.ARRAY_TYPE(4);return r[0]=t,r[1]=e,r[2]=n,r[3]=i,r},Wn.set=function(t,e,n,i,r){return t[0]=e,t[1]=n,t[2]=i,t[3]=r,t},Wn.transpose=function(t,e){if(t===e){var n=e[1];t[1]=e[2],t[2]=n}else t[0]=e[0],t[1]=e[2],t[2]=e[1],t[3]=e[3];return t},Wn.invert=function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],l=n*o-r*i;return l?(t[0]=o*(l=1/l),t[1]=-i*l,t[2]=-r*l,t[3]=n*l,t):null},Wn.adjoint=function(t,e){var n=e[0];return t[0]=e[3],t[1]=-e[1],t[2]=-e[2],t[3]=n,t},Wn.determinant=function(t){return t[0]*t[3]-t[2]*t[1]},Wn.multiply=MT,Wn.rotate=function(t,e,n){var i=e[0],r=e[1],o=e[2],l=e[3],u=Math.sin(n),h=Math.cos(n);return t[0]=i*h+o*u,t[1]=r*h+l*u,t[2]=i*-u+o*h,t[3]=r*-u+l*h,t},Wn.scale=function(t,e,n){var i=e[1],r=e[2],o=e[3],l=n[0],u=n[1];return t[0]=e[0]*l,t[1]=i*l,t[2]=r*u,t[3]=o*u,t},Wn.fromRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=-n,t[3]=i,t},Wn.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t},Wn.str=function(t){return"mat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Wn.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},Wn.LDU=function(t,e,n,i){return t[2]=i[2]/i[0],n[0]=i[0],n[1]=i[1],n[3]=i[3]-t[2]*n[1],[t,e,n]},Wn.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},Wn.subtract=DT,Wn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},Wn.equals=function(t,e){var n=t[0],i=t[1],r=t[2],o=t[3],l=e[0],u=e[1],h=e[2],p=e[3];return Math.abs(n-l)<=Ra.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(i-u)<=Ra.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(r-h)<=Ra.EPSILON*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(o-p)<=Ra.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))},Wn.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},Wn.multiplyScalarAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t},Wn.sub=Wn.mul=void 0;var Ra=function(t,e){if(t&&t.__esModule)return t;if(t===null||Z0(t)!=="object"&&typeof t!="function")return{default:t};var n=IT(void 0);if(n&&n.has(t))return n.get(t);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if(o!=="default"&&Object.prototype.hasOwnProperty.call(t,o)){var l=r?Object.getOwnPropertyDescriptor(t,o):null;l&&(l.get||l.set)?Object.defineProperty(i,o,l):i[o]=t[o]}return i.default=t,n&&n.set(t,i),i}(Li);function IT(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(IT=function(i){return i?n:e})(t)}function MT(t,e,n){var i=e[0],r=e[1],o=e[2],l=e[3],u=n[0],h=n[1],p=n[2],m=n[3];return t[0]=i*u+o*h,t[1]=r*u+l*h,t[2]=i*p+o*m,t[3]=r*p+l*m,t}function DT(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}Wn.mul=MT,Wn.sub=DT;var Jn={};function X0(t){return X0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},X0(t)}Object.defineProperty(Jn,"__esModule",{value:!0}),Jn.create=function(){var t=new _s.ARRAY_TYPE(6);return _s.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[4]=0,t[5]=0),t[0]=1,t[3]=1,t},Jn.clone=function(t){var e=new _s.ARRAY_TYPE(6);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e},Jn.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},Jn.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t},Jn.fromValues=function(t,e,n,i,r,o){var l=new _s.ARRAY_TYPE(6);return l[0]=t,l[1]=e,l[2]=n,l[3]=i,l[4]=r,l[5]=o,l},Jn.set=function(t,e,n,i,r,o,l){return t[0]=e,t[1]=n,t[2]=i,t[3]=r,t[4]=o,t[5]=l,t},Jn.invert=function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],l=e[4],u=e[5],h=n*o-i*r;return h?(t[0]=o*(h=1/h),t[1]=-i*h,t[2]=-r*h,t[3]=n*h,t[4]=(r*u-o*l)*h,t[5]=(i*l-n*u)*h,t):null},Jn.determinant=function(t){return t[0]*t[3]-t[1]*t[2]},Jn.multiply=AT,Jn.rotate=function(t,e,n){var i=e[0],r=e[1],o=e[2],l=e[3],u=e[4],h=e[5],p=Math.sin(n),m=Math.cos(n);return t[0]=i*m+o*p,t[1]=r*m+l*p,t[2]=i*-p+o*m,t[3]=r*-p+l*m,t[4]=u,t[5]=h,t},Jn.scale=function(t,e,n){var i=e[1],r=e[2],o=e[3],l=e[4],u=e[5],h=n[0],p=n[1];return t[0]=e[0]*h,t[1]=i*h,t[2]=r*p,t[3]=o*p,t[4]=l,t[5]=u,t},Jn.translate=function(t,e,n){var i=e[0],r=e[1],o=e[2],l=e[3],u=e[4],h=e[5],p=n[0],m=n[1];return t[0]=i,t[1]=r,t[2]=o,t[3]=l,t[4]=i*p+o*m+u,t[5]=r*p+l*m+h,t},Jn.fromRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=-n,t[3]=i,t[4]=0,t[5]=0,t},Jn.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=e[1],t[4]=0,t[5]=0,t},Jn.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=1,t[4]=e[0],t[5]=e[1],t},Jn.str=function(t){return"mat2d("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+")"},Jn.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],1)},Jn.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t},Jn.subtract=PT,Jn.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t},Jn.multiplyScalarAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t[4]=e[4]+n[4]*i,t[5]=e[5]+n[5]*i,t},Jn.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]},Jn.equals=function(t,e){var n=t[0],i=t[1],r=t[2],o=t[3],l=t[4],u=t[5],h=e[0],p=e[1],m=e[2],_=e[3],y=e[4],v=e[5];return Math.abs(n-h)<=_s.EPSILON*Math.max(1,Math.abs(n),Math.abs(h))&&Math.abs(i-p)<=_s.EPSILON*Math.max(1,Math.abs(i),Math.abs(p))&&Math.abs(r-m)<=_s.EPSILON*Math.max(1,Math.abs(r),Math.abs(m))&&Math.abs(o-_)<=_s.EPSILON*Math.max(1,Math.abs(o),Math.abs(_))&&Math.abs(l-y)<=_s.EPSILON*Math.max(1,Math.abs(l),Math.abs(y))&&Math.abs(u-v)<=_s.EPSILON*Math.max(1,Math.abs(u),Math.abs(v))},Jn.sub=Jn.mul=void 0;var _s=function(t,e){if(t&&t.__esModule)return t;if(t===null||X0(t)!=="object"&&typeof t!="function")return{default:t};var n=ST(void 0);if(n&&n.has(t))return n.get(t);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if(o!=="default"&&Object.prototype.hasOwnProperty.call(t,o)){var l=r?Object.getOwnPropertyDescriptor(t,o):null;l&&(l.get||l.set)?Object.defineProperty(i,o,l):i[o]=t[o]}return i.default=t,n&&n.set(t,i),i}(Li);function ST(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(ST=function(i){return i?n:e})(t)}function AT(t,e,n){var i=e[0],r=e[1],o=e[2],l=e[3],u=e[4],h=e[5],p=n[0],m=n[1],_=n[2],y=n[3],v=n[4],b=n[5];return t[0]=i*p+o*m,t[1]=r*p+l*m,t[2]=i*_+o*y,t[3]=r*_+l*y,t[4]=i*v+o*b+u,t[5]=r*v+l*b+h,t}function PT(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t}Jn.mul=AT,Jn.sub=PT;var In={};function Y0(t){return Y0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Y0(t)}Object.defineProperty(In,"__esModule",{value:!0}),In.create=function(){var t=new ro.ARRAY_TYPE(9);return ro.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},In.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},In.clone=function(t){var e=new ro.ARRAY_TYPE(9);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e},In.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},In.fromValues=function(t,e,n,i,r,o,l,u,h){var p=new ro.ARRAY_TYPE(9);return p[0]=t,p[1]=e,p[2]=n,p[3]=i,p[4]=r,p[5]=o,p[6]=l,p[7]=u,p[8]=h,p},In.set=function(t,e,n,i,r,o,l,u,h,p){return t[0]=e,t[1]=n,t[2]=i,t[3]=r,t[4]=o,t[5]=l,t[6]=u,t[7]=h,t[8]=p,t},In.identity=function(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},In.transpose=function(t,e){if(t===e){var n=e[1],i=e[2],r=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=i,t[7]=r}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},In.invert=function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],l=e[4],u=e[5],h=e[6],p=e[7],m=e[8],_=m*l-u*p,y=-m*o+u*h,v=p*o-l*h,b=n*_+i*y+r*v;return b?(t[0]=_*(b=1/b),t[1]=(-m*i+r*p)*b,t[2]=(u*i-r*l)*b,t[3]=y*b,t[4]=(m*n-r*h)*b,t[5]=(-u*n+r*o)*b,t[6]=v*b,t[7]=(-p*n+i*h)*b,t[8]=(l*n-i*o)*b,t):null},In.adjoint=function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],l=e[4],u=e[5],h=e[6],p=e[7],m=e[8];return t[0]=l*m-u*p,t[1]=r*p-i*m,t[2]=i*u-r*l,t[3]=u*h-o*m,t[4]=n*m-r*h,t[5]=r*o-n*u,t[6]=o*p-l*h,t[7]=i*h-n*p,t[8]=n*l-i*o,t},In.determinant=function(t){var e=t[3],n=t[4],i=t[5],r=t[6],o=t[7],l=t[8];return t[0]*(l*n-i*o)+t[1]*(-l*e+i*r)+t[2]*(o*e-n*r)},In.multiply=OT,In.translate=function(t,e,n){var i=e[0],r=e[1],o=e[2],l=e[3],u=e[4],h=e[5],p=e[6],m=e[7],_=e[8],y=n[0],v=n[1];return t[0]=i,t[1]=r,t[2]=o,t[3]=l,t[4]=u,t[5]=h,t[6]=y*i+v*l+p,t[7]=y*r+v*u+m,t[8]=y*o+v*h+_,t},In.rotate=function(t,e,n){var i=e[0],r=e[1],o=e[2],l=e[3],u=e[4],h=e[5],p=e[6],m=e[7],_=e[8],y=Math.sin(n),v=Math.cos(n);return t[0]=v*i+y*l,t[1]=v*r+y*u,t[2]=v*o+y*h,t[3]=v*l-y*i,t[4]=v*u-y*r,t[5]=v*h-y*o,t[6]=p,t[7]=m,t[8]=_,t},In.scale=function(t,e,n){var i=n[0],r=n[1];return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=r*e[3],t[4]=r*e[4],t[5]=r*e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},In.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=1,t[5]=0,t[6]=e[0],t[7]=e[1],t[8]=1,t},In.fromRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=0,t[3]=-n,t[4]=i,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},In.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=e[1],t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},In.fromMat2d=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},In.fromQuat=function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],l=n+n,u=i+i,h=r+r,p=n*l,m=i*l,_=i*u,y=r*l,v=r*u,b=r*h,w=o*l,C=o*u,E=o*h;return t[0]=1-_-b,t[3]=m-E,t[6]=y+C,t[1]=m+E,t[4]=1-p-b,t[7]=v-w,t[2]=y-C,t[5]=v+w,t[8]=1-p-_,t},In.normalFromMat4=function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],l=e[4],u=e[5],h=e[6],p=e[7],m=e[8],_=e[9],y=e[10],v=e[11],b=e[12],w=e[13],C=e[14],E=e[15],I=n*u-i*l,D=n*h-r*l,S=n*p-o*l,M=i*h-r*u,A=i*p-o*u,R=r*p-o*h,F=m*w-_*b,k=m*C-y*b,L=m*E-v*b,z=_*C-y*w,B=_*E-v*w,G=y*E-v*C,N=I*G-D*B+S*z+M*L-A*k+R*F;return N?(t[0]=(u*G-h*B+p*z)*(N=1/N),t[1]=(h*L-l*G-p*k)*N,t[2]=(l*B-u*L+p*F)*N,t[3]=(r*B-i*G-o*z)*N,t[4]=(n*G-r*L+o*k)*N,t[5]=(i*L-n*B-o*F)*N,t[6]=(w*R-C*A+E*M)*N,t[7]=(C*S-b*R-E*D)*N,t[8]=(b*A-w*S+E*I)*N,t):null},In.projection=function(t,e,n){return t[0]=2/e,t[1]=0,t[2]=0,t[3]=0,t[4]=-2/n,t[5]=0,t[6]=-1,t[7]=1,t[8]=1,t},In.str=function(t){return"mat3("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+")"},In.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8])},In.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t},In.subtract=FT,In.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t},In.multiplyScalarAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t[4]=e[4]+n[4]*i,t[5]=e[5]+n[5]*i,t[6]=e[6]+n[6]*i,t[7]=e[7]+n[7]*i,t[8]=e[8]+n[8]*i,t},In.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]},In.equals=function(t,e){var n=t[0],i=t[1],r=t[2],o=t[3],l=t[4],u=t[5],h=t[6],p=t[7],m=t[8],_=e[0],y=e[1],v=e[2],b=e[3],w=e[4],C=e[5],E=e[6],I=e[7],D=e[8];return Math.abs(n-_)<=ro.EPSILON*Math.max(1,Math.abs(n),Math.abs(_))&&Math.abs(i-y)<=ro.EPSILON*Math.max(1,Math.abs(i),Math.abs(y))&&Math.abs(r-v)<=ro.EPSILON*Math.max(1,Math.abs(r),Math.abs(v))&&Math.abs(o-b)<=ro.EPSILON*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(l-w)<=ro.EPSILON*Math.max(1,Math.abs(l),Math.abs(w))&&Math.abs(u-C)<=ro.EPSILON*Math.max(1,Math.abs(u),Math.abs(C))&&Math.abs(h-E)<=ro.EPSILON*Math.max(1,Math.abs(h),Math.abs(E))&&Math.abs(p-I)<=ro.EPSILON*Math.max(1,Math.abs(p),Math.abs(I))&&Math.abs(m-D)<=ro.EPSILON*Math.max(1,Math.abs(m),Math.abs(D))},In.sub=In.mul=void 0;var ro=function(t,e){if(t&&t.__esModule)return t;if(t===null||Y0(t)!=="object"&&typeof t!="function")return{default:t};var n=RT(void 0);if(n&&n.has(t))return n.get(t);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if(o!=="default"&&Object.prototype.hasOwnProperty.call(t,o)){var l=r?Object.getOwnPropertyDescriptor(t,o):null;l&&(l.get||l.set)?Object.defineProperty(i,o,l):i[o]=t[o]}return i.default=t,n&&n.set(t,i),i}(Li);function RT(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(RT=function(i){return i?n:e})(t)}function OT(t,e,n){var i=e[0],r=e[1],o=e[2],l=e[3],u=e[4],h=e[5],p=e[6],m=e[7],_=e[8],y=n[0],v=n[1],b=n[2],w=n[3],C=n[4],E=n[5],I=n[6],D=n[7],S=n[8];return t[0]=y*i+v*l+b*p,t[1]=y*r+v*u+b*m,t[2]=y*o+v*h+b*_,t[3]=w*i+C*l+E*p,t[4]=w*r+C*u+E*m,t[5]=w*o+C*h+E*_,t[6]=I*i+D*l+S*p,t[7]=I*r+D*u+S*m,t[8]=I*o+D*h+S*_,t}function FT(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t}In.mul=OT,In.sub=FT;var Dt={};function K0(t){return K0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},K0(t)}Object.defineProperty(Dt,"__esModule",{value:!0}),Dt.create=function(){var t=new oi.ARRAY_TYPE(16);return oi.ARRAY_TYPE!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},Dt.clone=function(t){var e=new oi.ARRAY_TYPE(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},Dt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Dt.fromValues=function(t,e,n,i,r,o,l,u,h,p,m,_,y,v,b,w){var C=new oi.ARRAY_TYPE(16);return C[0]=t,C[1]=e,C[2]=n,C[3]=i,C[4]=r,C[5]=o,C[6]=l,C[7]=u,C[8]=h,C[9]=p,C[10]=m,C[11]=_,C[12]=y,C[13]=v,C[14]=b,C[15]=w,C},Dt.set=function(t,e,n,i,r,o,l,u,h,p,m,_,y,v,b,w,C){return t[0]=e,t[1]=n,t[2]=i,t[3]=r,t[4]=o,t[5]=l,t[6]=u,t[7]=h,t[8]=p,t[9]=m,t[10]=_,t[11]=y,t[12]=v,t[13]=b,t[14]=w,t[15]=C,t},Dt.identity=LT,Dt.transpose=function(t,e){if(t===e){var n=e[1],i=e[2],r=e[3],o=e[6],l=e[7],u=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=o,t[11]=e[14],t[12]=r,t[13]=l,t[14]=u}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t},Dt.invert=function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],l=e[4],u=e[5],h=e[6],p=e[7],m=e[8],_=e[9],y=e[10],v=e[11],b=e[12],w=e[13],C=e[14],E=e[15],I=n*u-i*l,D=n*h-r*l,S=n*p-o*l,M=i*h-r*u,A=i*p-o*u,R=r*p-o*h,F=m*w-_*b,k=m*C-y*b,L=m*E-v*b,z=_*C-y*w,B=_*E-v*w,G=y*E-v*C,N=I*G-D*B+S*z+M*L-A*k+R*F;return N?(t[0]=(u*G-h*B+p*z)*(N=1/N),t[1]=(r*B-i*G-o*z)*N,t[2]=(w*R-C*A+E*M)*N,t[3]=(y*A-_*R-v*M)*N,t[4]=(h*L-l*G-p*k)*N,t[5]=(n*G-r*L+o*k)*N,t[6]=(C*S-b*R-E*D)*N,t[7]=(m*R-y*S+v*D)*N,t[8]=(l*B-u*L+p*F)*N,t[9]=(i*L-n*B-o*F)*N,t[10]=(b*A-w*S+E*I)*N,t[11]=(_*S-m*A-v*I)*N,t[12]=(u*k-l*z-h*F)*N,t[13]=(n*z-i*k+r*F)*N,t[14]=(w*D-b*M-C*I)*N,t[15]=(m*M-_*D+y*I)*N,t):null},Dt.adjoint=function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],l=e[4],u=e[5],h=e[6],p=e[7],m=e[8],_=e[9],y=e[10],v=e[11],b=e[12],w=e[13],C=e[14],E=e[15];return t[0]=u*(y*E-v*C)-_*(h*E-p*C)+w*(h*v-p*y),t[1]=-(i*(y*E-v*C)-_*(r*E-o*C)+w*(r*v-o*y)),t[2]=i*(h*E-p*C)-u*(r*E-o*C)+w*(r*p-o*h),t[3]=-(i*(h*v-p*y)-u*(r*v-o*y)+_*(r*p-o*h)),t[4]=-(l*(y*E-v*C)-m*(h*E-p*C)+b*(h*v-p*y)),t[5]=n*(y*E-v*C)-m*(r*E-o*C)+b*(r*v-o*y),t[6]=-(n*(h*E-p*C)-l*(r*E-o*C)+b*(r*p-o*h)),t[7]=n*(h*v-p*y)-l*(r*v-o*y)+m*(r*p-o*h),t[8]=l*(_*E-v*w)-m*(u*E-p*w)+b*(u*v-p*_),t[9]=-(n*(_*E-v*w)-m*(i*E-o*w)+b*(i*v-o*_)),t[10]=n*(u*E-p*w)-l*(i*E-o*w)+b*(i*p-o*u),t[11]=-(n*(u*v-p*_)-l*(i*v-o*_)+m*(i*p-o*u)),t[12]=-(l*(_*C-y*w)-m*(u*C-h*w)+b*(u*y-h*_)),t[13]=n*(_*C-y*w)-m*(i*C-r*w)+b*(i*y-r*_),t[14]=-(n*(u*C-h*w)-l*(i*C-r*w)+b*(i*h-r*u)),t[15]=n*(u*y-h*_)-l*(i*y-r*_)+m*(i*h-r*u),t},Dt.determinant=function(t){var e=t[0],n=t[1],i=t[2],r=t[3],o=t[4],l=t[5],u=t[6],h=t[7],p=t[8],m=t[9],_=t[10],y=t[11],v=t[12],b=t[13],w=t[14],C=t[15];return(e*l-n*o)*(_*C-y*w)-(e*u-i*o)*(m*C-y*b)+(e*h-r*o)*(m*w-_*b)+(n*u-i*l)*(p*C-y*v)-(n*h-r*l)*(p*w-_*v)+(i*h-r*u)*(p*b-m*v)},Dt.multiply=NT,Dt.translate=function(t,e,n){var i,r,o,l,u,h,p,m,_,y,v,b,w=n[0],C=n[1],E=n[2];return e===t?(t[12]=e[0]*w+e[4]*C+e[8]*E+e[12],t[13]=e[1]*w+e[5]*C+e[9]*E+e[13],t[14]=e[2]*w+e[6]*C+e[10]*E+e[14],t[15]=e[3]*w+e[7]*C+e[11]*E+e[15]):(r=e[1],o=e[2],l=e[3],u=e[4],h=e[5],p=e[6],m=e[7],_=e[8],y=e[9],v=e[10],b=e[11],t[0]=i=e[0],t[1]=r,t[2]=o,t[3]=l,t[4]=u,t[5]=h,t[6]=p,t[7]=m,t[8]=_,t[9]=y,t[10]=v,t[11]=b,t[12]=i*w+u*C+_*E+e[12],t[13]=r*w+h*C+y*E+e[13],t[14]=o*w+p*C+v*E+e[14],t[15]=l*w+m*C+b*E+e[15]),t},Dt.scale=function(t,e,n){var i=n[0],r=n[1],o=n[2];return t[0]=e[0]*i,t[1]=e[1]*i,t[2]=e[2]*i,t[3]=e[3]*i,t[4]=e[4]*r,t[5]=e[5]*r,t[6]=e[6]*r,t[7]=e[7]*r,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},Dt.rotate=function(t,e,n,i){var r,o,l,u,h,p,m,_,y,v,b,w,C,E,I,D,S,M,A,R,F,k,L,z,B=i[0],G=i[1],N=i[2],W=Math.hypot(B,G,N);return W<oi.EPSILON?null:(B*=W=1/W,G*=W,N*=W,r=Math.sin(n),o=Math.cos(n),h=e[1],p=e[2],m=e[3],y=e[5],v=e[6],b=e[7],C=e[9],E=e[10],I=e[11],A=B*G*(l=1-o)-N*r,R=G*G*l+o,F=N*G*l+B*r,k=B*N*l+G*r,L=G*N*l-B*r,z=N*N*l+o,t[0]=(u=e[0])*(D=B*B*l+o)+(_=e[4])*(S=G*B*l+N*r)+(w=e[8])*(M=N*B*l-G*r),t[1]=h*D+y*S+C*M,t[2]=p*D+v*S+E*M,t[3]=m*D+b*S+I*M,t[4]=u*A+_*R+w*F,t[5]=h*A+y*R+C*F,t[6]=p*A+v*R+E*F,t[7]=m*A+b*R+I*F,t[8]=u*k+_*L+w*z,t[9]=h*k+y*L+C*z,t[10]=p*k+v*L+E*z,t[11]=m*k+b*L+I*z,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)},Dt.rotateX=function(t,e,n){var i=Math.sin(n),r=Math.cos(n),o=e[4],l=e[5],u=e[6],h=e[7],p=e[8],m=e[9],_=e[10],y=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*r+p*i,t[5]=l*r+m*i,t[6]=u*r+_*i,t[7]=h*r+y*i,t[8]=p*r-o*i,t[9]=m*r-l*i,t[10]=_*r-u*i,t[11]=y*r-h*i,t},Dt.rotateY=function(t,e,n){var i=Math.sin(n),r=Math.cos(n),o=e[0],l=e[1],u=e[2],h=e[3],p=e[8],m=e[9],_=e[10],y=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r-p*i,t[1]=l*r-m*i,t[2]=u*r-_*i,t[3]=h*r-y*i,t[8]=o*i+p*r,t[9]=l*i+m*r,t[10]=u*i+_*r,t[11]=h*i+y*r,t},Dt.rotateZ=function(t,e,n){var i=Math.sin(n),r=Math.cos(n),o=e[0],l=e[1],u=e[2],h=e[3],p=e[4],m=e[5],_=e[6],y=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*r+p*i,t[1]=l*r+m*i,t[2]=u*r+_*i,t[3]=h*r+y*i,t[4]=p*r-o*i,t[5]=m*r-l*i,t[6]=_*r-u*i,t[7]=y*r-h*i,t},Dt.fromTranslation=function(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t},Dt.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Dt.fromRotation=function(t,e,n){var i,r,o,l=n[0],u=n[1],h=n[2],p=Math.hypot(l,u,h);return p<oi.EPSILON?null:(l*=p=1/p,u*=p,h*=p,i=Math.sin(e),r=Math.cos(e),t[0]=l*l*(o=1-r)+r,t[1]=u*l*o+h*i,t[2]=h*l*o-u*i,t[3]=0,t[4]=l*u*o-h*i,t[5]=u*u*o+r,t[6]=h*u*o+l*i,t[7]=0,t[8]=l*h*o+u*i,t[9]=u*h*o-l*i,t[10]=h*h*o+r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)},Dt.fromXRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=i,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Dt.fromYRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Dt.fromZRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t[0]=i,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=i,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Dt.fromRotationTranslation=zT,Dt.fromQuat2=function(t,e){var n=new oi.ARRAY_TYPE(3),i=-e[0],r=-e[1],o=-e[2],l=e[3],u=e[4],h=e[5],p=e[6],m=e[7],_=i*i+r*r+o*o+l*l;return _>0?(n[0]=2*(u*l+m*i+h*o-p*r)/_,n[1]=2*(h*l+m*r+p*i-u*o)/_,n[2]=2*(p*l+m*o+u*r-h*i)/_):(n[0]=2*(u*l+m*i+h*o-p*r),n[1]=2*(h*l+m*r+p*i-u*o),n[2]=2*(p*l+m*o+u*r-h*i)),zT(t,e,n),t},Dt.getTranslation=function(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t},Dt.getScaling=BT,Dt.getRotation=function(t,e){var n=new oi.ARRAY_TYPE(3);BT(n,e);var i=1/n[0],r=1/n[1],o=1/n[2],l=e[0]*i,u=e[1]*r,h=e[2]*o,p=e[4]*i,m=e[5]*r,_=e[6]*o,y=e[8]*i,v=e[9]*r,b=e[10]*o,w=l+m+b,C=0;return w>0?(C=2*Math.sqrt(w+1),t[3]=.25*C,t[0]=(_-v)/C,t[1]=(y-h)/C,t[2]=(u-p)/C):l>m&&l>b?(C=2*Math.sqrt(1+l-m-b),t[3]=(_-v)/C,t[0]=.25*C,t[1]=(u+p)/C,t[2]=(y+h)/C):m>b?(C=2*Math.sqrt(1+m-l-b),t[3]=(y-h)/C,t[0]=(u+p)/C,t[1]=.25*C,t[2]=(_+v)/C):(C=2*Math.sqrt(1+b-l-m),t[3]=(u-p)/C,t[0]=(y+h)/C,t[1]=(_+v)/C,t[2]=.25*C),t},Dt.fromRotationTranslationScale=function(t,e,n,i){var r=e[0],o=e[1],l=e[2],u=e[3],h=r+r,p=o+o,m=l+l,_=r*h,y=r*p,v=r*m,b=o*p,w=o*m,C=l*m,E=u*h,I=u*p,D=u*m,S=i[0],M=i[1],A=i[2];return t[0]=(1-(b+C))*S,t[1]=(y+D)*S,t[2]=(v-I)*S,t[3]=0,t[4]=(y-D)*M,t[5]=(1-(_+C))*M,t[6]=(w+E)*M,t[7]=0,t[8]=(v+I)*A,t[9]=(w-E)*A,t[10]=(1-(_+b))*A,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t},Dt.fromRotationTranslationScaleOrigin=function(t,e,n,i,r){var o=e[0],l=e[1],u=e[2],h=e[3],p=o+o,m=l+l,_=u+u,y=o*p,v=o*m,b=o*_,w=l*m,C=l*_,E=u*_,I=h*p,D=h*m,S=h*_,M=i[0],A=i[1],R=i[2],F=r[0],k=r[1],L=r[2],z=(1-(w+E))*M,B=(v+S)*M,G=(b-D)*M,N=(v-S)*A,W=(1-(y+E))*A,Y=(C+I)*A,te=(b+D)*R,q=(C-I)*R,X=(1-(y+w))*R;return t[0]=z,t[1]=B,t[2]=G,t[3]=0,t[4]=N,t[5]=W,t[6]=Y,t[7]=0,t[8]=te,t[9]=q,t[10]=X,t[11]=0,t[12]=n[0]+F-(z*F+N*k+te*L),t[13]=n[1]+k-(B*F+W*k+q*L),t[14]=n[2]+L-(G*F+Y*k+X*L),t[15]=1,t},Dt.fromQuat=function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],l=n+n,u=i+i,h=r+r,p=n*l,m=i*l,_=i*u,y=r*l,v=r*u,b=r*h,w=o*l,C=o*u,E=o*h;return t[0]=1-_-b,t[1]=m+E,t[2]=y-C,t[3]=0,t[4]=m-E,t[5]=1-p-b,t[6]=v+w,t[7]=0,t[8]=y+C,t[9]=v-w,t[10]=1-p-_,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},Dt.frustum=function(t,e,n,i,r,o,l){var u=1/(n-e),h=1/(r-i),p=1/(o-l);return t[0]=2*o*u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*h,t[6]=0,t[7]=0,t[8]=(n+e)*u,t[9]=(r+i)*h,t[10]=(l+o)*p,t[11]=-1,t[12]=0,t[13]=0,t[14]=l*o*2*p,t[15]=0,t},Dt.perspectiveNO=VT,Dt.perspectiveZO=function(t,e,n,i,r){var o,l=1/Math.tan(e/2);return t[0]=l/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,r!=null&&r!==1/0?(t[10]=r*(o=1/(i-r)),t[14]=r*i*o):(t[10]=-1,t[14]=-i),t},Dt.perspectiveFromFieldOfView=function(t,e,n,i){var r=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),l=Math.tan(e.leftDegrees*Math.PI/180),u=Math.tan(e.rightDegrees*Math.PI/180),h=2/(l+u),p=2/(r+o);return t[0]=h,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=p,t[6]=0,t[7]=0,t[8]=-(l-u)*h*.5,t[9]=(r-o)*p*.5,t[10]=i/(n-i),t[11]=-1,t[12]=0,t[13]=0,t[14]=i*n/(n-i),t[15]=0,t},Dt.orthoNO=jT,Dt.orthoZO=function(t,e,n,i,r,o,l){var u=1/(e-n),h=1/(i-r),p=1/(o-l);return t[0]=-2*u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=p,t[11]=0,t[12]=(e+n)*u,t[13]=(r+i)*h,t[14]=o*p,t[15]=1,t},Dt.lookAt=function(t,e,n,i){var r,o,l,u,h,p,m,_,y,v,b=e[0],w=e[1],C=e[2],E=i[0],I=i[1],D=i[2],S=n[0],M=n[1],A=n[2];return Math.abs(b-S)<oi.EPSILON&&Math.abs(w-M)<oi.EPSILON&&Math.abs(C-A)<oi.EPSILON?LT(t):(m=b-S,_=w-M,y=C-A,r=I*(y*=v=1/Math.hypot(m,_,y))-D*(_*=v),o=D*(m*=v)-E*y,l=E*_-I*m,(v=Math.hypot(r,o,l))?(r*=v=1/v,o*=v,l*=v):(r=0,o=0,l=0),u=_*l-y*o,h=y*r-m*l,p=m*o-_*r,(v=Math.hypot(u,h,p))?(u*=v=1/v,h*=v,p*=v):(u=0,h=0,p=0),t[0]=r,t[1]=u,t[2]=m,t[3]=0,t[4]=o,t[5]=h,t[6]=_,t[7]=0,t[8]=l,t[9]=p,t[10]=y,t[11]=0,t[12]=-(r*b+o*w+l*C),t[13]=-(u*b+h*w+p*C),t[14]=-(m*b+_*w+y*C),t[15]=1,t)},Dt.targetTo=function(t,e,n,i){var r=e[0],o=e[1],l=e[2],u=i[0],h=i[1],p=i[2],m=r-n[0],_=o-n[1],y=l-n[2],v=m*m+_*_+y*y;v>0&&(m*=v=1/Math.sqrt(v),_*=v,y*=v);var b=h*y-p*_,w=p*m-u*y,C=u*_-h*m;return(v=b*b+w*w+C*C)>0&&(b*=v=1/Math.sqrt(v),w*=v,C*=v),t[0]=b,t[1]=w,t[2]=C,t[3]=0,t[4]=_*C-y*w,t[5]=y*b-m*C,t[6]=m*w-_*b,t[7]=0,t[8]=m,t[9]=_,t[10]=y,t[11]=0,t[12]=r,t[13]=o,t[14]=l,t[15]=1,t},Dt.str=function(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"},Dt.frob=function(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])},Dt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t},Dt.subtract=UT,Dt.multiplyScalar=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t},Dt.multiplyScalarAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t[4]=e[4]+n[4]*i,t[5]=e[5]+n[5]*i,t[6]=e[6]+n[6]*i,t[7]=e[7]+n[7]*i,t[8]=e[8]+n[8]*i,t[9]=e[9]+n[9]*i,t[10]=e[10]+n[10]*i,t[11]=e[11]+n[11]*i,t[12]=e[12]+n[12]*i,t[13]=e[13]+n[13]*i,t[14]=e[14]+n[14]*i,t[15]=e[15]+n[15]*i,t},Dt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]},Dt.equals=function(t,e){var n=t[0],i=t[1],r=t[2],o=t[3],l=t[4],u=t[5],h=t[6],p=t[7],m=t[8],_=t[9],y=t[10],v=t[11],b=t[12],w=t[13],C=t[14],E=t[15],I=e[0],D=e[1],S=e[2],M=e[3],A=e[4],R=e[5],F=e[6],k=e[7],L=e[8],z=e[9],B=e[10],G=e[11],N=e[12],W=e[13],Y=e[14],te=e[15];return Math.abs(n-I)<=oi.EPSILON*Math.max(1,Math.abs(n),Math.abs(I))&&Math.abs(i-D)<=oi.EPSILON*Math.max(1,Math.abs(i),Math.abs(D))&&Math.abs(r-S)<=oi.EPSILON*Math.max(1,Math.abs(r),Math.abs(S))&&Math.abs(o-M)<=oi.EPSILON*Math.max(1,Math.abs(o),Math.abs(M))&&Math.abs(l-A)<=oi.EPSILON*Math.max(1,Math.abs(l),Math.abs(A))&&Math.abs(u-R)<=oi.EPSILON*Math.max(1,Math.abs(u),Math.abs(R))&&Math.abs(h-F)<=oi.EPSILON*Math.max(1,Math.abs(h),Math.abs(F))&&Math.abs(p-k)<=oi.EPSILON*Math.max(1,Math.abs(p),Math.abs(k))&&Math.abs(m-L)<=oi.EPSILON*Math.max(1,Math.abs(m),Math.abs(L))&&Math.abs(_-z)<=oi.EPSILON*Math.max(1,Math.abs(_),Math.abs(z))&&Math.abs(y-B)<=oi.EPSILON*Math.max(1,Math.abs(y),Math.abs(B))&&Math.abs(v-G)<=oi.EPSILON*Math.max(1,Math.abs(v),Math.abs(G))&&Math.abs(b-N)<=oi.EPSILON*Math.max(1,Math.abs(b),Math.abs(N))&&Math.abs(w-W)<=oi.EPSILON*Math.max(1,Math.abs(w),Math.abs(W))&&Math.abs(C-Y)<=oi.EPSILON*Math.max(1,Math.abs(C),Math.abs(Y))&&Math.abs(E-te)<=oi.EPSILON*Math.max(1,Math.abs(E),Math.abs(te))},Dt.sub=Dt.mul=Dt.ortho=Dt.perspective=void 0;var oi=function(t,e){if(t&&t.__esModule)return t;if(t===null||K0(t)!=="object"&&typeof t!="function")return{default:t};var n=kT(void 0);if(n&&n.has(t))return n.get(t);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if(o!=="default"&&Object.prototype.hasOwnProperty.call(t,o)){var l=r?Object.getOwnPropertyDescriptor(t,o):null;l&&(l.get||l.set)?Object.defineProperty(i,o,l):i[o]=t[o]}return i.default=t,n&&n.set(t,i),i}(Li);function kT(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(kT=function(i){return i?n:e})(t)}function LT(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function NT(t,e,n){var i=e[0],r=e[1],o=e[2],l=e[3],u=e[4],h=e[5],p=e[6],m=e[7],_=e[8],y=e[9],v=e[10],b=e[11],w=e[12],C=e[13],E=e[14],I=e[15],D=n[0],S=n[1],M=n[2],A=n[3];return t[0]=D*i+S*u+M*_+A*w,t[1]=D*r+S*h+M*y+A*C,t[2]=D*o+S*p+M*v+A*E,t[3]=D*l+S*m+M*b+A*I,t[4]=(D=n[4])*i+(S=n[5])*u+(M=n[6])*_+(A=n[7])*w,t[5]=D*r+S*h+M*y+A*C,t[6]=D*o+S*p+M*v+A*E,t[7]=D*l+S*m+M*b+A*I,t[8]=(D=n[8])*i+(S=n[9])*u+(M=n[10])*_+(A=n[11])*w,t[9]=D*r+S*h+M*y+A*C,t[10]=D*o+S*p+M*v+A*E,t[11]=D*l+S*m+M*b+A*I,t[12]=(D=n[12])*i+(S=n[13])*u+(M=n[14])*_+(A=n[15])*w,t[13]=D*r+S*h+M*y+A*C,t[14]=D*o+S*p+M*v+A*E,t[15]=D*l+S*m+M*b+A*I,t}function zT(t,e,n){var i=e[0],r=e[1],o=e[2],l=e[3],u=i+i,h=r+r,p=o+o,m=i*u,_=i*h,y=i*p,v=r*h,b=r*p,w=o*p,C=l*u,E=l*h,I=l*p;return t[0]=1-(v+w),t[1]=_+I,t[2]=y-E,t[3]=0,t[4]=_-I,t[5]=1-(m+w),t[6]=b+C,t[7]=0,t[8]=y+E,t[9]=b-C,t[10]=1-(m+v),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function BT(t,e){var n=e[4],i=e[5],r=e[6],o=e[8],l=e[9],u=e[10];return t[0]=Math.hypot(e[0],e[1],e[2]),t[1]=Math.hypot(n,i,r),t[2]=Math.hypot(o,l,u),t}function VT(t,e,n,i,r){var o,l=1/Math.tan(e/2);return t[0]=l/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=l,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,r!=null&&r!==1/0?(t[10]=(r+i)*(o=1/(i-r)),t[14]=2*r*i*o):(t[10]=-1,t[14]=-2*i),t}function jT(t,e,n,i,r,o,l){var u=1/(e-n),h=1/(i-r),p=1/(o-l);return t[0]=-2*u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*h,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*p,t[11]=0,t[12]=(e+n)*u,t[13]=(r+i)*h,t[14]=(l+o)*p,t[15]=1,t}function UT(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}Dt.perspective=VT,Dt.ortho=jT,Dt.mul=NT,Dt.sub=UT;var Et={},Mt={};function J0(t){return J0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},J0(t)}Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.create=GT,Mt.clone=function(t){var e=new Ws.ARRAY_TYPE(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},Mt.length=HT,Mt.fromValues=function(t,e,n){var i=new Ws.ARRAY_TYPE(3);return i[0]=t,i[1]=e,i[2]=n,i},Mt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},Mt.set=function(t,e,n,i){return t[0]=e,t[1]=n,t[2]=i,t},Mt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t},Mt.subtract=qT,Mt.multiply=WT,Mt.divide=ZT,Mt.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t},Mt.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t},Mt.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t},Mt.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t},Mt.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t},Mt.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t},Mt.scaleAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t},Mt.distance=XT,Mt.squaredDistance=YT,Mt.squaredLength=KT,Mt.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t},Mt.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t},Mt.normalize=function(t,e){var n=e[0],i=e[1],r=e[2],o=n*n+i*i+r*r;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t},Mt.dot=JT,Mt.cross=function(t,e,n){var i=e[0],r=e[1],o=e[2],l=n[0],u=n[1],h=n[2];return t[0]=r*h-o*u,t[1]=o*l-i*h,t[2]=i*u-r*l,t},Mt.lerp=function(t,e,n,i){var r=e[0],o=e[1],l=e[2];return t[0]=r+i*(n[0]-r),t[1]=o+i*(n[1]-o),t[2]=l+i*(n[2]-l),t},Mt.hermite=function(t,e,n,i,r,o){var l=o*o,u=l*(2*o-3)+1,h=l*(o-2)+o,p=l*(o-1),m=l*(3-2*o);return t[0]=e[0]*u+n[0]*h+i[0]*p+r[0]*m,t[1]=e[1]*u+n[1]*h+i[1]*p+r[1]*m,t[2]=e[2]*u+n[2]*h+i[2]*p+r[2]*m,t},Mt.bezier=function(t,e,n,i,r,o){var l=1-o,u=l*l,h=o*o,p=u*l,m=3*o*u,_=3*h*l,y=h*o;return t[0]=e[0]*p+n[0]*m+i[0]*_+r[0]*y,t[1]=e[1]*p+n[1]*m+i[1]*_+r[1]*y,t[2]=e[2]*p+n[2]*m+i[2]*_+r[2]*y,t},Mt.random=function(t,e){e=e||1;var n=2*Ws.RANDOM()*Math.PI,i=2*Ws.RANDOM()-1,r=Math.sqrt(1-i*i)*e;return t[0]=Math.cos(n)*r,t[1]=Math.sin(n)*r,t[2]=i*e,t},Mt.transformMat4=function(t,e,n){var i=e[0],r=e[1],o=e[2],l=n[3]*i+n[7]*r+n[11]*o+n[15];return t[0]=(n[0]*i+n[4]*r+n[8]*o+n[12])/(l=l||1),t[1]=(n[1]*i+n[5]*r+n[9]*o+n[13])/l,t[2]=(n[2]*i+n[6]*r+n[10]*o+n[14])/l,t},Mt.transformMat3=function(t,e,n){var i=e[0],r=e[1],o=e[2];return t[0]=i*n[0]+r*n[3]+o*n[6],t[1]=i*n[1]+r*n[4]+o*n[7],t[2]=i*n[2]+r*n[5]+o*n[8],t},Mt.transformQuat=function(t,e,n){var i=n[0],r=n[1],o=n[2],l=e[0],u=e[1],h=e[2],p=r*h-o*u,m=o*l-i*h,_=i*u-r*l,y=r*_-o*m,v=o*p-i*_,b=i*m-r*p,w=2*n[3];return m*=w,_*=w,v*=2,b*=2,t[0]=l+(p*=w)+(y*=2),t[1]=u+m+v,t[2]=h+_+b,t},Mt.rotateX=function(t,e,n,i){var r=[],o=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],o[0]=r[0],o[1]=r[1]*Math.cos(i)-r[2]*Math.sin(i),o[2]=r[1]*Math.sin(i)+r[2]*Math.cos(i),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t},Mt.rotateY=function(t,e,n,i){var r=[],o=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],o[0]=r[2]*Math.sin(i)+r[0]*Math.cos(i),o[1]=r[1],o[2]=r[2]*Math.cos(i)-r[0]*Math.sin(i),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t},Mt.rotateZ=function(t,e,n,i){var r=[],o=[];return r[0]=e[0]-n[0],r[1]=e[1]-n[1],r[2]=e[2]-n[2],o[0]=r[0]*Math.cos(i)-r[1]*Math.sin(i),o[1]=r[0]*Math.sin(i)+r[1]*Math.cos(i),o[2]=r[2],t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t},Mt.angle=function(t,e){var n=t[0],i=t[1],r=t[2],o=e[0],l=e[1],u=e[2],h=Math.sqrt(n*n+i*i+r*r)*Math.sqrt(o*o+l*l+u*u),p=h&&JT(t,e)/h;return Math.acos(Math.min(Math.max(p,-1),1))},Mt.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t},Mt.str=function(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"},Mt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},Mt.equals=function(t,e){var n=t[0],i=t[1],r=t[2],o=e[0],l=e[1],u=e[2];return Math.abs(n-o)<=Ws.EPSILON*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(i-l)<=Ws.EPSILON*Math.max(1,Math.abs(i),Math.abs(l))&&Math.abs(r-u)<=Ws.EPSILON*Math.max(1,Math.abs(r),Math.abs(u))},Mt.forEach=Mt.sqrLen=Mt.len=Mt.sqrDist=Mt.dist=Mt.div=Mt.mul=Mt.sub=void 0;var Ws=function(t,e){if(t&&t.__esModule)return t;if(t===null||J0(t)!=="object"&&typeof t!="function")return{default:t};var n=$T(void 0);if(n&&n.has(t))return n.get(t);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if(o!=="default"&&Object.prototype.hasOwnProperty.call(t,o)){var l=r?Object.getOwnPropertyDescriptor(t,o):null;l&&(l.get||l.set)?Object.defineProperty(i,o,l):i[o]=t[o]}return i.default=t,n&&n.set(t,i),i}(Li);function $T(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return($T=function(i){return i?n:e})(t)}function GT(){var t=new Ws.ARRAY_TYPE(3);return Ws.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function HT(t){return Math.hypot(t[0],t[1],t[2])}function qT(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function WT(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function ZT(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function XT(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])}function YT(t,e){var n=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2];return n*n+i*i+r*r}function KT(t){var e=t[0],n=t[1],i=t[2];return e*e+n*n+i*i}function JT(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}Mt.sub=qT,Mt.mul=WT,Mt.div=ZT,Mt.dist=XT,Mt.sqrDist=YT,Mt.len=HT,Mt.sqrLen=KT;var Zs,j3=(Zs=GT(),function(t,e,n,i,r,o){var l,u;for(e||(e=3),n||(n=0),u=i?Math.min(i*e+n,t.length):t.length,l=n;l<u;l+=e)Zs[0]=t[l],Zs[1]=t[l+1],Zs[2]=t[l+2],r(Zs,Zs,o),t[l]=Zs[0],t[l+1]=Zs[1],t[l+2]=Zs[2];return t});Mt.forEach=j3;var jt={};function Q0(t){return Q0=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Q0(t)}Object.defineProperty(jt,"__esModule",{value:!0}),jt.create=eI,jt.clone=function(t){var e=new To.ARRAY_TYPE(4);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e},jt.fromValues=function(t,e,n,i){var r=new To.ARRAY_TYPE(4);return r[0]=t,r[1]=e,r[2]=n,r[3]=i,r},jt.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},jt.set=function(t,e,n,i,r){return t[0]=e,t[1]=n,t[2]=i,t[3]=r,t},jt.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t},jt.subtract=tI,jt.multiply=nI,jt.divide=iI,jt.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t[3]=Math.ceil(e[3]),t},jt.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t[3]=Math.floor(e[3]),t},jt.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t[3]=Math.min(e[3],n[3]),t},jt.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t[3]=Math.max(e[3],n[3]),t},jt.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t[3]=Math.round(e[3]),t},jt.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},jt.scaleAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t[2]=e[2]+n[2]*i,t[3]=e[3]+n[3]*i,t},jt.distance=rI,jt.squaredDistance=oI,jt.length=sI,jt.squaredLength=aI,jt.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=-e[3],t},jt.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t[3]=1/e[3],t},jt.normalize=function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],l=n*n+i*i+r*r+o*o;return l>0&&(l=1/Math.sqrt(l)),t[0]=n*l,t[1]=i*l,t[2]=r*l,t[3]=o*l,t},jt.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},jt.cross=function(t,e,n,i){var r=n[0]*i[1]-n[1]*i[0],o=n[0]*i[2]-n[2]*i[0],l=n[0]*i[3]-n[3]*i[0],u=n[1]*i[2]-n[2]*i[1],h=n[1]*i[3]-n[3]*i[1],p=n[2]*i[3]-n[3]*i[2],m=e[0],_=e[1],y=e[2],v=e[3];return t[0]=_*p-y*h+v*u,t[1]=-m*p+y*l-v*o,t[2]=m*h-_*l+v*r,t[3]=-m*u+_*o-y*r,t},jt.lerp=function(t,e,n,i){var r=e[0],o=e[1],l=e[2],u=e[3];return t[0]=r+i*(n[0]-r),t[1]=o+i*(n[1]-o),t[2]=l+i*(n[2]-l),t[3]=u+i*(n[3]-u),t},jt.random=function(t,e){var n,i,r,o,l,u;e=e||1;do l=(n=2*To.RANDOM()-1)*n+(i=2*To.RANDOM()-1)*i;while(l>=1);do u=(r=2*To.RANDOM()-1)*r+(o=2*To.RANDOM()-1)*o;while(u>=1);var h=Math.sqrt((1-l)/u);return t[0]=e*n,t[1]=e*i,t[2]=e*r*h,t[3]=e*o*h,t},jt.transformMat4=function(t,e,n){var i=e[0],r=e[1],o=e[2],l=e[3];return t[0]=n[0]*i+n[4]*r+n[8]*o+n[12]*l,t[1]=n[1]*i+n[5]*r+n[9]*o+n[13]*l,t[2]=n[2]*i+n[6]*r+n[10]*o+n[14]*l,t[3]=n[3]*i+n[7]*r+n[11]*o+n[15]*l,t},jt.transformQuat=function(t,e,n){var i=e[0],r=e[1],o=e[2],l=n[0],u=n[1],h=n[2],p=n[3],m=p*i+u*o-h*r,_=p*r+h*i-l*o,y=p*o+l*r-u*i,v=-l*i-u*r-h*o;return t[0]=m*p+v*-l+_*-h-y*-u,t[1]=_*p+v*-u+y*-l-m*-h,t[2]=y*p+v*-h+m*-u-_*-l,t[3]=e[3],t},jt.zero=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=0,t},jt.str=function(t){return"vec4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},jt.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},jt.equals=function(t,e){var n=t[0],i=t[1],r=t[2],o=t[3],l=e[0],u=e[1],h=e[2],p=e[3];return Math.abs(n-l)<=To.EPSILON*Math.max(1,Math.abs(n),Math.abs(l))&&Math.abs(i-u)<=To.EPSILON*Math.max(1,Math.abs(i),Math.abs(u))&&Math.abs(r-h)<=To.EPSILON*Math.max(1,Math.abs(r),Math.abs(h))&&Math.abs(o-p)<=To.EPSILON*Math.max(1,Math.abs(o),Math.abs(p))},jt.forEach=jt.sqrLen=jt.len=jt.sqrDist=jt.dist=jt.div=jt.mul=jt.sub=void 0;var To=function(t,e){if(t&&t.__esModule)return t;if(t===null||Q0(t)!=="object"&&typeof t!="function")return{default:t};var n=QT(void 0);if(n&&n.has(t))return n.get(t);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if(o!=="default"&&Object.prototype.hasOwnProperty.call(t,o)){var l=r?Object.getOwnPropertyDescriptor(t,o):null;l&&(l.get||l.set)?Object.defineProperty(i,o,l):i[o]=t[o]}return i.default=t,n&&n.set(t,i),i}(Li);function QT(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(QT=function(i){return i?n:e})(t)}function eI(){var t=new To.ARRAY_TYPE(4);return To.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function tI(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t}function nI(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}function iI(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t[3]=e[3]/n[3],t}function rI(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2],e[3]-t[3])}function oI(t,e){var n=e[0]-t[0],i=e[1]-t[1],r=e[2]-t[2],o=e[3]-t[3];return n*n+i*i+r*r+o*o}function sI(t){return Math.hypot(t[0],t[1],t[2],t[3])}function aI(t){var e=t[0],n=t[1],i=t[2],r=t[3];return e*e+n*n+i*i+r*r}jt.sub=tI,jt.mul=nI,jt.div=iI,jt.dist=rI,jt.sqrDist=oI,jt.len=sI,jt.sqrLen=aI;var U3=function(){var t=eI();return function(e,n,i,r,o,l){var u,h;for(n||(n=4),i||(i=0),h=r?Math.min(r*n+i,e.length):e.length,u=i;u<h;u+=n)t[0]=e[u],t[1]=e[u+1],t[2]=e[u+2],t[3]=e[u+3],o(t,t,l),e[u]=t[0],e[u+1]=t[1],e[u+2]=t[2],e[u+3]=t[3];return e}}();function ev(t){return ev=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ev(t)}jt.forEach=U3,Object.defineProperty(Et,"__esModule",{value:!0}),Et.create=tv,Et.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t},Et.setAxisAngle=cI,Et.getAxisAngle=function(t,e){var n=2*Math.acos(e[3]),i=Math.sin(n/2);return i>kl.EPSILON?(t[0]=e[0]/i,t[1]=e[1]/i,t[2]=e[2]/i):(t[0]=1,t[1]=0,t[2]=0),n},Et.getAngle=function(t,e){var n=mI(t,e);return Math.acos(2*n*n-1)},Et.multiply=uI,Et.rotateX=function(t,e,n){n*=.5;var i=e[0],r=e[1],o=e[2],l=e[3],u=Math.sin(n),h=Math.cos(n);return t[0]=i*h+l*u,t[1]=r*h+o*u,t[2]=o*h-r*u,t[3]=l*h-i*u,t},Et.rotateY=function(t,e,n){n*=.5;var i=e[0],r=e[1],o=e[2],l=e[3],u=Math.sin(n),h=Math.cos(n);return t[0]=i*h-o*u,t[1]=r*h+l*u,t[2]=o*h+i*u,t[3]=l*h-r*u,t},Et.rotateZ=function(t,e,n){n*=.5;var i=e[0],r=e[1],o=e[2],l=e[3],u=Math.sin(n),h=Math.cos(n);return t[0]=i*h+r*u,t[1]=r*h-i*u,t[2]=o*h+l*u,t[3]=l*h-o*u,t},Et.calculateW=function(t,e){var n=e[0],i=e[1],r=e[2];return t[0]=n,t[1]=i,t[2]=r,t[3]=Math.sqrt(Math.abs(1-n*n-i*i-r*r)),t},Et.exp=dI,Et.ln=hI,Et.pow=function(t,e,n){return hI(t,e),pI(t,t,n),dI(t,t),t},Et.slerp=mp,Et.random=function(t){var e=kl.RANDOM(),n=kl.RANDOM(),i=kl.RANDOM(),r=Math.sqrt(1-e),o=Math.sqrt(e);return t[0]=r*Math.sin(2*Math.PI*n),t[1]=r*Math.cos(2*Math.PI*n),t[2]=o*Math.sin(2*Math.PI*i),t[3]=o*Math.cos(2*Math.PI*i),t},Et.invert=function(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],l=n*n+i*i+r*r+o*o,u=l?1/l:0;return t[0]=-n*u,t[1]=-i*u,t[2]=-r*u,t[3]=o*u,t},Et.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},Et.fromMat3=fI,Et.fromEuler=function(t,e,n,i){var r=.5*Math.PI/180;e*=r,n*=r,i*=r;var o=Math.sin(e),l=Math.cos(e),u=Math.sin(n),h=Math.cos(n),p=Math.sin(i),m=Math.cos(i);return t[0]=o*h*m-l*u*p,t[1]=l*u*m+o*h*p,t[2]=l*h*p-o*u*m,t[3]=l*h*m+o*u*p,t},Et.str=function(t){return"quat("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+")"},Et.setAxes=Et.sqlerp=Et.rotationTo=Et.equals=Et.exactEquals=Et.normalize=Et.sqrLen=Et.squaredLength=Et.len=Et.length=Et.lerp=Et.dot=Et.scale=Et.mul=Et.add=Et.set=Et.copy=Et.fromValues=Et.clone=void 0;var kl=pp(Li),$3=pp(In),Xs=pp(Mt),oo=pp(jt);function lI(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(lI=function(i){return i?n:e})(t)}function pp(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||ev(t)!=="object"&&typeof t!="function")return{default:t};var n=lI(e);if(n&&n.has(t))return n.get(t);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if(o!=="default"&&Object.prototype.hasOwnProperty.call(t,o)){var l=r?Object.getOwnPropertyDescriptor(t,o):null;l&&(l.get||l.set)?Object.defineProperty(i,o,l):i[o]=t[o]}return i.default=t,n&&n.set(t,i),i}function tv(){var t=new kl.ARRAY_TYPE(4);return kl.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function cI(t,e,n){n*=.5;var i=Math.sin(n);return t[0]=i*e[0],t[1]=i*e[1],t[2]=i*e[2],t[3]=Math.cos(n),t}function uI(t,e,n){var i=e[0],r=e[1],o=e[2],l=e[3],u=n[0],h=n[1],p=n[2],m=n[3];return t[0]=i*m+l*u+r*p-o*h,t[1]=r*m+l*h+o*u-i*p,t[2]=o*m+l*p+i*h-r*u,t[3]=l*m-i*u-r*h-o*p,t}function dI(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],l=Math.sqrt(n*n+i*i+r*r),u=Math.exp(o),h=l>0?u*Math.sin(l)/l:0;return t[0]=n*h,t[1]=i*h,t[2]=r*h,t[3]=u*Math.cos(l),t}function hI(t,e){var n=e[0],i=e[1],r=e[2],o=e[3],l=Math.sqrt(n*n+i*i+r*r),u=l>0?Math.atan2(l,o)/l:0;return t[0]=n*u,t[1]=i*u,t[2]=r*u,t[3]=.5*Math.log(n*n+i*i+r*r+o*o),t}function mp(t,e,n,i){var r,o,l,u,h,p=e[0],m=e[1],_=e[2],y=e[3],v=n[0],b=n[1],w=n[2],C=n[3];return(o=p*v+m*b+_*w+y*C)<0&&(o=-o,v=-v,b=-b,w=-w,C=-C),1-o>kl.EPSILON?(r=Math.acos(o),l=Math.sin(r),u=Math.sin((1-i)*r)/l,h=Math.sin(i*r)/l):(u=1-i,h=i),t[0]=u*p+h*v,t[1]=u*m+h*b,t[2]=u*_+h*w,t[3]=u*y+h*C,t}function fI(t,e){var n,i=e[0]+e[4]+e[8];if(i>0)n=Math.sqrt(i+1),t[3]=.5*n,t[0]=(e[5]-e[7])*(n=.5/n),t[1]=(e[6]-e[2])*n,t[2]=(e[1]-e[3])*n;else{var r=0;e[4]>e[0]&&(r=1),e[8]>e[3*r+r]&&(r=2);var o=(r+1)%3,l=(r+2)%3;n=Math.sqrt(e[3*r+r]-e[3*o+o]-e[3*l+l]+1),t[r]=.5*n,t[3]=(e[3*o+l]-e[3*l+o])*(n=.5/n),t[o]=(e[3*o+r]+e[3*r+o])*n,t[l]=(e[3*l+r]+e[3*r+l])*n}return t}Et.clone=oo.clone,Et.fromValues=oo.fromValues,Et.copy=oo.copy,Et.set=oo.set,Et.add=oo.add,Et.mul=uI;var pI=oo.scale;Et.scale=pI;var mI=oo.dot;Et.dot=mI,Et.lerp=oo.lerp;var gI=oo.length;Et.length=gI,Et.len=gI;var _I=oo.squaredLength;Et.squaredLength=_I,Et.sqrLen=_I;var nv=oo.normalize;Et.normalize=nv,Et.exactEquals=oo.exactEquals,Et.equals=oo.equals;var Wo,yI,vI,G3=(Wo=Xs.create(),yI=Xs.fromValues(1,0,0),vI=Xs.fromValues(0,1,0),function(t,e,n){var i=Xs.dot(e,n);return i<-.999999?(Xs.cross(Wo,yI,e),Xs.len(Wo)<1e-6&&Xs.cross(Wo,vI,e),Xs.normalize(Wo,Wo),cI(t,Wo,Math.PI),t):i>.999999?(t[0]=0,t[1]=0,t[2]=0,t[3]=1,t):(Xs.cross(Wo,e,n),t[0]=Wo[0],t[1]=Wo[1],t[2]=Wo[2],t[3]=1+i,nv(t,t))});Et.rotationTo=G3;var iv,rv,H3=(iv=tv(),rv=tv(),function(t,e,n,i,r,o){return mp(iv,e,r,o),mp(rv,n,i,o),mp(t,iv,rv,2*o*(1-o)),t});Et.sqlerp=H3;var Zo,q3=(Zo=$3.create(),function(t,e,n,i){return Zo[0]=n[0],Zo[3]=n[1],Zo[6]=n[2],Zo[1]=i[0],Zo[4]=i[1],Zo[7]=i[2],Zo[2]=-e[0],Zo[5]=-e[1],Zo[8]=-e[2],nv(t,fI(t,Zo))});Et.setAxes=q3;var Ht={};function ov(t){return ov=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ov(t)}Object.defineProperty(Ht,"__esModule",{value:!0}),Ht.create=function(){var t=new Ar.ARRAY_TYPE(8);return Ar.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[4]=0,t[5]=0,t[6]=0,t[7]=0),t[3]=1,t},Ht.clone=function(t){var e=new Ar.ARRAY_TYPE(8);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e},Ht.fromValues=function(t,e,n,i,r,o,l,u){var h=new Ar.ARRAY_TYPE(8);return h[0]=t,h[1]=e,h[2]=n,h[3]=i,h[4]=r,h[5]=o,h[6]=l,h[7]=u,h},Ht.fromRotationTranslationValues=function(t,e,n,i,r,o,l){var u=new Ar.ARRAY_TYPE(8);u[0]=t,u[1]=e,u[2]=n,u[3]=i;var h=.5*r,p=.5*o,m=.5*l;return u[4]=h*i+p*n-m*e,u[5]=p*i+m*t-h*n,u[6]=m*i+h*e-p*t,u[7]=-h*t-p*e-m*n,u},Ht.fromRotationTranslation=wI,Ht.fromTranslation=function(t,e){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=.5*e[0],t[5]=.5*e[1],t[6]=.5*e[2],t[7]=0,t},Ht.fromRotation=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},Ht.fromMat4=function(t,e){var n=Ys.create();xI.getRotation(n,e);var i=new Ar.ARRAY_TYPE(3);return xI.getTranslation(i,e),wI(t,n,i),t},Ht.copy=CI,Ht.identity=function(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t[4]=0,t[5]=0,t[6]=0,t[7]=0,t},Ht.set=function(t,e,n,i,r,o,l,u,h){return t[0]=e,t[1]=n,t[2]=i,t[3]=r,t[4]=o,t[5]=l,t[6]=u,t[7]=h,t},Ht.getDual=function(t,e){return t[0]=e[4],t[1]=e[5],t[2]=e[6],t[3]=e[7],t},Ht.setDual=function(t,e){return t[4]=e[0],t[5]=e[1],t[6]=e[2],t[7]=e[3],t},Ht.getTranslation=function(t,e){var n=e[4],i=e[5],r=e[6],o=e[7],l=-e[0],u=-e[1],h=-e[2],p=e[3];return t[0]=2*(n*p+o*l+i*h-r*u),t[1]=2*(i*p+o*u+r*l-n*h),t[2]=2*(r*p+o*h+n*u-i*l),t},Ht.translate=function(t,e,n){var i=e[0],r=e[1],o=e[2],l=e[3],u=.5*n[0],h=.5*n[1],p=.5*n[2],m=e[4],_=e[5],y=e[6],v=e[7];return t[0]=i,t[1]=r,t[2]=o,t[3]=l,t[4]=l*u+r*p-o*h+m,t[5]=l*h+o*u-i*p+_,t[6]=l*p+i*h-r*u+y,t[7]=-i*u-r*h-o*p+v,t},Ht.rotateX=function(t,e,n){var i=-e[0],r=-e[1],o=-e[2],l=e[3],u=e[4],h=e[5],p=e[6],m=e[7],_=u*l+m*i+h*o-p*r,y=h*l+m*r+p*i-u*o,v=p*l+m*o+u*r-h*i,b=m*l-u*i-h*r-p*o;return Ys.rotateX(t,e,n),t[4]=_*(l=t[3])+b*(i=t[0])+y*(o=t[2])-v*(r=t[1]),t[5]=y*l+b*r+v*i-_*o,t[6]=v*l+b*o+_*r-y*i,t[7]=b*l-_*i-y*r-v*o,t},Ht.rotateY=function(t,e,n){var i=-e[0],r=-e[1],o=-e[2],l=e[3],u=e[4],h=e[5],p=e[6],m=e[7],_=u*l+m*i+h*o-p*r,y=h*l+m*r+p*i-u*o,v=p*l+m*o+u*r-h*i,b=m*l-u*i-h*r-p*o;return Ys.rotateY(t,e,n),t[4]=_*(l=t[3])+b*(i=t[0])+y*(o=t[2])-v*(r=t[1]),t[5]=y*l+b*r+v*i-_*o,t[6]=v*l+b*o+_*r-y*i,t[7]=b*l-_*i-y*r-v*o,t},Ht.rotateZ=function(t,e,n){var i=-e[0],r=-e[1],o=-e[2],l=e[3],u=e[4],h=e[5],p=e[6],m=e[7],_=u*l+m*i+h*o-p*r,y=h*l+m*r+p*i-u*o,v=p*l+m*o+u*r-h*i,b=m*l-u*i-h*r-p*o;return Ys.rotateZ(t,e,n),t[4]=_*(l=t[3])+b*(i=t[0])+y*(o=t[2])-v*(r=t[1]),t[5]=y*l+b*r+v*i-_*o,t[6]=v*l+b*o+_*r-y*i,t[7]=b*l-_*i-y*r-v*o,t},Ht.rotateByQuatAppend=function(t,e,n){var i=n[0],r=n[1],o=n[2],l=n[3],u=e[0],h=e[1],p=e[2],m=e[3];return t[0]=u*l+m*i+h*o-p*r,t[1]=h*l+m*r+p*i-u*o,t[2]=p*l+m*o+u*r-h*i,t[3]=m*l-u*i-h*r-p*o,t[4]=(u=e[4])*l+(m=e[7])*i+(h=e[5])*o-(p=e[6])*r,t[5]=h*l+m*r+p*i-u*o,t[6]=p*l+m*o+u*r-h*i,t[7]=m*l-u*i-h*r-p*o,t},Ht.rotateByQuatPrepend=function(t,e,n){var i=e[0],r=e[1],o=e[2],l=e[3],u=n[0],h=n[1],p=n[2],m=n[3];return t[0]=i*m+l*u+r*p-o*h,t[1]=r*m+l*h+o*u-i*p,t[2]=o*m+l*p+i*h-r*u,t[3]=l*m-i*u-r*h-o*p,t[4]=i*(m=n[7])+l*(u=n[4])+r*(p=n[6])-o*(h=n[5]),t[5]=r*m+l*h+o*u-i*p,t[6]=o*m+l*p+i*h-r*u,t[7]=l*m-i*u-r*h-o*p,t},Ht.rotateAroundAxis=function(t,e,n,i){if(Math.abs(i)<Ar.EPSILON)return CI(t,e);var r=Math.hypot(n[0],n[1],n[2]);i*=.5;var o=Math.sin(i),l=o*n[0]/r,u=o*n[1]/r,h=o*n[2]/r,p=Math.cos(i),m=e[0],_=e[1],y=e[2],v=e[3];t[0]=m*p+v*l+_*h-y*u,t[1]=_*p+v*u+y*l-m*h,t[2]=y*p+v*h+m*u-_*l,t[3]=v*p-m*l-_*u-y*h;var b=e[4],w=e[5],C=e[6],E=e[7];return t[4]=b*p+E*l+w*h-C*u,t[5]=w*p+E*u+C*l-b*h,t[6]=C*p+E*h+b*u-w*l,t[7]=E*p-b*l-w*u-C*h,t},Ht.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t},Ht.multiply=EI,Ht.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t},Ht.lerp=function(t,e,n,i){var r=1-i;return TI(e,n)<0&&(i=-i),t[0]=e[0]*r+n[0]*i,t[1]=e[1]*r+n[1]*i,t[2]=e[2]*r+n[2]*i,t[3]=e[3]*r+n[3]*i,t[4]=e[4]*r+n[4]*i,t[5]=e[5]*r+n[5]*i,t[6]=e[6]*r+n[6]*i,t[7]=e[7]*r+n[7]*i,t},Ht.invert=function(t,e){var n=gp(e);return t[0]=-e[0]/n,t[1]=-e[1]/n,t[2]=-e[2]/n,t[3]=e[3]/n,t[4]=-e[4]/n,t[5]=-e[5]/n,t[6]=-e[6]/n,t[7]=e[7]/n,t},Ht.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t[4]=-e[4],t[5]=-e[5],t[6]=-e[6],t[7]=e[7],t},Ht.normalize=function(t,e){var n=gp(e);if(n>0){n=Math.sqrt(n);var i=e[0]/n,r=e[1]/n,o=e[2]/n,l=e[3]/n,u=e[4],h=e[5],p=e[6],m=e[7],_=i*u+r*h+o*p+l*m;t[0]=i,t[1]=r,t[2]=o,t[3]=l,t[4]=(u-i*_)/n,t[5]=(h-r*_)/n,t[6]=(p-o*_)/n,t[7]=(m-l*_)/n}return t},Ht.str=function(t){return"quat2("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+")"},Ht.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]},Ht.equals=function(t,e){var n=t[0],i=t[1],r=t[2],o=t[3],l=t[4],u=t[5],h=t[6],p=t[7],m=e[0],_=e[1],y=e[2],v=e[3],b=e[4],w=e[5],C=e[6],E=e[7];return Math.abs(n-m)<=Ar.EPSILON*Math.max(1,Math.abs(n),Math.abs(m))&&Math.abs(i-_)<=Ar.EPSILON*Math.max(1,Math.abs(i),Math.abs(_))&&Math.abs(r-y)<=Ar.EPSILON*Math.max(1,Math.abs(r),Math.abs(y))&&Math.abs(o-v)<=Ar.EPSILON*Math.max(1,Math.abs(o),Math.abs(v))&&Math.abs(l-b)<=Ar.EPSILON*Math.max(1,Math.abs(l),Math.abs(b))&&Math.abs(u-w)<=Ar.EPSILON*Math.max(1,Math.abs(u),Math.abs(w))&&Math.abs(h-C)<=Ar.EPSILON*Math.max(1,Math.abs(h),Math.abs(C))&&Math.abs(p-E)<=Ar.EPSILON*Math.max(1,Math.abs(p),Math.abs(E))},Ht.sqrLen=Ht.squaredLength=Ht.len=Ht.length=Ht.dot=Ht.mul=Ht.setReal=Ht.getReal=void 0;var Ar=sv(Li),Ys=sv(Et),xI=sv(Dt);function bI(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(bI=function(i){return i?n:e})(t)}function sv(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||ov(t)!=="object"&&typeof t!="function")return{default:t};var n=bI(e);if(n&&n.has(t))return n.get(t);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if(o!=="default"&&Object.prototype.hasOwnProperty.call(t,o)){var l=r?Object.getOwnPropertyDescriptor(t,o):null;l&&(l.get||l.set)?Object.defineProperty(i,o,l):i[o]=t[o]}return i.default=t,n&&n.set(t,i),i}function wI(t,e,n){var i=.5*n[0],r=.5*n[1],o=.5*n[2],l=e[0],u=e[1],h=e[2],p=e[3];return t[0]=l,t[1]=u,t[2]=h,t[3]=p,t[4]=i*p+r*h-o*u,t[5]=r*p+o*l-i*h,t[6]=o*p+i*u-r*l,t[7]=-i*l-r*u-o*h,t}function CI(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t}function EI(t,e,n){var i=e[0],r=e[1],o=e[2],l=e[3],u=n[4],h=n[5],p=n[6],m=n[7],_=e[4],y=e[5],v=e[6],b=e[7],w=n[0],C=n[1],E=n[2],I=n[3];return t[0]=i*I+l*w+r*E-o*C,t[1]=r*I+l*C+o*w-i*E,t[2]=o*I+l*E+i*C-r*w,t[3]=l*I-i*w-r*C-o*E,t[4]=i*m+l*u+r*p-o*h+_*I+b*w+y*E-v*C,t[5]=r*m+l*h+o*u-i*p+y*I+b*C+v*w-_*E,t[6]=o*m+l*p+i*h-r*u+v*I+b*E+_*C-y*w,t[7]=l*m-i*u-r*h-o*p+b*I-_*w-y*C-v*E,t}Ht.getReal=Ys.copy,Ht.setReal=Ys.copy,Ht.mul=EI;var TI=Ys.dot;Ht.dot=TI;var II=Ys.length;Ht.length=II,Ht.len=II;var gp=Ys.squaredLength;Ht.squaredLength=gp,Ht.sqrLen=gp;var Ft={};function av(t){return av=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},av(t)}Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.create=DI,Ft.clone=function(t){var e=new Ll.ARRAY_TYPE(2);return e[0]=t[0],e[1]=t[1],e},Ft.fromValues=function(t,e){var n=new Ll.ARRAY_TYPE(2);return n[0]=t,n[1]=e,n},Ft.copy=function(t,e){return t[0]=e[0],t[1]=e[1],t},Ft.set=function(t,e,n){return t[0]=e,t[1]=n,t},Ft.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t},Ft.subtract=SI,Ft.multiply=AI,Ft.divide=PI,Ft.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},Ft.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},Ft.min=function(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t},Ft.max=function(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t},Ft.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},Ft.scale=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t},Ft.scaleAndAdd=function(t,e,n,i){return t[0]=e[0]+n[0]*i,t[1]=e[1]+n[1]*i,t},Ft.distance=RI,Ft.squaredDistance=OI,Ft.length=FI,Ft.squaredLength=kI,Ft.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},Ft.inverse=function(t,e){return t[0]=1/e[0],t[1]=1/e[1],t},Ft.normalize=function(t,e){var n=e[0],i=e[1],r=n*n+i*i;return r>0&&(r=1/Math.sqrt(r)),t[0]=e[0]*r,t[1]=e[1]*r,t},Ft.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},Ft.cross=function(t,e,n){var i=e[0]*n[1]-e[1]*n[0];return t[0]=t[1]=0,t[2]=i,t},Ft.lerp=function(t,e,n,i){var r=e[0],o=e[1];return t[0]=r+i*(n[0]-r),t[1]=o+i*(n[1]-o),t},Ft.random=function(t,e){e=e||1;var n=2*Ll.RANDOM()*Math.PI;return t[0]=Math.cos(n)*e,t[1]=Math.sin(n)*e,t},Ft.transformMat2=function(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[2]*r,t[1]=n[1]*i+n[3]*r,t},Ft.transformMat2d=function(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[2]*r+n[4],t[1]=n[1]*i+n[3]*r+n[5],t},Ft.transformMat3=function(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[3]*r+n[6],t[1]=n[1]*i+n[4]*r+n[7],t},Ft.transformMat4=function(t,e,n){var i=e[0],r=e[1];return t[0]=n[0]*i+n[4]*r+n[12],t[1]=n[1]*i+n[5]*r+n[13],t},Ft.rotate=function(t,e,n,i){var r=e[0]-n[0],o=e[1]-n[1],l=Math.sin(i),u=Math.cos(i);return t[0]=r*u-o*l+n[0],t[1]=r*l+o*u+n[1],t},Ft.angle=function(t,e){var n=t[0],i=t[1],r=e[0],o=e[1],l=Math.sqrt(n*n+i*i)*Math.sqrt(r*r+o*o);return Math.acos(Math.min(Math.max(l&&(n*r+i*o)/l,-1),1))},Ft.zero=function(t){return t[0]=0,t[1]=0,t},Ft.str=function(t){return"vec2("+t[0]+", "+t[1]+")"},Ft.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]},Ft.equals=function(t,e){var n=t[0],i=t[1],r=e[0],o=e[1];return Math.abs(n-r)<=Ll.EPSILON*Math.max(1,Math.abs(n),Math.abs(r))&&Math.abs(i-o)<=Ll.EPSILON*Math.max(1,Math.abs(i),Math.abs(o))},Ft.forEach=Ft.sqrLen=Ft.sqrDist=Ft.dist=Ft.div=Ft.mul=Ft.sub=Ft.len=void 0;var Ll=function(t,e){if(t&&t.__esModule)return t;if(t===null||av(t)!=="object"&&typeof t!="function")return{default:t};var n=MI(void 0);if(n&&n.has(t))return n.get(t);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if(o!=="default"&&Object.prototype.hasOwnProperty.call(t,o)){var l=r?Object.getOwnPropertyDescriptor(t,o):null;l&&(l.get||l.set)?Object.defineProperty(i,o,l):i[o]=t[o]}return i.default=t,n&&n.set(t,i),i}(Li);function MI(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(MI=function(i){return i?n:e})(t)}function DI(){var t=new Ll.ARRAY_TYPE(2);return Ll.ARRAY_TYPE!=Float32Array&&(t[0]=0,t[1]=0),t}function SI(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function AI(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t}function PI(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t}function RI(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1])}function OI(t,e){var n=e[0]-t[0],i=e[1]-t[1];return n*n+i*i}function FI(t){return Math.hypot(t[0],t[1])}function kI(t){var e=t[0],n=t[1];return e*e+n*n}Ft.len=FI,Ft.sub=SI,Ft.mul=AI,Ft.div=PI,Ft.dist=RI,Ft.sqrDist=OI,Ft.sqrLen=kI;var W3=function(){var t=DI();return function(e,n,i,r,o,l){var u,h;for(n||(n=2),i||(i=0),h=r?Math.min(r*n+i,e.length):e.length,u=i;u<h;u+=n)t[0]=e[u],t[1]=e[u+1],o(t,t,l),e[u]=t[0],e[u+1]=t[1];return e}}();function lv(t){return lv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},lv(t)}Ft.forEach=W3,Object.defineProperty(ki,"__esModule",{value:!0});var vn=ki.vec4=$=ki.vec3=ki.vec2=ki.quat2=Xi=ki.quat=ne=ki.mat4=Pr=ki.mat3=ki.mat2d=Hc=ki.mat2=ki.glMatrix=void 0,Z3=ys(Li);ki.glMatrix=Z3;var X3=ys(Wn),Hc=ki.mat2=X3,Y3=ys(Jn);ki.mat2d=Y3;var K3=ys(In),Pr=ki.mat3=K3,J3=ys(Dt),ne=ki.mat4=J3,Q3=ys(Et),Xi=ki.quat=Q3,eN=ys(Ht);ki.quat2=eN;var tN=ys(Ft);ki.vec2=tN;var nN=ys(Mt),$=ki.vec3=nN,iN=ys(jt);function LI(t){if(typeof WeakMap!="function")return null;var e=new WeakMap,n=new WeakMap;return(LI=function(i){return i?n:e})(t)}function ys(t,e){if(!e&&t&&t.__esModule)return t;if(t===null||lv(t)!=="object"&&typeof t!="function")return{default:t};var n=LI(e);if(n&&n.has(t))return n.get(t);var i={},r=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in t)if(o!=="default"&&Object.prototype.hasOwnProperty.call(t,o)){var l=r?Object.getOwnPropertyDescriptor(t,o):null;l&&(l.get||l.set)?Object.defineProperty(i,o,l):i[o]=t[o]}return i.default=t,n&&n.set(t,i),i}vn=ki.vec4=iN;let rN=ln([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:_p}=rN,NI=ln([{name:"a_pos_3",components:3,type:"Int16"}]);var Oa=ln([{name:"a_pos",type:"Int16",components:2}]),zI={};(function(t,e){(function(n){function i(o,l,u){var h=r(256*o,256*(l=Math.pow(2,u)-l-1),u),p=r(256*(o+1),256*(l+1),u);return h[0]+","+h[1]+","+p[0]+","+p[1]}function r(o,l,u){var h=2*Math.PI*6378137/256/Math.pow(2,u);return[o*h-2*Math.PI*6378137/2,l*h-2*Math.PI*6378137/2]}n.getURL=function(o,l,u,h,p,m){return m=m||{},o+"?"+["bbox="+i(u,h,p),"format="+(m.format||"image/png"),"service="+(m.service||"WMS"),"version="+(m.version||"1.1.1"),"request="+(m.request||"GetMap"),"srs="+(m.srs||"EPSG:3857"),"width="+(m.width||256),"height="+(m.height||256),"layers="+l].join("&")},n.getTileBBox=i,n.getMercCoords=r,Object.defineProperty(n,"__esModule",{value:!0})})(e)})(0,zI);var oN=zI;class Io{constructor(e,n,i){this.z=e,this.x=n,this.y=i,this.key=Fd(0,e,e,n,i)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){let i=oN.getTileBBox(this.x,this.y,this.z),r=function(o,l,u){let h,p="";for(let m=o;m>0;m--)h=1<<m-1,p+=(l&h?1:0)+(u&h?2:0);return p}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(n==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",r).replace("{bbox-epsg-3857}",i)}toString(){return`${this.z}/${this.x}/${this.y}`}}class cv{constructor(e,n){this.wrap=e,this.canonical=n,this.key=Fd(e,n.z,n.z,n.x,n.y)}}class Jt{constructor(e,n,i,r,o){this.overscaledZ=e,this.wrap=n,this.canonical=new Io(i,+r,+o),this.key=n===0&&e===i?this.canonical.key:Fd(n,e,i,r,o)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){let n=this.canonical.z-e;return e>this.canonical.z?new Jt(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Jt(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return Fd(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{let i=this.canonical.z-e;return Fd(this.wrap*+n,e,e,this.canonical.x>>i,this.canonical.y>>i)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;let n=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new Jt(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];let n=this.canonical.z+1,i=2*this.canonical.x,r=2*this.canonical.y;return[new Jt(n,this.wrap,n,i,r),new Jt(n,this.wrap,n,i+1,r),new Jt(n,this.wrap,n,i,r+1),new Jt(n,this.wrap,n,i+1,r+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Jt(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Jt(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new cv(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Fd(t,e,n,i,r){let o=1<<Math.min(n,22),l=o*(r%o)+i%o;return t&&n<22&&(l+=o*o*((t<0?-2*t-1:2*t)%(1<<2*(22-n)))),16*(32*l+n)+(e-n)}let BI=[t=>{let e=t.canonical.x-1,n=t.wrap;return e<0&&(e=(1<<t.canonical.z)-1,n--),new Jt(t.overscaledZ,n,t.canonical.z,e,t.canonical.y)},t=>{let e=t.canonical.x+1,n=t.wrap;return e===1<<t.canonical.z&&(e=0,n++),new Jt(t.overscaledZ,n,t.canonical.z,e,t.canonical.y)},t=>new Jt(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,(t.canonical.y===0?1<<t.canonical.z:t.canonical.y)-1),t=>new Jt(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y===(1<<t.canonical.z)-1?0:t.canonical.y+1)];Ge(Io,"CanonicalTileID"),Ge(Jt,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});class yp{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,i){let r=$.dot(n,this.dir);if(Math.abs(r)<1e-6)return!1;let o=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/r;return i[0]=this.pos[0]+this.dir[0]*o,i[1]=this.pos[1]+this.dir[1]*o,i[2]=this.pos[2]+this.dir[2]*o,!0}closestPointOnSphere(e,n,i){if($.equals(this.pos,e)||n===0)return i[0]=i[1]=i[2]=0,!1;let[r,o,l]=this.dir,u=this.pos[0]-e[0],h=this.pos[1]-e[1],p=this.pos[2]-e[2],m=r*r+o*o+l*l,_=2*(u*r+h*o+p*l),y=_*_-4*m*(u*u+h*h+p*p-n*n);if(y<0){let v=Math.max(-_/2,0),b=u+r*v,w=h+o*v,C=p+l*v,E=Math.hypot(b,w,C);return i[0]=b*n/E,i[1]=w*n/E,i[2]=C*n/E,!1}{let v=(-_-Math.sqrt(y))/(2*m);if(v<0){let b=Math.hypot(u,h,p);return i[0]=u*n/b,i[1]=h*n/b,i[2]=p*n/b,!1}return i[0]=u+r*v,i[1]=h+o*v,i[2]=p+l*v,!0}}}class uv{constructor(e,n,i,r,o){this.TL=e,this.TR=n,this.BR=i,this.BL=r,this.horizon=o}static fromInvProjectionMatrix(e,n,i){let r=[-1,1,1],o=[1,1,1],l=[1,-1,1],u=[-1,-1,1],h=$.transformMat4(r,r,e),p=$.transformMat4(o,o,e),m=$.transformMat4(l,l,e),_=$.transformMat4(u,u,e);return new uv(h,p,m,_,n/i)}}function kd(t,e,n){let i=1/0,r=-1/0,o=[];for(let l of t){$.sub(o,l,e);let u=$.dot(o,n);i=Math.min(i,u),r=Math.max(r,u)}return[i,r]}function VI(t,e){let n=!0;for(let i=0;i<t.planes.length;i++){let r=t.planes[i],o=0;for(let l=0;l<e.length;l++)o+=$.dot(r,e[l])+r[3]>=0;if(o===0)return 0;o!==e.length&&(n=!1)}return n?2:1}function jI(t,e){for(let n of t.projections){let i=kd(e,t.points[0],n.axis);if(n.projection[1]<i[0]||n.projection[0]>i[1])return 0}return 1}function UI(t,e){let n=0,i=[0,0,0,0];for(let r=0;r<t.length;r++)i[0]=t[r][0],i[1]=t[r][1],i[2]=t[r][2],i[3]=1,vn.dot(i,e)>=0&&n++;return n}class Ks{constructor(e,n){this.points=e||new Array(8).fill([0,0,0]),this.planes=n||new Array(6).fill([0,0,0,0]),this.bounds=On.fromPoints(this.points),this.projections=[],this.frustumEdges=[$.sub([],this.points[2],this.points[3]),$.sub([],this.points[0],this.points[3]),$.sub([],this.points[4],this.points[0]),$.sub([],this.points[5],this.points[1]),$.sub([],this.points[6],this.points[2]),$.sub([],this.points[7],this.points[3])];for(let i of this.frustumEdges){let r=[0,-i[2],i[1]],o=[i[2],0,-i[0]];this.projections.push({axis:r,projection:kd(this.points,this.points[0],r)}),this.projections.push({axis:o,projection:kd(this.points,this.points[0],o)})}}static fromInvProjectionMatrix(e,n,i,r){let o=Math.pow(2,i),l=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(p=>{let m=vn.transformMat4([],p,e),_=1/m[3]/n*o;return vn.mul(m,m,[_,_,r?1/m[3]:_,_])}),u=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(p=>{let m=$.sub([],l[p[0]],l[p[1]]),_=$.sub([],l[p[2]],l[p[1]]),y=$.normalize([],$.cross([],m,_)),v=-$.dot(y,l[p[1]]);return y.concat(v)}),h=[];for(let p=0;p<l.length;p++)h.push([l[p][0],l[p][1],l[p][2]]);return new Ks(h,u)}intersectsPrecise(e,n,i){for(let r=0;r<n.length;r++)if(!UI(e,n[r]))return 0;for(let r=0;r<this.planes.length;r++)if(!UI(e,this.planes[r]))return 0;for(let r of i)for(let o of this.frustumEdges){let l=$.cross([],r,o),u=$.length(l);if(u===0)continue;$.scale(l,l,1/u);let h=kd(this.points,this.points[0],l),p=kd(e,this.points[0],l);if(h[0]>p[1]||p[0]>h[1])return 0}return 1}}class On{static fromPoints(e){let n=[1/0,1/0,1/0],i=[-1/0,-1/0,-1/0];for(let r of e)$.min(n,n,r),$.max(i,i,r);return new On(n,i)}static fromTileIdAndHeight(e,n,i){let r=1<<e.canonical.z,o=e.canonical.x,l=e.canonical.y;return new On([o/r,l/r,n],[(o+1)/r,(l+1)/r,i])}static applyTransform(e,n){let i=e.getCorners();for(let r=0;r<i.length;++r)$.transformMat4(i[r],i[r],n);return On.fromPoints(i)}static projectAabbCorners(e,n){let i=e.getCorners();for(let r=0;r<i.length;++r)$.transformMat4(i[r],i[r],n);return i}constructor(e,n){this.min=e,this.max=n,this.center=$.scale([],$.add([],this.min,this.max),.5)}quadrant(e){let n=[e%2==0,e<2],i=$.clone(this.min),r=$.clone(this.max);for(let o=0;o<n.length;o++)i[o]=n[o]?this.min[o]:this.center[o],r[o]=n[o]?this.center[o]:this.max[o];return r[2]=this.max[2],new On(i,r)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){let e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?VI(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?VI(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,n){return n||this.intersects(e)?jI(e,this.getCorners()):0}intersectsPreciseFlat(e,n){return n||this.intersectsFlat(e)?jI(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let n=0;n<3;++n)if(this.min[n]>e.max[n]||e.min[n]>this.max[n])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e.min[n]),this.max[n]=Math.max(this.max[n],e.max[n])}encapsulatePoint(e){for(let n=0;n<3;n++)this.min[n]=Math.min(this.min[n],e[n]),this.max[n]=Math.max(this.max[n],e[n])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}Ge(On,"Aabb");let Ld=5,Fa=6,xr=le/Math.PI/2,sN=16383,qc=64,dv=[qc,32,16],Mo=-xr,Do=xr,aN=[new On([Mo,Mo,Mo],[Do,Do,Do]),new On([Mo,Mo,Mo],[0,0,Do]),new On([0,Mo,Mo],[Do,0,Do]),new On([Mo,0,Mo],[0,Do,Do]),new On([0,0,Mo],[Do,Do,Do])];function vp(t){return t*xr/Zc}function $I(t,e,n,i=!0){let r=$.scale([],t._camera.position,t.worldSize),o=[e,n,1,1];vn.transformMat4(o,o,t.pixelMatrixInverse),vn.scale(o,o,1/o[3]);let l=$.sub([],o,r),u=$.normalize([],l),h=t.globeMatrix,p=[h[12],h[13],h[14]],m=$.sub([],p,r),_=$.length(m),y=$.normalize([],m),v=t.worldSize/(2*Math.PI),b=$.dot(y,u),w=Math.asin(v/_);if(w<Math.acos(b)){if(!i)return null;let z=[],B=[];$.scale(z,u,_/b),$.normalize(B,$.sub(B,z,m)),$.normalize(u,$.add(u,m,$.scale(u,B,Math.tan(w)*_)))}let C=[];new yp(r,u).closestPointOnSphere(p,v,C);let E=$.normalize([],ei(h,0)),I=$.normalize([],ei(h,1)),D=$.normalize([],ei(h,2)),S=$.dot(E,C),M=$.dot(I,C),A=$.dot(D,C),R=ji(Math.asin(-M/v)),F=ji(Math.atan2(S,A));F=t.center.lng+function(z,B){let G=(B-z+180)%360-180;return G<-180?G+360:G}(t.center.lng,F);let k=Ii(F),L=We(Ai(R),0,1);return new Gt(k,L)}class lN{constructor(e,n,i){this.a=$.sub([],e,i),this.b=$.sub([],n,i),this.center=i;let r=$.normalize([],this.a),o=$.normalize([],this.b);this.angle=Math.acos($.dot(r,o))}}function hv(t,e){if(t.angle===0)return null;let n;return n=t.a[e]===0?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),n<0||n>1?null:function(i,r,o,l){let u=Math.sin(o);return i*(Math.sin((1-l)*o)/u)+r*(Math.sin(l*o)/u)}(t.a[e],t.b[e],t.angle,We(n,0,1))+t.center[e]}function so(t){if(t.z<=1)return aN[t.z+2*t.y+t.x];let e=pv(xp(t));return On.fromPoints(e)}function Js(t,e,n){return $.scale(t,t,1-n),$.scaleAndAdd(t,t,e,n)}function GI(t,e){let n=Ni(e.zoom);if(n===0)return so(t);let i=xp(t),r=pv(i),o=Ii(i.getWest())*e.worldSize,l=Ii(i.getEast())*e.worldSize,u=Ai(i.getNorth())*e.worldSize,h=Ai(i.getSouth())*e.worldSize,p=[o,u,0],m=[l,u,0],_=[o,h,0],y=[l,h,0],v=ne.invert([],e.globeMatrix);return $.transformMat4(p,p,v),$.transformMat4(m,m,v),$.transformMat4(_,_,v),$.transformMat4(y,y,v),r[0]=Js(r[0],_,n),r[1]=Js(r[1],y,n),r[2]=Js(r[2],m,n),r[3]=Js(r[3],p,n),On.fromPoints(r)}function HI(t,e,n){for(let i of t)$.transformMat4(i,i,e),$.scale(i,i,n)}function fv(t,e,n,i){let r=e/t.worldSize,o=t.globeMatrix;if(n.z<=1){let k=so(n).getCorners();return HI(k,o,r),On.fromPoints(k)}let l=xp(n,i),u=pv(l);HI(u,o,r);let h=Number.MAX_VALUE,p=[-h,-h,-h],m=[h,h,h];if(l.contains(t.center)){for(let z of u)$.min(m,m,z),$.max(p,p,z);p[2]=0;let k=t.point,L=[k.x*r,k.y*r,0];return $.min(m,m,L),$.max(p,p,L),new On(m,p)}let _=[o[12]*r,o[13]*r,o[14]*r],y=l.getCenter(),v=We(t.center.lat,-si,si),b=We(y.lat,-si,si),w=Ii(t.center.lng),C=Ai(v),E=w-Ii(y.lng),I=C-Ai(b);E>.5?E-=1:E<-.5&&(E+=1);let D=0;if(Math.abs(E)>Math.abs(I))D=E>=0?1:3;else{D=I>=0?0:2;let k=[o[4]*r,o[5]*r,o[6]*r],L=-Math.sin(Tt(I>=0?l.getSouth():l.getNorth()))*xr;$.scaleAndAdd(_,_,k,L)}let S=u[D],M=u[(D+1)%4],A=new lN(S,M,_),R=[hv(A,0)||S[0],hv(A,1)||S[1],hv(A,2)||S[2]],F=Ni(t.zoom);if(F>0){let k=function({x:z,y:B,z:G},N,W,Y,te){let q=1/(1<<G),X=z*q,re=X+q,se=B*q,oe=se+q,ue=0,de=(X+re)/2-Y;return de>.5?ue=-1:de<-.5&&(ue=1),X=((X+ue)*N-(Y*=N))*W+Y,re=((re+ue)*N-Y)*W+Y,se=(se*N-(te*=N))*W+te,oe=(oe*N-te)*W+te,[[X,oe,0],[re,oe,0],[re,se,0],[X,se,0]]}(n,e,t._pixelsPerMercatorPixel,w,C);for(let z=0;z<u.length;z++)Js(u[z],k[z],F);let L=$.add([],k[D],k[(D+1)%4]);$.scale(L,L,.5),Js(R,L,F)}for(let k of u)$.min(m,m,k),$.max(p,p,k);return m[2]=Math.min(S[2],M[2]),$.min(m,m,R),$.max(p,p,R),new On(m,p)}function xp({x:t,y:e,z:n},i=!1){let r=1/(1<<n),o=new pt(qr(t*r),e===(1<<n)-1&&i?-90:bi((e+1)*r)),l=new pt(qr((t+1)*r),e===0&&i?90:bi(e*r));return new Hr(o,l)}function pv(t){let e=Tt(t.getNorth()),n=Tt(t.getSouth()),i=Math.cos(e),r=Math.cos(n),o=Math.sin(e),l=Math.sin(n),u=t.getWest(),h=t.getEast();return[Wc(r,l,u),Wc(r,l,h),Wc(i,o,h),Wc(i,o,u)]}function Wc(t,e,n,i=xr){return n=Tt(n),[t*Math.sin(n)*i,-e*i,t*Math.cos(n)*i]}function Rr(t,e,n){return Wc(Math.cos(Tt(t)),Math.sin(Tt(t)),e,n)}function Nd(t,e,n,i){let r=1<<n.z,o=(t/le+n.x)/r;return Rr(bi((e/le+n.y)/r),qr(o),i)}function bp({min:t,max:e}){return sN/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}let qI=new Float64Array(16);function ka(t){let e=bp(t),n=ne.fromScaling(qI,[e,e,e]);return ne.translate(n,n,$.negate([],t.min))}function mv(t){let e=ne.fromTranslation(qI,t.min),n=1/bp(t);return ne.scale(e,e,[n,n,n])}function gv(t){let e=le/(2*Math.PI);return t/(2*Math.PI)/e}function WI(t,e){return le/(512*Math.pow(2,t))*bp(so(e))}function ZI(t,e,n,i,r){let o=gv(n),l=[t,e,-n/(2*Math.PI)],u=ne.identity(new Float64Array(16));return ne.translate(u,u,l),ne.scale(u,u,[o,o,o]),ne.rotateX(u,u,Tt(-r)),ne.rotateY(u,u,Tt(-i)),u}function XI(t){let e=t.pixelsPerMeter,n=e/Cn(1,t.center.lat),i=ne.identity(new Float64Array(16));return ne.translate(i,i,[t.point.x,t.point.y,0]),ne.scale(i,i,[n,n,e]),Float32Array.from(i)}function Ni(t){return ds(Ld,Fa,t)}function YI(t,e,n){let i=ne.identity(new Float64Array(16)),r=(e/(1<<t)-.5)*Math.PI*2;return ne.rotateY(i,n.globeMatrix,r),Float32Array.from(i)}function KI(t,e,n){let i=Ni(n.zoom),r=t.style.map._antialias,o=e.options.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return i===0&&!r&&!o}function JI(t,e,n,i){let r=e.getNorth(),o=e.getSouth(),l=e.getWest(),u=e.getEast(),h=1<<t.z,p=u-l,m=r-o,_=p/qc,y=-m/dv[n],v=[0,_,0,y,0,0,r,l,0];if(t.z>0){let b=180/i;Pr.multiply(v,v,[b/p+1,0,0,0,b/m+1,0,-.5*b/_,.5*b/y,1])}return v[2]=h,v[5]=t.x,v[8]=t.y,v}function cN(t){let e=si-5;t=We(t,-e,e)/e*90;let n=Math.pow(Math.abs(Math.sin(Tt(t))),3);return Math.round(n*(dv.length-1))}function QI(t){let e=[0,0,0],n=ne.identity(new Float64Array(16));return ne.multiply(n,t.pixelMatrix,t.globeMatrix),$.transformMat4(e,e,n),new Q(e[0],e[1])}function eM(t,e){let n=Rr(e.lat,e.lng),i=function(o){let l=Rr(o._center.lat,o._center.lng),u=$.fromValues(0,1,0),h=$.cross([],u,l),p=ne.fromRotation([],-o.angle,l);h=$.transformMat4(h,h,p),ne.fromRotation(p,-o._pitch,h);let m=$.normalize([],l);return $.scale(m,m,vp(o.cameraToCenterDistance/o.pixelsPerMeter)),$.transformMat4(m,m,p),$.add([],l,m)}(t),r=$.subtract([],i,n);return $.angle(r,n)}function wp(t,e){return eM(t,e)>Math.PI/2*1.01}let tM=Tt(85),uN=Math.cos(tM),dN=Math.sin(tM);class hN{constructor(e){this._createGrid(e),this._createPoles(e)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(let e of this._poleSegments)e.destroy();for(let e of this._gridSegments)e.withSkirts.destroy(),e.withoutSkirts.destroy()}_fillGridMeshWithLods(e,n){let i=new $r,r=new xi,o=[],l=e+1+2,u=n[0]+1,h=n[0]+1+(1+n.length),p=(m,_,y)=>{let v=m===l-1?m-2:m===0?m:m-1;return v+=y?24575:0,[v,_]};for(let m=0;m<l;++m)i.emplaceBack(...p(m,0,!0));for(let m=0;m<u;++m)for(let _=0;_<l;++_)i.emplaceBack(...p(_,m,(_===0||_===l-1)&&!0));for(let m=0;m<n.length;++m){let _=n[m];for(let y=0;y<l;++y)i.emplaceBack(...p(y,_,!0))}for(let m=0;m<n.length;++m){let _=r.length,y=n[m]+1+2,v=new xi;for(let C=0;C<y-1;C++){let E=C===y-2,I=E?l*(h-n.length+m-C):l;for(let D=0;D<l-1;D++){let S=C*l+D;C===0||E||D===0||D===l-2?(v.emplaceBack(S+1,S,S+I),v.emplaceBack(S+I,S+I+1,S+1)):(r.emplaceBack(S+1,S,S+I),r.emplaceBack(S+I,S+I+1,S+1))}}let b=yn.simpleSegment(0,_,i.length,r.length-_);for(let C=0;C<v.uint16.length;C+=3)r.emplaceBack(v.uint16[C],v.uint16[C+1],v.uint16[C+2]);let w=yn.simpleSegment(0,_,i.length,r.length-_);o.push({withoutSkirts:b,withSkirts:w})}return{vertices:i,indices:r,segments:o}}_createGrid(e){let n=this._fillGridMeshWithLods(qc,dv);this._gridSegments=n.segments,this._gridBuffer=e.createVertexBuffer(n.vertices,Oa.members),this._gridIndexBuffer=e.createIndexBuffer(n.indices,!0)}_createPoles(e){let n=new xi;for(let u=0;u<=qc;u++)n.emplaceBack(0,u+1,u+2);this._poleIndexBuffer=e.createIndexBuffer(n,!0);let i=new Rl,r=new Rl,o=new Rl,l=new Rl;this._poleSegments=[];for(let u=0,h=0;u<Ld;u++){let p=360/(1<<u);i.emplaceBack(0,-xr,0,.5,0),r.emplaceBack(0,-xr,0,.5,1),o.emplaceBack(0,-xr,0,.5,.5),l.emplaceBack(0,-xr,0,.5,.5);for(let m=0;m<=qc;m++){let _=m/qc,y=0,v=ft(0,p,_),[b,w,C]=Wc(uN,dN,v,xr);i.emplaceBack(b,w,C,_,y),r.emplaceBack(b,w,C,_,1-y);let E=Tt(v);_=.5+.5*Math.sin(E),y=.5+.5*Math.cos(E),o.emplaceBack(b,w,C,_,y),l.emplaceBack(b,w,C,_,1-y)}this._poleSegments.push(yn.simpleSegment(h,0,66,64)),h+=66}this._poleNorthVertexBuffer=e.createVertexBuffer(i,_p,!1),this._poleSouthVertexBuffer=e.createVertexBuffer(r,_p,!1),this._texturedPoleNorthVertexBuffer=e.createVertexBuffer(o,_p,!1),this._texturedPoleSouthVertexBuffer=e.createVertexBuffer(l,_p,!1)}getGridBuffers(e,n){return[this._gridBuffer,this._gridIndexBuffer,n?this._gridSegments[e].withSkirts:this._gridSegments[e].withoutSkirts]}getPoleBuffers(e,n){return[n?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,n?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[e]]}}let Zc=63710088e-1,_v=2*Math.PI*Zc;class La{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new La(hs(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){let n=Math.PI/180,i=this.lat*n,r=e.lat*n,o=Math.sin(i)*Math.sin(r)+Math.cos(i)*Math.cos(r)*Math.cos((e.lng-this.lng)*n);return Zc*Math.acos(Math.min(o,1))}toBounds(e=0){let n=360*e/40075017,i=n/Math.cos(Math.PI/180*this.lat);return new Hr(new La(this.lng-i,this.lat-n),new La(this.lng+i,this.lat+n))}toEcef(e){let n=vp(e);return Rr(this.lat,this.lng,xr+n)}static convert(e){if(e instanceof La)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new La(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new La(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var pt=La;let fN=0,pN=25.5;function Cp(t){return _v*Math.cos(t*Math.PI/180)}function Ii(t){return(180+t)/360}function Ai(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Cn(t,e){return t/Cp(e)}function qr(t){return 360*t-180}function bi(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function nM(t,e){return t*Cp(bi(e))}let si=85.051129;function iM(t){return Math.cos(Tt(We(t,-si,si)))}function Na(t,e){let n=We(e,fN,pN),i=Math.pow(2,n);return iM(t)*_v/(512*i)}function yv(t){return 1/Math.cos(t*Math.PI/180)}function zd(t,e=0){let n=Math.exp(Math.PI*(1-(t.y+e/le)/(1<<t.z)*2));return 80150034*n/(n*n+1)/le/(1<<t.z)}class Gt{constructor(e,n,i=0){this.x=+e,this.y=+n,this.z=+i}static fromLngLat(e,n=0){let i=pt.convert(e);return new Gt(Ii(i.lng),Ai(i.lat),Cn(n,i.lat))}toLngLat(){return new pt(qr(this.x),bi(this.y))}toAltitude(){return nM(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/_v*yv(bi(this.y))}}function vv(t,e,n,i,r,o,l,u,h){let p=(e+i)/2,m=(n+r)/2,_=new Q(p,m);u(_),function(y,v,b,w,C,E){let I=b-C,D=w-E;return Math.abs((w-v)*I-(b-y)*D)/Math.hypot(I,D)}(_.x,_.y,o.x,o.y,l.x,l.y)>=h?(vv(t,e,n,p,m,o,_,u,h),vv(t,p,m,i,r,_,l,u,h)):t.push(l)}function rM(t,e,n){let i=t[0],r=i.x,o=i.y;e(i);let l=[i];for(let u=1;u<t.length;u++){let h=t[u],{x:p,y:m}=h;e(h),vv(l,r,o,p,m,i,h,e,n),r=p,o=m,i=h}return l}function xv(t,e,n,i){if(i(e,n)){let r=e.add(n)._mult(.5);xv(t,e,r,i),xv(t,r,n,i)}else t.push(n)}function mN(t,e){let n=t[0],i=[n];for(let r=1;r<t.length;r++){let o=t[r];xv(i,n,o,e),n=o}return i}let bv=Math.pow(2,14)-1,oM=-bv-1;function gN(t,e){let n=Math.round(t.x*e),i=Math.round(t.y*e);return t.x=We(n,oM,bv),t.y=We(i,oM,bv),(n<t.x||n>t.x+1||i<t.y||i>t.y+1)&&J("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function vs(t,e,n){let i=t.loadGeometry(),r=t.extent,o=le/r;if(e&&n&&n.projection.isReprojectedInTileSpace){let l=1<<e.z,{scale:u,x:h,y:p,projection:m}=n,_=y=>{let v=qr((e.x+y.x/r)/l),b=bi((e.y+y.y/r)/l),w=m.project(v,b);y.x=(w.x*u-h)*r,y.y=(w.y*u-p)*r};for(let y=0;y<i.length;y++)if(t.type!==1)i[y]=rM(i[y],_,1);else{let v=[];for(let b of i[y])b.x<0||b.x>=r||b.y<0||b.y>=r||(_(b),v.push(b));i[y]=v}}for(let l of i)for(let u of l)gN(u,o);return i}function za(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?vs(t):[]}}function Ep(t,e,n,i,r){t.emplaceBack(2*e+(i+1)/2,2*n+(r+1)/2)}function Tp(t,e,n){t.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class wv{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new $r,this.indexArray=new xi,this.segments=new yn,this.programConfigurations=new Pa(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,i,r){let o=this.layers[0],l=[],u=null;o.type==="circle"&&(u=o.layout.get("circle-sort-key"));for(let{feature:p,id:m,index:_,sourceLayerIndex:y}of e){let v=this.layers[0]._featureFilter.needGeometry,b=za(p,v);if(!this.layers[0]._featureFilter.filter(new Hn(this.zoom),b,i))continue;let w=u?u.evaluate(b,{},i):void 0,C={id:m,properties:p.properties,type:p.type,sourceLayerIndex:y,index:_,geometry:v?b.geometry:vs(p,i,r),patterns:{},sortKey:w};l.push(C)}u&&l.sort((p,m)=>p.sortKey-m.sortKey);let h=null;r.projection.name==="globe"&&(this.globeExtVertexArray=new cp,h=r.projection);for(let p of l){let{geometry:m,index:_,sourceLayerIndex:y}=p,v=e[_].feature;this.addFeature(p,m,_,n.availableImages,i,h,n.brightness),n.featureIndex.insert(v,m,_,y,this.index)}}update(e,n,i,r,o){let l=Object.keys(e).length!==0;l&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,l?this.stateDependentLayers:this.layers,i,r,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,I3.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,M3.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,n,i,r,o,l,u){for(let h of n)for(let p of h){let m=p.x,_=p.y;if(m<0||m>=le||_<0||_>=le)continue;if(l){let b=l.projectTilePoint(m,_,o),w=l.upVector(o,m,_),C=this.globeExtVertexArray;Tp(C,b,w),Tp(C,b,w),Tp(C,b,w),Tp(C,b,w)}let y=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),v=y.vertexLength;Ep(this.layoutVertexArray,m,_,-1,-1),Ep(this.layoutVertexArray,m,_,1,-1),Ep(this.layoutVertexArray,m,_,1,1),Ep(this.layoutVertexArray,m,_,-1,1),this.indexArray.emplaceBack(v,v+1,v+2),this.indexArray.emplaceBack(v,v+2,v+3),y.vertexLength+=4,y.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,{},r,o,u)}}function sM(t,e){for(let n=0;n<t.length;n++)if(Ba(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(Ba(t,e[n]))return!0;return!!Cv(t,e)}function _N(t,e,n){return!!Ba(t,e)||!!Ev(e,t,n)}function aM(t,e){if(t.length===1)return cM(e,t[0]);for(let n=0;n<e.length;n++){let i=e[n];for(let r=0;r<i.length;r++)if(Ba(t,i[r]))return!0}for(let n=0;n<t.length;n++)if(cM(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(Cv(t,e[n]))return!0;return!1}function yN(t,e,n){if(t.length>1){if(Cv(t,e))return!0;for(let i=0;i<e.length;i++)if(Ev(e[i],t,n))return!0}for(let i=0;i<t.length;i++)if(Ev(t[i],e,n))return!0;return!1}function Cv(t,e){if(t.length===0||e.length===0)return!1;for(let n=0;n<t.length-1;n++){let i=t[n],r=t[n+1];for(let o=0;o<e.length-1;o++)if(vN(i,r,e[o],e[o+1]))return!0}return!1}function vN(t,e,n,i){return _e(t,n,i)!==_e(e,n,i)&&_e(t,e,n)!==_e(t,e,i)}function Ev(t,e,n){let i=n*n;if(e.length===1)return t.distSqr(e[0])<i;for(let r=1;r<e.length;r++)if(lM(t,e[r-1],e[r])<i)return!0;return!1}function lM(t,e,n){let i=e.distSqr(n);if(i===0)return t.distSqr(e);let r=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/i;return t.distSqr(r<0?e:r>1?n:n.sub(e)._mult(r)._add(e))}function cM(t,e){let n,i,r,o=!1;for(let l=0;l<t.length;l++){n=t[l];for(let u=0,h=n.length-1;u<n.length;h=u++)i=n[u],r=n[h],i.y>e.y!=r.y>e.y&&e.x<(r.x-i.x)*(e.y-i.y)/(r.y-i.y)+i.x&&(o=!o)}return o}function Ba(t,e){let n=!1;for(let i=0,r=t.length-1;i<t.length;r=i++){let o=t[i],l=t[r];o.y>e.y!=l.y>e.y&&e.x<(l.x-o.x)*(e.y-o.y)/(l.y-o.y)+o.x&&(n=!n)}return n}function uM(t,e,n,i,r){for(let l of t)if(e<=l.x&&n<=l.y&&i>=l.x&&r>=l.y)return!0;let o=[new Q(e,n),new Q(e,r),new Q(i,r),new Q(i,n)];if(t.length>2){for(let l of o)if(Ba(t,l))return!0}for(let l=0;l<t.length-1;l++)if(xN(t[l],t[l+1],o))return!0;return!1}function xN(t,e,n){let i=n[0],r=n[2];if(t.x<i.x&&e.x<i.x||t.x>r.x&&e.x>r.x||t.y<i.y&&e.y<i.y||t.y>r.y&&e.y>r.y)return!1;let o=_e(t,e,n[0]);return o!==_e(t,e,n[1])||o!==_e(t,e,n[2])||o!==_e(t,e,n[3])}function Xc(t,e,n,i,r,o){let l=e.y-t.y,u=t.x-e.x;if(o=o||0){let h=l*l+u*u;if(h===0)return!0;let p=Math.sqrt(h);l/=p,u/=p}return!((n.x-t.x)*l+(n.y-t.y)*u-o<0||(i.x-t.x)*l+(i.y-t.y)*u-o<0||(r.x-t.x)*l+(r.y-t.y)*u-o<0)}function Tv(t,e,n,i,r,o,l){return!(Xc(t,e,i,r,o,l)||Xc(e,n,i,r,o,l)||Xc(n,t,i,r,o,l)||Xc(i,r,t,e,n,l)||Xc(r,o,t,e,n,l)||Xc(o,i,t,e,n,l))}function Yc(t,e,n){let i=e.paint.get(t).value;return i.kind==="constant"?i.value:n.programConfigurations.get(e.id).getMaxValue(t)}function Ip(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function dM(t,e,n,i,r){if(!e[0]&&!e[1])return t;let o=Q.convert(e)._mult(r);n==="viewport"&&o._rotate(-i);let l=[];for(let u=0;u<t.length;u++)l.push(t[u].sub(o));return l}function hM(t,e,n,i){let r=Q.convert(t)._mult(i);return e==="viewport"&&r._rotate(-n),r}Ge(wv,"CircleBucket",{omit:["layers"]});let bN=new ii({"circle-sort-key":new et(ie.layout_circle["circle-sort-key"]),visibility:new be(ie.layout_circle.visibility)});var wN={paint:new ii({"circle-radius":new et(ie.paint_circle["circle-radius"]),"circle-color":new et(ie.paint_circle["circle-color"]),"circle-blur":new et(ie.paint_circle["circle-blur"]),"circle-opacity":new et(ie.paint_circle["circle-opacity"]),"circle-translate":new be(ie.paint_circle["circle-translate"]),"circle-translate-anchor":new be(ie.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new be(ie.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new be(ie.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new et(ie.paint_circle["circle-stroke-width"]),"circle-stroke-color":new et(ie.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new et(ie.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new be(ie.paint_circle["circle-emissive-strength"])}),layout:bN};let CN=ne.create(),EN=(t,e,n,i,r,o)=>{let l=t.transform,u=l.projection.name==="globe",h;if(o.paint.get("circle-pitch-alignment")==="map")if(u){let m=WI(l.zoom,e.canonical)*l._pixelsPerMercatorPixel;h=Float32Array.from([m,0,0,m])}else h=l.calculatePixelsToTileUnitsMatrix(n);else h=new Float32Array([l.pixelsToGLUnits[0],0,0,l.pixelsToGLUnits[1]]);let p={u_camera_to_center_distance:t.transform.getCameraToCenterDistance(l.projection),u_matrix:t.translatePosMatrix(e.projMatrix,n,o.paint.get("circle-translate"),o.paint.get("circle-translate-anchor")),u_device_pixel_ratio:yt.devicePixelRatio,u_extrude_scale:h,u_inv_rot_matrix:CN,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:o.paint.get("circle-emissive-strength")};if(u){p.u_inv_rot_matrix=i,p.u_merc_center=r,p.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],p.u_zoom_transition=Ni(l.zoom);let m=r[0]*le,_=r[1]*le;p.u_up_dir=l.projection.upVector(new Io(0,0,0),m,_)}return p},fM=t=>{let e=[];return t.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),t.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function pM(t,e,n,i,r,o,l,u,h){if(o&&t.queryGeometry.isAboveHorizon)return!1;o&&(h*=t.pixelToTileUnitsFactor);let p=t.tileID.canonical,m=n.projection.upVectorScale(p,n.center.lat,n.worldSize).metersToTile;for(let _ of e)for(let y of _){let v=y.add(u),b=r&&n.elevation?n.elevation.exaggeration()*r.getElevationAt(v.x,v.y,!0):0,w=n.projection.projectTilePoint(v.x,v.y,p);if(b>0){let D=n.projection.upVector(p,v.x,v.y);w.x+=D[0]*m*b,w.y+=D[1]*m*b,w.z+=D[2]*m*b}let C=o?v:TN(w.x,w.y,w.z,i),E=o?t.tilespaceRays.map(D=>MN(D,b)):t.queryGeometry.screenGeometry,I=vn.transformMat4([],[w.x,w.y,w.z,1],i);if(!l&&o?h*=I[3]/n.cameraToCenterDistance:l&&!o&&(h*=n.cameraToCenterDistance/I[3]),o){let D=bi((y.y/le+p.y)/(1<<p.z));h/=n.projection.pixelsPerMeter(D,1)/Cn(1,D)}if(_N(E,C,h))return!0}return!1}function TN(t,e,n,i){let r=vn.transformMat4([],[t,e,n,1],i);return new Q(r[0]/r[3],r[1]/r[3])}let mM=$.fromValues(0,0,0),IN=$.fromValues(0,0,1);function MN(t,e){let n=$.create();return mM[2]=e,t.intersectsPlane(mM,IN,n),new Q(n[0],n[1])}class gM extends wv{}function _M(t,{width:e,height:n},i,r){if(r){if(r instanceof Uint8ClampedArray)r=new Uint8Array(r.buffer);else if(r.length!==e*n*i)throw new RangeError("mismatched image size")}else r=new Uint8Array(e*n*i);return t.width=e,t.height=n,t.data=r,t}function yM(t,e,n){let{width:i,height:r}=e;i===t.width&&r===t.height||(Iv(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,i),height:Math.min(t.height,r)},n),t.width=i,t.height=r,t.data=e.data)}function Iv(t,e,n,i,r,o){if(r.width===0||r.height===0)return e;if(r.width>t.width||r.height>t.height||n.x>t.width-r.width||n.y>t.height-r.height)throw new RangeError("out of range source coordinates for image copy");if(r.width>e.width||r.height>e.height||i.x>e.width-r.width||i.y>e.height-r.height)throw new RangeError("out of range destination coordinates for image copy");let l=t.data,u=e.data;for(let h=0;h<r.height;h++){let p=((n.y+h)*t.width+n.x)*o,m=((i.y+h)*e.width+i.x)*o;for(let _=0;_<r.width*o;_++)u[m+_]=l[p+_]}return e}Ge(gM,"HeatmapBucket",{omit:["layers"]});class Qs{constructor(e,n){_M(this,e,1,n)}resize(e){yM(this,new Qs(e),1)}clone(){return new Qs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,i,r,o){Iv(e,n,i,r,o,1)}}class gi{constructor(e,n){_M(this,e,4,n)}resize(e){yM(this,new gi(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new gi({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,i,r,o){Iv(e,n,i,r,o,4)}}class vM{constructor(e,n){this.width=e.width,this.height=e.height,this.data=n instanceof Uint8Array?new Float32Array(n.buffer):n}}Ge(Qs,"AlphaImage"),Ge(gi,"RGBAImage");let DN=new ii({visibility:new be(ie.layout_heatmap.visibility)});var SN={paint:new ii({"heatmap-radius":new et(ie.paint_heatmap["heatmap-radius"]),"heatmap-weight":new et(ie.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new be(ie.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Dd(ie.paint_heatmap["heatmap-color"]),"heatmap-opacity":new be(ie.paint_heatmap["heatmap-opacity"])}),layout:DN};function Mp(t){let e={},n=t.resolution||256,i=t.clips?t.clips.length:1,r=t.image||new gi({width:n,height:i}),o=(l,u,h)=>{e[t.evaluationKey]=h;let p=t.expression.evaluate(e);p&&(r.data[l+u+0]=Math.floor(255*p.r/p.a),r.data[l+u+1]=Math.floor(255*p.g/p.a),r.data[l+u+2]=Math.floor(255*p.b/p.a),r.data[l+u+3]=Math.floor(255*p.a))};if(t.clips)for(let l=0,u=0;l<i;++l,u+=4*n)for(let h=0,p=0;h<n;h++,p+=4){let m=h/(n-1),{start:_,end:y}=t.clips[l];o(u,p,_*(1-m)+y*m)}else for(let l=0,u=0;l<n;l++,u+=4)o(0,u,l/(n-1));return r}let AN=new ii({visibility:new be(ie.layout_hillshade.visibility)});var PN={paint:new ii({"hillshade-illumination-direction":new be(ie.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new be(ie.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new be(ie.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new be(ie.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new be(ie.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new be(ie.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new be(ie.paint_hillshade["hillshade-emissive-strength"])}),layout:AN};let RN=ln([{name:"a_pos",components:2,type:"Int16"}],4),{members:ON}=RN;var Mv={exports:{}};function Dp(t,e,n){n=n||2;var i,r,o,l,u,h,p,m=e&&e.length,_=m?e[0]*n:t.length,y=xM(t,0,_,n,!0),v=[];if(!y||y.next===y.prev)return v;if(m&&(y=function(w,C,E,I){var D,S,M,A=[];for(D=0,S=C.length;D<S;D++)(M=xM(w,C[D]*I,D<S-1?C[D+1]*I:w.length,I,!1))===M.next&&(M.steiner=!0),A.push(jN(M));for(A.sort(zN),D=0;D<A.length;D++)E=BN(A[D],E);return E}(t,e,y,n)),t.length>80*n){i=o=t[0],r=l=t[1];for(var b=n;b<_;b+=n)(u=t[b])<i&&(i=u),(h=t[b+1])<r&&(r=h),u>o&&(o=u),h>l&&(l=h);p=(p=Math.max(o-i,l-r))!==0?32767/p:0}return Bd(y,v,n,i,r,p,0),v}function xM(t,e,n,i,r){var o,l;if(r===Av(t,e,n,i)>0)for(o=e;o<n;o+=i)l=CM(o,t[o],t[o+1],l);else for(o=n-i;o>=e;o-=i)l=CM(o,t[o],t[o+1],l);return l&&Sp(l,l.next)&&(jd(l),l=l.next),l}function Nl(t,e){if(!t)return t;e||(e=t);var n,i=t;do if(n=!1,i.steiner||!Sp(i,i.next)&&Mi(i.prev,i,i.next)!==0)i=i.next;else{if(jd(i),(i=e=i.prev)===i.next)break;n=!0}while(n||i!==e);return e}function Bd(t,e,n,i,r,o,l){if(t){!l&&o&&function(m,_,y,v){var b=m;do b.z===0&&(b.z=Dv(b.x,b.y,_,y,v)),b.prevZ=b.prev,b.nextZ=b.next,b=b.next;while(b!==m);b.prevZ.nextZ=null,b.prevZ=null,function(w){var C,E,I,D,S,M,A,R,F=1;do{for(E=w,w=null,S=null,M=0;E;){for(M++,I=E,A=0,C=0;C<F&&(A++,I=I.nextZ);C++);for(R=F;A>0||R>0&&I;)A!==0&&(R===0||!I||E.z<=I.z)?(D=E,E=E.nextZ,A--):(D=I,I=I.nextZ,R--),S?S.nextZ=D:w=D,D.prevZ=S,S=D;E=I}S.nextZ=null,F*=2}while(M>1)}(b)}(t,i,r,o);for(var u,h,p=t;t.prev!==t.next;)if(u=t.prev,h=t.next,o?kN(t,i,r,o):FN(t))e.push(u.i/n|0),e.push(t.i/n|0),e.push(h.i/n|0),jd(t),t=h.next,p=h.next;else if((t=h)===p){l?l===1?Bd(t=LN(Nl(t),e,n),e,n,i,r,o,2):l===2&&NN(t,e,n,i,r,o):Bd(Nl(t),e,n,i,r,o,1);break}}}function FN(t){var e=t.prev,n=t,i=t.next;if(Mi(e,n,i)>=0)return!1;for(var r=e.x,o=n.x,l=i.x,u=e.y,h=n.y,p=i.y,m=r<o?r<l?r:l:o<l?o:l,_=u<h?u<p?u:p:h<p?h:p,y=r>o?r>l?r:l:o>l?o:l,v=u>h?u>p?u:p:h>p?h:p,b=i.next;b!==e;){if(b.x>=m&&b.x<=y&&b.y>=_&&b.y<=v&&Kc(r,u,o,h,l,p,b.x,b.y)&&Mi(b.prev,b,b.next)>=0)return!1;b=b.next}return!0}function kN(t,e,n,i){var r=t.prev,o=t,l=t.next;if(Mi(r,o,l)>=0)return!1;for(var u=r.x,h=o.x,p=l.x,m=r.y,_=o.y,y=l.y,v=u<h?u<p?u:p:h<p?h:p,b=m<_?m<y?m:y:_<y?_:y,w=u>h?u>p?u:p:h>p?h:p,C=m>_?m>y?m:y:_>y?_:y,E=Dv(v,b,e,n,i),I=Dv(w,C,e,n,i),D=t.prevZ,S=t.nextZ;D&&D.z>=E&&S&&S.z<=I;){if(D.x>=v&&D.x<=w&&D.y>=b&&D.y<=C&&D!==r&&D!==l&&Kc(u,m,h,_,p,y,D.x,D.y)&&Mi(D.prev,D,D.next)>=0||(D=D.prevZ,S.x>=v&&S.x<=w&&S.y>=b&&S.y<=C&&S!==r&&S!==l&&Kc(u,m,h,_,p,y,S.x,S.y)&&Mi(S.prev,S,S.next)>=0))return!1;S=S.nextZ}for(;D&&D.z>=E;){if(D.x>=v&&D.x<=w&&D.y>=b&&D.y<=C&&D!==r&&D!==l&&Kc(u,m,h,_,p,y,D.x,D.y)&&Mi(D.prev,D,D.next)>=0)return!1;D=D.prevZ}for(;S&&S.z<=I;){if(S.x>=v&&S.x<=w&&S.y>=b&&S.y<=C&&S!==r&&S!==l&&Kc(u,m,h,_,p,y,S.x,S.y)&&Mi(S.prev,S,S.next)>=0)return!1;S=S.nextZ}return!0}function LN(t,e,n){var i=t;do{var r=i.prev,o=i.next.next;!Sp(r,o)&&bM(r,i,i.next,o)&&Vd(r,o)&&Vd(o,r)&&(e.push(r.i/n|0),e.push(i.i/n|0),e.push(o.i/n|0),jd(i),jd(i.next),i=t=o),i=i.next}while(i!==t);return Nl(i)}function NN(t,e,n,i,r,o){var l=t;do{for(var u=l.next.next;u!==l.prev;){if(l.i!==u.i&&UN(l,u)){var h=wM(l,u);return l=Nl(l,l.next),h=Nl(h,h.next),Bd(l,e,n,i,r,o,0),void Bd(h,e,n,i,r,o,0)}u=u.next}l=l.next}while(l!==t)}function zN(t,e){return t.x-e.x}function BN(t,e){var n=function(r,o){var l,u=o,h=r.x,p=r.y,m=-1/0;do{if(p<=u.y&&p>=u.next.y&&u.next.y!==u.y){var _=u.x+(p-u.y)*(u.next.x-u.x)/(u.next.y-u.y);if(_<=h&&_>m&&(m=_,l=u.x<u.next.x?u:u.next,_===h))return l}u=u.next}while(u!==o);if(!l)return null;var y,v=l,b=l.x,w=l.y,C=1/0;u=l;do h>=u.x&&u.x>=b&&h!==u.x&&Kc(p<w?h:m,p,b,w,p<w?m:h,p,u.x,u.y)&&(y=Math.abs(p-u.y)/(h-u.x),Vd(u,r)&&(y<C||y===C&&(u.x>l.x||u.x===l.x&&VN(l,u)))&&(l=u,C=y)),u=u.next;while(u!==v);return l}(t,e);if(!n)return e;var i=wM(n,t);return Nl(i,i.next),Nl(n,n.next)}function VN(t,e){return Mi(t.prev,t,e.prev)<0&&Mi(e.next,t,t.next)<0}function Dv(t,e,n,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*r|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-i)*r|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function jN(t){var e=t,n=t;do(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next;while(e!==t);return n}function Kc(t,e,n,i,r,o,l,u){return(r-l)*(e-u)>=(t-l)*(o-u)&&(t-l)*(i-u)>=(n-l)*(e-u)&&(n-l)*(o-u)>=(r-l)*(i-u)}function UN(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(n,i){var r=n;do{if(r.i!==n.i&&r.next.i!==n.i&&r.i!==i.i&&r.next.i!==i.i&&bM(r,r.next,n,i))return!0;r=r.next}while(r!==n);return!1}(t,e)&&(Vd(t,e)&&Vd(e,t)&&function(n,i){var r=n,o=!1,l=(n.x+i.x)/2,u=(n.y+i.y)/2;do r.y>u!=r.next.y>u&&r.next.y!==r.y&&l<(r.next.x-r.x)*(u-r.y)/(r.next.y-r.y)+r.x&&(o=!o),r=r.next;while(r!==n);return o}(t,e)&&(Mi(t.prev,t,e.prev)||Mi(t,e.prev,e))||Sp(t,e)&&Mi(t.prev,t,t.next)>0&&Mi(e.prev,e,e.next)>0)}function Mi(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Sp(t,e){return t.x===e.x&&t.y===e.y}function bM(t,e,n,i){var r=Pp(Mi(t,e,n)),o=Pp(Mi(t,e,i)),l=Pp(Mi(n,i,t)),u=Pp(Mi(n,i,e));return r!==o&&l!==u||!(r!==0||!Ap(t,n,e))||!(o!==0||!Ap(t,i,e))||!(l!==0||!Ap(n,t,i))||!(u!==0||!Ap(n,e,i))}function Ap(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Pp(t){return t>0?1:t<0?-1:0}function Vd(t,e){return Mi(t.prev,t,t.next)<0?Mi(t,e,t.next)>=0&&Mi(t,t.prev,e)>=0:Mi(t,e,t.prev)<0||Mi(t,t.next,e)<0}function wM(t,e){var n=new Sv(t.i,t.x,t.y),i=new Sv(e.i,e.x,e.y),r=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,o.next=i,i.prev=o,i}function CM(t,e,n,i){var r=new Sv(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function jd(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Sv(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Av(t,e,n,i){for(var r=0,o=e,l=n-i;o<n;o+=i)r+=(t[l]-t[o])*(t[o+1]+t[l+1]),l=o;return r}Mv.exports=Dp,Mv.exports.default=Dp,Dp.deviation=function(t,e,n,i){var r=e&&e.length,o=Math.abs(Av(t,0,r?e[0]*n:t.length,n));if(r)for(var l=0,u=e.length;l<u;l++)o-=Math.abs(Av(t,e[l]*n,l<u-1?e[l+1]*n:t.length,n));var h=0;for(l=0;l<i.length;l+=3){var p=i[l]*n,m=i[l+1]*n,_=i[l+2]*n;h+=Math.abs((t[p]-t[_])*(t[m+1]-t[p+1])-(t[p]-t[m])*(t[_+1]-t[p+1]))}return o===0&&h===0?0:Math.abs((h-o)/o)},Dp.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},i=0,r=0;r<t.length;r++){for(var o=0;o<t[r].length;o++)for(var l=0;l<e;l++)n.vertices.push(t[r][o][l]);r>0&&n.holes.push(i+=t[r-1].length)}return n};var Rp=tt(Mv.exports);function Pv(t,e){let n=t.length;if(n<=1)return[t];let i=[],r,o;for(let l=0;l<n;l++){let u=ve(t[l]);u!==0&&(t[l].area=Math.abs(u),o===void 0&&(o=u<0),o===u<0?(r&&i.push(r),r=[t[l]]):r.push(t[l]))}if(r&&i.push(r),e>1)for(let l=0;l<i.length;l++)i[l].length<=e||(TL(i[l],e,1,i[l].length-1,$N),i[l]=i[l].slice(0,e));return i}function $N(t,e){return e.area-t.area}function Rv(t,e,n){let i=n.patternDependencies,r=!1;for(let o of e){let l=o.paint.get(`${t}-pattern`);l.isConstant()||(r=!0);let u=l.constantOr(null);u&&(r=!0,i[u]=!0)}return r}function Ov(t,e,n,i,r){let o=r.patternDependencies;for(let l of e){let u=l.paint.get(`${t}-pattern`).value;if(u.kind!=="constant"){let h=u.evaluate({zoom:i},n,{},r.availableImages);h=h&&h.name?h.name:h,o[h]=!0,n.patterns[l.id]=h}}return n}class Op{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new $r,this.indexArray=new xi,this.indexArray2=new Sa,this.programConfigurations=new Pa(e.layers,e.zoom),this.segments=new yn,this.segments2=new yn,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection}populate(e,n,i,r){this.hasPattern=Rv("fill",this.layers,n);let o=this.layers[0].layout.get("fill-sort-key"),l=[];for(let{feature:u,id:h,index:p,sourceLayerIndex:m}of e){let _=this.layers[0]._featureFilter.needGeometry,y=za(u,_);if(!this.layers[0]._featureFilter.filter(new Hn(this.zoom),y,i))continue;let v=o?o.evaluate(y,{},i,n.availableImages):void 0,b={id:h,properties:u.properties,type:u.type,sourceLayerIndex:m,index:p,geometry:_?y.geometry:vs(u,i,r),patterns:{},sortKey:v};l.push(b)}o&&l.sort((u,h)=>u.sortKey-h.sortKey);for(let u of l){let{geometry:h,index:p,sourceLayerIndex:m}=u;if(this.hasPattern){let _=Ov("fill",this.layers,u,this.zoom,n);this.patternFeatures.push(_)}else this.addFeature(u,h,p,i,{},n.availableImages,n.brightness);n.featureIndex.insert(e[p].feature,h,p,m,this.index)}}update(e,n,i,r,o){let l=Object.keys(e).length!==0;l&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,l?this.stateDependentLayers:this.layers,i,r,o)}addFeatures(e,n,i,r,o,l){for(let u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,n,i,r,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ON),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,i,r,o,l=[],u){for(let h of Pv(n,500)){let p=0;for(let w of h)p+=w.length;let m=this.segments.prepareSegment(p,this.layoutVertexArray,this.indexArray),_=m.vertexLength,y=[],v=[];for(let w of h){if(w.length===0)continue;w!==h[0]&&v.push(y.length/2);let C=this.segments2.prepareSegment(w.length,this.layoutVertexArray,this.indexArray2),E=C.vertexLength;this.layoutVertexArray.emplaceBack(w[0].x,w[0].y),this.indexArray2.emplaceBack(E+w.length-1,E),y.push(w[0].x),y.push(w[0].y);for(let I=1;I<w.length;I++)this.layoutVertexArray.emplaceBack(w[I].x,w[I].y),this.indexArray2.emplaceBack(E+I-1,E+I),y.push(w[I].x),y.push(w[I].y);C.vertexLength+=w.length,C.primitiveLength+=w.length}let b=Rp(y,v);for(let w=0;w<b.length;w+=3)this.indexArray.emplaceBack(_+b[w],_+b[w+1],_+b[w+2]);m.vertexLength+=p,m.primitiveLength+=b.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,o,l,r,u)}}Ge(Op,"FillBucket",{omit:["layers","patternFeatures"]});let GN=new ii({"fill-sort-key":new et(ie.layout_fill["fill-sort-key"]),visibility:new be(ie.layout_fill.visibility)});var HN={paint:new ii({"fill-antialias":new be(ie.paint_fill["fill-antialias"]),"fill-opacity":new et(ie.paint_fill["fill-opacity"]),"fill-color":new et(ie.paint_fill["fill-color"]),"fill-outline-color":new et(ie.paint_fill["fill-outline-color"]),"fill-translate":new be(ie.paint_fill["fill-translate"]),"fill-translate-anchor":new be(ie.paint_fill["fill-translate-anchor"]),"fill-pattern":new et(ie.paint_fill["fill-pattern"]),"fill-emissive-strength":new be(ie.paint_fill["fill-emissive-strength"])}),layout:GN};let qN=ln([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),WN=ln([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),ZN=ln([{name:"a_centroid_pos",components:2,type:"Uint16"}]),XN=ln([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),YN=ln([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:KN}=qN;var Fp={},JN=Pi,EM=Jc;function Jc(t,e,n,i,r){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=i,this._values=r,t.readFields(QN,this,e)}function QN(t,e,n){t==1?e.id=n.readVarint():t==2?function(i,r){for(var o=i.readVarint()+i.pos;i.pos<o;){var l=r._keys[i.readVarint()],u=r._values[i.readVarint()];r.properties[l]=u}}(n,e):t==3?e.type=n.readVarint():t==4&&(e._geometry=n.pos)}function ez(t){for(var e,n,i=0,r=0,o=t.length,l=o-1;r<o;l=r++)i+=((n=t[l]).x-(e=t[r]).x)*(e.y+n.y);return i}Jc.types=["Unknown","Point","LineString","Polygon"],Jc.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,i=1,r=0,o=0,l=0,u=[];t.pos<n;){if(r<=0){var h=t.readVarint();i=7&h,r=h>>3}if(r--,i===1||i===2)o+=t.readSVarint(),l+=t.readSVarint(),i===1&&(e&&u.push(e),e=[]),e.push(new JN(o,l));else{if(i!==7)throw new Error("unknown command "+i);e&&e.push(e[0].clone())}}return e&&u.push(e),u},Jc.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,i=0,r=0,o=0,l=1/0,u=-1/0,h=1/0,p=-1/0;t.pos<e;){if(i<=0){var m=t.readVarint();n=7&m,i=m>>3}if(i--,n===1||n===2)(r+=t.readSVarint())<l&&(l=r),r>u&&(u=r),(o+=t.readSVarint())<h&&(h=o),o>p&&(p=o);else if(n!==7)throw new Error("unknown command "+n)}return[l,h,u,p]},Jc.prototype.toGeoJSON=function(t,e,n){var i,r,o=this.extent*Math.pow(2,n),l=this.extent*t,u=this.extent*e,h=this.loadGeometry(),p=Jc.types[this.type];function m(v){for(var b=0;b<v.length;b++){var w=v[b];v[b]=[360*(w.x+l)/o-180,360/Math.PI*Math.atan(Math.exp((180-360*(w.y+u)/o)*Math.PI/180))-90]}}switch(this.type){case 1:var _=[];for(i=0;i<h.length;i++)_[i]=h[i][0];m(h=_);break;case 2:for(i=0;i<h.length;i++)m(h[i]);break;case 3:for(h=function(v){var b=v.length;if(b<=1)return[v];for(var w,C,E=[],I=0;I<b;I++){var D=ez(v[I]);D!==0&&(C===void 0&&(C=D<0),C===D<0?(w&&E.push(w),w=[v[I]]):w.push(v[I]))}return w&&E.push(w),E}(h),i=0;i<h.length;i++)for(r=0;r<h[i].length;r++)m(h[i][r])}h.length===1?h=h[0]:p="Multi"+p;var y={type:"Feature",geometry:{type:p,coordinates:h},properties:this.properties};return"id"in this&&(y.id=this.id),y};var tz=EM,TM=IM;function IM(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(nz,this,e),this.length=this._features.length}function nz(t,e,n){t===15?e.version=n.readVarint():t===1?e.name=n.readString():t===5?e.extent=n.readVarint():t===2?e._features.push(n.pos):t===3?e._keys.push(n.readString()):t===4&&e._values.push(function(i){for(var r=null,o=i.readVarint()+i.pos;i.pos<o;){var l=i.readVarint()>>3;r=l===1?i.readString():l===2?i.readFloat():l===3?i.readDouble():l===4?i.readVarint64():l===5?i.readVarint():l===6?i.readSVarint():l===7?i.readBoolean():null}return r}(n))}IM.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new tz(this._pbf,e,this.extent,this._keys,this._values)};var iz=TM;function rz(t,e,n){if(t===3){var i=new iz(n,n.readVarint()+n.pos);i.length&&(e[i.name]=i)}}var Fv=Fp.VectorTile=function(t,e){this.layers=t.readFields(rz,{},e)},kp=Fp.VectorTileFeature=EM;function Lp(t,e,n,i){let r=[],o=i===0?(l,u,h,p,m,_)=>{l.push(new Q(_,h+(_-u)/(p-u)*(m-h)))}:(l,u,h,p,m,_)=>{l.push(new Q(u+(_-h)/(m-h)*(p-u),_))};for(let l of t){let u=[];for(let h of l){if(h.length<=2)continue;let p=[];for(let y=0;y<h.length-1;y++){let v=h[y].x,b=h[y].y,w=h[y+1].x,C=h[y+1].y,E=i===0?v:b,I=i===0?w:C;E<e?I>e&&o(p,v,b,w,C,e):E>n?I<n&&o(p,v,b,w,C,n):p.push(h[y]),I<e&&E>=e&&o(p,v,b,w,C,e),I>n&&E<=n&&o(p,v,b,w,C,n)}let m=h[h.length-1],_=i===0?m.x:m.y;_>=e&&_<=n&&p.push(m),p.length&&(m=p[p.length-1],p[0].x===m.x&&p[0].y===m.y||p.push(p[0]),u.push(p))}u.length&&r.push(u)}return r}Fp.VectorTileLayer=TM;class MM{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){let i=e[n];this._stringToNumber[i]=n,this._numberToString[n]=i}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}var oz={read:function(t,e,n,i,r){var o,l,u=8*r-i-1,h=(1<<u)-1,p=h>>1,m=-7,_=n?r-1:0,y=n?-1:1,v=t[e+_];for(_+=y,o=v&(1<<-m)-1,v>>=-m,m+=u;m>0;o=256*o+t[e+_],_+=y,m-=8);for(l=o&(1<<-m)-1,o>>=-m,m+=i;m>0;l=256*l+t[e+_],_+=y,m-=8);if(o===0)o=1-p;else{if(o===h)return l?NaN:1/0*(v?-1:1);l+=Math.pow(2,i),o-=p}return(v?-1:1)*l*Math.pow(2,o-i)},write:function(t,e,n,i,r,o){var l,u,h,p=8*o-r-1,m=(1<<p)-1,_=m>>1,y=r===23?Math.pow(2,-24)-Math.pow(2,-77):0,v=i?0:o-1,b=i?1:-1,w=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(u=isNaN(e)?1:0,l=m):(l=Math.floor(Math.log(e)/Math.LN2),e*(h=Math.pow(2,-l))<1&&(l--,h*=2),(e+=l+_>=1?y/h:y*Math.pow(2,1-_))*h>=2&&(l++,h/=2),l+_>=m?(u=0,l=m):l+_>=1?(u=(e*h-1)*Math.pow(2,r),l+=_):(u=e*Math.pow(2,_-1)*Math.pow(2,r),l=0));r>=8;t[n+v]=255&u,v+=b,u/=256,r-=8);for(l=l<<r|u,p+=r;p>0;t[n+v]=255&l,v+=b,l/=256,p-=8);t[n+v-b]|=128*w}},DM=Vn,Np=oz;function Vn(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Vn.Varint=0,Vn.Fixed64=1,Vn.Bytes=2,Vn.Fixed32=5;var kv=4294967296,SM=1/kv,AM=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function ea(t){return t.type===Vn.Bytes?t.readVarint()+t.pos:t.pos+1}function Qc(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function PM(t,e,n){var i=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(i);for(var r=n.pos-1;r>=t;r--)n.buf[r+i]=n.buf[r]}function sz(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function az(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function lz(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function cz(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function uz(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function dz(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function hz(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function fz(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function pz(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function zp(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function eu(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function RM(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}Vn.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var i=this.readVarint(),r=i>>3,o=this.pos;this.type=7&i,t(r,e,this),this.pos===o&&this.skip(i)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=zp(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=RM(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=zp(this.buf,this.pos)+zp(this.buf,this.pos+4)*kv;return this.pos+=8,t},readSFixed64:function(){var t=zp(this.buf,this.pos)+RM(this.buf,this.pos+4)*kv;return this.pos+=8,t},readFloat:function(){var t=Np.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Np.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,i=this.buf;return e=127&(n=i[this.pos++]),n<128?e:(e|=(127&(n=i[this.pos++]))<<7,n<128?e:(e|=(127&(n=i[this.pos++]))<<14,n<128?e:(e|=(127&(n=i[this.pos++]))<<21,n<128?e:function(r,o,l){var u,h,p=l.buf;if(u=(112&(h=p[l.pos++]))>>4,h<128||(u|=(127&(h=p[l.pos++]))<<3,h<128)||(u|=(127&(h=p[l.pos++]))<<10,h<128)||(u|=(127&(h=p[l.pos++]))<<17,h<128)||(u|=(127&(h=p[l.pos++]))<<24,h<128)||(u|=(1&(h=p[l.pos++]))<<31,h<128))return Qc(r,u,o);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=i[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&AM?function(n,i,r){return AM.decode(n.subarray(i,r))}(this.buf,e,t):function(n,i,r){for(var o="",l=i;l<r;){var u,h,p,m=n[l],_=null,y=m>239?4:m>223?3:m>191?2:1;if(l+y>r)break;y===1?m<128&&(_=m):y===2?(192&(u=n[l+1]))==128&&(_=(31&m)<<6|63&u)<=127&&(_=null):y===3?(h=n[l+2],(192&(u=n[l+1]))==128&&(192&h)==128&&((_=(15&m)<<12|(63&u)<<6|63&h)<=2047||_>=55296&&_<=57343)&&(_=null)):y===4&&(h=n[l+2],p=n[l+3],(192&(u=n[l+1]))==128&&(192&h)==128&&(192&p)==128&&((_=(15&m)<<18|(63&u)<<12|(63&h)<<6|63&p)<=65535||_>=1114112)&&(_=null)),_===null?(_=65533,y=1):_>65535&&(_-=65536,o+=String.fromCharCode(_>>>10&1023|55296),_=56320|1023&_),o+=String.fromCharCode(_),l+=y}return o}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Vn.Bytes)return t.push(this.readVarint(e));var n=ea(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Vn.Bytes)return t.push(this.readSVarint());var e=ea(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Vn.Bytes)return t.push(this.readBoolean());var e=ea(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Vn.Bytes)return t.push(this.readFloat());var e=ea(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Vn.Bytes)return t.push(this.readDouble());var e=ea(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Vn.Bytes)return t.push(this.readFixed32());var e=ea(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Vn.Bytes)return t.push(this.readSFixed32());var e=ea(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Vn.Bytes)return t.push(this.readFixed64());var e=ea(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Vn.Bytes)return t.push(this.readSFixed64());var e=ea(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Vn.Varint)for(;this.buf[this.pos++]>127;);else if(e===Vn.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Vn.Fixed32)this.pos+=4;else{if(e!==Vn.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),eu(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),eu(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),eu(this.buf,-1&t,this.pos),eu(this.buf,Math.floor(t*SM),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),eu(this.buf,-1&t,this.pos),eu(this.buf,Math.floor(t*SM),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,n){var i,r;if(e>=0?(i=e%4294967296|0,r=e/4294967296|0):(r=~(-e/4294967296),4294967295^(i=~(-e%4294967296))?i=i+1|0:(i=0,r=r+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),function(o,l,u){u.buf[u.pos++]=127&o|128,o>>>=7,u.buf[u.pos++]=127&o|128,o>>>=7,u.buf[u.pos++]=127&o|128,o>>>=7,u.buf[u.pos++]=127&o|128,u.buf[u.pos]=127&(o>>>=7)}(i,0,n),function(o,l){var u=(7&o)<<4;l.buf[l.pos++]|=u|((o>>>=3)?128:0),o&&(l.buf[l.pos++]=127&o|((o>>>=7)?128:0),o&&(l.buf[l.pos++]=127&o|((o>>>=7)?128:0),o&&(l.buf[l.pos++]=127&o|((o>>>=7)?128:0),o&&(l.buf[l.pos++]=127&o|((o>>>=7)?128:0),o&&(l.buf[l.pos++]=127&o)))))}(r,n)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(!!t)},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(i,r,o){for(var l,u,h=0;h<r.length;h++){if((l=r.charCodeAt(h))>55295&&l<57344){if(!u){l>56319||h+1===r.length?(i[o++]=239,i[o++]=191,i[o++]=189):u=l;continue}if(l<56320){i[o++]=239,i[o++]=191,i[o++]=189,u=l;continue}l=u-55296<<10|l-56320|65536,u=null}else u&&(i[o++]=239,i[o++]=191,i[o++]=189,u=null);l<128?i[o++]=l:(l<2048?i[o++]=l>>6|192:(l<65536?i[o++]=l>>12|224:(i[o++]=l>>18|240,i[o++]=l>>12&63|128),i[o++]=l>>6&63|128),i[o++]=63&l|128)}return o}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&PM(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),Np.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Np.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var i=this.pos-n;i>=128&&PM(n,i,this),this.pos=n-1,this.writeVarint(i),this.pos+=i},writeMessage:function(t,e,n){this.writeTag(t,Vn.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,sz,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,az,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,uz,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,lz,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,cz,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,dz,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,hz,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,fz,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,pz,e)},writeBytesField:function(t,e){this.writeTag(t,Vn.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Vn.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Vn.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Vn.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Vn.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Vn.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Vn.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Vn.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Vn.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Vn.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,!!e)}};var Bp=tt(DM);let mz=["tile","layer","source","sourceLayer","state"];class OM{constructor(e,n,i,r,o){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=i,this._y=r,this.properties=e.properties,this.id=o}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){let e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};this.id!==void 0&&(e.id=this.id);for(let n of mz)this[n]!==void 0&&(e[n]=this[n]);return e}}class gz{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,i){let r=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][r]=this.stateChanges[e][r]||{},$e(this.stateChanges[e][r],i),this.deletedStates[e]===null){this.deletedStates[e]={};for(let o in this.state[e])o!==r&&(this.deletedStates[e][o]=null)}else if(this.deletedStates[e]&&this.deletedStates[e][r]===null){this.deletedStates[e][r]={};for(let o in this.state[e][r])i[o]||(this.deletedStates[e][r][o]=null)}else for(let o in i)this.deletedStates[e]&&this.deletedStates[e][r]&&this.deletedStates[e][r][o]===null&&delete this.deletedStates[e][r][o]}removeFeatureState(e,n,i){if(this.deletedStates[e]===null)return;let r=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},i&&n!==void 0)this.deletedStates[e][r]!==null&&(this.deletedStates[e][r]=this.deletedStates[e][r]||{},this.deletedStates[e][r][i]=null);else if(n!==void 0)if(this.stateChanges[e]&&this.stateChanges[e][r])for(i in this.deletedStates[e][r]={},this.stateChanges[e][r])this.deletedStates[e][r][i]=null;else this.deletedStates[e][r]=null;else this.deletedStates[e]=null}getState(e,n){let i=String(n),r=$e({},(this.state[e]||{})[i],(this.stateChanges[e]||{})[i]);if(this.deletedStates[e]===null)return{};if(this.deletedStates[e]){let o=this.deletedStates[e][n];if(o===null)return{};for(let l in o)delete r[l]}return r}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){let i={};for(let r in this.stateChanges){this.state[r]=this.state[r]||{};let o={};for(let l in this.stateChanges[r])this.state[r][l]||(this.state[r][l]={}),$e(this.state[r][l],this.stateChanges[r][l]),o[l]=this.state[r][l];i[r]=o}for(let r in this.deletedStates){this.state[r]=this.state[r]||{};let o={};if(this.deletedStates[r]===null)for(let l in this.state[r])o[l]={},this.state[r][l]={};else for(let l in this.deletedStates[r]){if(this.deletedStates[r][l]===null)this.state[r][l]={};else if(this.state[r][l])for(let u of Object.keys(this.deletedStates[r][l]))delete this.state[r][l][u];o[l]=this.state[r][l]}i[r]=i[r]||{},$e(i[r],o)}if(this.stateChanges={},this.deletedStates={},Object.keys(i).length!==0)for(let r in e)e[r].setFeatureState(i,n)}}class FM{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){let i=this.toIdx(e,n);return{min:this.minimums[i],max:this.maximums[i]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function kM(t,e,n,i){let r=0,o=Number.MAX_VALUE;for(let l=0;l<3;l++)if(Math.abs(i[l])<1e-15){if(n[l]<t[l]||n[l]>e[l])return null}else{let u=1/i[l],h=(t[l]-n[l])*u,p=(e[l]-n[l])*u;if(h>p){let m=h;h=p,p=m}if(h>r&&(r=h),p<o&&(o=p),r>o)return null}return r}function LM(t,e,n,i,r,o,l,u,h,p,m){let _=i-t,y=r-e,v=o-n,b=l-t,w=u-e,C=h-n,E=m[1]*C-m[2]*w,I=m[2]*b-m[0]*C,D=m[0]*w-m[1]*b,S=_*E+y*I+v*D;if(Math.abs(S)<1e-15)return null;let M=1/S,A=p[0]-t,R=p[1]-e,F=p[2]-n,k=(A*E+R*I+F*D)*M;if(k<0||k>1)return null;let L=R*v-F*y,z=F*_-A*v,B=A*y-R*_,G=(m[0]*L+m[1]*z+m[2]*B)*M;return G<0||k+G>1?null:(b*L+w*z+C*B)*M}function NM(t,e,n){return(t-e)/(n-e)}function zM(t,e,n,i,r,o,l,u,h){let p=1<<n,m=o-i,_=l-r,y=(t+1)/p*m+i,v=(e+0)/p*_+r,b=(e+1)/p*_+r;u[0]=(t+0)/p*m+i,u[1]=v,h[0]=y,h[1]=b}class BM{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;let n=function(o){let l=Math.ceil(Math.log2(o.dim/8)),u=[],h=Math.ceil(Math.pow(2,l)),p=1/h,m=(v,b,w,C,E)=>{let I=C?1:0,D=(v+1)*w-I,S=b*w,M=(b+1)*w-I;E[0]=v*w,E[1]=S,E[2]=D,E[3]=M},_=new FM(h),y=[];for(let v=0;v<h*h;v++){m(v%h,Math.floor(v/h),p,!1,y);let b=Va(y[0],y[1],o),w=Va(y[2],y[1],o),C=Va(y[2],y[3],o),E=Va(y[0],y[3],o);_.minimums.push(Math.min(b,w,C,E)),_.maximums.push(Math.max(b,w,C,E)),_.leaves.push(1)}for(u.push(_),h/=2;h>=1;h/=2){let v=u[u.length-1];_=new FM(h);for(let b=0;b<h*h;b++){m(b%h,Math.floor(b/h),2,!0,y);let w=v.getElevation(y[0],y[1]),C=v.getElevation(y[2],y[1]),E=v.getElevation(y[2],y[3]),I=v.getElevation(y[0],y[3]),D=v.isLeaf(y[0],y[1]),S=v.isLeaf(y[2],y[1]),M=v.isLeaf(y[2],y[3]),A=v.isLeaf(y[0],y[3]),R=Math.min(w.min,C.min,E.min,I.min),F=Math.max(w.max,C.max,E.max,I.max),k=D&&S&&M&&A;_.maximums.push(F),_.minimums.push(R),_.leaves.push(F-R<=5&&k?1:0)}u.push(_)}return u}(this.dem),i=n.length-1,r=n[i];this._addNode(r.minimums[0],r.maximums[0],r.leaves[0]),this._construct(n,0,0,i,0)}raycastRoot(e,n,i,r,o,l,u=1){return kM([e,n,-100],[i,r,this.maximums[0]*u],o,l)}raycast(e,n,i,r,o,l,u=1){if(!this.nodeCount)return null;let h=this.raycastRoot(e,n,i,r,o,l,u);if(h==null)return null;let p=[],m=[],_=[],y=[],v=[{idx:0,t:h,nodex:0,nodey:0,depth:0}];for(;v.length>0;){let{idx:b,t:w,nodex:C,nodey:E,depth:I}=v.pop();if(this.leaves[b]){zM(C,E,I,e,n,i,r,_,y);let S=1<<I,M=(C+0)/S,A=(C+1)/S,R=(E+0)/S,F=(E+1)/S,k=Va(M,R,this.dem)*u,L=Va(A,R,this.dem)*u,z=Va(A,F,this.dem)*u,B=Va(M,F,this.dem)*u,G=LM(_[0],_[1],k,y[0],_[1],L,y[0],y[1],z,o,l),N=LM(y[0],y[1],z,_[0],y[1],B,_[0],_[1],k,o,l),W=Math.min(G!==null?G:Number.MAX_VALUE,N!==null?N:Number.MAX_VALUE);if(W!==Number.MAX_VALUE)return W;{let Y=$.scaleAndAdd([],o,l,w);if(VM(k,L,B,z,NM(Y[0],_[0],y[0]),NM(Y[1],_[1],y[1]))>=Y[2])return w}continue}let D=0;for(let S=0;S<this._siblingOffset.length;S++){zM((C<<1)+this._siblingOffset[S][0],(E<<1)+this._siblingOffset[S][1],I+1,e,n,i,r,_,y),_[2]=-100,y[2]=this.maximums[this.childOffsets[b]+S]*u;let M=kM(_,y,o,l);if(M!=null){let A=M;p[S]=A;let R=!1;for(let F=0;F<D&&!R;F++)A>=p[m[F]]&&(m.splice(F,0,S),R=!0);R||(m[D]=S),D++}}for(let S=0;S<D;S++){let M=m[S];v.push({idx:this.childOffsets[b]+M,t:p[M],nodex:(C<<1)+this._siblingOffset[M][0],nodey:(E<<1)+this._siblingOffset[M][1],depth:I+1})}}return null}_addNode(e,n,i){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(i),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,i,r,o){if(e[r].isLeaf(n,i)===1)return;this.childOffsets[o]||(this.childOffsets[o]=this.nodeCount);let l=r-1,u=e[l],h=0,p=0;for(let m=0;m<this._siblingOffset.length;m++){let _=2*n+this._siblingOffset[m][0],y=2*i+this._siblingOffset[m][1],v=u.getElevation(_,y),b=u.isLeaf(_,y),w=this._addNode(v.min,v.max,b);b&&(h|=1<<m),p||(p=w)}for(let m=0;m<this._siblingOffset.length;m++)h&1<<m||this._construct(e,2*n+this._siblingOffset[m][0],2*i+this._siblingOffset[m][1],l,p+m)}}function VM(t,e,n,i,r,o){return ft(ft(t,n,o),ft(e,i,o),r)}function Va(t,e,n){let i=n.dim,r=We(t*i-.5,0,i-1),o=We(e*i-.5,0,i-1),l=Math.floor(r),u=Math.floor(o),h=Math.min(l+1,i-1),p=Math.min(u+1,i-1);return VM(n.get(l,u),n.get(h,u),n.get(l,p),n.get(h,p),r-l,o-u)}let _z={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function yz(t,e,n){return(256*t*256+256*e+n)/10-1e4}function vz(t,e,n){return 256*t+e+n/256-32768}class Vp{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,i,r=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(i&&i!=="mapbox"&&i!=="terrarium")return J(`"${i}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;let o=this.dim=n.height-2,l=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.floatView=new Float32Array(n.data.buffer),this.borderReady=r,this._modifiedForSources={},!r){for(let h=0;h<o;h++)l[this._idx(-1,h)]=l[this._idx(0,h)],l[this._idx(o,h)]=l[this._idx(o-1,h)],l[this._idx(h,-1)]=l[this._idx(h,0)],l[this._idx(h,o)]=l[this._idx(h,o-1)];l[this._idx(-1,-1)]=l[this._idx(0,0)],l[this._idx(o,-1)]=l[this._idx(o-1,0)],l[this._idx(-1,o)]=l[this._idx(0,o-1)],l[this._idx(o,o)]=l[this._idx(o-1,o-1)]}let u=i==="terrarium"?vz:yz;for(let h=0;h<l.length;++h){let p=4*h;this.floatView[h]=u(this.pixels[p],this.pixels[p+1],this.pixels[p+2])}this._timestamp=yt.now()}_buildQuadTree(){this._tree=new BM(this)}get(e,n,i=!1){i&&(e=We(e,-1,this.dim),n=We(n,-1,this.dim));let r=this._idx(e,n);return this.floatView[r]}set(e,n,i){let r=this._idx(e,n),o=this.floatView[r];return this.floatView[r]=i,i-o}static getUnpackVector(e){return _z[e]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}static pack(e,n){let i=[0,0,0,0],r=Vp.getUnpackVector(n),o=Math.floor((e+r[3])/r[2]);return i[2]=o%256,o=Math.floor(o/256),i[1]=o%256,o=Math.floor(o/256),i[0]=o,i}getPixels(){return new vM({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,i){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let r=n*this.dim,o=n*this.dim+this.dim,l=i*this.dim,u=i*this.dim+this.dim;switch(n){case-1:r=o-1;break;case 1:o=r+1}switch(i){case-1:l=u-1;break;case 1:u=l+1}let h=-n*this.dim,p=-i*this.dim;for(let m=l;m<u;m++)for(let _=r;_<o;_++){let y=4*this._idx(_,m),v=4*this._idx(_+h,m+p);this.pixels[y+0]=e.pixels[v+0],this.pixels[y+1]=e.pixels[v+1],this.pixels[y+2]=e.pixels[v+2],this.pixels[y+3]=e.pixels[v+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}Ge(Vp,"DEMData"),Ge(BM,"DemMinMaxQuadTree",{omit:["dem"]});class xz{isDataAvailableAtPoint(e){let n=this._source();if(this.isUsingMockSource()||!n||e.y<0||e.y>1)return!1;let i=n.getSource().maxzoom,r=1<<i,o=Math.floor(e.x),l=Math.floor((e.x-o)*r),u=Math.floor(e.y*r),h=this.findDEMTileFor(new Jt(i,o,i,l,u));return!(!h||!h.dem)}getAtPointOrZero(e,n=0){return this.getAtPoint(e,n)||0}getAtPoint(e,n,i=!0){if(this.isUsingMockSource())return null;n==null&&(n=null);let r=this._source();if(!r||e.y<0||e.y>1)return n;let o=r.getSource().maxzoom,l=1<<o,u=Math.floor(e.x),h=e.x-u,p=new Jt(o,u,o,Math.floor(h*l),Math.floor(e.y*l)),m=this.findDEMTileFor(p);if(!m||!m.dem)return n;let _=m.dem,y=1<<m.tileID.canonical.z,v=(h*y-m.tileID.canonical.x)*_.dim,b=(e.y*y-m.tileID.canonical.y)*_.dim,w=Math.floor(v),C=Math.floor(b);return(i?this.exaggeration():1)*ft(ft(_.get(w,C),_.get(w,C+1),b-C),ft(_.get(w+1,C),_.get(w+1,C+1),b-C),v-w)}getAtTileOffset(e,n,i){let r=1<<e.canonical.z;return this.getAtPointOrZero(new Gt(e.wrap+(e.canonical.x+n/le)/r,(e.canonical.y+i/le)/r))}getAtTileOffsetFunc(e,n,i,r){return o=>{let l=this.getAtTileOffset(e,o.x,o.y),u=r.upVector(e.canonical,o.x,o.y),h=r.upVectorScale(e.canonical,n,i).metersToTile;return $.scale(u,u,l*h),u}}getForTilePoints(e,n,i,r){if(this.isUsingMockSource())return!1;let o=tu.create(this,e,r);return!!o&&(n.forEach(l=>{l[2]=this.exaggeration()*o.getElevationAt(l[0],l[1],i)}),!0)}getMinMaxForTile(e){if(this.isUsingMockSource())return null;let n=this.findDEMTileFor(e);if(!n||!n.dem)return null;let i=n.dem.tree,r=n.tileID,o=1<<e.canonical.z-r.canonical.z,l=e.canonical.x/o-r.canonical.x,u=e.canonical.y/o-r.canonical.y,h=0;for(let p=0;p<e.canonical.z-r.canonical.z&&!i.leaves[h];p++){l*=2,u*=2;let m=2*Math.floor(u)+Math.floor(l);h=i.childOffsets[h]+m,l%=1,u%=1}return{min:this.exaggeration()*i.minimums[h],max:this.exaggeration()*i.maximums[h]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(e,n,i){throw new Error("Pure virtual method called.")}pointCoordinate(e){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(e){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){let e=this.visibleDemTiles;if(e.length===0)return null;let n=!1,i=Number.MAX_VALUE,r=Number.MIN_VALUE;for(let o of e){let l=this.getMinMaxForTile(o.tileID);l&&(i=Math.min(i,l.min),r=Math.max(r,l.max),n=!0)}return n?{min:i,max:r}:null}}class tu{constructor(e,n,i){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=i}static create(e,n,i){let r=i||e.findDEMTileFor(n);if(!r||!r.dem)return;let o=r.dem,l=r.tileID,u=1<<n.canonical.z-l.canonical.z;return new tu(r,o.dim/le/u,[(n.canonical.x/u-l.canonical.x)*o.dim,(n.canonical.y/u-l.canonical.y)*o.dim])}tileCoordToPixel(e,n){let i=n*this._scale+this._offset[1],r=Math.floor(e*this._scale+this._offset[0]),o=Math.floor(i);return new Q(r,o)}getElevationAt(e,n,i,r){let o=e*this._scale+this._offset[0],l=n*this._scale+this._offset[1],u=Math.floor(o),h=Math.floor(l),p=this._dem;return r=!!r,i?ft(ft(p.get(u,h,r),p.get(u,h+1,r),l-h),ft(p.get(u+1,h,r),p.get(u+1,h+1,r),l-h),o-u):p.get(u,h,r)}getElevationAtPixel(e,n,i){return this._dem.get(e,n,!!i)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Cn(1,e)*this._dem.stride}}class Lv{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Bc(le,16,0),this.featureIndexArray=new gT,this.promoteId=n}insert(e,n,i,r,o,l=0){let u=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(i,r,o,l);let h=this.grid;for(let p=0;p<n.length;p++){let m=n[p],_=[1/0,1/0,-1/0,-1/0];for(let y=0;y<m.length;y++){let v=m[y];_[0]=Math.min(_[0],v.x),_[1]=Math.min(_[1],v.y),_[2]=Math.max(_[2],v.x),_[3]=Math.max(_[3],v.y)}_[0]<le&&_[1]<le&&_[2]>=0&&_[3]>=0&&h.insert(u,_[0],_[1],_[2],_[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Fv(new Bp(this.rawTileData)).layers,this.sourceLayerCoder=new MM(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(let e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n,i,r){this.loadVTLayers();let o=e.params||{},l=Jf(o.filter),u=e.tileResult,h=e.transform,p=u.bufferedTilespaceBounds,m=this.grid.query(p.min.x,p.min.y,p.max.x,p.max.y,(b,w,C,E)=>uM(u.bufferedTilespaceGeometry,b,w,C,E));m.sort(bz);let _=null;h.elevation&&m.length>0&&(_=tu.create(h.elevation,this.tileID));let y={},v;for(let b=0;b<m.length;b++){let w=m[b];if(w===v)continue;v=w;let C=this.featureIndexArray.get(w),E=null;this.loadMatchingFeature(y,C,l,o.layers,o.availableImages,n,i,r,(I,D,S,M=0)=>(E||(E=vs(I,this.tileID.canonical,e.tileTransform)),D.queryIntersectsFeature(u,I,S,E,this.z,e.transform,e.pixelPosMatrix,_,M)))}return y}loadMatchingFeature(e,n,i,r,o,l,u,h,p){let{featureIndex:m,bucketIndex:_,sourceLayerIndex:y,layoutVertexArrayOffset:v}=n,b=this.bucketLayerIDs[_];if(r&&!function(I,D){for(let S=0;S<I.length;S++)if(D.indexOf(I[S])>=0)return!0;return!1}(r,b))return;let w=this.sourceLayerCoder.decode(y),C=this.vtLayers[w].feature(m);if(i.needGeometry){let I=za(C,!0);if(!i.filter(new Hn(this.tileID.overscaledZ),I,this.tileID.canonical))return}else if(!i.filter(new Hn(this.tileID.overscaledZ),C))return;let E=this.getId(C,w);for(let I=0;I<b.length;I++){let D=b[I];if(r&&r.indexOf(D)<0)continue;let S=l[D];if(!S)continue;let M={};E!==void 0&&h&&(M=h.getState(S.sourceLayer||"_geojsonTileLayer",E));let A=$e({},u[D]);A.paint=jM(A.paint,S.paint,C,M,o),A.layout=jM(A.layout,S.layout,C,M,o);let R=!p||p(C,S,M,v);if(!R)continue;let F=new OM(C,this.z,this.x,this.y,E);F.layer=A;let k=e[D];k===void 0&&(k=e[D]=[]),k.push({featureIndex:m,feature:F,intersectionZ:R})}}lookupSymbolFeatures(e,n,i,r,o,l,u,h){let p={};this.loadVTLayers();let m=Jf(o);for(let _ of e)this.loadMatchingFeature(p,{bucketIndex:i,sourceLayerIndex:r,featureIndex:_,layoutVertexArrayOffset:0},m,l,u,h,n);return p}loadFeature(e){let{featureIndex:n,sourceLayerIndex:i}=e;this.loadVTLayers();let r=this.sourceLayerCoder.decode(i),o=this.vtFeatures[r];if(o[n])return o[n];let l=this.vtLayers[r].feature(n);return o[n]=l,l}hasLayer(e){for(let n of this.bucketLayerIDs)for(let i of n)if(e===i)return!0;return!1}getId(e,n){let i=e.id;if(this.promoteId){let r=typeof this.promoteId=="string"?this.promoteId:this.promoteId[n];r!=null&&(i=e.properties[r]),typeof i=="boolean"&&(i=Number(i))}return i}}function jM(t,e,n,i,r){return wc(t,(o,l)=>{let u=e instanceof Md?e.get(l):null;return u&&u.evaluate?u.evaluate(n,i,r):u})}function bz(t,e){return e-t}Ge(Lv,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});let wz=ln([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Cz=ln([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Ez=ln([{name:"a_projected_pos",components:4,type:"Float32"}],4);ln([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);let Tz=ln([{name:"a_z_offset",components:1,type:"Float32"}],4),Iz=ln([{name:"a_texb",components:2,type:"Uint16"}]),Mz=ln([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Dz=ln([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_z_offset",components:1,type:"Float32"}]);ln([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);let UM=ln([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Sz=ln([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ln([{name:"triangle",components:3,type:"Uint16"}]),ln([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ln([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"}]),ln([{type:"Float32",name:"offsetX"}]),ln([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var zi=24;let Xo=128;function Nv(t,e){let{expression:n}=e;if(n.kind==="constant")return{kind:"constant",layoutSize:n.evaluate(new Hn(t+1))};if(n.kind==="source")return{kind:"source"};{let{zoomStops:i,interpolationType:r}=n,o=0;for(;o<i.length&&i[o]<=t;)o++;o=Math.max(0,o-1);let l=o;for(;l<i.length&&i[l]<t+1;)l++;l=Math.min(i.length-1,l);let u=i[o],h=i[l];return n.kind==="composite"?{kind:"composite",minZoom:u,maxZoom:h,interpolationType:r}:{kind:"camera",minZoom:u,maxZoom:h,minSize:n.evaluate(new Hn(u)),maxSize:n.evaluate(new Hn(h)),interpolationType:r}}}function Ud(t,{uSize:e,uSizeT:n},{lowerSize:i,upperSize:r}){return t.kind==="source"?i/Xo:t.kind==="composite"?ft(i/Xo,r/Xo,n):e}function xs(t,e){let n=0,i=0;if(t.kind==="constant")i=t.layoutSize;else if(t.kind!=="source"){let{interpolationType:r,minZoom:o,maxZoom:l}=t,u=r?We(ms.interpolationFactor(r,e,o,l),0,1):0;t.kind==="camera"?i=ft(t.minSize,t.maxSize,u):n=u}return{uSizeT:n,uSize:i}}var Az=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Xo,evaluateSizeForFeature:Ud,evaluateSizeForZoom:xs,getSizeData:Nv});function Pz(t,e,n){return t.sections.forEach(i=>{i.text=function(r,o,l){let u=o.layout.get("text-transform").evaluate(l,{});return u==="uppercase"?r=r.toLocaleUpperCase():u==="lowercase"&&(r=r.toLocaleLowerCase()),Eo.applyArabicShaping&&(r=Eo.applyArabicShaping(r)),r}(i.text,e,n)}),t}let $d={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42","\u2190":"\u2191","\u2192":"\u2193"};function Rz(t){return t==="\uFE36"||t==="\uFE48"||t==="\uFE38"||t==="\uFE44"||t==="\uFE42"||t==="\uFE3E"||t==="\uFE3C"||t==="\uFE3A"||t==="\uFE18"||t==="\uFE40"||t==="\uFE10"||t==="\uFE13"||t==="\uFE14"||t==="\uFF40"||t==="\uFFE3"||t==="\uFE11"||t==="\uFE12"}function Oz(t){return t==="\uFE35"||t==="\uFE47"||t==="\uFE37"||t==="\uFE43"||t==="\uFE41"||t==="\uFE3D"||t==="\uFE3B"||t==="\uFE39"||t==="\uFE17"||t==="\uFE3F"}let zv=3;function Fz(t,e,n){e.glyphs=[],t===1&&n.readMessage(kz,e)}function kz(t,e,n){if(t===3){let{id:i,bitmap:r,width:o,height:l,left:u,top:h,advance:p}=n.readMessage(Lz,{});e.glyphs.push({id:i,bitmap:new Qs({width:o+2*zv,height:l+2*zv},r),metrics:{width:o,height:l,left:u,top:h,advance:p}})}else t===4?e.ascender=n.readSVarint():t===5&&(e.descender=n.readSVarint())}function Lz(t,e,n){t===1?e.id=n.readVarint():t===2?e.bitmap=n.readBytes():t===3?e.width=n.readVarint():t===4?e.height=n.readVarint():t===5?e.left=n.readSVarint():t===6?e.top=n.readSVarint():t===7&&(e.advance=n.readVarint())}let $M=zv,jn={horizontal:1,vertical:2,horizontalOnly:3},GM=-17;class Gd{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){let i=new Gd;return i.scale=e||1,i.fontStack=n,i}static forImage(e){let n=new Gd;return n.imageName=e,n}}class nu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){let i=new nu;for(let r=0;r<e.sections.length;r++){let o=e.sections[r];o.image?i.addImageSection(o):i.addTextSection(o,n)}return i}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(n,i){let r="";for(let o=0;o<n.length;o++){let l=n.charCodeAt(o+1)||null,u=n.charCodeAt(o-1)||null;r+=!i&&(l&&QE(l)&&!$d[n[o+1]]||u&&QE(u)&&!$d[n[o-1]])||!$d[n[o]]?n[o]:$d[n[o]]}return r}(this.text,e)}trim(){let e=0;for(let i=0;i<this.text.length&&jp[this.text.charCodeAt(i)];i++)e++;let n=this.text.length;for(let i=this.text.length-1;i>=0&&i>=e&&jp[this.text.charCodeAt(i)];i--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){let i=new nu;return i.text=this.text.substring(e,n),i.sectionIndex=this.sectionIndex.slice(e,n),i.sections=this.sections,i}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(Gd.forText(e.scale,e.fontStack||n));let i=this.sections.length-1;for(let r=0;r<e.text.length;++r)this.sectionIndex.push(i)}addImageSection(e){let n=e.image?e.image.namePrimary:"";if(n.length===0)return void J("Can't add FormattedSection with an empty image.");let i=this.getNextImageSectionCharCode();i?(this.text+=String.fromCodePoint(i),this.sections.push(Gd.forImage(n)),this.sectionIndex.push(this.sections.length-1)):J("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Bv(t,e,n,i,r,o,l,u,h,p,m,_,y,v,b){let w=nu.fromFeature(t,r);_===jn.vertical&&w.verticalizePunctuation(y);let C=[],E=function(A,R,F,k,L,z){if(!A)return[];let B=[],G=function(te,q,X,re,se,oe){let ue=0;for(let de=0;de<te.length();de++){let pe=te.getSection(de);ue+=HM(te.getCodePoint(de),pe,re,se,q,oe)}return ue/Math.max(1,Math.ceil(ue/X))}(A,R,F,k,L,z),N=A.text.indexOf("\u200B")>=0,W=0;for(let te=0;te<A.length();te++){let q=A.getSection(te),X=A.getCodePoint(te);if(jp[X]||(W+=HM(X,q,k,L,R,z)),te<A.length()-1){let re=!((Y=X)<11904||!(Xe["Bopomofo Extended"](Y)||Xe.Bopomofo(Y)||Xe["CJK Compatibility Forms"](Y)||Xe["CJK Compatibility Ideographs"](Y)||Xe["CJK Compatibility"](Y)||Xe["CJK Radicals Supplement"](Y)||Xe["CJK Strokes"](Y)||Xe["CJK Symbols and Punctuation"](Y)||Xe["CJK Unified Ideographs Extension A"](Y)||Xe["CJK Unified Ideographs"](Y)||Xe["Enclosed CJK Letters and Months"](Y)||Xe["Halfwidth and Fullwidth Forms"](Y)||Xe.Hiragana(Y)||Xe["Ideographic Description Characters"](Y)||Xe["Kangxi Radicals"](Y)||Xe["Katakana Phonetic Extensions"](Y)||Xe.Katakana(Y)||Xe["Vertical Forms"](Y)||Xe["Yi Radicals"](Y)||Xe["Yi Syllables"](Y)));(Nz[X]||re||q.imageName)&&B.push(WM(te+1,W,G,B,zz(X,A.getCodePoint(te+1),re&&N),!1))}}var Y;return ZM(WM(A.length(),W,G,B,0,!0))}(w,p,o,e,i,v),{processBidirectionalText:I,processStyledBidirectionalText:D}=Eo;if(I&&w.sections.length===1){let A=I(w.toString(),E);for(let R of A){let F=new nu;F.text=R,F.sections=w.sections;for(let k=0;k<R.length;k++)F.sectionIndex.push(0);C.push(F)}}else if(D){let A=D(w.text,w.sectionIndex,E);for(let R of A){let F=new nu;F.text=R[0],F.sectionIndex=R[1],F.sections=w.sections,C.push(F)}}else C=function(A,R){let F=[],k=A.text,L=0;for(let z of R)F.push(A.substring(L,z)),L=z;return L<k.length&&F.push(A.substring(L,k.length)),F}(w,E);let S=[],M={positionedLines:S,text:w.toString(),top:m[1],bottom:m[1],left:m[0],right:m[0],writingMode:_,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(A,R,F,k,L,z,B,G,N,W,Y,te){let q=0,X=0,re=0,se=G==="right"?1:G==="left"?0:.5,oe=!1;for(let Ae of L){let Pe=Ae.getSections();for(let Ne of Pe){if(Ne.imageName)continue;let Be=R[Ne.fontStack];if(Be&&(oe=Be.ascender!==void 0&&Be.descender!==void 0,!oe))break}if(!oe)break}let ue=0;for(let Ae of L){Ae.trim();let Pe=Ae.getMaxScale(),Ne=(Pe-1)*zi,Be={positionedGlyphs:[],lineOffset:0};A.positionedLines[ue]=Be;let lt=Be.positionedGlyphs,Ye=0;if(!Ae.length()){X+=z,++ue;continue}let Zt=0,Bt=0;for(let st=0;st<Ae.length();st++){let Qe=Ae.getSection(st),Ut=Ae.getSectionIndex(st),qt=Ae.getCodePoint(st),At=Qe.scale,En=null,ai=null,xn=null,Fn=zi,fi=0,li=!(N===jn.horizontal||!Y&&!v0(qt)||Y&&(jp[qt]||(de=qt,Xe.Arabic(de)||Xe["Arabic Supplement"](de)||Xe["Arabic Extended-A"](de)||Xe["Arabic Presentation Forms-A"](de)||Xe["Arabic Presentation Forms-B"](de))));if(Qe.imageName){let Bn=k[Qe.imageName];if(!Bn)continue;xn=Qe.imageName,A.iconsInText=A.iconsInText||!0,ai=Bn.paddedRect;let pn=Bn.displaySize;At=At*zi/te,En={width:pn[0],height:pn[1],left:0,top:-$M,advance:li?pn[1]:pn[0],localGlyph:!1},fi=oe?-En.height*At:GM+Pe*zi-pn[1]*At,Fn=En.advance;let Gi=(li?pn[0]:pn[1])*At-zi*Pe;Gi>0&&Gi>Ye&&(Ye=Gi)}else{let Bn=F[Qe.fontStack];if(!Bn)continue;Bn[qt]&&(ai=Bn[qt]);let pn=R[Qe.fontStack];if(!pn)continue;let Gi=pn.glyphs[qt];if(!Gi)continue;if(En=Gi.metrics,Fn=qt!==8203?zi:0,oe){let Is=pn.ascender!==void 0?Math.abs(pn.ascender):0,na=pn.descender!==void 0?Math.abs(pn.descender):0,ia=(Is+na)*At;Zt<ia&&(Zt=ia,Bt=(Is-na)/2*At),fi=-Is*At}else fi=GM+(Pe-At)*zi}li?(A.verticalizable=!0,lt.push({glyph:qt,imageName:xn,x:q,y:X+fi,vertical:li,scale:At,localGlyph:En.localGlyph,fontStack:Qe.fontStack,sectionIndex:Ut,metrics:En,rect:ai}),q+=Fn*At+W):(lt.push({glyph:qt,imageName:xn,x:q,y:X+fi,vertical:li,scale:At,localGlyph:En.localGlyph,fontStack:Qe.fontStack,sectionIndex:Ut,metrics:En,rect:ai}),q+=En.advance*At+W)}lt.length!==0&&(re=Math.max(q-W,re),oe?XM(lt,se,Ye,Bt,z*Pe/2):XM(lt,se,Ye,0,z/2)),q=0;let ct=z*Pe+Ye;Be.lineOffset=Math.max(Ye,Ne),X+=ct,++ue}var de;let pe=X,{horizontalAlign:ae,verticalAlign:ge}=Up(B);(function(Ae,Pe,Ne,Be,lt,Ye){let Zt=(Pe-Ne)*lt,Bt=-Ye*Be;for(let ct of Ae)for(let st of ct.positionedGlyphs)st.x+=Zt,st.y+=Bt})(A.positionedLines,se,ae,ge,re,pe),A.top+=-ge*pe,A.bottom=A.top+pe,A.left+=-ae*re,A.right=A.left+re,A.hasBaseline=oe}(M,e,n,i,C,l,u,h,_,p,y,b),!function(A){for(let R of A)if(R.positionedGlyphs.length!==0)return!1;return!0}(S)&&M}let jp={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Nz={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function HM(t,e,n,i,r,o){if(e.imageName){let l=i[e.imageName];return l?l.displaySize[0]*e.scale*zi/o+r:0}{let l=n[e.fontStack],u=l&&l.glyphs[t];return u?u.metrics.advance*e.scale+r:0}}function qM(t,e,n,i){let r=Math.pow(t-e,2);return i?t<e?r/2:2*r:r+Math.abs(n)*n}function zz(t,e,n){let i=0;return t===10&&(i-=1e4),n&&(i+=150),t!==40&&t!==65288||(i+=50),e!==41&&e!==65289||(i+=50),i}function WM(t,e,n,i,r,o){let l=null,u=qM(e,n,r,o);for(let h of i){let p=qM(e-h.x,n,r,o)+h.badness;p<=u&&(l=h,u=p)}return{index:t,x:e,priorBreak:l,badness:u}}function ZM(t){return t?ZM(t.priorBreak).concat(t.index):[]}function Up(t){let e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function XM(t,e,n,i,r){if(!(e||n||i||r))return;let o=t.length-1,l=t[o],u=(l.x+l.metrics.advance*l.scale)*e;for(let h=0;h<=o;h++)t[h].x-=u,t[h].y+=n+i+r}function Bz(t,e,n,i){let{horizontalAlign:r,verticalAlign:o}=Up(i),l=n[0]-t.displaySize[0]*r,u=n[1]-t.displaySize[1]*o;return{imagePrimary:t,imageSecondary:e,top:u,bottom:u+t.displaySize[1],left:l,right:l+t.displaySize[0]}}function YM(t,e,n,i,r,o){let l=t.imagePrimary,u;if(l.content){let C=l.content,E=l.pixelRatio||1;u=[C[0]/E,C[1]/E,l.displaySize[0]-C[2]/E,l.displaySize[1]-C[3]/E]}let h=e.left*o,p=e.right*o,m,_,y,v;n==="width"||n==="both"?(v=r[0]+h-i[3],_=r[0]+p+i[1]):(v=r[0]+(h+p-l.displaySize[0])/2,_=v+l.displaySize[0]);let b=e.top*o,w=e.bottom*o;return n==="height"||n==="both"?(m=r[1]+b-i[0],y=r[1]+w+i[2]):(m=r[1]+(b+w-l.displaySize[1])/2,y=m+l.displaySize[1]),{imagePrimary:l,imageSecondary:void 0,top:m,right:_,bottom:y,left:v,collisionPadding:u}}class ta extends Q{constructor(e,n,i,r,o){super(e,n),this.angle=r,this.z=i,o!==void 0&&(this.segment=o)}clone(){return new ta(this.x,this.y,this.z,this.angle,this.segment)}}function KM(t,e,n,i,r){if(e.segment===void 0)return!0;let o=e,l=e.segment+1,u=0;for(;u>-n/2;){if(l--,l<0)return!1;u-=t[l].dist(o),o=t[l]}u+=t[l].dist(t[l+1]),l++;let h=[],p=0;for(;u<n/2;){let m=t[l],_=t[l+1];if(!_)return!1;let y=t[l-1].angleTo(m)-m.angleTo(_);for(y=Math.abs((y+3*Math.PI)%(2*Math.PI)-Math.PI),h.push({distance:u,angleDelta:y}),p+=y;u-h[0].distance>i;)p-=h.shift().angleDelta;if(p>r)return!1;l++,u+=m.dist(_)}return!0}function JM(t){let e=0;for(let n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function QM(t,e,n){return t?.6*e*n:0}function eD(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function Vz(t,e,n,i,r,o){let l=QM(n,r,o),u=eD(n,i)*o,h=0,p=JM(t)/2;for(let m=0;m<t.length-1;m++){let _=t[m],y=t[m+1],v=_.dist(y);if(h+v>p){let b=(p-h)/v,w=ft(_.x,y.x,b),C=ft(_.y,y.y,b),E=new ta(w,C,0,y.angleTo(_),m);return!l||KM(t,E,u,l,e)?E:void 0}h+=v}}function jz(t,e,n,i,r,o,l,u,h){let p=QM(i,o,l),m=eD(i,r),_=m*l,y=t[0].x===0||t[0].x===h||t[0].y===0||t[0].y===h;return e-_<e/4&&(e=_+e/4),tD(t,y?e/2*u%e:(m/2+2*o)*l*u%e,e,p,n,_,y,!1,h)}function tD(t,e,n,i,r,o,l,u,h){let p=o/2,m=JM(t),_=0,y=e-n,v=[];for(let b=0;b<t.length-1;b++){let w=t[b],C=t[b+1],E=w.dist(C),I=C.angleTo(w);for(;y+n<_+E;){y+=n;let D=(y-_)/E,S=ft(w.x,C.x,D),M=ft(w.y,C.y,D);if(S>=0&&S<h&&M>=0&&M<h&&y-p>=0&&y+p<=m){let A=new ta(S,M,0,I,b);i&&!KM(t,A,o,i,r)||v.push(A)}}_+=E}return u||v.length||l||(v=tD(t,_/2,n,i,r,o,l,!0,h)),v}function nD(t,e,n,i,r){let o=[];for(let l=0;l<t.length;l++){let u=t[l],h;for(let p=0;p<u.length-1;p++){let m=u[p],_=u[p+1];m.x<e&&_.x<e||(m.x<e?m=new Q(e,m.y+(e-m.x)/(_.x-m.x)*(_.y-m.y))._round():_.x<e&&(_=new Q(e,m.y+(e-m.x)/(_.x-m.x)*(_.y-m.y))._round()),m.y<n&&_.y<n||(m.y<n?m=new Q(m.x+(n-m.y)/(_.y-m.y)*(_.x-m.x),n)._round():_.y<n&&(_=new Q(m.x+(n-m.y)/(_.y-m.y)*(_.x-m.x),n)._round()),m.x>=i&&_.x>=i||(m.x>=i?m=new Q(i,m.y+(i-m.x)/(_.x-m.x)*(_.y-m.y))._round():_.x>=i&&(_=new Q(i,m.y+(i-m.x)/(_.x-m.x)*(_.y-m.y))._round()),m.y>=r&&_.y>=r||(m.y>=r?m=new Q(m.x+(r-m.y)/(_.y-m.y)*(_.x-m.x),r)._round():_.y>=r&&(_=new Q(m.x+(r-m.y)/(_.y-m.y)*(_.x-m.x),r)._round()),h&&m.equals(h[h.length-1])||(h=[m],o.push(h)),h.push(_)))))}}return o}function Vv(t){let e=0,n=0;for(let l of t)e+=l.w*l.h,n=Math.max(n,l.w);t.sort((l,u)=>u.h-l.h);let i=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}],r=0,o=0;for(let l of t)for(let u=i.length-1;u>=0;u--){let h=i[u];if(!(l.w>h.w||l.h>h.h)){if(l.x=h.x,l.y=h.y,o=Math.max(o,l.y+l.h),r=Math.max(r,l.x+l.w),l.w===h.w&&l.h===h.h){let p=i.pop();u<i.length&&(i[u]=p)}else l.h===h.h?(h.x+=l.w,h.w-=l.w):l.w===h.w?(h.y+=l.h,h.h-=l.h):(i.push({x:h.x+l.w,y:h.y,w:h.w-l.w,h:l.h}),h.y+=l.h,h.h-=l.h);break}}return{w:r,h:o,fill:e/(r*o)||0}}Ge(ta,"Anchor");let Wr=1;class jv{constructor(e,{pixelRatio:n,version:i,stretchX:r,stretchY:o,content:l}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=r,this.stretchY=o,this.content=l,this.version=i}get tl(){return[this.paddedRect.x+Wr,this.paddedRect.y+Wr]}get br(){return[this.paddedRect.x+this.paddedRect.w-Wr,this.paddedRect.y+this.paddedRect.h-Wr]}get displaySize(){return[(this.paddedRect.w-2*Wr)/this.pixelRatio,(this.paddedRect.h-2*Wr)/this.pixelRatio]}}class iD{constructor(e,n){let i={},r={};this.haveRenderCallbacks=[];let o=[];this.addImages(e,i,o),this.addImages(n,r,o);let{w:l,h:u}=Vv(o),h=new gi({width:l||1,height:u||1});for(let p in e){let m=e[p],_=i[p].paddedRect;gi.copy(m.data,h,{x:0,y:0},{x:_.x+Wr,y:_.y+Wr},m.data)}for(let p in n){let m=n[p],_=r[p].paddedRect,y=_.x+Wr,v=_.y+Wr,b=m.data.width,w=m.data.height;gi.copy(m.data,h,{x:0,y:0},{x:y,y:v},m.data),gi.copy(m.data,h,{x:0,y:w-1},{x:y,y:v-1},{width:b,height:1}),gi.copy(m.data,h,{x:0,y:0},{x:y,y:v+w},{width:b,height:1}),gi.copy(m.data,h,{x:b-1,y:0},{x:y-1,y:v},{width:1,height:w}),gi.copy(m.data,h,{x:0,y:0},{x:y+b,y:v},{width:1,height:w})}this.image=h,this.iconPositions=i,this.patternPositions=r}addImages(e,n,i){for(let r in e){let o=e[r],l={x:0,y:0,w:o.data.width+2*Wr,h:o.data.height+2*Wr};i.push(l),n[r]=new jv(l,o),o.hasRenderCallback&&this.haveRenderCallbacks.push(r)}}patchUpdatedImages(e,n,i){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(r=>e.hasImage(r,i)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,i);for(let r in e.getUpdatedImages(i))this.patchUpdatedImage(this.iconPositions[r],e.getImage(r,i),n),this.patchUpdatedImage(this.patternPositions[r],e.getImage(r,i),n)}patchUpdatedImage(e,n,i){if(!e||!n||e.version===n.version)return;e.version=n.version;let[r,o]=e.tl;i.update(n.data,void 0,{x:r,y:o})}}Ge(jv,"ImagePosition"),Ge(iD,"ImageAtlas");let Hd=1e20;function rD(t,e,n,i,r,o,l,u,h){for(let p=e;p<e+i;p++)oD(t,n*o+p,o,r,l,u,h);for(let p=n;p<n+r;p++)oD(t,p*o+e,1,i,l,u,h)}function oD(t,e,n,i,r,o,l){o[0]=0,l[0]=-Hd,l[1]=Hd,r[0]=t[e];for(let u=1,h=0,p=0;u<i;u++){r[u]=t[e+u*n];let m=u*u;do{let _=o[h];p=(r[u]-r[_]+m-_*_)/(u-_)/2}while(p<=l[h]&&--h>-1);h++,o[h]=u,l[h]=p,l[h+1]=Hd}for(let u=0,h=0;u<i;u++){for(;l[h+1]<u;)h++;let p=o[h],m=u-p;t[e+u*n]=r[p]+m*m}}let Yo=2;class iu{constructor(e,n,i){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=i,this.urls={},this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e,n){this.urls[n]=e}getGlyphs(e,n,i){let r=[],o=this.urls[n]||O.GLYPHS_URL;for(let l in e)for(let u of e[l])r.push({stack:l,id:u});vl(r,({stack:l,id:u},h)=>{let p=this.entries[l];p||(p=this.entries[l]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let m=p.glyphs[u];if(m!==void 0)return void h(null,{stack:l,id:u,glyph:m});if(m=this._tinySDF(p,l,u),m)return p.glyphs[u]=m,void h(null,{stack:l,id:u,glyph:m});let _=Math.floor(u/256);if(256*_>65535)return void h(new Error("glyphs > 65535 not supported"));if(p.ranges[_])return void h(null,{stack:l,id:u,glyph:m});let y=p.requests[_];y||(y=p.requests[_]=[],iu.loadGlyphRange(l,_,o,this.requestManager,(v,b)=>{if(b){p.ascender=b.ascender,p.descender=b.descender;for(let w in b.glyphs)this._doesCharSupportLocalGlyph(+w)||(p.glyphs[+w]=b.glyphs[+w]);p.ranges[_]=!0}for(let w of y)w(v,b);delete p.requests[_]})),y.push((v,b)=>{v?h(v):b&&h(null,{stack:l,id:u,glyph:b.glyphs[u]||null})})},(l,u)=>{if(l)i(l);else if(u){let h={};for(let{stack:p,id:m,glyph:_}of u)h[p]===void 0&&(h[p]={}),h[p].glyphs===void 0&&(h[p].glyphs={}),h[p].glyphs[m]=_&&{id:_.id,bitmap:_.bitmap.clone(),metrics:_.metrics},h[p].ascender=this.entries[p].ascender,h[p].descender=this.entries[p].descender;i(null,h)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==0&&(this.localGlyphMode===2?!!this.localFontFamily:!!this.localFontFamily&&(Xe["CJK Unified Ideographs"](e)||Xe["Hangul Syllables"](e)||Xe.Hiragana(e)||Xe.Katakana(e)||Xe["CJK Symbols and Punctuation"](e)||Xe["CJK Unified Ideographs Extension A"](e)||Xe["CJK Unified Ideographs Extension B"](e)))}_tinySDF(e,n,i){let r=this.localFontFamily;if(!r||!this._doesCharSupportLocalGlyph(i))return;let o=e.tinySDF;if(!o){let w="400";/bold/i.test(n)?w="900":/medium/i.test(n)?w="500":/light/i.test(n)&&(w="200"),o=e.tinySDF=new iu.TinySDF({fontFamily:r,fontWeight:w,fontSize:24*Yo,buffer:3*Yo,radius:8*Yo}),o.fontWeight=w}if(this.localGlyphs[o.fontWeight][i])return this.localGlyphs[o.fontWeight][i];let l=String.fromCodePoint(i),{data:u,width:h,height:p,glyphWidth:m,glyphHeight:_,glyphLeft:y,glyphTop:v,glyphAdvance:b}=o.draw(l);return this.localGlyphs[o.fontWeight][i]={id:i,bitmap:new Qs({width:h,height:p},u),metrics:{width:m/Yo,height:_/Yo,left:y/Yo,top:v/Yo-27,advance:b/Yo,localGlyph:!0}}}}iu.loadGlyphRange=function(t,e,n,i,r){let o=256*e,l=o+255,u=i.transformRequest(i.normalizeGlyphsURL(n).replace("{fontstack}",t).replace("{range}",`${o}-${l}`),fe.Glyphs);Oe(u,(h,p)=>{if(h)r(h);else if(p){let m={},_=function(y){return new Bp(y).readFields(Fz,{})}(p);for(let y of _.glyphs)m[y.id]=y;r(null,{glyphs:m,ascender:_.ascender,descender:_.descender})}})},iu.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:n=8,cutoff:i=.25,fontFamily:r="sans-serif",fontWeight:o="normal",fontStyle:l="normal"}={}){this.buffer=e,this.cutoff=i,this.radius=n;let u=this.size=t+4*e,h=this._createCanvas(u),p=this.ctx=h.getContext("2d",{willReadFrequently:!0});p.font=`${l} ${o} ${t}px ${r}`,p.textBaseline="alphabetic",p.textAlign="left",p.fillStyle="black",this.gridOuter=new Float64Array(u*u),this.gridInner=new Float64Array(u*u),this.f=new Float64Array(u),this.z=new Float64Array(u+1),this.v=new Uint16Array(u)}_createCanvas(t){let e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){let{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:i,actualBoundingBoxLeft:r,actualBoundingBoxRight:o}=this.ctx.measureText(t),l=Math.ceil(n),u=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(o-r))),h=Math.min(this.size-this.buffer,l+Math.ceil(i)),p=u+2*this.buffer,m=h+2*this.buffer,_=Math.max(p*m,0),y=new Uint8ClampedArray(_),v={data:y,width:p,height:m,glyphWidth:u,glyphHeight:h,glyphTop:l,glyphLeft:0,glyphAdvance:e};if(u===0||h===0)return v;let{ctx:b,buffer:w,gridInner:C,gridOuter:E}=this;b.clearRect(w,w,u,h),b.fillText(t,w,w+l);let I=b.getImageData(w,w,u,h);E.fill(Hd,0,_),C.fill(0,0,_);for(let D=0;D<h;D++)for(let S=0;S<u;S++){let M=I.data[4*(D*u+S)+3]/255;if(M===0)continue;let A=(D+w)*p+S+w;if(M===1)E[A]=0,C[A]=Hd;else{let R=.5-M;E[A]=R>0?R*R:0,C[A]=R<0?R*R:0}}rD(E,0,0,p,m,p,this.f,this.v,this.z),rD(C,w,w,u,h,p,this.f,this.v,this.z);for(let D=0;D<_;D++){let S=Math.sqrt(E[D])-Math.sqrt(C[D]);y[D]=Math.round(255-255*(S/this.radius+this.cutoff))}return v}};let ja=Wr;function sD(t,e,n,i){let r=[],o=t.imagePrimary,l=o.pixelRatio,u=o.paddedRect.w-2*ja,h=o.paddedRect.h-2*ja,p=t.right-t.left,m=t.bottom-t.top,_=o.stretchX||[[0,u]],y=o.stretchY||[[0,h]],v=(z,B)=>z+B[1]-B[0],b=_.reduce(v,0),w=y.reduce(v,0),C=u-b,E=h-w,I=0,D=b,S=0,M=w,A=0,R=C,F=0,k=E;if(o.content&&i){let z=o.content;I=$p(_,0,z[0]),S=$p(y,0,z[1]),D=$p(_,z[0],z[2]),M=$p(y,z[1],z[3]),A=z[0]-I,F=z[1]-S,R=z[2]-z[0]-D,k=z[3]-z[1]-M}let L=(z,B,G,N)=>{let W=Gp(z.stretch-I,D,p,t.left),Y=Hp(z.fixed-A,R,z.stretch,b),te=Gp(B.stretch-S,M,m,t.top),q=Hp(B.fixed-F,k,B.stretch,w),X=Gp(G.stretch-I,D,p,t.left),re=Hp(G.fixed-A,R,G.stretch,b),se=Gp(N.stretch-S,M,m,t.top),oe=Hp(N.fixed-F,k,N.stretch,w),ue=new Q(W,te),de=new Q(X,te),pe=new Q(X,se),ae=new Q(W,se),ge=new Q(Y/l,q/l),Ae=new Q(re/l,oe/l),Pe=e*Math.PI/180;if(Pe){let Bt=Math.sin(Pe),ct=Math.cos(Pe),st=[ct,-Bt,Bt,ct];ue._matMult(st),de._matMult(st),ae._matMult(st),pe._matMult(st)}let Ne=z.stretch+z.fixed,Be=G.stretch+G.fixed,lt=B.stretch+B.fixed,Ye=N.stretch+N.fixed,Zt=t.imageSecondary;return{tl:ue,tr:de,bl:ae,br:pe,texPrimary:{x:o.paddedRect.x+ja+Ne,y:o.paddedRect.y+ja+lt,w:Be-Ne,h:Ye-lt},texSecondary:Zt?{x:Zt.paddedRect.x+ja+Ne,y:Zt.paddedRect.y+ja+lt,w:Be-Ne,h:Ye-lt}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ge,pixelOffsetBR:Ae,minFontScaleX:R/l/p,minFontScaleY:k/l/m,isSDF:n}};if(i&&(o.stretchX||o.stretchY)){let z=aD(_,C,b),B=aD(y,E,w);for(let G=0;G<z.length-1;G++){let N=z[G],W=z[G+1];for(let Y=0;Y<B.length-1;Y++)r.push(L(N,B[Y],W,B[Y+1]))}}else r.push(L({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:u+1},{fixed:0,stretch:h+1}));return r}function $p(t,e,n){let i=0;for(let r of t)i+=Math.max(e,Math.min(n,r[1]))-Math.max(e,Math.min(n,r[0]));return i}function aD(t,e,n){let i=[{fixed:-ja,stretch:0}];for(let[r,o]of t){let l=i[i.length-1];i.push({fixed:r-l.stretch,stretch:l.stretch}),i.push({fixed:r-l.stretch,stretch:l.stretch+(o-r)})}return i.push({fixed:e+ja,stretch:n}),i}function Gp(t,e,n,i){return t/e*n+i}function Hp(t,e,n,i){return t-e*n/i}function Uz(t,e,n,i){let r=e+t.positionedLines[i].lineOffset;return i===0?n+r/2:n+(r+(e+t.positionedLines[i-1].lineOffset))/2}function $z(t,e=1,n=!1){let i=1/0,r=1/0,o=-1/0,l=-1/0,u=t[0];for(let v=0;v<u.length;v++){let b=u[v];(!v||b.x<i)&&(i=b.x),(!v||b.y<r)&&(r=b.y),(!v||b.x>o)&&(o=b.x),(!v||b.y>l)&&(l=b.y)}let h=Math.min(o-i,l-r),p=h/2,m=new Oy([],Gz);if(h===0)return new Q(i,r);for(let v=i;v<o;v+=h)for(let b=r;b<l;b+=h)m.push(new ru(v+p,b+p,p,t));let _=function(v){let b=0,w=0,C=0,E=v[0];for(let I=0,D=E.length,S=D-1;I<D;S=I++){let M=E[I],A=E[S],R=M.x*A.y-A.x*M.y;w+=(M.x+A.x)*R,C+=(M.y+A.y)*R,b+=3*R}return new ru(w/b,C/b,0,v)}(t),y=m.length;for(;m.length;){let v=m.pop();(v.d>_.d||!_.d)&&(_=v,n&&console.log("found best %d after %d probes",Math.round(1e4*v.d)/1e4,y)),v.max-_.d<=e||(p=v.h/2,m.push(new ru(v.p.x-p,v.p.y-p,p,t)),m.push(new ru(v.p.x+p,v.p.y-p,p,t)),m.push(new ru(v.p.x-p,v.p.y+p,p,t)),m.push(new ru(v.p.x+p,v.p.y+p,p,t)),y+=4)}return n&&(console.log(`num probes: ${y}`),console.log(`best distance: ${_.d}`)),_.p}function Gz(t,e){return e.max-t.max}class ru{constructor(e,n,i,r){this.p=new Q(e,n),this.h=i,this.d=function(o,l){let u=!1,h=1/0;for(let p=0;p<l.length;p++){let m=l[p];for(let _=0,y=m.length,v=y-1;_<y;v=_++){let b=m[_],w=m[v];b.y>o.y!=w.y>o.y&&o.x<(w.x-b.x)*(o.y-b.y)/(w.y-b.y)+b.x&&(u=!u),h=Math.min(h,lM(o,b,w))}}return(u?1:-1)*Math.sqrt(h)}(this.p,r),this.max=this.d+this.h*Math.SQRT2}}let ou=7,Uv=Number.POSITIVE_INFINITY,Hz=Math.sqrt(2);function $v(t,[e,n]){let i=0,r=0;if(n===Uv){e<0&&(e=0);let o=e/Hz;switch(t){case"top-right":case"top-left":r=o-ou;break;case"bottom-right":case"bottom-left":r=-o+ou;break;case"bottom":r=-e+ou;break;case"top":r=e-ou}switch(t){case"top-right":case"bottom-right":i=-o;break;case"top-left":case"bottom-left":i=o;break;case"left":i=e;break;case"right":i=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),t){case"top-right":case"top-left":case"top":r=n-ou;break;case"bottom-right":case"bottom-left":case"bottom":r=-n+ou}switch(t){case"top-right":case"bottom-right":case"right":i=-e;break;case"top-left":case"bottom-left":case"left":i=e}}return[i,r]}function qz(t,e,n,i,r,o,l,u,h,p,m){t.createArrays(),t.tilePixelRatio=le/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;let _=t.layers[0].layout,y=t.layers[0]._unevaluatedLayout._values,v={};if(t.textSizeData.kind==="composite"){let{minZoom:E,maxZoom:I}=t.textSizeData;v.compositeTextSizes=[y["text-size"].possiblyEvaluate(new Hn(E),u),y["text-size"].possiblyEvaluate(new Hn(I),u)]}if(t.iconSizeData.kind==="composite"){let{minZoom:E,maxZoom:I}=t.iconSizeData;v.compositeIconSizes=[y["icon-size"].possiblyEvaluate(new Hn(E),u),y["icon-size"].possiblyEvaluate(new Hn(I),u)]}v.layoutTextSize=y["text-size"].possiblyEvaluate(new Hn(h+1),u),v.layoutIconSize=y["icon-size"].possiblyEvaluate(new Hn(h+1),u),v.textMaxSize=y["text-size"].possiblyEvaluate(new Hn(18),u);let b=_.get("text-rotation-alignment")==="map"&&_.get("symbol-placement")!=="point",w=_.get("text-size"),C=!1;for(let E of t.features)if(E.icon&&E.icon.nameSecondary){C=!0;break}for(let E of t.features){let I=_.get("text-font").evaluate(E,{},u).join(","),D=w.evaluate(E,{},u),S=v.layoutTextSize.evaluate(E,{},u),M=(v.layoutIconSize.evaluate(E,{},u),{horizontal:{},vertical:void 0}),A=E.text,R,F=[0,0];if(A){let z=A.toString(),B=_.get("text-letter-spacing").evaluate(E,{},u)*zi,G=_.get("text-line-height").evaluate(E,{},u)*zi,N=v3(z)?B:0,W=_.get("text-anchor").evaluate(E,{},u),Y=_.get("text-variable-anchor");if(!Y){let se=_.get("text-radial-offset").evaluate(E,{},u);F=se?$v(W,[se*zi,Uv]):_.get("text-offset").evaluate(E,{},u).map(oe=>oe*zi)}let te=b?"center":_.get("text-justify").evaluate(E,{},u),q=_.get("symbol-placement")==="point",X=q?_.get("text-max-width").evaluate(E,{},u)*zi:1/0,re=se=>{t.allowVerticalPlacement&&y0(z)&&(M.vertical=Bv(A,e,n,r,I,X,G,W,se,N,F,jn.vertical,!0,S,D))};if(!b&&Y){let se=te==="auto"?Y.map(ue=>Gv(ue)):[te],oe=!1;for(let ue=0;ue<se.length;ue++){let de=se[ue];if(!M.horizontal[de])if(oe)M.horizontal[de]=M.horizontal[0];else{let pe=Bv(A,e,n,r,I,X,G,"center",de,N,F,jn.horizontal,!1,S,D);pe&&(M.horizontal[de]=pe,oe=pe.positionedLines.length===1)}}re("left")}else{if(te==="auto"&&(te=Gv(W)),q||_.get("text-writing-mode").indexOf("horizontal")>=0||!y0(z)){let se=Bv(A,e,n,r,I,X,G,W,te,N,F,jn.horizontal,!1,S,D);se&&(M.horizontal[te]=se)}re(q?"left":te)}}let k=!1;if(E.icon&&E.icon.namePrimary){let z=i[E.icon.namePrimary];z&&(R=Bz(r[E.icon.namePrimary],E.icon.nameSecondary?r[E.icon.nameSecondary]:void 0,_.get("icon-offset").evaluate(E,{},u),_.get("icon-anchor").evaluate(E,{},u)),k=z.sdf,t.sdfIcons===void 0?t.sdfIcons=z.sdf:t.sdfIcons!==z.sdf&&J("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(z.pixelRatio!==t.pixelRatio||_.get("icon-rotate").constantOr(1)!==0)&&(t.iconsNeedLinear=!0))}let L=cD(M.horizontal)||M.vertical;t.iconsInText||(t.iconsInText=!!L&&L.iconsInText),(L||R)&&Wz(t,E,M,R,i,v,S,0,F,k,l,u,p,m,C)}o&&t.generateCollisionDebugBuffers(h,t.collisionBoxArray)}function Gv(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Wz(t,e,n,i,r,o,l,u,h,p,m,_,y,v,b){let w=o.textMaxSize.evaluate(e,{},_);w===void 0&&(w=l);let C=t.layers[0].layout,E=C.get("icon-offset").evaluate(e,{},_),I=cD(n.horizontal)||n.vertical,D=y.name==="globe",S=zi,M=l/S,A=t.tilePixelRatio*w/S,R=(W=t.overscaling,t.zoom>18&&W>2&&(W>>=1),Math.max(le/(512*W),1)*C.get("symbol-spacing")),F=C.get("text-padding")*t.tilePixelRatio,k=C.get("icon-padding")*t.tilePixelRatio,L=Tt(C.get("text-max-angle")),z=C.get("text-rotation-alignment")==="map"&&C.get("symbol-placement")!=="point",B=C.get("icon-rotation-alignment")==="map"&&C.get("symbol-placement")!=="point",G=C.get("symbol-placement"),N=R/2;var W;let Y=C.get("icon-text-fit").evaluate(e,{},_),te=C.get("icon-text-fit-padding").evaluate(e,{},_),q=Y!=="none",X;t.hasAnyIconTextFit===!1&&q&&(t.hasAnyIconTextFit=!0),i&&q&&(t.allowVerticalPlacement&&n.vertical&&(X=YM(i,n.vertical,Y,te,E,M)),I&&(i=YM(i,I,Y,te,E,M)));let re=(se,oe,ue)=>{if(oe.x<0||oe.x>=le||oe.y<0||oe.y>=le)return;let de=null;if(D){let{x:pe,y:ae,z:ge}=y.projectTilePoint(oe.x,oe.y,ue);de={anchor:new ta(pe,ae,ge,0,void 0),up:y.upVector(ue,oe.x,oe.y)}}(function(pe,ae,ge,Ae,Pe,Ne,Be,lt,Ye,Zt,Bt,ct,st,Qe,Ut,qt,At,En,ai,xn,Fn,fi,li,Bn,pn,Gi,Is){let na=pe.addToLineVertexArray(ae,Ae),ia,fh,ph,jm,gA,_A,yA,vA=0,xA=0,bA=0,wA=0,Gx=-1,Hx=-1,Ms={},CA=$0(""),Hl=ge?ge.anchor:ae,qx=Ye.layout.get("icon-text-fit").evaluate(Fn,{},pn)!=="none",Wx=0,Zx=0;if(Ye._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Wx,Zx]=Ye.layout.get("text-offset").evaluate(Fn,{},pn).map(Xr=>Xr*zi):(Wx=Ye.layout.get("text-radial-offset").evaluate(Fn,{},pn)*zi,Zx=Uv),pe.allowVerticalPlacement&&Pe.vertical){let Xr=Pe.vertical;if(Ut)_A=Hv(Xr),lt&&(yA=Hv(lt));else{let Yr=Ye.layout.get("text-rotate").evaluate(Fn,{},pn)+90;ph=qp(Zt,Hl,ae,Bt,ct,st,Xr,Qe,Yr,qt),lt&&(jm=qp(Zt,Hl,ae,Bt,ct,st,lt,En,Yr))}}if(Ne){let Xr=Ye.layout.get("icon-rotate").evaluate(Fn,{},pn),Yr=sD(Ne,Xr,li,qx),gu=lt?sD(lt,Xr,li,qx):void 0;fh=qp(Zt,Hl,ae,Bt,ct,st,Ne,En,Xr),vA=4*Yr.length;let EA=pe.iconSizeData,ql=null;EA.kind==="source"?(ql=[Xo*Ye.layout.get("icon-size").evaluate(Fn,{},pn)],ql[0]>Ua&&J(`${pe.layerIds[0]}: Value for "icon-size" is >= ${qd}. Reduce your "icon-size".`)):EA.kind==="composite"&&(ql=[Xo*fi.compositeIconSizes[0].evaluate(Fn,{},pn),Xo*fi.compositeIconSizes[1].evaluate(Fn,{},pn)],(ql[0]>Ua||ql[1]>Ua)&&J(`${pe.layerIds[0]}: Value for "icon-size" is >= ${qd}. Reduce your "icon-size".`)),pe.addSymbols(pe.icon,Yr,ql,xn,ai,Fn,!1,ge,ae,na.lineStartIndex,na.lineLength,-1,Bn,pn,Gi,Is),Gx=pe.icon.placedSymbolArray.length-1,gu&&(xA=4*gu.length,pe.addSymbols(pe.icon,gu,ql,xn,ai,Fn,jn.vertical,ge,ae,na.lineStartIndex,na.lineLength,-1,Bn,pn,Gi,Is),Hx=pe.icon.placedSymbolArray.length-1)}for(let Xr in Pe.horizontal){let Yr=Pe.horizontal[Xr];ia||(CA=$0(Yr.text),Ut?gA=Hv(Yr):ia=qp(Zt,Hl,ae,Bt,ct,st,Yr,Qe,Ye.layout.get("text-rotate").evaluate(Fn,{},pn),qt));let gu=Yr.positionedLines.length===1;if(bA+=lD(pe,ge,ae,Yr,Be,Ye,Ut,Fn,qt,na,Pe.vertical?jn.horizontal:jn.horizontalOnly,gu?Object.keys(Pe.horizontal):[Xr],Ms,Gx,fi,Bn,pn,Gi),gu)break}Pe.vertical&&(wA+=lD(pe,ge,ae,Pe.vertical,Be,Ye,Ut,Fn,qt,na,jn.vertical,["vertical"],Ms,Hx,fi,Bn,pn,Gi));let Xa=-1,Xx=(Xr,Yr)=>Xr?Math.max(Xr,Yr):Yr;Xa=Xx(gA,Xa),Xa=Xx(_A,Xa),Xa=Xx(yA,Xa);let Pj=Xa>-1?1:0;pe.glyphOffsetArray.length>=Kd.MAX_GLYPHS&&J("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Fn.sortKey!==void 0&&pe.addToSortKeyRanges(pe.symbolInstances.length,Fn.sortKey),pe.symbolInstances.emplaceBack(ae.x,ae.y,Hl.x,Hl.y,Hl.z,Ms.right>=0?Ms.right:-1,Ms.center>=0?Ms.center:-1,Ms.left>=0?Ms.left:-1,Ms.vertical>=0?Ms.vertical:-1,Gx,Hx,CA,ia!==void 0?ia:pe.collisionBoxArray.length,ia!==void 0?ia+1:pe.collisionBoxArray.length,ph!==void 0?ph:pe.collisionBoxArray.length,ph!==void 0?ph+1:pe.collisionBoxArray.length,fh!==void 0?fh:pe.collisionBoxArray.length,fh!==void 0?fh+1:pe.collisionBoxArray.length,jm||pe.collisionBoxArray.length,jm?jm+1:pe.collisionBoxArray.length,Bt,bA,wA,vA,xA,Pj,0,Wx,Zx,Xa,0,qx?1:0)})(t,oe,de,se,n,i,r,X,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,F,z,h,0,k,B,E,e,o,p,m,_,v,b)};if(G==="line")for(let se of nD(e.geometry,0,0,le,le)){let oe=jz(se,R,L,n.vertical||I,i,S,A,t.overscaling,le);for(let ue of oe)I&&Zz(t,I.text,N,ue)||re(se,ue,_)}else if(G==="line-center"){for(let se of e.geometry)if(se.length>1){let oe=Vz(se,L,n.vertical||I,i,S,A);oe&&re(se,oe,_)}}else if(e.type==="Polygon")for(let se of Pv(e.geometry,0)){let oe=$z(se,16);re(se[0],new ta(oe.x,oe.y,0,0,void 0),_)}else if(e.type==="LineString")for(let se of e.geometry)re(se,new ta(se[0].x,se[0].y,0,0,void 0),_);else if(e.type==="Point")for(let se of e.geometry)for(let oe of se)re([oe],new ta(oe.x,oe.y,0,0,void 0),_)}let qd=255,Ua=qd*Xo;function lD(t,e,n,i,r,o,l,u,h,p,m,_,y,v,b,w,C,E){let I=function(M,A,R,F,k,L,z,B){let G=[];if(A.positionedLines.length===0)return G;let N=F.layout.get("text-rotate").evaluate(L,{})*Math.PI/180,W=function(re){let se=re[0],oe=re[1],ue=se*oe;return ue>0?[se,-oe]:ue<0?[-se,oe]:se===0?[oe,se]:[oe,-se]}(R),Y=Math.abs(A.top-A.bottom);for(let re of A.positionedLines)Y-=re.lineOffset;let te=A.positionedLines.length,q=Y/te,X=A.top-R[1];for(let re=0;re<te;++re){let se=A.positionedLines[re];X=Uz(A,q,X,re);for(let oe of se.positionedGlyphs){if(!oe.rect)continue;let ue=oe.rect||{},de=$M+1,pe=!0,ae=1,ge=0;if(oe.imageName){let xn=z[oe.imageName];if(!xn)continue;if(xn.sdf){J("SDF images are not supported in formatted text and will be ignored.");continue}pe=!1,ae=xn.pixelRatio,de=Wr/ae}let Ae=(k||B)&&oe.vertical,Pe=oe.metrics.advance*oe.scale/2,Ne=oe.metrics,Be=oe.rect;if(Be===null)continue;B&&A.verticalizable&&(ge=oe.imageName?Pe-oe.metrics.width*oe.scale/2:0);let lt=k?[oe.x+Pe,oe.y]:[0,0],Ye=[0,0],Zt=[0,0],Bt=!1;k||(Ae?(Zt=[oe.x+Pe+W[0],oe.y+W[1]-ge],Bt=!0):Ye=[oe.x+Pe+R[0],oe.y+R[1]-ge]);let ct=Be.w*oe.scale/(ae*(oe.localGlyph?Yo:1)),st=Be.h*oe.scale/(ae*(oe.localGlyph?Yo:1)),Qe,Ut,qt,At;if(Ae){let xn=oe.y-X,Fn=new Q(-Pe,Pe-xn),fi=-Math.PI/2,li=new Q(...Zt);Qe=new Q(-Pe+Ye[0],Ye[1]),Qe._rotateAround(fi,Fn)._add(li),Qe.x+=-xn+Pe,Qe.y-=(Ne.left-de)*oe.scale;let Bn=oe.imageName?Ne.advance*oe.scale:zi*oe.scale,pn=String.fromCodePoint(oe.glyph);Rz(pn)?Qe.x+=(1-de)*oe.scale:Oz(pn)?Qe.x+=Bn-Ne.height*oe.scale+(-de-1)*oe.scale:Qe.x+=oe.imageName||Ne.width+2*de===Be.w&&Ne.height+2*de===Be.h?(Bn-st)/2:(Bn-(Ne.height+2*de)*oe.scale)/2,Ut=new Q(Qe.x,Qe.y-ct),qt=new Q(Qe.x+st,Qe.y),At=new Q(Qe.x+st,Qe.y-ct)}else{let xn=(Ne.left-de)*oe.scale-Pe+Ye[0],Fn=(-Ne.top-de)*oe.scale+Ye[1],fi=xn+ct,li=Fn+st;Qe=new Q(xn,Fn),Ut=new Q(fi,Fn),qt=new Q(xn,li),At=new Q(fi,li)}if(N){let xn;xn=k?new Q(0,0):Bt?new Q(W[0],W[1]):new Q(R[0],R[1]),Qe._rotateAround(N,xn),Ut._rotateAround(N,xn),qt._rotateAround(N,xn),At._rotateAround(N,xn)}let En=new Q(0,0),ai=new Q(0,0);G.push({tl:Qe,tr:Ut,bl:qt,br:At,texPrimary:ue,texSecondary:void 0,writingMode:A.writingMode,glyphOffset:lt,sectionIndex:oe.sectionIndex,isSDF:pe,pixelOffsetTL:En,pixelOffsetBR:ai,minFontScaleX:0,minFontScaleY:0})}}return G}(0,i,h,o,l,u,r,t.allowVerticalPlacement),D=t.textSizeData,S=null;D.kind==="source"?(S=[Xo*o.layout.get("text-size").evaluate(u,{},C)],S[0]>Ua&&J(`${t.layerIds[0]}: Value for "text-size" is >= ${qd}. Reduce your "text-size".`)):D.kind==="composite"&&(S=[Xo*b.compositeTextSizes[0].evaluate(u,{},C),Xo*b.compositeTextSizes[1].evaluate(u,{},C)],(S[0]>Ua||S[1]>Ua)&&J(`${t.layerIds[0]}: Value for "text-size" is >= ${qd}. Reduce your "text-size".`)),t.addSymbols(t.text,I,S,h,l,u,m,e,n,p.lineStartIndex,p.lineLength,v,w,C,E,!1);for(let M of _)y[M]=t.text.placedSymbolArray.length-1;return 4*I.length}function cD(t){for(let e in t)return t[e];return null}function qp(t,e,n,i,r,o,l,u,h,p){let m=l.top,_=l.bottom,y=l.left,v=l.right,b=l.collisionPadding;if(b&&(y-=b[0],m-=b[1],v+=b[2],_+=b[3]),h){let w=new Q(y,m),C=new Q(v,m),E=new Q(y,_),I=new Q(v,_),D=Tt(h),S=new Q(0,0);p&&(S=new Q(p[0],p[1])),w._rotateAround(D,S),C._rotateAround(D,S),E._rotateAround(D,S),I._rotateAround(D,S),y=Math.min(w.x,C.x,E.x,I.x),v=Math.max(w.x,C.x,E.x,I.x),m=Math.min(w.y,C.y,E.y,I.y),_=Math.max(w.y,C.y,E.y,I.y)}return t.emplaceBack(e.x,e.y,e.z,n.x,n.y,y,m,v,_,u,i,r,o),t.length-1}function Hv(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);let e=t.bottom-t.top;return e>0?Math.max(10,e):null}function Zz(t,e,n,i){let r=t.compareText;if(e in r){let o=r[e];for(let l=o.length-1;l>=0;l--)if(i.dist(o[l])<n)return!0}else r[e]=[];return r[e].push(i),!1}function uD(t,e){let n=t.fovAboveCenter,i=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,r=(t._camera.position[2]*t.worldSize-i)/Math.cos(t._pitch),o=Math.sin(n)*r/Math.sin(Math.max(Math.PI/2-t._pitch-n,.01)),l=Math.sin(t._pitch)*o+r;return Math.min(1.01*l,r*(1/t._horizonShift))}function zl(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};let n=Math.pow(2,-t.z),i=t.x*n,r=(t.x+1)*n,o=t.y*n,l=(t.y+1)*n,u=qr(i),h=qr(r),p=bi(o),m=bi(l),_=e.project(u,p),y=e.project(h,p),v=e.project(h,m),b=e.project(u,m),w=Math.min(_.x,y.x,v.x,b.x),C=Math.min(_.y,y.y,v.y,b.y),E=Math.max(_.x,y.x,v.x,b.x),I=Math.max(_.y,y.y,v.y,b.y),D=n/16;function S(A,R,F,k,L,z){let B=(F+L)/2,G=(k+z)/2,N=e.project(qr(B),bi(G)),W=Math.max(0,w-N.x,C-N.y,N.x-E,N.y-I);w=Math.min(w,N.x),E=Math.max(E,N.x),C=Math.min(C,N.y),I=Math.max(I,N.y),W>D&&(S(A,N,F,k,B,G),S(N,R,B,G,L,z))}S(_,y,i,o,r,o),S(y,v,r,o,r,l),S(v,b,r,l,i,l),S(b,_,i,l,i,o),w-=D,C-=D,E+=D,I+=D;let M=1/Math.max(E-w,I-C);return{scale:M,x:w*M,y:C*M,x2:E*M,y2:I*M,projection:e}}function dD(t,e,n,i,r,o,l,u,h){if(h.name==="globe")return fv(t,e,new Io(n,i,r),!1);let p=zl({z:n,x:i,y:r},h);return new On([(o+p.x/p.scale)*e,e*(p.y/p.scale),l],[(o+p.x2/p.scale)*e,e*(p.y2/p.scale),u])}function hD(t,{x:e,y:n},i=0){return new Q(((e-i)*t.scale-t.x)*le,(n*t.scale-t.y)*le)}function fD(t,e,n=0){return $.fromValues(((e.x-n)*t.scale-t.x)*le,(e.y*t.scale-t.y)*le,nM(e.z,e.y))}let Xz=ne.identity(new Float32Array(16));class $a{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new pt(0,0)}projectTilePoint(e,n,i){return{x:e,y:n,z:0}}locationPoint(e,n,i=!0){return e._coordinatePoint(e.locationCoordinate(n),i)}pixelsPerMeter(e,n){return Cn(1,e)*n}pixelSpaceConversion(e,n,i){return 1}farthestPixelDistance(e){return uD(e,e.pixelsPerMeter)}pointCoordinate(e,n,i,r){let o=e.horizonLineFromTop(!1),l=new Q(n,Math.max(o,i));return e.rayIntersectionCoordinate(e.pointRayIntersection(l,r))}pointCoordinate3D(e,n,i){let r=new Q(n,i);if(e.elevation)return e.elevation.pointCoordinate(r);{let o=this.pointCoordinate(e,r.x,r.y,0);return[o.x,o.y,o.z]}}isPointAboveHorizon(e,n){if(e.elevation)return!this.pointCoordinate3D(e,n.x,n.y);let i=e.horizonLineFromTop();return n.y<i}createInversionMatrix(e,n){return Xz}createTileMatrix(e,n,i){let r,o,l,u=i.canonical,h=ne.identity(new Float64Array(16));if(this.isReprojectedInTileSpace){let p=zl(u,this);r=1,o=p.x+i.wrap*p.scale,l=p.y,ne.scale(h,h,[r/p.scale,r/p.scale,e.pixelsPerMeter/n])}else r=n/e.zoomScale(u.z),o=(u.x+Math.pow(2,u.z)*i.wrap)*r,l=u.y*r;return ne.translate(h,h,[o,l,0]),ne.scale(h,h,[r/le,r/le,1]),h}upVector(e,n,i){return[0,0,1]}upVectorScale(e,n,i){return{metersToTile:1}}}class Yz extends $a{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];let[n,i]=this.parallels=e.parallels||[29.5,45.5],r=Math.sin(Tt(n));this.n=(r+Math.sin(Tt(i)))/2,this.c=1+r*(2*this.n-r),this.r0=Math.sqrt(this.c)/this.n}project(e,n){let{n:i,c:r,r0:o}=this,l=Tt(e-this.center[0]),u=Tt(n),h=Math.sqrt(r-2*i*Math.sin(u))/i;return{x:h*Math.sin(l*i),y:h*Math.cos(l*i)-o,z:0}}unproject(e,n){let{n:i,c:r,r0:o}=this,l=o+n,u=Math.atan2(e,Math.abs(l))*Math.sign(l);l*i<0&&(u-=Math.PI*Math.sign(e)*Math.sign(l));let h=Tt(this.center[0])*i;u=hs(u,-Math.PI-h,Math.PI-h);let p=We(ji(u/i)+this.center[0],-180,180),m=Math.asin(We((r-(e*e+l*l)*i*i)/(2*i),-1,1)),_=We(ji(m),-si,si);return new pt(p,_)}}let Wd=1.340264,Zd=-.081106,Xd=893e-6,Yd=.003796,Wp=Math.sqrt(3)/2;class Kz extends $a{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;let i=Math.asin(Wp*Math.sin(n)),r=i*i,o=r*r*r;return{x:.5*(e*Math.cos(i)/(Wp*(Wd+3*Zd*r+o*(7*Xd+9*Yd*r)))/Math.PI+.5),y:1-.5*(i*(Wd+Zd*r+o*(Xd+Yd*r))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let i=n=(2*(1-n)-1)*Math.PI,r=i*i,o=r*r*r;for(let m,_,y,v=0;v<12&&(_=i*(Wd+Zd*r+o*(Xd+Yd*r))-n,y=Wd+3*Zd*r+o*(7*Xd+9*Yd*r),m=_/y,i=We(i-m,-Math.PI/3,Math.PI/3),r=i*i,o=r*r*r,!(Math.abs(m)<1e-12));++v);let l=Wp*e*(Wd+3*Zd*r+o*(7*Xd+9*Yd*r))/Math.cos(i),u=Math.asin(Math.sin(i)/Wp),h=We(180*l/Math.PI,-180,180),p=We(180*u/Math.PI,-si,si);return new pt(h,p)}}class Jz extends $a{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){let i=360*(e-.5),r=We(360*(.5-n),-si,si);return new pt(i,r)}}let su=Math.PI/2;function Zp(t){return Math.tan((su+t)/2)}class Qz extends $a{constructor(e){super(e),this.center=e.center||[0,30];let[n,i]=this.parallels=e.parallels||[30,30],r=Tt(n),o=Tt(i);this.southernCenter=r+o<0,this.southernCenter&&(r=-r,o=-o);let l=Math.cos(r),u=Zp(r);this.n=r===o?Math.sin(r):Math.log(l/Math.cos(o))/Math.log(Zp(o)/u),this.f=l*Math.pow(Zp(r),this.n)/this.n}project(e,n){n=Tt(n),this.southernCenter&&(n=-n),e=Tt(e-this.center[0]);let i=1e-6,{n:r,f:o}=this;o>0?n<-su+i&&(n=-su+i):n>su-i&&(n=su-i);let l=o/Math.pow(Zp(n),r),u=l*Math.sin(r*e),h=o-l*Math.cos(r*e);return u=.5*(u/Math.PI+.5),h=.5*(h/Math.PI+.5),{x:u,y:this.southernCenter?h:1-h,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;let{n:i,f:r}=this,o=r-n,l=Math.sign(o),u=Math.sign(i)*Math.sqrt(e*e+o*o),h=Math.atan2(e,Math.abs(o))*l;o*i<0&&(h-=Math.PI*Math.sign(e)*l);let p=We(ji(h/i)+this.center[0],-180,180),m=We(ji(2*Math.atan(Math.pow(r/u,1/i))-su),-si,si);return new pt(p,this.southernCenter?-m:m)}}class pD extends $a{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:Ii(e),y:Ai(n),z:0}}unproject(e,n){let i=qr(e),r=bi(n);return new pt(i,r)}}let mD=Tt(si);class eB extends $a{project(e,n){let i=(n=Tt(n))*n,r=i*i;return{x:.5*((e=Tt(e))*(.8707-.131979*i+r*(r*(.003971*i-.001529*r)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+i*(.015085+r*(.028874*i-.044475-.005916*r)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let i=n=(2*(1-n)-1)*Math.PI,r=25,o=0,l=i*i;do{l=i*i;let p=l*l;o=(i*(1.007226+l*(.015085+p*(.028874*l-.044475-.005916*p)))-n)/(1.007226+l*(.045255+p*(.259866*l-.311325-.005916*11*p))),i=We(i-o,-mD,mD)}while(Math.abs(o)>1e-6&&--r>0);l=i*i;let u=We(ji(e/(.8707+l*(l*(l*l*l*(.003971-.001529*l)-.013791)-.131979))),-180,180),h=ji(i);return new pt(u,h)}}let gD=Tt(si);class tB extends $a{project(e,n){n=Tt(n),e=Tt(e);let i=Math.cos(n),r=2/Math.PI,o=Math.acos(i*Math.cos(e/2)),l=Math.sin(o)/o,u=.5*(e*r+2*i*Math.sin(e/2)/l)||0,h=.5*(n+Math.sin(n)/l)||0;return{x:.5*(u/Math.PI+.5),y:1-.5*(h/Math.PI+1),z:0}}unproject(e,n){let i=e=(2*e-.5)*Math.PI,r=n=(2*(1-n)-1)*Math.PI,o=25,l=1e-6,u=0,h=0;do{let p=Math.cos(r),m=Math.sin(r),_=2*m*p,y=m*m,v=p*p,b=Math.cos(i/2),w=Math.sin(i/2),C=2*b*w,E=w*w,I=1-v*b*b,D=I?1/I:0,S=I?Math.acos(p*b)*Math.sqrt(1/I):0,M=.5*(2*S*p*w+2*i/Math.PI)-e,A=.5*(S*m+r)-n,R=.5*D*(v*E+S*p*b*y)+1/Math.PI,F=D*(C*_/4-S*m*w),k=.125*D*(_*w-S*m*v*C),L=.5*D*(y*b+S*E*p)+.5,z=F*k-L*R;u=(A*F-M*L)/z,h=(M*k-A*R)/z,i=We(i-u,-Math.PI,Math.PI),r=We(r-h,-gD,gD)}while((Math.abs(u)>l||Math.abs(h)>l)&&--o>0);return new pt(ji(i),ji(r))}}class _D extends $a{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Tt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){let{scale:i,cosPhi:r}=this;return{x:Tt(e)*r*i+.5,y:-Math.sin(Tt(n))/r*i+.5,z:0}}unproject(e,n){let{scale:i,cosPhi:r}=this,o=-(n-.5)/i,l=We(ji((e-.5)/i)/r,-180,180),u=Math.asin(We(o*r,-1,1)),h=We(ji(u),-si,si);return new pt(l,h)}}class nB extends pD{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,n,i){let r=Nd(e,n,i),o=ka(so(i));return $.transformMat4(r,r,o),{x:r[0],y:r[1],z:r[2]}}locationPoint(e,n){let i=Rr(n.lat,n.lng),r=$.normalize([],i),o=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude,l=Cn(1,0)*le*o;$.scaleAndAdd(i,i,r,l);let u=ne.identity(new Float64Array(16));return ne.multiply(u,e.pixelMatrix,e.globeMatrix),$.transformMat4(i,i,u),new Q(i[0],i[1])}pixelsPerMeter(e,n){return Cn(1,0)*n}pixelSpaceConversion(e,n,i){let r=Cn(1,e)*n,o=ft(Cn(1,45)*n,r,i);return this.pixelsPerMeter(e,n)/o}createTileMatrix(e,n,i){let r=mv(so(i.canonical));return ne.multiply(new Float64Array(16),e.globeMatrix,r)}createInversionMatrix(e,n){let{center:i}=e,r=ka(so(n));return ne.rotateY(r,r,Tt(i.lng)),ne.rotateX(r,r,Tt(i.lat)),ne.scale(r,r,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(r)}pointCoordinate(e,n,i,r){return $I(e,n,i,!0)||new Gt(0,0)}pointCoordinate3D(e,n,i){let r=this.pointCoordinate(e,n,i,0);return[r.x,r.y,r.z]}isPointAboveHorizon(e,n){return!$I(e,n.x,n.y,!1)}farthestPixelDistance(e){let n=function(r,o){let l=r.cameraToCenterDistance,u=r._centerAltitude*o,h=r._camera,p=r._camera.forward(),m=$.add([],$.scale([],p,-l),[0,0,u]),_=r.worldSize/(2*Math.PI),y=[0,0,-_],v=r.width/r.height,b=Math.tan(r.fovAboveCenter),w=$.scale([],h.up(),b),C=$.scale([],h.right(),b*v),E=$.normalize([],$.add([],$.add([],p,w),C)),I=[],D;if(new yp(m,E).closestPointOnSphere(y,_,I)){let S=$.add([],I,y),M=$.sub([],S,m);D=Math.cos(r.fovAboveCenter)*$.length(M)}else{let S=$.sub([],m,y),M=$.sub([],y,m);$.normalize(M,M);let A=$.length(S)-_;D=Math.sqrt(A*(A+2*_));let R=Math.acos(D/(_+A))-Math.acos($.dot(p,M));D*=Math.cos(R)}return 1.01*D}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),i=Ni(e.zoom);if(i>0){let r=uD(e,Cn(1,e.center.lat)*e.worldSize),o=e.worldSize/(2*Math.PI),l=Math.max(e.width,e.height)/e.worldSize*Math.PI;return ft(n,r+o*(1-Math.cos(l)),Math.pow(i,10))}return n}upVector(e,n,i){return Nd(n,i,e,1)}upVectorScale(e){return{metersToTile:vp(bp(so(e)))}}}function Xp(t){let e=t.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new pD(t);case"equirectangular":return new Jz(t);case"naturalEarth":return new eB(t);case"equalEarth":return new Kz(t);case"winkelTripel":return new tB(t);case"albers":return n?new _D(t):new Yz(t);case"lambertConformalConic":return n?new _D(t):new Qz(t);case"globe":return new nB(t)}throw new Error(`Invalid projection name: ${t.name}`)}let iB=new ii({"symbol-placement":new be(ie.layout_symbol["symbol-placement"]),"symbol-spacing":new be(ie.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new be(ie.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new et(ie.layout_symbol["symbol-sort-key"]),"symbol-z-order":new be(ie.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new be(ie.layout_symbol["symbol-z-elevate"]),"icon-allow-overlap":new be(ie.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new be(ie.layout_symbol["icon-ignore-placement"]),"icon-optional":new be(ie.layout_symbol["icon-optional"]),"icon-rotation-alignment":new be(ie.layout_symbol["icon-rotation-alignment"]),"icon-size":new et(ie.layout_symbol["icon-size"]),"icon-text-fit":new et(ie.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new et(ie.layout_symbol["icon-text-fit-padding"]),"icon-image":new et(ie.layout_symbol["icon-image"]),"icon-rotate":new et(ie.layout_symbol["icon-rotate"]),"icon-padding":new be(ie.layout_symbol["icon-padding"]),"icon-keep-upright":new be(ie.layout_symbol["icon-keep-upright"]),"icon-offset":new et(ie.layout_symbol["icon-offset"]),"icon-anchor":new et(ie.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new be(ie.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new be(ie.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new be(ie.layout_symbol["text-rotation-alignment"]),"text-field":new et(ie.layout_symbol["text-field"]),"text-font":new et(ie.layout_symbol["text-font"]),"text-size":new et(ie.layout_symbol["text-size"]),"text-max-width":new et(ie.layout_symbol["text-max-width"]),"text-line-height":new et(ie.layout_symbol["text-line-height"]),"text-letter-spacing":new et(ie.layout_symbol["text-letter-spacing"]),"text-justify":new et(ie.layout_symbol["text-justify"]),"text-radial-offset":new et(ie.layout_symbol["text-radial-offset"]),"text-variable-anchor":new be(ie.layout_symbol["text-variable-anchor"]),"text-anchor":new et(ie.layout_symbol["text-anchor"]),"text-max-angle":new be(ie.layout_symbol["text-max-angle"]),"text-writing-mode":new be(ie.layout_symbol["text-writing-mode"]),"text-rotate":new et(ie.layout_symbol["text-rotate"]),"text-padding":new be(ie.layout_symbol["text-padding"]),"text-keep-upright":new be(ie.layout_symbol["text-keep-upright"]),"text-transform":new et(ie.layout_symbol["text-transform"]),"text-offset":new et(ie.layout_symbol["text-offset"]),"text-allow-overlap":new be(ie.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new be(ie.layout_symbol["text-ignore-placement"]),"text-optional":new be(ie.layout_symbol["text-optional"]),visibility:new be(ie.layout_symbol.visibility)});var qv={paint:new ii({"icon-opacity":new et(ie.paint_symbol["icon-opacity"]),"icon-emissive-strength":new et(ie.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new et(ie.paint_symbol["text-emissive-strength"]),"icon-color":new et(ie.paint_symbol["icon-color"]),"icon-halo-color":new et(ie.paint_symbol["icon-halo-color"]),"icon-halo-width":new et(ie.paint_symbol["icon-halo-width"]),"icon-halo-blur":new et(ie.paint_symbol["icon-halo-blur"]),"icon-translate":new be(ie.paint_symbol["icon-translate"]),"icon-translate-anchor":new be(ie.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new et(ie.paint_symbol["icon-image-cross-fade"]),"text-opacity":new et(ie.paint_symbol["text-opacity"]),"text-color":new et(ie.paint_symbol["text-color"],{runtimeType:bo,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new et(ie.paint_symbol["text-halo-color"]),"text-halo-width":new et(ie.paint_symbol["text-halo-width"]),"text-halo-blur":new et(ie.paint_symbol["text-halo-blur"]),"text-translate":new be(ie.paint_symbol["text-translate"]),"text-translate-anchor":new be(ie.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new be(ie.paint_symbol["icon-color-saturation"])}),layout:iB};class yD{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Mc,this.defaultValue=e}evaluate(e){if(e.formattedSection){let n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ge(yD,"FormatSectionOverride",{omit:["defaultValue"]});class Yp extends io{constructor(e,n){super(e,qv,n)}recalculate(e,n){super.recalculate(e,n),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));let i=this.layout.get("text-writing-mode");if(i){let r=[];for(let o of i)r.indexOf(o)<0&&r.push(o);this.layout._values["text-writing-mode"]=r}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,n,i,r){let o=this.layout.get(e).evaluate(n,{},i,r),l=this._unevaluatedLayout._values[e];return l.isDataDriven()||Zf(l.value)||!o?o:function(u,h){return h.replace(/{([^{}]+)}/g,(p,m)=>m in u?String(u[m]):"")}(n.properties,o)}createBucket(e){return new Kd(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(let e of qv.paint.overridableProperties){if(!Yp.hasPaintOverride(this.layout,e))continue;let n=this.paint.get(e),i=new yD(n),r=new d0(i,n.property.specification),o=null;o=n.value.kind==="constant"||n.value.kind==="source"?new h0("source",r):new Ta("composite",r,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new Uc(n.property,o,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,i){return!(!this.layout||n.isDataDriven()||i.isDataDriven())&&Yp.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){let i=e.get("text-field"),r=qv.paint.properties[n],o=!1,l=u=>{for(let h of u)if(r.overrides&&r.overrides.hasOverride(h))return void(o=!0)};if(i.value.kind==="constant"&&i.value.value instanceof jr)l(i.value.value.sections);else if(i.value.kind==="source"){let u=p=>{o||(p instanceof pd&&Fi(p.value)===cd?l(p.value.sections):p instanceof md?l(p.sections):p.eachChild(u))},h=i.value;h._styleExpression&&u(h._styleExpression.expression)}return o}getProgramIds(){let e=this.paint.get("icon-opacity").constantOr(1)!==0,n=this.paint.get("text-opacity").constantOr(1)!==0,i=[];return e&&i.push("symbolIcon"),n&&i.push("symbolSDF"),i}getDefaultProgramParams(e,n){return{config:new Fl(this,n),overrideFog:!1}}}let rB=kp.types,oB=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Kp(t,e,n,i,r,o,l,u,h,p,m,_,y){let v=u?Math.min(Ua,Math.round(u[0])):0,b=u?Math.min(Ua,Math.round(u[1])):0;t.emplaceBack(e,n,Math.round(32*i),Math.round(32*r),o,l,(v<<1)+(h?1:0),b,16*p,16*m,256*_,256*y)}function Jp(t,e,n){t.emplaceBack(e,n)}function Qp(t,e,n,i,r,o,l){t.emplaceBack(e,n,i,r,o,l)}function em(t,e,n,i,r){let o=5*e+2;t.float32[o+0]=n,t.float32[o+1]=i,t.float32[o+2]=r}function au(t,e,n,i,r){t.emplaceBack(e,n,i,r),t.emplaceBack(e,n,i,r),t.emplaceBack(e,n,i,r),t.emplaceBack(e,n,i,r)}function sB(t){for(let e of t.sections)if(w3(e.text))return!0;return!1}class Wv{constructor(e){this.layoutVertexArray=new A0,this.indexArray=new xi,this.programConfigurations=e,this.segments=new yn,this.dynamicLayoutVertexArray=new Gs,this.opacityVertexArray=new R0,this.placedSymbolArray=new uT,this.iconTransitioningVertexArray=new Sa,this.globeExtVertexArray=new P0,this.zOffsetVertexArray=new Sd}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(e,n,i,r,o){this.isEmpty()||(i&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,wz.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Ez.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,oB,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,Iz.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Cz.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||o)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Tz.members,!0)),this.opacityVertexBuffer.itemSize=1),(i||r)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy())}}Ge(Wv,"SymbolBuffers");class Zv{constructor(e,n,i){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new i,this.segments=new yn,this.collisionVertexArray=new k0,this.collisionVertexArrayExt=new Gs}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Mz.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Dz.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ge(Zv,"CollisionBuffers");class tm{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(l=>l.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ne.identity([]),this.placementViewportMatrix=ne.identity([]);let n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Nv(this.zoom,n["text-size"]),this.iconSizeData=Nv(this.zoom,n["icon-size"]);let i=this.layers[0].layout,r=i.get("symbol-sort-key"),o=i.get("symbol-z-order");this.canOverlap=i.get("text-allow-overlap")||i.get("icon-allow-overlap")||i.get("text-ignore-placement")||i.get("icon-ignore-placement"),this.sortFeaturesByKey=o!=="viewport-y"&&r.constantOr(1)!==void 0,this.sortFeaturesByY=(o==="viewport-y"||o==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=i.get("text-writing-mode").map(l=>jn[l]),this.stateDependentLayerIds=this.layers.filter(l=>l.isStateDependent()).map(l=>l.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=i.get("symbol-z-elevate")}createArrays(){this.text=new Wv(new Pa(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Wv(new Pa(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new fT,this.lineVertexArray=new pT,this.symbolInstances=new hT}calculateGlyphDependencies(e,n,i,r,o){for(let l=0;l<e.length;l++){let u=e.codePointAt(l);if(u===void 0)break;if(n[u]=!0,r&&o&&u<=65535){let h=$d[e.charAt(l)];h&&(n[h.charCodeAt(0)]=!0)}}}populate(e,n,i,r){let o=this.layers[0],l=o.layout,u=this.projection.name==="globe",h=l.get("text-font"),p=l.get("text-field"),m=l.get("icon-image"),_=(p.value.kind!=="constant"||p.value.value instanceof jr&&!p.value.value.isEmpty()||p.value.value.toString().length>0)&&(h.value.kind!=="constant"||h.value.value.length>0),y=m.value.kind!=="constant"||!!m.value.value||Object.keys(m.parameters).length>0,v=l.get("symbol-sort-key");if(this.features=[],!_&&!y)return;let b=n.iconDependencies,w=n.glyphDependencies,C=n.availableImages,E=new Hn(this.zoom);for(let{feature:I,id:D,index:S,sourceLayerIndex:M}of e){let A=o._featureFilter.needGeometry,R=za(I,A);if(!o._featureFilter.filter(E,R,i))continue;if(A||(R.geometry=vs(I,i,r)),u&&I.type!==1&&i.z<=5){let z=R.geometry,B=.98078528056,G=(N,W)=>{let Y=Nd(N.x,N.y,i,1),te=Nd(W.x,W.y,i,1);return $.dot(Y,te)<B};for(let N=0;N<z.length;N++)z[N]=mN(z[N],G)}let F,k;if(_){let z=o.getValueAndResolveTokens("text-field",R,i,C),B=jr.factory(z);sB(B)&&(this.hasRTLText=!0),(!this.hasRTLText||I0()==="unavailable"||this.hasRTLText&&Eo.isParsed())&&(F=Pz(B,o,R))}if(y){let z=o.getValueAndResolveTokens("icon-image",R,i,C);k=z instanceof wo?z:wo.fromString(z)}if(!F&&!k)continue;let L=this.sortFeaturesByKey?v.evaluate(R,{},i):void 0;if(this.features.push({id:D,text:F,icon:k,index:S,sourceLayerIndex:M,geometry:R.geometry,properties:I.properties,type:rB[I.type],sortKey:L}),k&&(b[k.namePrimary]=!0,k.nameSecondary&&(b[k.nameSecondary]=!0)),F){let z=h.evaluate(R,{},i).join(","),B=l.get("text-rotation-alignment")==="map"&&l.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(jn.vertical)>=0;for(let G of F.sections)if(G.image)b[G.image.namePrimary]=!0;else{let N=y0(F.toString()),W=G.fontStack||z,Y=w[W]=w[W]||{};this.calculateGlyphDependencies(G.text,Y,B,this.allowVerticalPlacement,N)}}}l.get("symbol-placement")==="line"&&(this.features=function(I){let D={},S={},M=[],A=0;function R(z){M.push(I[z]),A++}function F(z,B,G){let N=S[z];return delete S[z],S[B]=N,M[N].geometry[0].pop(),M[N].geometry[0]=M[N].geometry[0].concat(G[0]),N}function k(z,B,G){let N=D[B];return delete D[B],D[z]=N,M[N].geometry[0].shift(),M[N].geometry[0]=G[0].concat(M[N].geometry[0]),N}function L(z,B,G){let N=G?B[0][B[0].length-1]:B[0][0];return`${z}:${N.x}:${N.y}`}for(let z=0;z<I.length;z++){let B=I[z],G=B.geometry,N=B.text?B.text.toString():null;if(!N){R(z);continue}let W=L(N,G),Y=L(N,G,!0);if(W in S&&Y in D&&S[W]!==D[Y]){let te=k(W,Y,G),q=F(W,Y,M[te].geometry);delete D[W],delete S[Y],S[L(N,M[q].geometry,!0)]=q,M[te].geometry=null}else W in S?F(W,Y,G):Y in D?k(W,Y,G):(R(z),D[W]=A-1,S[Y]=A-1)}return M.filter(z=>z.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((I,D)=>I.sortKey-D.sortKey)}update(e,n,i,r,o){let l=Object.keys(e).length!==0;if(l&&!this.stateDependentLayers.length)return;let u=l?this.stateDependentLayers:this.layers;this.text.programConfigurations.updatePaintArrays(e,n,u,i,r,o),this.icon.programConfigurations.updatePaintArrays(e,n,u,i,r,o)}updateZOffset(){let e=(o,l,u)=>{i+=l,i>o.length&&o.resize(i);for(let h=-l;h<0;h++)o.emplace(h+i,u)},n=(o,l,u)=>{r+=l,r>o.length&&o.resize(r);for(let h=-l;h<0;h++)o.emplace(h+r,u)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let i=0,r=0;for(let o=0;o<this.symbolInstances.length;o++){let l=this.symbolInstances.get(o),{numHorizontalGlyphVertices:u,numVerticalGlyphVertices:h,numIconVertices:p}=l,m=l.zOffset,_=p>0;if((u>0||h>0)&&(e(this.text.zOffsetVertexArray,u,m),e(this.text.zOffsetVertexArray,h,m)),_){let{placedIconSymbolIndex:y,verticalPlacedIconSymbolIndex:v}=l;y>=0&&n(this.icon.zOffsetVertexArray,p,m),v>=0&&n(this.icon.zOffsetVertexArray,l.numVerticalIconVertices,m)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Xp(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){let i=this.lineVertexArray.length;if(e.segment!==void 0)for(let{x:r,y:o}of n)this.lineVertexArray.emplaceBack(r,o);return{lineStartIndex:i,lineLength:this.lineVertexArray.length-i}}addSymbols(e,n,i,r,o,l,u,h,p,m,_,y,v,b,w,C){let E=e.indexArray,I=e.layoutVertexArray,D=e.globeExtVertexArray,S=e.segments.prepareSegment(4*n.length,I,E,this.canOverlap?l.sortKey:void 0),M=this.glyphOffsetArray.length,A=S.vertexLength,R=this.allowVerticalPlacement&&u===jn.vertical?Math.PI/2:0,F=l.text&&l.text.sections;for(let L=0;L<n.length;L++){let{tl:z,tr:B,bl:G,br:N,texPrimary:W,texSecondary:Y,pixelOffsetTL:te,pixelOffsetBR:q,minFontScaleX:X,minFontScaleY:re,glyphOffset:se,isSDF:oe,sectionIndex:ue}=n[L],de=S.vertexLength,pe=se[1];if(Kp(I,p.x,p.y,z.x,pe+z.y,W.x,W.y,i,oe,te.x,te.y,X,re),Kp(I,p.x,p.y,B.x,pe+B.y,W.x+W.w,W.y,i,oe,q.x,te.y,X,re),Kp(I,p.x,p.y,G.x,pe+G.y,W.x,W.y+W.h,i,oe,te.x,q.y,X,re),Kp(I,p.x,p.y,N.x,pe+N.y,W.x+W.w,W.y+W.h,i,oe,q.x,q.y,X,re),h){let{x:ae,y:ge,z:Ae}=h.anchor,[Pe,Ne,Be]=h.up;Qp(D,ae,ge,Ae,Pe,Ne,Be),Qp(D,ae,ge,Ae,Pe,Ne,Be),Qp(D,ae,ge,Ae,Pe,Ne,Be),Qp(D,ae,ge,Ae,Pe,Ne,Be),au(e.dynamicLayoutVertexArray,ae,ge,Ae,R)}else au(e.dynamicLayoutVertexArray,p.x,p.y,p.z,R);if(C){let ae=Y||W;Jp(e.iconTransitioningVertexArray,ae.x,ae.y),Jp(e.iconTransitioningVertexArray,ae.x+ae.w,ae.y),Jp(e.iconTransitioningVertexArray,ae.x,ae.y+ae.h),Jp(e.iconTransitioningVertexArray,ae.x+ae.w,ae.y+ae.h)}E.emplaceBack(de,de+1,de+2),E.emplaceBack(de+1,de+2,de+3),S.vertexLength+=4,S.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(se[0]),L!==n.length-1&&ue===n[L+1].sectionIndex||e.programConfigurations.populatePaintArrays(I.length,l,l.index,{},v,b,w,F&&F[ue])}let k=h?h.anchor:p;e.placedSymbolArray.emplaceBack(k.x,k.y,k.z,p.x,p.y,M,this.glyphOffsetArray.length-M,A,m,_,p.segment,i?i[0]:0,i?i[1]:0,r[0],r[1],u,0,!1,0,y,0)}_commitLayoutVertex(e,n,i,r,o,l,u){e.emplaceBack(n,i,r,o,l,Math.round(u.x),Math.round(u.y))}_addCollisionDebugVertices(e,n,i,r,o,l,u){let h=i.segments.prepareSegment(4,i.layoutVertexArray,i.indexArray),p=h.vertexLength,m=u.tileAnchorX,_=u.tileAnchorY;for(let v=0;v<4;v++)i.collisionVertexArray.emplaceBack(0,0,0,0);this._commitDebugCollisionVertexUpdate(i.collisionVertexArrayExt,n,e.padding,u.zOffset),this._commitLayoutVertex(i.layoutVertexArray,r,o,l,m,_,new Q(e.x1,e.y1)),this._commitLayoutVertex(i.layoutVertexArray,r,o,l,m,_,new Q(e.x2,e.y1)),this._commitLayoutVertex(i.layoutVertexArray,r,o,l,m,_,new Q(e.x2,e.y2)),this._commitLayoutVertex(i.layoutVertexArray,r,o,l,m,_,new Q(e.x1,e.y2)),h.vertexLength+=4;let y=i.indexArray;y.emplaceBack(p,p+1),y.emplaceBack(p+1,p+2),y.emplaceBack(p+2,p+3),y.emplaceBack(p+3,p),h.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,i,r,o,l){for(let u=r;u<o;u++){let h=i.get(u),p=this.getSymbolInstanceTextSize(e,l,n,u);this._addCollisionDebugVertices(h,p,this.textCollisionBox,h.projectedAnchorX,h.projectedAnchorY,h.projectedAnchorZ,l)}}_addIconDebugCollisionBoxes(e,n,i,r,o,l){for(let u=r;u<o;u++){let h=i.get(u),p=this.getSymbolInstanceIconSize(e,n,l.placedIconSymbolIndex);this._addCollisionDebugVertices(h,p,this.iconCollisionBox,h.projectedAnchorX,h.projectedAnchorY,h.projectedAnchorZ,l)}}generateCollisionDebugBuffers(e,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Zv(up,UM.members,Sa),this.iconCollisionBox=new Zv(up,UM.members,Sa);let i=xs(this.iconSizeData,e),r=xs(this.textSizeData,e);for(let o=0;o<this.symbolInstances.length;o++){let l=this.symbolInstances.get(o);this._addTextDebugCollisionBoxes(r,e,n,l.textBoxStartIndex,l.textBoxEndIndex,l),this._addTextDebugCollisionBoxes(r,e,n,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l),this._addIconDebugCollisionBoxes(i,e,n,l.iconBoxStartIndex,l.iconBoxEndIndex,l),this._addIconDebugCollisionBoxes(i,e,n,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex,l)}}getSymbolInstanceTextSize(e,n,i,r){let o=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:r),l=Ud(this.textSizeData,e,o)/zi;return this.tilePixelRatio*l}getSymbolInstanceIconSize(e,n,i){let r=this.icon.placedSymbolArray.get(i),o=Ud(this.iconSizeData,e,r);return this.tilePixelRatio*o}_commitDebugCollisionVertexUpdate(e,n,i,r){e.emplaceBack(n,-i,-i,r),e.emplaceBack(n,i,-i,r),e.emplaceBack(n,i,i,r),e.emplaceBack(n,-i,i,r)}_updateTextDebugCollisionBoxes(e,n,i,r,o,l){for(let u=r;u<o;u++){let h=i.get(u),p=this.getSymbolInstanceTextSize(e,l,n,u);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,p,h.padding,l.zOffset)}}_updateIconDebugCollisionBoxes(e,n,i,r,o,l){for(let u=r;u<o;u++){let h=i.get(u),p=this.getSymbolInstanceIconSize(e,n,l.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,p,h.padding,l.zOffset)}}updateCollisionDebugBuffers(e,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();let i=xs(this.iconSizeData,e),r=xs(this.textSizeData,e);for(let o=0;o<this.symbolInstances.length;o++){let l=this.symbolInstances.get(o);this._updateTextDebugCollisionBoxes(r,e,n,l.textBoxStartIndex,l.textBoxEndIndex,l),this._updateTextDebugCollisionBoxes(r,e,n,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l),this._updateIconDebugCollisionBoxes(i,e,n,l.iconBoxStartIndex,l.iconBoxEndIndex,l),this._updateIconDebugCollisionBoxes(i,e,n,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex,l)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,i,r,o,l,u,h,p){let m={};if(n<i){let{x1:_,y1:y,x2:v,y2:b,padding:w,projectedAnchorX:C,projectedAnchorY:E,projectedAnchorZ:I,tileAnchorX:D,tileAnchorY:S,featureIndex:M}=e.get(n);m.textBox={x1:_,y1:y,x2:v,y2:b,padding:w,projectedAnchorX:C,projectedAnchorY:E,projectedAnchorZ:I,tileAnchorX:D,tileAnchorY:S},m.textFeatureIndex=M}if(r<o){let{x1:_,y1:y,x2:v,y2:b,padding:w,projectedAnchorX:C,projectedAnchorY:E,projectedAnchorZ:I,tileAnchorX:D,tileAnchorY:S,featureIndex:M}=e.get(r);m.verticalTextBox={x1:_,y1:y,x2:v,y2:b,padding:w,projectedAnchorX:C,projectedAnchorY:E,projectedAnchorZ:I,tileAnchorX:D,tileAnchorY:S},m.verticalTextFeatureIndex=M}if(l<u){let{x1:_,y1:y,x2:v,y2:b,padding:w,projectedAnchorX:C,projectedAnchorY:E,projectedAnchorZ:I,tileAnchorX:D,tileAnchorY:S,featureIndex:M}=e.get(l);m.iconBox={x1:_,y1:y,x2:v,y2:b,padding:w,projectedAnchorX:C,projectedAnchorY:E,projectedAnchorZ:I,tileAnchorX:D,tileAnchorY:S},m.iconFeatureIndex=M}if(h<p){let{x1:_,y1:y,x2:v,y2:b,padding:w,projectedAnchorX:C,projectedAnchorY:E,projectedAnchorZ:I,tileAnchorX:D,tileAnchorY:S,featureIndex:M}=e.get(h);m.verticalIconBox={x1:_,y1:y,x2:v,y2:b,padding:w,projectedAnchorX:C,projectedAnchorY:E,projectedAnchorZ:I,tileAnchorX:D,tileAnchorY:S},m.verticalIconFeatureIndex=M}return m}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){let i=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,i.textBoxStartIndex,i.textBoxEndIndex,i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i.iconBoxStartIndex,i.iconBoxEndIndex,i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,n){let i=e.placedSymbolArray.get(n),r=i.vertexStartIndex+4*i.numGlyphs;for(let o=i.vertexStartIndex;o<r;o+=4)e.indexArray.emplaceBack(o,o+1,o+2),e.indexArray.emplaceBack(o+1,o+2,o+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;let n=Math.sin(e),i=Math.cos(e),r=[],o=[],l=[];for(let u=0;u<this.symbolInstances.length;++u){l.push(u);let h=this.symbolInstances.get(u);r.push(0|Math.round(n*h.tileAnchorX+i*h.tileAnchorY)),o.push(h.featureIndex)}return l.sort((u,h)=>r[u]-r[h]||o[h]-o[u]),l}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,n)=>this.symbolInstances.get(n).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,n){let i=this.sortKeyRanges[this.sortKeyRanges.length-1];i&&i.sortKey===n?i.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(let n of this.symbolInstanceIndexes){let i=this.symbolInstances.get(n);this.featureSortOrder.push(i.featureIndex);let{rightJustifiedTextSymbolIndex:r,centerJustifiedTextSymbolIndex:o,leftJustifiedTextSymbolIndex:l,verticalPlacedTextSymbolIndex:u,placedIconSymbolIndex:h,verticalPlacedIconSymbolIndex:p}=i;r>=0&&this.addIndicesForPlacedSymbol(this.text,r),o>=0&&o!==r&&this.addIndicesForPlacedSymbol(this.text,o),l>=0&&l!==o&&l!==r&&this.addIndicesForPlacedSymbol(this.text,l),u>=0&&this.addIndicesForPlacedSymbol(this.text,u),h>=0&&this.addIndicesForPlacedSymbol(this.icon,h),p>=0&&this.addIndicesForPlacedSymbol(this.icon,p)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Ge(tm,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),tm.MAX_GLYPHS=65535,tm.addDynamicAttributes=au;var Kd=tm;let aB=ln([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:lB}=aB,cB=ln([{name:"a_packed",components:4,type:"Float32"}]),{members:uB}=cB,dB=kp.types,hB=Math.cos(Math.PI/180*37.5);class nm{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new S0,this.layoutVertexArray2=new Gs,this.indexArray=new xi,this.programConfigurations=new Pa(e.layers,e.zoom),this.segments=new yn,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,i,r){this.hasPattern=Rv("line",this.layers,n);let o=this.layers[0].layout.get("line-sort-key"),l=[];for(let{feature:m,id:_,index:y,sourceLayerIndex:v}of e){let b=this.layers[0]._featureFilter.needGeometry,w=za(m,b);if(!this.layers[0]._featureFilter.filter(new Hn(this.zoom),w,i))continue;let C=o?o.evaluate(w,{},i):void 0,E={id:_,properties:m.properties,type:m.type,sourceLayerIndex:v,index:y,geometry:b?w.geometry:vs(m,i,r),patterns:{},sortKey:C};l.push(E)}o&&l.sort((m,_)=>m.sortKey-_.sortKey);let{lineAtlas:u,featureIndex:h}=n,p=this.addConstantDashes(u);for(let m of l){let{geometry:_,index:y,sourceLayerIndex:v}=m;if(p&&this.addFeatureDashes(m,u),this.hasPattern){let b=Ov("line",this.layers,m,this.zoom,n);this.patternFeatures.push(b)}else this.addFeature(m,_,y,i,u.positions,n.availableImages,n.brightness);h.insert(e[y].feature,_,y,v,this.index)}}addConstantDashes(e){let n=!1;for(let i of this.layers){let r=i.paint.get("line-dasharray").value,o=i.layout.get("line-cap").value;if(r.kind!=="constant"||o.kind!=="constant")n=!0;else{let l=o.value,u=r.value;if(!u)continue;e.addDash(u,l)}}return n}addFeatureDashes(e,n){let i=this.zoom;for(let r of this.layers){let o=r.paint.get("line-dasharray").value,l=r.layout.get("line-cap").value;if(o.kind==="constant"&&l.kind==="constant")continue;let u,h;if(o.kind==="constant"){if(u=o.value,!u)continue}else u=o.evaluate({zoom:i},e);h=l.kind==="constant"?l.value:l.evaluate({zoom:i},e),n.addDash(u,h),e.patterns[r.id]=n.getKey(u,h)}}update(e,n,i,r,o){let l=Object.keys(e).length!==0;l&&!this.stateDependentLayers.length||this.programConfigurations.updatePaintArrays(e,n,l?this.stateDependentLayers:this.layers,i,r,o)}addFeatures(e,n,i,r,o,l){for(let u of this.patternFeatures)this.addFeature(u,u.geometry,u.index,n,i,r,l)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,uB)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,lB),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,i,r,o,l,u){let h=this.layers[0].layout,p=h.get("line-join").evaluate(e,{}),m=h.get("line-cap").evaluate(e,{}),_=h.get("line-miter-limit"),y=h.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(let v of n)this.addLine(v,e,p,m,_,y);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,o,l,r,u)}addLine(e,n,i,r,o,l){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let E=0;E<e.length-1;E++)this.totalDistance+=e[E].dist(e[E+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}let u=dB[n.type]==="Polygon",h=e.length;for(;h>=2&&e[h-1].equals(e[h-2]);)h--;let p=0;for(;p<h-1&&e[p].equals(e[p+1]);)p++;if(h<(u?3:2))return;i==="bevel"&&(o=1.05);let m=this.overscaling<=16?15*le/(512*this.overscaling):0,_=this.segments.prepareSegment(10*h,this.layoutVertexArray,this.indexArray),y,v,b,w,C;this.e1=this.e2=-1,u&&(y=e[h-2],C=e[p].sub(y)._unit()._perp());for(let E=p;E<h;E++){if(b=E===h-1?u?e[p+1]:void 0:e[E+1],b&&e[E].equals(b))continue;C&&(w=C),y&&(v=y),y=e[E],C=b?b.sub(y)._unit()._perp():w,w=w||C;let I=w.add(C);I.x===0&&I.y===0||I._unit();let D=w.x*C.x+w.y*C.y,S=I.x*C.x+I.y*C.y,M=S!==0?1/S:1/0,A=2*Math.sqrt(2-2*S),R=S<hB&&v&&b,F=w.x*C.y-w.y*C.x>0;if(R&&E>p){let z=y.dist(v);if(z>2*m){let B=y.sub(y.sub(v)._mult(m/z)._round());this.updateDistance(v,B),this.addCurrentVertex(B,w,0,0,_),v=B}}let k=v&&b,L=k?i:u?"butt":r;if(k&&L==="round"&&(M<l?L="miter":M<=2&&(L="fakeround")),L==="miter"&&M>o&&(L="bevel"),L==="bevel"&&(M>2&&(L="flipbevel"),M<o&&(L="miter")),v&&this.updateDistance(v,y),L==="miter")I._mult(M),this.addCurrentVertex(y,I,0,0,_);else if(L==="flipbevel"){if(M>100)I=C.mult(-1);else{let z=M*w.add(C).mag()/w.sub(C).mag();I._perp()._mult(z*(F?-1:1))}this.addCurrentVertex(y,I,0,0,_),this.addCurrentVertex(y,I.mult(-1),0,0,_)}else if(L==="bevel"||L==="fakeround"){let z=-Math.sqrt(M*M-1),B=F?z:0,G=F?0:z;if(v&&this.addCurrentVertex(y,w,B,G,_),L==="fakeround"){let N=Math.round(180*A/Math.PI/20);for(let W=1;W<N;W++){let Y=W/N;if(Y!==.5){let q=Y-.5;Y+=Y*q*(Y-1)*((1.0904+D*(D*(3.55645-1.43519*D)-3.2452))*q*q+(.848013+D*(.215638*D-1.06021)))}let te=C.sub(w)._mult(Y)._add(w)._unit()._mult(F?-1:1);this.addHalfVertex(y,te.x,te.y,!1,F,0,_)}}b&&this.addCurrentVertex(y,C,-B,-G,_)}else if(L==="butt")this.addCurrentVertex(y,I,0,0,_);else if(L==="square"){let z=v?1:-1;v||this.addCurrentVertex(y,I,z,z,_),this.addCurrentVertex(y,I,0,0,_),v&&this.addCurrentVertex(y,I,z,z,_)}else L==="round"&&(v&&(this.addCurrentVertex(y,w,0,0,_),this.addCurrentVertex(y,w,1,1,_,!0)),b&&(this.addCurrentVertex(y,C,-1,-1,_,!0),this.addCurrentVertex(y,C,0,0,_)));if(R&&E<h-1){let z=y.dist(b);if(z>2*m){let B=y.add(b.sub(y)._mult(m/z)._round());this.updateDistance(y,B),this.addCurrentVertex(B,C,0,0,_),y=B}}}}addCurrentVertex(e,n,i,r,o,l=!1){let u=n.y*r-n.x,h=-n.y-n.x*r;this.addHalfVertex(e,n.x+n.y*i,n.y-n.x*i,l,!1,i,o),this.addHalfVertex(e,u,h,l,!0,-r,o)}addHalfVertex({x:e,y:n},i,r,o,l,u,h){this.layoutVertexArray.emplaceBack((e<<1)+(o?1:0),(n<<1)+(l?1:0),Math.round(63*i)+128,Math.round(63*r)+128,1+(u===0?0:u<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);let p=h.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,p),h.primitiveLength++),l?this.e2=p:this.e1=p}updateScaledDistance(){if(this.lineClips){let e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}Ge(nm,"LineBucket",{omit:["layers","patternFeatures"]});class Zn{constructor(e,n,i,r){this.context=e,this.format=i,this.texture=e.gl.createTexture(),this.update(n,r)}update(e,n,i){let{width:r,height:o}=e,{context:l}=this,{gl:u}=l,{HTMLImageElement:h,HTMLCanvasElement:p,HTMLVideoElement:m,ImageData:_,ImageBitmap:y}=x;if(u.bindTexture(u.TEXTURE_2D,this.texture),l.pixelStoreUnpackFlipY.set(!1),l.pixelStoreUnpack.set(1),l.pixelStoreUnpackPremultiplyAlpha.set(this.format===u.RGBA&&(!n||n.premultiply!==!1)),i||this.size&&this.size[0]===r&&this.size[1]===o){let{x:v,y:b}=i||{x:0,y:0};if(e instanceof h||e instanceof p||e instanceof m||e instanceof _||y&&e instanceof y)u.texSubImage2D(u.TEXTURE_2D,0,v,b,u.RGBA,u.UNSIGNED_BYTE,e);else{let w=this.format,C=u.UNSIGNED_BYTE;this.format===u.R32F&&(w=u.RED,C=u.FLOAT),u.texSubImage2D(u.TEXTURE_2D,0,v,b,r,o,w,C,e.data)}}else if(this.size=[r,o],e instanceof h||e instanceof p||e instanceof m||e instanceof _||y&&e instanceof y){let v=this.format;this.format===u.R8&&(v=u.RED),u.texImage2D(u.TEXTURE_2D,0,this.format,v,u.UNSIGNED_BYTE,e)}else{let v=this.format,b=this.format,w=u.UNSIGNED_BYTE;this.format===u.DEPTH_COMPONENT&&(v=u.DEPTH_COMPONENT16,w=u.UNSIGNED_SHORT),this.format===u.R32F&&(w=u.FLOAT,b=u.RED),u.texImage2D(u.TEXTURE_2D,0,v,r,o,0,b,w,e.data)}this.useMipmap=!!(n&&n.useMipmap),this.useMipmap&&u.generateMipmap(u.TEXTURE_2D)}bind(e,n){let{context:i}=this,{gl:r}=i;r.bindTexture(r.TEXTURE_2D,this.texture),e!==this.minFilter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,this.useMipmap?e===r.NEAREST?r.NEAREST_MIPMAP_NEAREST:r.LINEAR_MIPMAP_NEAREST:e),this.minFilter=e),n!==this.wrapS&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,n),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,n),this.wrapS=n)}bindExtraParam(e,n,i,r){let{context:o}=this,{gl:l}=o;l.bindTexture(l.TEXTURE_2D,this.texture),n!==this.magFilter&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MAG_FILTER,n),this.magFilter=n),e!==this.minFilter&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_MIN_FILTER,this.useMipmap?e===l.NEAREST?l.NEAREST_MIPMAP_NEAREST:l.LINEAR_MIPMAP_NEAREST:e),this.minFilter=e),i!==this.wrapS&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_S,i),this.wrapS=i),r!==this.wrapT&&(l.texParameteri(l.TEXTURE_2D,l.TEXTURE_WRAP_T,r),this.wrapT=r)}destroy(){let{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class im{constructor(e,n){this.context=e,this.texture=n}bind(e,n){let{context:i}=this,{gl:r}=i;r.bindTexture(r.TEXTURE_2D,this.texture),e!==this.minFilter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,e),this.minFilter=e),n!==this.wrapS&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,n),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,n),this.wrapS=n)}}let So=32,bs=33,Ga=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,n=0,i=0,r=0,o=0,l=0,u=0;for(1&e?r=o=l=So:n=i=u=So;(e>>=1)>1;){let p=n+r>>1,m=i+o>>1;1&e?(r=n,o=i,n=l,i=u):(n=r,i=o,r=l,o=u),l=p,u=m}let h=4*t;Ga[h+0]=n,Ga[h+1]=i,Ga[h+2]=r,Ga[h+3]=o}let ws=new Uint16Array(2178),Ha=new Uint8Array(1089),rm=new Uint16Array(1089);function vD(t){return t===0?-.03125:t===32?.03125:0}var Xv=ln([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);let xD={type:2,extent:le,loadGeometry:()=>[[new Q(0,0),new Q(le+1,0),new Q(le+1,le+1),new Q(0,le+1),new Q(0,0)]]};class Jd{constructor(e,n,i,r,o){this.tileID=e,this.uid=xc(),this.uses=0,this.tileSize=n,this.tileZoom=i,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=o,r&&r.style&&(this._lastUpdatedBrightness=r.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",r&&r.transform&&(this.projection=r.transform.projection)}registerFadeDuration(e){let n=e+this.timeAdded;n<yt.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=zl(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,n,i){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(r,o){let l={};if(!o)return l;for(let u of r){let h=u.layerIds.map(p=>o.getLayer(p)).filter(Boolean);if(h.length!==0){u.layers=h,u.stateDependentLayerIds&&(u.stateDependentLayers=u.stateDependentLayerIds.map(p=>h.filter(m=>m.id===p)[0]));for(let p of h)l[p.fqid]=u}}return l}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(let r in this.buckets){let o=this.buckets[r];if(o instanceof Kd){if(this.hasSymbolBuckets=!0,!i)break;o.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(let r in this.buckets){let o=this.buckets[r];if(o instanceof Kd&&o.hasRTLText){this.hasRTLText=!0,Eo.isLoading()||Eo.isLoaded()||I0()!=="deferred"||nT();break}}this.queryPadding=0;for(let r in this.buckets){let o=this.buckets[r],l=n.style.getOwnLayer(r);if(!l)continue;let u=l.queryRadius(o);this.queryPadding=Math.max(this.queryPadding,u)}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas),this._lastUpdatedBrightness=e.brightness}else this.collisionBoxArray=new U0}unloadVectorData(){if(this.hasData()){for(let e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.fqid]}upload(e){for(let i in this.buckets){let r=this.buckets[i];r.uploadPending()&&r.upload(e)}let n=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Zn(e,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Zn(e,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Zn(e,this.lineAtlas.image,n.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e,n,i){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,i),!n||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;let r=n.style.getBrightness();(this._lastUpdatedBrightness||r)&&(this._lastUpdatedBrightness&&r&&Math.abs(this._lastUpdatedBrightness-r)<.001||(this._lastUpdatedBrightness=r,this.updateBuckets(void 0,n)))}queryRenderedFeatures(e,n,i,r,o,l,u,h){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:r,pixelPosMatrix:u,transform:l,params:o,tileTransform:this.tileTransform},e,n,i):{}}querySourceFeatures(e,n){let i=this.latestFeatureIndex;if(!i||!i.rawTileData)return;let r=i.loadVTLayers(),o=n?n.sourceLayer:"",l=r._geojsonTileLayer||r[o];if(!l)return;let u=Jf(n&&n.filter),{z:h,x:p,y:m}=this.tileID.canonical,_={z:h,x:p,y:m};for(let y=0;y<l.length;y++){let v=l.feature(y);if(u.needGeometry){let C=za(v,!0);if(!u.filter(new Hn(this.tileID.overscaledZ),C,this.tileID.canonical))continue}else if(!u.filter(new Hn(this.tileID.overscaledZ),v))continue;let b=i.getId(v,o),w=new OM(v,h,p,m,b);w.tile=_,e.push(w)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}bucketsLoaded(){for(let e in this.buckets)if(this.buckets[e].uploadPending())return!1;return!0}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){let n=this.expirationTime;if(e.cacheControl){let i=nt(e.cacheControl);i["max-age"]&&(this.expirationTime=Date.now()+1e3*i["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){let i=Date.now(),r=!1;if(this.expirationTime>i)r=!1;else if(n)if(this.expirationTime<n)r=!0;else{let o=this.expirationTime-n;o?this.expirationTime=i+Math.max(o,3e4):r=!0}else r=!0;r?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(e).length!==0&&n&&this.updateBuckets(e,n)}updateBuckets(e,n){if(!this.latestFeatureIndex)return;let i=this.latestFeatureIndex.loadVTLayers(),r=n.style.listImages(),o=n.style.getBrightness();for(let l in this.buckets){if(!n.style.hasLayer(l))continue;let u=this.buckets[l],h=u.layers[0].sourceLayer||"_geojsonTileLayer",p=i[h],m={};if(e&&(m=e[h],!p||!m||Object.keys(m).length===0))continue;if(u.update(m,p,r,this.imageAtlas&&this.imageAtlas.patternPositions||{},o),u instanceof nm||u instanceof Op){let y=n.style.getOwnSourceCache(u.layers[0].source);n._terrain&&n._terrain.enabled&&y&&u.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(y.id,this.tileID)}let _=n&&n.style&&n.style.getOwnLayer(l);_&&(this.queryPadding=Math.max(this.queryPadding,_.queryRadius(u)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<yt.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=yt.now()+e}setTexture(e,n){let i=n.context,r=i.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture&&this.texture instanceof Zn?this.texture.update(e,{useMipmap:!0}):(this.texture=new Zn(i,e,r.RGBA,{useMipmap:!0}),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE))}setDependencies(e,n){let i={};for(let r of n)i[r]=!0;this.dependencies[e]=i}hasDependency(e,n){for(let i of e){let r=this.dependencies[i];if(r){for(let o of n)if(r[o])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,n){if(!n||n.name==="mercator"||this._tileDebugBuffer)return;let i=vs(xD,this.tileID.canonical,this.tileTransform)[0],r=new $r,o=new Ad;for(let l=0;l<i.length;l++){let{x:u,y:h}=i[l];r.emplaceBack(u,h),o.emplaceBack(l)}o.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(o),this._tileDebugBuffer=e.createVertexBuffer(r,Oa.members),this._tileDebugSegments=yn.simpleSegment(0,0,r.length,o.length)}_makeTileBoundsBuffers(e,n){if(this._tileBoundsBuffer||!n||n.name==="mercator")return;let i=vs(xD,this.tileID.canonical,this.tileTransform)[0],r,o;if(this.isRaster){let l=function(u,h){let p=zl(u,h),m=Math.pow(2,u.z);for(let C=0;C<bs;C++)for(let E=0;E<bs;E++){let I=qr((u.x+(E+vD(E))/So)/m),D=bi((u.y+(C+vD(C))/So)/m),S=h.project(I,D),M=C*bs+E;ws[2*M+0]=Math.round((S.x*p.scale-p.x)*le),ws[2*M+1]=Math.round((S.y*p.scale-p.y)*le)}Ha.fill(0),rm.fill(0);for(let C=2045;C>=0;C--){let E=4*C,I=Ga[E+0],D=Ga[E+1],S=Ga[E+2],M=Ga[E+3],A=I+S>>1,R=D+M>>1,F=A+R-D,k=R+I-A,L=D*bs+I,z=M*bs+S,B=R*bs+A,G=Math.hypot((ws[2*L+0]+ws[2*z+0])/2-ws[2*B+0],(ws[2*L+1]+ws[2*z+1])/2-ws[2*B+1])>=16;Ha[B]=Ha[B]||(G?1:0),C<1022&&(Ha[B]=Ha[B]||Ha[(D+k>>1)*bs+(I+F>>1)]||Ha[(M+k>>1)*bs+(S+F>>1)])}let _=new Pl,y=new xi,v=0;function b(C,E){let I=E*bs+C;return rm[I]===0&&(_.emplaceBack(ws[2*I+0],ws[2*I+1],C*le/So,E*le/So),rm[I]=++v),rm[I]-1}function w(C,E,I,D,S,M){let A=C+I>>1,R=E+D>>1;if(Math.abs(C-S)+Math.abs(E-M)>1&&Ha[R*bs+A])w(S,M,C,E,A,R),w(I,D,S,M,A,R);else{let F=b(C,E),k=b(I,D),L=b(S,M);y.emplaceBack(F,k,L)}}return w(0,0,So,So,So,0),w(So,So,0,0,0,So),{vertices:_,indices:y}}(this.tileID.canonical,n);r=l.vertices,o=l.indices}else{r=new Pl,o=new xi;for(let{x:u,y:h}of i)r.emplaceBack(u,h,0,0);let l=Rp(r.int16,void 0,4);for(let u=0;u<l.length;u+=3)o.emplaceBack(l[u],l[u+1],l[u+2])}this._tileBoundsBuffer=e.createVertexBuffer(r,Xv.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(o),this._tileBoundsSegments=yn.simpleSegment(0,0,r.length,o.length)}_makeGlobeTileDebugBuffers(e,n){let i=n.projection;if(!i||i.name!=="globe"||n.freezeTileCoverage)return;let r=this.tileID.canonical,o=ka(GI(r,n)),l=Ni(n.zoom),u;l>0&&(u=ne.invert(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,r,n,o,u,l),this._makeGlobeTileDebugTextBuffer(e,r,n,o,u,l)}_globePoint(e,n,i,r,o,l,u){let h=Nd(e,n,i);if(l){let p=1<<i.z,m=Ii(r.center.lng),_=Ai(r.center.lat),y=(i.x+.5)/p-m,v=0;y>.5?v=-1:y<-.5&&(v=1);let b=(e/le+i.x)/p+v,w=(n/le+i.y)/p;b=(b-m)*r._pixelsPerMercatorPixel+m,w=(w-_)*r._pixelsPerMercatorPixel+_;let C=[b*r.worldSize,w*r.worldSize,0];$.transformMat4(C,C,l),h=Js(h,C,u)}return $.transformMat4(h,h,o)}_makeGlobeTileDebugBorderBuffer(e,n,i,r,o,l){let u=new $r,h=new Ad,p=new ap,m=(y,v,b,w,C)=>{let E=(b-y)/(C-1),I=(w-v)/(C-1),D=u.length;for(let S=0;S<C;S++){let M=y+S*E,A=v+S*I;u.emplaceBack(M,A);let R=this._globePoint(M,A,n,i,r,o,l);p.emplaceBack(R[0],R[1],R[2]),h.emplaceBack(D+S)}},_=le;m(0,0,_,0,16),m(_,0,_,_,16),m(_,_,0,_,16),m(0,_,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(h),this._tileDebugBuffer=e.createVertexBuffer(u,Oa.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(p,NI.members),this._tileDebugSegments=yn.simpleSegment(0,0,u.length,h.length)}_makeGlobeTileDebugTextBuffer(e,n,i,r,o,l){let u=le/4,h=new $r,p=new xi,m=new ap,_=25;p.reserve(32),h.reserve(_),m.reserve(_);let y=(v,b)=>_*v+b;for(let v=0;v<_;v++){let b=v*u;for(let w=0;w<_;w++){let C=w*u;h.emplaceBack(C,b);let E=this._globePoint(C,b,n,i,r,o,l);m.emplaceBack(E[0],E[1],E[2])}}for(let v=0;v<4;v++)for(let b=0;b<4;b++){let w=y(v,b),C=y(v,b+1),E=y(v+1,b),I=y(v+1,b+1);p.emplaceBack(w,C,E),p.emplaceBack(E,C,I)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(p),this._tileDebugTextBuffer=e.createVertexBuffer(h,Oa.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(m,NI.members),this._tileDebugTextSegments=yn.simpleSegment(0,0,_,32)}destroy(e=!1){for(let n in this.buckets)this.buckets[n].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!e&&this.texture&&this.texture instanceof Zn&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.latestFeatureIndex=null,this.state="unloaded"}}class fB{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(let e in this.data)for(let n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,i){let r=e.wrapped().key;this.data[r]===void 0&&(this.data[r]=[]);let o={value:n,timeout:void 0};if(i!==void 0&&(o.timeout=setTimeout(()=>{this.remove(e,o)},i)),this.data[r].push(o),this.order.push(r),this.order.length>this.max){let l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){let n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),this.data[e].length===0&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){let n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;let i=e.wrapped().key,r=n===void 0?0:this.data[i].indexOf(n),o=this.data[i][r];return this.data[i].splice(r,1),o.timeout&&clearTimeout(o.timeout),this.data[i].length===0&&delete this.data[i],this.onRemove(o.value),this.order.splice(this.order.indexOf(i),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){let n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){let n=[];for(let i in this.data)for(let r of this.data[i])e(r.value)||n.push(r);for(let i of n)this.remove(i.value.tileID,i)}}let bD=(()=>{class t{constructor(n,i,r,o){this.id=t.uniqueIdxCounter,t.uniqueIdxCounter++,this.context=n;let l=n.gl;this.buffer=l.createBuffer(),this.dynamicDraw=!!r,this.context.unbindVAO(),n.bindElementBuffer.set(this.buffer),l.bufferData(l.ELEMENT_ARRAY_BUFFER,i.arrayBuffer,this.dynamicDraw?l.DYNAMIC_DRAW:l.STATIC_DRAW),this.dynamicDraw||o||i.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(n){this.id=t.uniqueIdxCounter,t.uniqueIdxCounter++;let i=this.context.gl;this.context.unbindVAO(),this.bind(),i.bufferSubData(i.ELEMENT_ARRAY_BUFFER,0,n.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}return t.uniqueIdxCounter=0,t})(),pB={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class mB{constructor(e,n,i,r,o,l){this.length=n.length,this.attributes=i,this.itemSize=n.bytesPerElement,this.dynamicDraw=r,this.instanceCount=l,this.context=e;let u=e.gl;this.buffer=u.createBuffer(),e.bindVertexBuffer.set(this.buffer),u.bufferData(u.ARRAY_BUFFER,n.arrayBuffer,this.dynamicDraw?u.DYNAMIC_DRAW:u.STATIC_DRAW),this.dynamicDraw||o||n.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){let n=this.context.gl;this.bind(),n.bufferSubData(n.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,n){for(let i=0;i<this.attributes.length;i++){let r=n.attributes[this.attributes[i].name];r!==void 0&&e.enableVertexAttribArray(r)}}setVertexAttribPointers(e,n,i){for(let r=0;r<this.attributes.length;r++){let o=this.attributes[r],l=n.attributes[o.name];l!==void 0&&e.vertexAttribPointer(l,o.components,e[pB[o.type]],!1,this.itemSize,o.offset+this.itemSize*(i||0))}}setVertexAttribDivisor(e,n,i){for(let r=0;r<this.attributes.length;r++){let o=n.attributes[this.attributes[r].name];o!==void 0&&this.instanceCount&&this.instanceCount>0&&e.vertexAttribDivisor(o,i)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class zn{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class gB extends zn{getDefault(){return Rt.transparent}set(e){let n=this.current;(e.r!==n.r||e.g!==n.g||e.b!==n.b||e.a!==n.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class _B extends zn{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class yB extends zn{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class vB extends zn{getDefault(){return[!0,!0,!0,!0]}set(e){let n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||e[3]!==n[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class xB extends zn{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class bB extends zn{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class wB extends zn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){let n=this.current;(e.func!==n.func||e.ref!==n.ref||e.mask!==n.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class CB extends zn{getDefault(){let e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){let n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class EB extends zn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;e?n.enable(n.STENCIL_TEST):n.disable(n.STENCIL_TEST),this.current=e,this.dirty=!1}}class TB extends zn{getDefault(){return[0,1]}set(e){let n=this.current;(e[0]!==n[0]||e[1]!==n[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class IB extends zn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;e?n.enable(n.DEPTH_TEST):n.disable(n.DEPTH_TEST),this.current=e,this.dirty=!1}}class MB extends zn{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class DB extends zn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;e?n.enable(n.BLEND):n.disable(n.BLEND),this.current=e,this.dirty=!1}}class SB extends zn{getDefault(){let e=this.gl;return[e.ONE,e.ZERO,e.ONE,e.ZERO]}set(e){let n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||e[3]!==n[3]||this.dirty)&&(this.gl.blendFuncSeparate(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class AB extends zn{getDefault(){return Rt.transparent}set(e){let n=this.current;(e.r!==n.r||e.g!==n.g||e.b!==n.b||e.a!==n.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class PB extends zn{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(e,e),this.current=e,this.dirty=!1)}}class RB extends zn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;e?n.enable(n.CULL_FACE):n.disable(n.CULL_FACE),this.current=e,this.dirty=!1}}class OB extends zn{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class FB extends zn{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}let kB=class extends zn{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}};class LB extends zn{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class NB extends zn{getDefault(){let e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){let n=this.current;(e[0]!==n[0]||e[1]!==n[1]||e[2]!==n[2]||e[3]!==n[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class zB extends zn{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;n.bindFramebuffer(n.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class BB extends zn{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;n.bindRenderbuffer(n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class VB extends zn{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;n.bindTexture(n.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class jB extends zn{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;n.bindBuffer(n.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class UB extends zn{getDefault(){return null}set(e){let n=this.gl;n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class $B extends zn{getDefault(){return null}set(e){this.gl&&(e!==this.current||this.dirty)&&(this.gl.bindVertexArray(e),this.current=e,this.dirty=!1)}}class GB extends zn{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;n.pixelStorei(n.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class HB extends zn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class qB extends zn{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;let n=this.gl;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Yv extends zn{constructor(e,n){super(e),this.context=e,this.parent=n}getDefault(){return null}}class WB extends Yv{setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class wD extends Yv{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let n=this.gl;n.framebufferRenderbuffer(n.FRAMEBUFFER,this.attachment(),n.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class ZB extends Yv{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);let n=this.gl;n.framebufferTexture2D(n.FRAMEBUFFER,this.attachment(),n.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class XB extends wD{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class YB{constructor(e,n,i,r,o){this.context=e,this.width=n,this.height=i;let l=this.framebuffer=e.gl.createFramebuffer();r&&(this.colorAttachment=new WB(e,l)),o&&(this.depthAttachmentType=o,this.depthAttachment=o==="renderbuffer"?new wD(e,l):new ZB(e,l))}destroy(){let e=this.context.gl;if(this.colorAttachment){let n=this.colorAttachment.get();n&&e.deleteTexture(n)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){let n=this.depthAttachment.get();n&&e.deleteRenderbuffer(n)}else{let n=this.depthAttachment.get();n&&e.deleteTexture(n)}e.deleteFramebuffer(this.framebuffer)}}class at{constructor(e,n,i){this.func=e,this.mask=n,this.range=i}}at.ReadOnly=!1,at.ReadWrite=!0,at.disabled=new at(519,at.ReadOnly,[0,1]);let Kv=7680;class Ot{constructor(e,n,i,r,o,l){this.test=e,this.ref=n,this.mask=i,this.fail=r,this.depthFail=o,this.pass=l}}Ot.disabled=new Ot({func:519,mask:0},0,0,Kv,Kv,Kv);let om=771;class Xt{constructor(e,n,i,r){this.blendFunction=e,this.blendColor=n,this.mask=i,this.blendEquation=r}}Xt.Replace=[1,0,1,0],Xt.disabled=new Xt(Xt.Replace,Rt.transparent,[!1,!1,!1,!1]),Xt.unblended=new Xt(Xt.Replace,Rt.transparent,[!0,!0,!0,!0]),Xt.alphaBlended=new Xt([1,om,1,om],Rt.transparent,[!0,!0,!0,!0]),Xt.multiply=new Xt([774,0,774,0],Rt.transparent,[!0,!0,!0,!0]);let Jv=1029,Qv=2305;class kt{constructor(e,n,i){this.enable=e,this.mode=n,this.frontFace=i}}kt.disabled=new kt(!1,Jv,Qv),kt.backCCW=new kt(!0,Jv,Qv),kt.backCW=new kt(!0,Jv,2304),kt.frontCW=new kt(!0,1028,2304),kt.frontCCW=new kt(!0,1028,Qv);class KB{constructor(e,n){this.gl=e,this.clearColor=new gB(this),this.clearDepth=new _B(this),this.clearStencil=new yB(this),this.colorMask=new vB(this),this.depthMask=new xB(this),this.stencilMask=new bB(this),this.stencilFunc=new wB(this),this.stencilOp=new CB(this),this.stencilTest=new EB(this),this.depthRange=new TB(this),this.depthTest=new IB(this),this.depthFunc=new MB(this),this.blend=new DB(this),this.blendFunc=new SB(this),this.blendColor=new AB(this),this.blendEquation=new PB(this),this.cullFace=new RB(this),this.cullFaceSide=new OB(this),this.frontFace=new FB(this),this.program=new kB(this),this.activeTexture=new LB(this),this.viewport=new NB(this),this.bindFramebuffer=new zB(this),this.bindRenderbuffer=new BB(this),this.bindTexture=new VB(this),this.bindVertexBuffer=new jB(this),this.bindElementBuffer=new UB(this),this.bindVertexArrayOES=new $B(this),this.pixelStoreUnpack=new GB(this),this.pixelStoreUnpackPremultiplyAlpha=new HB(this),this.pixelStoreUnpackFlipY=new qB(this),this.options=n?rt({},n):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=e.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=e.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=e.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=e.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=e.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=e.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,n,i){return new bD(this,e,n,i)}createVertexBuffer(e,n,i,r,o){return new mB(this,e,n,i,r,o)}createRenderbuffer(e,n,i){let r=this.gl,o=r.createRenderbuffer();return this.bindRenderbuffer.set(o),r.renderbufferStorage(r.RENDERBUFFER,e,n,i),this.bindRenderbuffer.set(null),o}createFramebuffer(e,n,i,r){return new YB(this,e,n,i,r)}clear({color:e,depth:n,stencil:i,colorMask:r}){let o=this.gl,l=0;e&&(l|=o.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set(r||[!0,!0,!0,!0])),n!==void 0&&(l|=o.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),i!==void 0&&(l|=o.STENCIL_BUFFER_BIT,this.clearStencil.set(i),this.stencilMask.set(255)),o.clear(l)}setCullFace(e){e.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(e){Wt(e.blendFunction,Xt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor),e.blendEquation?this.blendEquation.set(e.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(e.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}class Ko extends yi{constructor(e,n,i){super(),this.id=e,this._onlySymbols=i,n.on("data",r=>{r.dataType==="source"&&r.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&r.dataType==="source"&&r.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new fB(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this._coveredTiles={},this._shadowCasterTiles={},this._state=new gz,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(e){this.map=e,this._minTileCacheSize=this._minTileCacheSize===void 0&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(let e in this._tiles){let n=this._tiles[e];if(n.state!=="errored"&&(n.state!=="loaded"||!n.bucketsLoaded()))return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;let e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,n){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,n)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(let n in this._tiles){let i=this._tiles[n];i.upload(e),i.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return xl(this._tiles).map(e=>e.tileID).sort(CD).map(e=>e.key)}getRenderableIds(e,n){let i=[];for(let r in this._tiles)this._isIdRenderable(+r,e,n)&&i.push(this._tiles[r]);return e?i.sort((r,o)=>{let l=r.tileID,u=o.tileID,h=new Q(l.canonical.x,l.canonical.y)._rotate(this.transform.angle),p=new Q(u.canonical.x,u.canonical.y)._rotate(this.transform.angle);return l.overscaledZ-u.overscaledZ||p.y-h.y||p.x-h.x}).map(r=>r.tileID.key):i.map(r=>r.tileID).sort(CD).map(r=>r.key)}hasRenderableParent(e){let n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n,i){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())&&(i||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(let e in this._tiles)this._tiles[e].state!=="errored"&&this._reloadTile(+e,"reloading")}}_reloadTile(e,n){let i=this._tiles[e];i&&(i.state!=="loading"&&(i.state=n),this._loadTile(i,this._tileLoaded.bind(this,i,e,n)))}_tileLoaded(e,n,i,r){if(r)if(e.state="errored",r.status!==404)this._source.fire(new mt(r,{tile:e}));else{if(!(e.tileID.key in this._loadedParentTiles))return void this._source.fire(new Ce("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id}));if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){let o=this.map.painter.terrain;this.update(this.transform,o.getScaledDemTileSize(),!0),o.resetTileLookupCache(this.id)}else this.update(this.transform)}else e.timeAdded=yt.now(),i==="expired"&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),this._source.type==="raster-dem"&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Ce("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){let n=this.getRenderableIds();for(let r=0;r<n.length;r++){let o=n[r];if(e.neighboringTiles&&e.neighboringTiles[o]){let l=this.getTileByID(o);i(e,l),i(l,e)}}function i(r,o){if(!r.dem||r.dem.borderReady)return;r.needsHillshadePrepare=!0,r.needsDEMTextureUpload=!0;let l=o.tileID.canonical.x-r.tileID.canonical.x,u=o.tileID.canonical.y-r.tileID.canonical.y,h=Math.pow(2,r.tileID.canonical.z),p=o.tileID.key;l===0&&u===0||Math.abs(u)>1||(Math.abs(l)>1&&(Math.abs(l+h)===1?l+=h:Math.abs(l-h)===1&&(l-=h)),o.dem&&r.dem&&(r.dem.backfillBorder(o.dem,l,u),r.neighboringTiles&&r.neighboringTiles[p]&&(r.neighboringTiles[p].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,i,r){for(let o in this._tiles){let l=this._tiles[o];if(r[o]||!l.hasData()||l.tileID.overscaledZ<=n||l.tileID.overscaledZ>i)continue;let u=l.tileID;for(;l&&l.tileID.overscaledZ>n+1;){let p=l.tileID.scaledTo(l.tileID.overscaledZ-1);l=this._tiles[p.key],l&&l.hasData()&&(u=p)}let h=u;for(;h.overscaledZ>n;)if(h=h.scaledTo(h.overscaledZ-1),e[h.key]){r[u.key]=u;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){let i=this._loadedParentTiles[e.key];return i&&i.tileID.overscaledZ>=n?i:null}for(let i=e.overscaledZ-1;i>=n;i--){let r=e.scaledTo(i),o=this._getLoadedTile(r);if(o)return o}}_getLoadedTile(e){let n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,n){n=n||this._source.tileSize;let i=Math.ceil(e.width/n)+1,r=Math.ceil(e.height/n)+1,o=Math.floor(i*r*5),l=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,o):o,u=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,l):l;this._cache.setMaxSize(u)}handleWrapJump(e){let n=Math.round((e-(this._prevLng===void 0?e:this._prevLng))/360);if(this._prevLng=e,n){let i={};for(let r in this._tiles){let o=this._tiles[r];o.tileID=o.tileID.unwrapTo(o.tileID.wrap+n),i[o.tileID.key]=o}this._tiles=i;for(let r in this._timers)clearTimeout(this._timers[r]),delete this._timers[r];for(let r in this._tiles)this._setTileReloadTimer(+r,this._tiles[r])}}update(e,n,i,r){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!i)return;let o;if(this.updateCacheSize(e,n),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?o=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(h=>new Jt(h.canonical.z,h.wrap,h.canonical.z,h.canonical.x,h.canonical.y)):(o=e.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!i,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(o=o.filter(h=>this._source.hasTile(h)))):o=[],o.length>0&&this.castsShadows&&r&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!ex(this._source.type)){let h=e.coveringZoomLevel({tileSize:n||this._source.tileSize,roundZoom:this._source.roundZoom&&!i}),p=Math.min(h,this._source.maxzoom),m=e.extendTileCoverForShadows(o,r,p);for(let _ of m)this._shadowCasterTiles[_.key]=!0,o.push(_)}let l=this._updateRetainedTiles(o);if(ex(this._source.type)&&o.length!==0){let h={},p={},m=Object.keys(l);for(let y of m){let v=l[y],b=this._tiles[y];if(!b||b.fadeEndTime&&b.fadeEndTime<=yt.now())continue;let w=this.findLoadedParent(v,Math.max(v.overscaledZ-Ko.maxOverzooming,this._source.minzoom));w&&(this._addTile(w.tileID),h[w.tileID.key]=w.tileID),p[y]=v}let _=o[o.length-1].overscaledZ;for(let y in this._tiles){let v=this._tiles[y];if(l[y]||!v.hasData())continue;let b=v.tileID;for(;b.overscaledZ>_;){b=b.scaledTo(b.overscaledZ-1);let w=this._tiles[b.key];if(w&&w.hasData()&&p[b.key]){l[y]=v.tileID;break}}}for(let y in h)l[y]||(this._coveredTiles[y]=!0,l[y]=h[y])}for(let h in l)this._tiles[h].clearFadeHold();let u=function(h,p){let m=[];for(let _ in h)_ in p||m.push(_);return m}(this._tiles,l);for(let h of u){let p=this._tiles[h];p.hasSymbolBuckets&&!p.holdingForFade()?p.setHoldDuration(this.map._fadeDuration):p.hasSymbolBuckets&&!p.symbolFadeFinished()||this._removeTile(+h)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(let e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){let n={};if(e.length===0)return n;let i={},r=e.reduce((p,m)=>Math.min(p,m.overscaledZ),1/0),o=e[0].overscaledZ,l=Math.max(o-Ko.maxOverzooming,this._source.minzoom),u=Math.max(o+Ko.maxUnderzooming,this._source.minzoom),h={};for(let p of e){let m=this._addTile(p);n[p.key]=p,m.hasData()||r<this._source.maxzoom&&(h[p.key]=p)}this._retainLoadedChildren(h,r,u,n);for(let p of e){let m=this._tiles[p.key];if(m.hasData())continue;if(p.canonical.z>=this._source.maxzoom){let y=p.children(this._source.maxzoom)[0],v=this.getTile(y);if(v&&v.hasData()){n[y.key]=y;continue}}else{let y=p.children(this._source.maxzoom);if(n[y[0].key]&&n[y[1].key]&&n[y[2].key]&&n[y[3].key])continue}let _=m.wasRequested();for(let y=p.overscaledZ-1;y>=l;--y){let v=p.scaledTo(y);if(i[v.key]||(i[v.key]=!0,m=this.getTile(v),!m&&_&&(m=this._addTile(v)),m&&(n[v.key]=v,_=m.wasRequested(),m.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(let e in this._tiles){let n=[],i,r=this._tiles[e].tileID;for(;r.overscaledZ>0;){if(r.key in this._loadedParentTiles){i=this._loadedParentTiles[r.key];break}n.push(r.key);let o=r.scaledTo(r.overscaledZ-1);if(i=this._getLoadedTile(o),i)break;r=o}for(let o of n)this._loadedParentTiles[o]=i}}_addTile(e){let n=this._tiles[e.key];if(n)return n.isExtraShadowCaster!==!0||this._shadowCasterTiles[e.key]||this._reloadTile(e.key,"reloading"),n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));let i=!!n;if(!i){let r=this.map?this.map.painter:null;n=new Jd(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,r,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))}return n?(n.uses++,this._tiles[e.key]=n,i||this._source.fire(new Ce("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);let i=n.getExpiryTimeout();i&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},i))}_removeTile(e){let n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&n.state!=="reloading"?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(let e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,n,i){let r=[],o=this.transform;if(!o)return r;let l=o.projection.name==="globe",u=Ii(o.center.lng);for(let h in this._tiles){let p=this._tiles[h];if(i&&p.clearQueryDebugViz(),p.holdingForFade())continue;let m;if(l){let _=p.tileID.canonical;if(_.z===0){let y=[Math.abs(We(u,...Qd(_,-1))-u),Math.abs(We(u,...Qd(_,1))-u)];m=[0,2*y.indexOf(Math.min(...y))-1]}else{let y=[Math.abs(We(u,...Qd(_,-1))-u),Math.abs(We(u,...Qd(_,0))-u),Math.abs(We(u,...Qd(_,1))-u)];m=[y.indexOf(Math.min(...y))-1]}}else m=[0];for(let _ of m){let y=e.containsTile(p,o,n,_);y&&r.push(y)}}return r}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,n){let i=this.getRenderableIds(e,n).map(o=>this._tiles[o].tileID),r=this.transform.projection.name==="globe";for(let o of i)o.projMatrix=this.transform.calculateProjMatrix(o.toUnwrapped()),o.expandedProjMatrix=r?this.transform.calculateProjMatrix(o.toUnwrapped(),!1,!0):o.projMatrix;return i}sortCoordinatesByDistance(e){let n=e.slice(),i=this.transform._camera.position,r=this.transform._camera.forward(),o={};for(let l of n){let u=1/(1<<l.canonical.z);o[l.key]=((l.canonical.x+.5)*u+l.wrap-i[0])*r[0]+((l.canonical.y+.5)*u-i[1])*r[1]-i[2]*r[2]}return n.sort((l,u)=>o[l.key]-o[u.key]),n}hasTransition(){if(this._source.hasTransition())return!0;if(ex(this._source.type))for(let e in this._tiles){let n=this._tiles[e];if(n.fadeEndTime!==void 0&&n.fadeEndTime>=yt.now())return!0}return!1}setFeatureState(e,n,i){this._state.updateState(e=e||"_geojsonTileLayer",n,i)}removeFeatureState(e,n,i){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,i)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,i){let r=this._tiles[e];r&&r.setDependencies(n,i)}reloadTilesForDependencies(e,n){for(let i in this._tiles)this._tiles[i].hasDependency(e,n)&&this._reloadTile(+i,"reloading");this._cache.filter(i=>!i.hasDependency(e,n))}_preloadTiles(e,n){if(!this._sourceLoaded){let u=()=>{this._sourceLoaded&&(this._source.off("data",u),this._preloadTiles(e,n))};return void this._source.on("data",u)}let i=new Map,r=Array.isArray(e)?e:[e],o=this.map.painter.terrain,l=this.usedForTerrain&&o?o.getScaledDemTileSize():this._source.tileSize;for(let u of r){let h=u.coveringTiles({tileSize:l,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(let p of h)i.set(p.key,p);this.usedForTerrain&&u.updateElevation(!1)}vl(Array.from(i.values()),(u,h)=>{let p=new Jd(u,this._source.tileSize*u.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(p,m=>{this._source.type==="raster-dem"&&p.dem&&this._backfillDEM(p),h(m,p)})},n)}}function CD(t,e){let n=Math.abs(2*t.wrap)-+(t.wrap<0),i=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||i-n||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function ex(t){return t==="raster"||t==="image"||t==="video"||t==="custom"}function Qd(t,e){let n=1<<t.z;return[t.x/n+e,(t.x+1)/n+e]}Ko.maxOverzooming=10,Ko.maxUnderzooming=3;let JB=ln([{name:"a_pos_3f",components:3,type:"Float32"}]),QB=ln([{name:"a_color_3f",components:3,type:"Float32"}]),e4=ln([{name:"a_color_4f",components:4,type:"Float32"}]),t4=ln([{name:"a_uv_2f",components:2,type:"Float32"}]),n4=ln([{name:"a_normal_3f",components:3,type:"Float32"}]),i4=ln([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),r4=ln([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);class tx{constructor(e=0,n=0,i=0,r=0){if(isNaN(e)||e<0||isNaN(n)||n<0||isNaN(i)||i<0||isNaN(r)||r<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=n,this.left=i,this.right=r}interpolate(e,n,i){return n.top!=null&&e.top!=null&&(this.top=ft(e.top,n.top,i)),n.bottom!=null&&e.bottom!=null&&(this.bottom=ft(e.bottom,n.bottom,i)),n.left!=null&&e.left!=null&&(this.left=ft(e.left,n.left,i)),n.right!=null&&e.right!=null&&(this.right=ft(e.right,n.right,i)),this}getCenter(e,n){let i=We((this.left+e-this.right)/2,0,e),r=We((this.top+n-this.bottom)/2,0,n);return new Q(i,r)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new tx(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ED(t,e){let n=ei(t,3);ne.fromQuat(t,e),Ui(t,3,n)}function nx(t,e){let n=Xi.identity([]);return Xi.rotateZ(n,n,-e),Xi.rotateX(n,n,-t),n}function TD(t,e){let n=[t[0],t[1],0],i=[e[0],e[1],0];if($.length(n)>=1e-15){let l=$.normalize([],n);$.scale(i,l,$.dot(i,l)),e[0]=i[0],e[1]=i[1]}let r=$.cross([],e,t);if($.len(r)<1e-15)return null;let o=Math.atan2(-r[1],r[0]);return nx(Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2]),o)}class ID{constructor(e,n){this.position=e,this.orientation=n}get position(){return this._position}set position(e){if(e){let n=e instanceof Gt?e:new Gt(e[0],e[1],e[2]);this._renderWorldCopies&&(n.x=hs(n.x,0,1)),this._position=n}else this._position=null}lookAtPoint(e,n){if(this.orientation=null,!this.position)return;let i=this.position,r=this._elevation?this._elevation.getAtPointOrZero(Gt.fromLngLat(e)):0,o=Gt.fromLngLat(e,r),l=[o.x-i.x,o.y-i.y,o.z-i.z];n||(n=[0,0,1]),n[2]=Math.abs(n[2]),this.orientation=TD(l,n)}setPitchBearing(e,n){this.orientation=nx(Tt(e),Tt(-n))}}class sm{constructor(e,n){this._transform=ne.identity([]),this.orientation=n,this.position=e}get mercatorPosition(){let e=this.position;return new Gt(e[0],e[1],e[2])}get position(){let e=ei(this._transform,3);return[e[0],e[1],e[2]]}set position(e){var n;e&&Ui(this._transform,3,[(n=e)[0],n[1],n[2],1])}get orientation(){return this._orientation}set orientation(e){this._orientation=e||Xi.identity([]),e&&ED(this._transform,this._orientation)}getPitchBearing(){let e=this.forward(),n=this.right();return{bearing:Math.atan2(-n[1],n[0]),pitch:Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2])}}setPitchBearing(e,n){this._orientation=nx(e,n),ED(this._transform,this._orientation)}forward(){let e=ei(this._transform,2);return[-e[0],-e[1],-e[2]]}up(){let e=ei(this._transform,1);return[-e[0],-e[1],-e[2]]}right(){let e=ei(this._transform,0);return[e[0],e[1],e[2]]}getCameraToWorld(e,n){let i=new Float64Array(16);return ne.invert(i,this.getWorldToCamera(e,n)),i}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(e,n,i){let r=this.position;$.scale(r,r,-e);let o=new Float64Array(16);return ne.fromScaling(o,[i,i,i]),ne.translate(o,o,r),o[10]*=n,o}getWorldToCamera(e,n){let i=new Float64Array(16),r=new Float64Array(4),o=this.position;return Xi.conjugate(r,this._orientation),$.scale(o,o,-e),ne.fromQuat(i,r),ne.translate(i,i,o),i[1]*=-1,i[5]*=-1,i[9]*=-1,i[13]*=-1,i[8]*=n,i[9]*=n,i[10]*=n,i[11]*=n,i}getCameraToClipPerspective(e,n,i,r){let o=new Float64Array(16);return ne.perspective(o,e,n,i,r),o}getCameraToClipOrthographic(e,n,i,r,o,l){let u=new Float64Array(16);return ne.ortho(u,e,n,i,r,o,l),u}getDistanceToElevation(e,n=!1){let i=e===0?0:Cn(e,n?bi(this.position[1]):this.position[1]),r=this.forward();return(i-this.position[2])/r[2]}clone(){return new sm([...this.position],[...this.orientation])}}function MD(t,e){let n=eh(t.projection,t.zoom,t.width,t.height),i=function(o,l,u,h,p){let m=new pt(u.lng-180*qa,u.lat),_=new pt(u.lng+180*qa,u.lat),y=o.project(m.lng,m.lat),v=o.project(_.lng,_.lat),b=-Math.atan2(v.y-y.y,v.x-y.x),w=Gt.fromLngLat(u);w.y=We(w.y,-1+qa,1-qa);let C=w.toLngLat(),E=o.project(C.lng,C.lat),I=Gt.fromLngLat(C);I.x+=qa;let D=I.toLngLat(),S=o.project(D.lng,D.lat),M=AD(S.x-E.x,S.y-E.y,b),A=Gt.fromLngLat(C);A.y+=qa;let R=A.toLngLat(),F=o.project(R.lng,R.lat),k=AD(F.x-E.x,F.y-E.y,b),L=Math.abs(M.x)/Math.abs(k.y),z=ne.identity([]);ne.rotateZ(z,z,-b*(1-(p?0:h)));let B=ne.identity([]);return ne.scale(B,B,[1,1-(1-L)*h,1]),B[4]=-k.x/k.y*h,ne.rotateZ(B,B,b),ne.multiply(B,z,B),B}(t.projection,0,t.center,n,e),r=DD(t);return ne.scale(i,i,[r,r,1]),i}function DD(t){let e=t.projection,n=eh(t.projection,t.zoom,t.width,t.height),i=SD(e,t.center),r=SD(e,pt.convert(e.center));return Math.pow(2,i*n+(1-n)*r)}function eh(t,e,n,i,r=1/0){let o=t.range;if(!o)return 0;let l=Math.min(r,Math.max(n,i)),u=Math.log(l/1024)/Math.LN2;return ds(o[0]+u,o[1]+u,e)}let qa=1/4e4;function SD(t,e){let n=We(e.lat,-si,si),i=new pt(e.lng-180*qa,n),r=new pt(e.lng+180*qa,n),o=t.project(i.lng,n),l=t.project(r.lng,n),u=Gt.fromLngLat(i),h=Gt.fromLngLat(r),p=l.x-o.x,m=l.y-o.y,_=h.x-u.x,y=h.y-u.y,v=Math.sqrt((_*_+y*y)/(p*p+m*m));return Math.log(v)/Math.LN2}function AD(t,e,n){let i=Math.cos(n),r=Math.sin(n);return{x:t*i-e*r,y:t*r+e*i}}function Bl(t,e,n){return e*(le/(t.tileSize*Math.pow(2,n-t.tileID.overscaledZ)))}let lu={unknown:0,flipRequired:1,flipNotRequired:2},o4=Math.tan(85*Math.PI/180);function am(t,e,n,i,r,o,l){let u=ne.create();if(n)if(o.name==="globe"){let h=function(p,m){let{x:_,y}=p.point,v=ZI(_,y,p.worldSize/p._pixelsPerMercatorPixel,0,0);return ne.multiply(v,v,mv(so(m)))}(r,e);ne.multiply(u,u,h)}else{let h=Hc.invert([],l);u[0]=h[0],u[1]=h[1],u[4]=h[2],u[5]=h[3],i||ne.rotateZ(u,u,r.angle)}else ne.multiply(u,r.labelPlaneMatrix,t);return u}function PD(t,e,n,i,r,o,l){let u=am(t,e,n,i,r,o,l);return o.name==="globe"&&n||(u[2]=u[6]=u[10]=u[14]=0),u}function RD(t,e,n,i,r,o,l){if(n){if(o.name==="globe"){let u=am(t,e,n,i,r,o,l);return ne.invert(u,u),ne.multiply(u,t,u),u}{let u=ne.clone(t),h=ne.identity([]);return h[0]=l[0],h[1]=l[1],h[4]=l[2],h[5]=l[3],ne.multiply(u,u,h),i||ne.rotateZ(u,u,-r.angle),u}}return r.glCoordMatrix}function Jo(t,e,n,i){let r=[t,e,n,1];n?vn.transformMat4(r,r,i):BD(r,r,i);let o=r[3];return r[0]/=o,r[1]/=o,r[2]/=o,r}function OD(t,e){return Math.min(.5+t/e*.5,1.5)}function s4(t,e){let n=t[0]/t[3],i=t[1]/t[3];return n>=-e[0]&&n<=e[0]&&i>=-e[1]&&i<=e[1]}function a4(t,e,n,i,r,o,l,u,h,p){let m=n.transform,_=i?t.textSizeData:t.iconSizeData,y=xs(_,n.transform.zoom),v=m.projection.name==="globe",b=[256/n.width*2+1,256/n.height*2+1],w=i?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;w.clear();let C=null;v&&(C=i?t.text.globeExtVertexArray:t.icon.globeExtVertexArray);let E=t.lineVertexArray,I=i?t.text.placedSymbolArray:t.icon.placedSymbolArray,D=n.transform.width/n.transform.height,S,M=!1;for(let A=0;A<I.length;A++){let R=I.get(A),{numGlyphs:F,writingMode:k}=R;if(k!==jn.vertical||M||S===jn.horizontal||(M=!0),S=k,(R.hidden||k===jn.vertical)&&!M){cu(F,w);continue}M=!1;let L=new Q(R.tileAnchorX,R.tileAnchorY),{x:z,y:B,z:G}=m.projection.projectTilePoint(L.x,L.y,p.canonical);if(h){let[ue,de,pe]=h(L);z+=ue,B+=de,G+=pe}let N=[z,B,G,1];if(vn.transformMat4(N,N,e),!s4(N,b)){cu(F,w);continue}let W=N[3],Y=OD(n.transform.getCameraToCenterDistance(m.projection),W),te=Ud(_,y,R),q=l?te/Y:te*Y,X=Jo(z,B,G,r);if(X[3]<=0){cu(F,w);continue}let re={},se=l?null:h,oe=LD(R,q,!1,u,e,r,o,t.glyphOffsetArray,E,w,C,X,L,re,D,se,m.projection,p,l);M=oe.useVertical,se&&oe.needsFlipping&&(re={}),(oe.notEnoughRoom||M||oe.needsFlipping&&LD(R,q,!0,u,e,r,o,t.glyphOffsetArray,E,w,C,X,L,re,D,se,m.projection,p,l).notEnoughRoom)&&cu(F,w)}i?(t.text.dynamicLayoutVertexBuffer.updateData(w),C&&t.text.globeExtVertexBuffer&&t.text.globeExtVertexBuffer.updateData(C)):(t.icon.dynamicLayoutVertexBuffer.updateData(w),C&&t.icon.globeExtVertexBuffer&&t.icon.globeExtVertexBuffer.updateData(C))}function FD(t,e,n,i,r,o,l,u,h,p,m,_,y,v,b,w){let{lineStartIndex:C,glyphStartIndex:E,segment:I}=u,D=E+u.numGlyphs,S=C+u.lineLength,M=e.getoffsetX(E),A=e.getoffsetX(D-1),R=lm(t*M,n,i,r,o,l,I,C,S,h,p,m,_,y,!0,v,b,w);if(!R)return null;let F=lm(t*A,n,i,r,o,l,I,C,S,h,p,m,_,y,!0,v,b,w);return F?{first:R,last:F}:null}function kD(t,e,n,i){return t===jn.horizontal&&Math.abs(i)>Math.abs(n)?{useVertical:!0}:t===jn.vertical?i>0?{needsFlipping:!0}:null:e!==lu.unknown&&function(r,o){return r===0||Math.abs(o/r)>o4}(n,i)?e===lu.flipRequired?{needsFlipping:!0}:null:n<0?{needsFlipping:!0}:null}function LD(t,e,n,i,r,o,l,u,h,p,m,_,y,v,b,w,C,E,I){let D=e/24,S=t.lineOffsetX*D,M=t.lineOffsetY*D,{lineStartIndex:A,glyphStartIndex:R,numGlyphs:F,segment:k,writingMode:L,flipState:z}=t,B=A+t.lineLength,G=N=>{if(m){let[q,X,re]=N.up,se=p.length;em(m,se+0,q,X,re),em(m,se+1,q,X,re),em(m,se+2,q,X,re),em(m,se+3,q,X,re)}let[W,Y,te]=N.point;au(p,W,Y,te,N.angle)};if(F>1){let N=FD(D,u,S,M,n,_,y,t,h,o,v,w,!1,C,E,I);if(!N)return{notEnoughRoom:!0};if(i&&!n){let[W,Y,te]=N.first.point,[q,X,re]=N.last.point;[W,Y]=Jo(W,Y,te,l),[q,X]=Jo(q,X,re,l);let se=kD(L,z,(q-W)*b,X-Y);if(t.flipState=se&&se.needsFlipping?lu.flipRequired:lu.flipNotRequired,se)return se}G(N.first);for(let W=R+1;W<R+F-1;W++){let Y=lm(D*u.getoffsetX(W),S,M,n,_,y,k,A,B,h,o,v,w,!1,!1,C,E,I);if(!Y)return p.length-=4*(W-R),{notEnoughRoom:!0};G(Y)}G(N.last)}else{if(i&&!n){let W=Jo(y.x,y.y,0,r),Y=A+k+1,te=new Q(h.getx(Y),h.gety(Y)),q=Jo(te.x,te.y,0,r),X=q[3]>0?q:zD(y,te,W,1,r,void 0,C,E.canonical),re=kD(L,z,(X[0]-W[0])*b,X[1]-W[1]);if(t.flipState=re&&re.needsFlipping?lu.flipRequired:lu.flipNotRequired,re)return re}let N=lm(D*u.getoffsetX(R),S,M,n,_,y,k,A,B,h,o,v,w,!1,!1,C,E,I);if(!N)return{notEnoughRoom:!0};G(N)}return{}}function ND(t,e,n,i,r){let{x:o,y:l,z:u}=i.projectTilePoint(t.x,t.y,e);if(!r)return Jo(o,l,u,n);let[h,p,m]=r(t);return Jo(o+h,l+p,u+m,n)}function zD(t,e,n,i,r,o,l,u){let h=ND(t.sub(e)._unit()._add(t),u,r,l,o);return $.sub(h,n,h),$.normalize(h,h),$.scaleAndAdd(h,n,h,i)}function lm(t,e,n,i,r,o,l,u,h,p,m,_,y,v,b,w,C,E){let I=i?t-e:t+e,D=I>0?1:-1,S=0;i&&(D*=-1,S=Math.PI),D<0&&(S+=Math.PI);let M=u+l+(D>0?0:1)|0,A=r,R=r,F=0,k=0,L=Math.abs(I),z=[],B=[],G=o,N=G,W=()=>zD(N,G,R,L-F+1,m,y,w,C.canonical);for(;F+k<=L;){if(M+=D,M<u||M>=h)return null;if(R=A,N=G,z.push(R),v&&B.push(N),G=new Q(p.getx(M),p.gety(M)),A=_[M],!A){let de=ND(G,C.canonical,m,w,y);A=de[3]>0?_[M]=de:W()}F+=k,k=$.distance(R,A)}b&&y&&(_[M]&&(A=W(),k=$.distance(R,A)),_[M]=A);let Y=(L-F)/k,te=G.sub(N)._mult(Y)._add(N),q=$.sub([],A,R),X=$.scaleAndAdd([],R,q,Y),re=[0,0,1],se=q[0],oe=q[1];if(E&&(re=w.upVector(C.canonical,te.x,te.y),re[0]!==0||re[1]!==0||re[2]!==1)){let de=[re[2],0,-re[0]],pe=$.cross([],re,de);$.normalize(de,de),$.normalize(pe,pe),se=$.dot(q,de),oe=$.dot(q,pe)}if(n){let de=$.cross([],re,q);$.normalize(de,de),$.scaleAndAdd(X,X,de,n*D)}let ue=S+Math.atan2(oe,se);return z.push(X),v&&B.push(te),{point:X,angle:ue,path:z,tilePath:B,up:re}}function cu(t,e){let n=e.length,i=n+4*t;e.resize(i),e.float32.fill(-1/0,4*n,4*i)}function BD(t,e,n){let i=e[0],r=e[1];return t[0]=n[0]*i+n[4]*r+n[12],t[1]=n[1]*i+n[5]*r+n[13],t[3]=n[3]*i+n[7]*r+n[15],t}let VD=(t,e,n)=>(1-n)*t+n*e,jD=t=>t*t*t*t*t;class ix{constructor(e,n,i,r,o,l,u){this.tileSize=512,this._renderWorldCopies=o===void 0||o,this._minZoom=e||0,this._maxZoom=n||22,this._minPitch=i??0,this._maxPitch=r??60,this.setProjection(l),this.setMaxBounds(u),this.width=0,this.height=0,this._center=new pt(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new tx,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new sm,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1}clone(){let e=new ix(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return e._elevation=this._elevation,e._centerAltitude=this._centerAltitude,e._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,e.tileSize=this.tileSize,e.mercatorFromTransition=this.mercatorFromTransition,e.width=this.width,e.height=this.height,e.cameraElevationReference=this.cameraElevationReference,e._center=this._center,e._setZoom(this.zoom),e._seaLevelZoom=this._seaLevelZoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._nearZ=this._nearZ,e._farZ=this._farZ,e._averageElevation=this._averageElevation,e._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,e._unmodified=this._unmodified,e._edgeInsets=this._edgeInsets.clone(),e._camera=this._camera.clone(),e._calcMatrices(),e.freezeTileCoverage=this.freezeTileCoverage,e.frustumCorners=this.frustumCorners,e}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<15}get elevation(){return this._elevation}set elevation(e){this._elevation!==e&&(this._elevation=e,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(e,n=!1){let i=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||i)&&this._updateCameraOnTerrain(),(e||i)&&this._constrainCamera(n),this._calcMatrices()}getProjection(){return Nr(this.projection,["name","center","parallels"])}setProjection(e){this.projectionOptions=e||{name:"mercator"};let n=this.projection?this.getProjection():void 0;this.projection=Xp(this.projectionOptions);let i=!Wt(n,this.getProjection());return i&&this._calcMatrices(),this.mercatorFromTransition=!1,i}setOrthographicProjectionAtLowPitch(e){return this._orthographicProjectionAtLowPitch!==e&&(this._orthographicProjectionAtLowPitch=e,this._calcMatrices(),!0)}setMercatorFromTransition(){let e=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=Xp({name:"mercator"});let n=e!==this.projection.name;return n&&this._calcMatrices(),n}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(e){e===void 0?e=!0:e===null&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){let e=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get cameraWorldSize(){let e=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return Cn(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new Q(this.width,this.height)}get bearing(){return hs(this.rotation,-180,180)}set bearing(e){this.rotation=e}get rotation(){return-this.angle/Math.PI*180}set rotation(e){let n=-e*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=Hc.create(),Hc.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){let n=We(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){let e=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/e)}set fov(e){e=Math.max(.01,Math.min(60,e)),this._fov!==e&&(this._unmodified=!1,this._fov=Tt(e),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(e){this._averageElevation=e,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(e){let n=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==n&&(this._unmodified=!1,this._setZoom(n),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(e){this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom}_updateCameraOnTerrain(){let e=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,n=this.elevation&&e===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||e===Number.NEGATIVE_INFINITY&&(!n||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);let i=this._elevation;n||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&i.exaggeration()&&this._centerAltitudeValidForExaggeration!==i.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*i.exaggeration(),this._centerAltitudeValidForExaggeration=i.exaggeration()):(this._centerAltitude=e||0,this._centerAltitudeValidForExaggeration=i.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){this._centerAltitudeValidForExaggeration!==void 0&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;let e=this._elevation,n=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],i=this.horizonLineFromTop(),r=0,o=0;for(let l=0;l<n.length;l++){let u=new Q(n[l][0]*this.width,i+n[l][1]*(this.height-i)),h=e.pointCoordinate(u);if(!h)continue;let p=1/Math.hypot(h[0]-this._camera.position[0],h[1]-this._camera.position[1]);r+=h[3]*p,o+=p}return o===0?NaN:r/o}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;let e=this._seaLevelZoom,n=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),i=this.pixelsPerMeter/this.worldSize*n,r=this._mercatorZfromZoom(e),o=this._mercatorZfromZoom(this._maxZoom),l=Math.max(r-i,o);this._setZoom(this._zoomFromMercatorZ(l))}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}computeZoomRelativeTo(e){let n=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,e.toAltitude())),i;i=e.z<this._camera.position[2]?[n.x,n.y,n.z]:[e.x,e.y,e.z];let r=$.length($.sub([],this._camera.position,i));return We(this._zoomFromMercatorZ(r),this._minZoom,this._maxZoom)}setFreeCameraOptions(e){if(!this.height||!e.position&&!e.orientation)return;this._updateCameraState();let n=!1;if(e.orientation&&!Xi.exactEquals(e.orientation,this._camera.orientation)&&(n=this._setCameraOrientation(e.orientation)),e.position){let i=[e.position.x,e.position.y,e.position.z];$.exactEquals(i,this._camera.position)||(this._setCameraPosition(i),n=!0)}n&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();let e=this._camera.position,n=new ID;return n.position=new Gt(e[0],e[1],e[2]),n.orientation=this._camera.orientation,n._elevation=this.elevation,n._renderWorldCopies=this.renderWorldCopies,n}_setCameraOrientation(e){if(!Xi.length(e))return!1;Xi.normalize(e,e);let n=$.transformQuat([],[0,0,-1],e),i=$.transformQuat([],[0,-1,0],e);if(i[2]<0)return!1;let r=TD(n,i);return!!r&&(this._camera.orientation=r,!0)}_setCameraPosition(e){let n=this.zoomScale(this.minZoom)*this.tileSize,i=this.zoomScale(this.maxZoom)*this.tileSize,r=this.cameraToCenterDistance;e[2]=We(e[2],r/i,r/n),this._camera.position=e}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,n,i){this._unmodified=!1,this._edgeInsets.interpolate(e,n,i),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){let n=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,n)}getVisibleUnwrappedCoordinates(e){let n=[new cv(0,e)];if(this.renderWorldCopies){let i=this.pointCoordinate(new Q(0,0)),r=this.pointCoordinate(new Q(this.width,0)),o=this.pointCoordinate(new Q(this.width,this.height)),l=this.pointCoordinate(new Q(0,this.height)),u=Math.floor(Math.min(i.x,r.x,o.x,l.x)),h=Math.floor(Math.max(i.x,r.x,o.x,l.x)),p=1;for(let m=u-p;m<=h+p;m++)m!==0&&n.push(new cv(m,e))}return n}isLODDisabled(e){return(!e||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCoverForShadows(e,n,i){let r=[];if(n[0]===0&&n[1]===0)return r;for(let l of e){let u=l.canonical,h=l.overscaledZ,p=l.wrap,m=1<<u.z,_=u.x+1<m,y=u.x>0,v=u.y+1<m,b=u.y>0,w=l.wrap-(y?0:1),C=l.wrap+(_?0:1),E=y?u.x-1:m-1,I=_?u.x+1:0;n[0]<0?(r.push(new Jt(h,C,u.z,I,u.y)),n[1]<0&&v&&(r.push(new Jt(h,p,u.z,u.x,u.y+1)),r.push(new Jt(h,C,u.z,I,u.y+1))),n[1]>0&&b&&(r.push(new Jt(h,p,u.z,u.x,u.y-1)),r.push(new Jt(h,C,u.z,I,u.y-1)))):n[0]>0?(r.push(new Jt(h,w,u.z,E,u.y)),n[1]<0&&v&&(r.push(new Jt(h,p,u.z,u.x,u.y+1)),r.push(new Jt(h,w,u.z,E,u.y+1))),n[1]>0&&b&&(r.push(new Jt(h,p,u.z,u.x,u.y-1)),r.push(new Jt(h,w,u.z,E,u.y-1)))):n[1]<0&&v?r.push(new Jt(h,p,u.z,u.x,u.y+1)):b&&r.push(new Jt(h,p,u.z,u.x,u.y-1))}if(r.length>1){r.sort((h,p)=>h.overscaledZ-p.overscaledZ||h.wrap-p.wrap||h.canonical.z-p.canonical.z||h.canonical.x-p.canonical.x||h.canonical.y-p.canonical.y);let l=0,u=0;for(;u<r.length;)r[u].equals(r[l])?++u:r[++l]=r[u++];r.length=l+1}let o=[];for(let l of r)r.some(u=>l.isChildOf(u))||o.push(l);return r=o.filter(l=>!e.some(u=>!!(l.overscaledZ<i&&u.isChildOf(l))||l.equals(u)||l.isChildOf(u))),r}coveringTiles(e){let n=this.coveringZoomLevel(e),i=n,r=this.elevation&&this.elevation.exaggeration(),o=r&&!e.isTerrainDEM,l=this.projection.name==="mercator";if(e.minzoom!==void 0&&n<e.minzoom)return[];e.maxzoom!==void 0&&n>e.maxzoom&&(n=e.maxzoom);let u=this.locationCoordinate(this.center),h=this.center.lat,p=1<<n,m=[p*u.x,p*u.y,0],_=this.projection.name==="globe",y=!_,v=Ks.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,y),b=_?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),w=p*Cn(1,this.center.lat),C=this._camera.position[2]/Cn(1,this.center.lat),E=[p*b.x,p*b.y,C*(y?1:w)],I=_||r,D=this.cameraToCenterDistance/e.tileSize*(e.roundZoom?1:.502),S=this.isLODDisabled(!0)?n:0,M;if(this._elevation&&e.isTerrainDEM)M=1e4*this._elevation.exaggeration();else if(this._elevation){let q=this._elevation.getMinMaxForVisibleTiles();M=q?q.max:this._centerAltitude}else M=this._centerAltitude;let A=e.isTerrainDEM?-M:this._elevation?this._elevation.getMinElevationBelowMSL():0,R=this.projection.isReprojectedInTileSpace?DD(this):1,F=q=>{let re=new Gt(q.x+25e-6,q.y,q.z),se=new Gt(q.x,q.y+25e-6,q.z),oe=q.toLngLat(),ue=re.toLngLat(),de=se.toLngLat(),pe=this.locationCoordinate(oe),ae=this.locationCoordinate(ue),ge=this.locationCoordinate(de),Ae=Math.hypot(ae.x-pe.x,ae.y-pe.y),Pe=Math.hypot(ge.x-pe.x,ge.y-pe.y);return Math.sqrt(Ae*Pe)*R/25e-6},k=q=>{let X=M,re=A;return{aabb:dD(this,p,0,0,0,q,re,X,this.projection),zoom:0,x:0,y:0,minZ:re,maxZ:X,wrap:q,fullyVisible:!1}},L=[],z=[],B=n,G=e.reparseOverscaled?i:n,N=q=>q*q,W=N((C-this._centerAltitude)*w),Y=q=>{if(!this._elevation||!q.tileID||!l)return;let X=this._elevation.getMinMaxForTile(q.tileID),re=q.aabb;X?(re.min[2]=X.min,re.max[2]=X.max,re.center[2]=(re.min[2]+re.max[2])/2):(q.shouldSplit=te(q),q.shouldSplit||(re.min[2]=re.max[2]=re.center[2]=this._centerAltitude))},te=q=>{if(q.zoom<S)return!0;if(q.zoom===B)return!1;if(q.shouldSplit!=null)return q.shouldSplit;let X=q.aabb.distanceX(E),re=q.aabb.distanceY(E),se=W,oe=1;if(_){se=N(q.aabb.distanceZ(E));let pe=Math.pow(2,q.zoom),ae=bi((q.y+1)/pe),ge=bi(q.y/pe),Ae=Math.min(Math.max(h,ae),ge),Pe=Cp(Ae)/Cp(h);if(oe=Ae===h?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Pe/this._mercatorScaleRatio),this.zoom<=Ld&&q.zoom===B-1&&Pe>=.9)return!0}else if(o&&(se=N(q.aabb.distanceZ(E)*w)),this.projection.isReprojectedInTileSpace&&i<=5){let pe=Math.pow(2,q.zoom),ae=F(new Gt((q.x+.5)/pe,(q.y+.5)/pe));oe=ae>.85?1:ae}let ue=X*X+re*re+se,de=N((1<<B-q.zoom)*D*oe*((pe,ae)=>{if(ae*N(.707)<pe)return 1;let ge=Math.sqrt(ae/pe);return ge/(1.4144271570014144+(Math.pow(1.1,ge-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(se,W),ue));return ue<de};if(this.renderWorldCopies)for(let q=1;q<=3;q++)L.push(k(-q)),L.push(k(q));for(L.push(k(0));L.length>0;){let q=L.pop(),X=q.x,re=q.y,se=q.fullyVisible,oe=()=>this.projection.name==="globe"&&(q.y===0||q.y===(1<<q.zoom)-1);if(!se){let ue=I?q.aabb.intersects(v):q.aabb.intersectsFlat(v);if(ue===0&&oe()){let de=new Io(q.zoom,X,re);ue=fv(this,p,de,!0).intersects(v)}if(ue===0)continue;se=ue===2}if(q.zoom!==B&&te(q))for(let ue=0;ue<4;ue++){let de=(X<<1)+ue%2,pe=(re<<1)+(ue>>1),ae={aabb:l?q.aabb.quadrant(ue):dD(this,p,q.zoom+1,de,pe,q.wrap,q.minZ,q.maxZ,this.projection),zoom:q.zoom+1,x:de,y:pe,wrap:q.wrap,fullyVisible:se,tileID:void 0,shouldSplit:void 0,minZ:q.minZ,maxZ:q.maxZ};o&&!_&&(ae.tileID=new Jt(q.zoom+1===B?G:q.zoom+1,q.wrap,q.zoom+1,de,pe),Y(ae)),L.push(ae)}else{let ue=q.zoom===B?G:q.zoom;if(e.minzoom&&e.minzoom>ue)continue;if(!se){let ge=I?q.aabb.intersectsPrecise(v):q.aabb.intersectsPreciseFlat(v);if(ge===0&&oe()){let Ae=new Io(q.zoom,X,re);ge=fv(this,p,Ae,!0).intersectsPrecise(v)}if(ge===0)continue}let de=m[0]-(.5+X+(q.wrap<<q.zoom))*(1<<n-q.zoom),pe=m[1]-.5-re,ae=q.tileID?q.tileID:new Jt(ue,q.wrap,q.zoom,X,re);z.push({tileID:ae,distanceSq:de*de+pe*pe})}}if(this.fogCullDistSq){let q=this.fogCullDistSq,X=this.horizonLineFromTop();z=z.filter(re=>{let se=[0,0,0,1],oe=[le,le,0,1],ue=this.calculateFogTileMatrix(re.tileID.toUnwrapped());vn.transformMat4(se,se,ue),vn.transformMat4(oe,oe,ue);let de=function(ge,Ae,Pe){let Ne=0;for(let Be=0;Be<2;++Be)ge[Be]>0&&(Ne+=(ge[Be]-0)*(ge[Be]-0)),Ae[Be]<0&&(Ne+=(0-Ae[Be])*(0-Ae[Be]));return Ne}(vn.min([],se,oe),vn.max([],se,oe));if(de===0)return!0;let pe=!1,ae=this._elevation;if(ae&&de>q&&X!==0){let ge=this.calculateProjMatrix(re.tileID.toUnwrapped()),Ae;e.isTerrainDEM||(Ae=ae.getMinMaxForTile(re.tileID)),Ae||(Ae={min:A,max:M});let Pe=function(Be){let lt=Math.round((Be+45+360)%360/90)%4;return ly[lt]}(this.rotation),Ne=[Pe[0]*le,Pe[1]*le,Ae.max];$.transformMat4(Ne,Ne,ge),pe=(1-Ne[1])*this.height*.5<X}return de<q||pe})}return z.sort((q,X)=>q.distanceSq-X.distanceSq).map(q=>q.tileID)}resize(e,n){this.width=e,this.height=n,this.pixelsToGLUnits=[2/e,-2/n],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log(e)/Math.LN2}project(e){let n=We(e.lat,-si,si),i=this.projection.project(e.lng,n);return new Q(i.x*this.worldSize,i.y*this.worldSize)}unproject(e){return this.projection.unproject(e.x/this.worldSize,e.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/Cn(1,this.center.lat)/this.worldSize}setLocationAtPoint(e,n){let i,r,o=this.centerPoint;if(this.projection.name==="globe"){let u=this.worldSize;i=(n.x-o.x)/u,r=(n.y-o.y)/u}else{let u=this.pointCoordinate(n),h=this.pointCoordinate(o);i=u.x-h.x,r=u.y-h.y}let l=this.locationCoordinate(e);this.setLocation(new Gt(l.x-i,l.y-r))}setLocation(e){this.center=this.coordinateLocation(e),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(e){return this.projection.locationPoint(this,e)}locationPoint3D(e){return this.projection.locationPoint(this,e,!0)}pointLocation(e){return this.coordinateLocation(this.pointCoordinate(e))}pointLocation3D(e){return this.coordinateLocation(this.pointCoordinate3D(e))}locationCoordinate(e,n){let i=n?Cn(n,e.lat):void 0,r=this.projection.project(e.lng,e.lat);return new Gt(r.x,r.y,i)}coordinateLocation(e){return this.projection.unproject(e.x,e.y)}pointRayIntersection(e,n){let i=n??this._centerAltitude,r=[e.x,e.y,0,1],o=[e.x,e.y,1,1];vn.transformMat4(r,r,this.pixelMatrixInverse),vn.transformMat4(o,o,this.pixelMatrixInverse);let l=o[3];vn.scale(r,r,1/r[3]),vn.scale(o,o,1/l);let u=r[2],h=o[2];return{p0:r,p1:o,t:u===h?0:(i-u)/(h-u)}}screenPointToMercatorRay(e){let n=[e.x,e.y,0,1],i=[e.x,e.y,1,1];return vn.transformMat4(n,n,this.pixelMatrixInverse),vn.transformMat4(i,i,this.pixelMatrixInverse),vn.scale(n,n,1/n[3]),vn.scale(i,i,1/i[3]),n[2]=Cn(n[2],this._center.lat)*this.worldSize,i[2]=Cn(i[2],this._center.lat)*this.worldSize,vn.scale(n,n,1/this.worldSize),vn.scale(i,i,1/this.worldSize),new yp([n[0],n[1],n[2]],$.normalize([],$.sub([],i,n)))}rayIntersectionCoordinate(e){let{p0:n,p1:i,t:r}=e,o=Cn(n[2],this._center.lat),l=Cn(i[2],this._center.lat);return new Gt(ft(n[0],i[0],r)/this.worldSize,ft(n[1],i[1],r)/this.worldSize,ft(o,l,r))}pointCoordinate(e,n=this._centerAltitude){return this.projection.pointCoordinate(this,e.x,e.y,n)}pointCoordinate3D(e){if(!this.elevation)return this.pointCoordinate(e);let n=this.projection.pointCoordinate3D(this,e.x,e.y);if(n)return new Gt(n[0],n[1],n[2]);let i=0,r=this.horizonLineFromTop();if(e.y>r)return this.pointCoordinate(e);let o=.02*r,l=e.clone();for(let u=0;u<10&&r-i>o;u++){l.y=ft(i,r,.66);let h=this.projection.pointCoordinate3D(this,l.x,l.y);h?(r=l.y,n=h):i=l.y}return n?new Gt(n[0],n[1],n[2]):this.pointCoordinate(e)}isPointAboveHorizon(e){return this.projection.isPointAboveHorizon(this,e)}isPointOnSurface(e){if(e.y<0||e.y>this.height||e.x<0||e.x>this.width)return!1;if(this.elevation||this.zoom>=Fa)return!this.isPointAboveHorizon(e);let n=this.pointCoordinate(e);return n.y>=0&&n.y<=1}_coordinatePoint(e,n){let i=n&&this.elevation?this.elevation.getAtPointOrZero(e,this._centerAltitude):this._centerAltitude,r=[e.x*this.worldSize,e.y*this.worldSize,i+e.toAltitude(),1];return vn.transformMat4(r,r,this.pixelMatrix),r[3]>0?new Q(r[0]/r[3],r[1]/r[3]):new Q(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){let{top:e,left:n}=this._edgeInsets,i=this.height-this._edgeInsets.bottom,r=this.width-this._edgeInsets.right,o=this.pointLocation3D(new Q(n,e)),l=this.pointLocation3D(new Q(r,e)),u=this.pointLocation3D(new Q(r,i)),h=this.pointLocation3D(new Q(n,i)),p=Math.min(o.lng,l.lng,u.lng,h.lng),m=Math.max(o.lng,l.lng,u.lng,h.lng),_=Math.min(o.lat,l.lat,u.lat,h.lat),y=Math.max(o.lat,l.lat,u.lat,h.lat),v=Math.pow(2,-this.zoom)/16*270,b=this.projection.name==="globe"?1:4,w=(C,E,I,D,S)=>{let M=(C+I)/2,A=(E+D)/2,R=new Q(M,A),{lng:F,lat:k}=this.pointLocation3D(R),L=Math.max(0,p-F,_-k,F-m,k-y);p=Math.min(p,F),m=Math.max(m,F),_=Math.min(_,k),y=Math.max(y,k),(S<b||L>v)&&(w(C,E,M,A,S+1),w(M,A,I,D,S+1))};if(w(n,e,r,e,1),w(r,e,r,i,1),w(r,i,n,i,1),w(n,i,n,e,1),this.projection.name==="globe"){let[C,E]=function(I){let D=ne.identity(new Float64Array(16));ne.multiply(D,I.pixelMatrix,I.globeMatrix);let S=[0,Mo,0],M=[0,Do,0];return $.transformMat4(S,S,D),$.transformMat4(M,M,D),[S[0]>0&&S[0]<=I.width&&S[1]>0&&S[1]<=I.height&&!wp(I,new pt(I.center.lat,90)),M[0]>0&&M[0]<=I.width&&M[1]>0&&M[1]<=I.height&&!wp(I,new pt(I.center.lat,-90))]}(this);C?(y=90,m=180,p=-180):E&&(_=-90,m=180,p=-180)}return new Hr(new pt(p,_),new pt(m,y))}_getBoundsRectangular(e,n){let{top:i,left:r}=this._edgeInsets,o=this.height-this._edgeInsets.bottom,l=this.width-this._edgeInsets.right,u=new Q(r,i),h=new Q(l,i),p=new Q(l,o),m=new Q(r,o),_=this.pointCoordinate(u,e),y=this.pointCoordinate(h,e),v=this.pointCoordinate(p,n),b=this.pointCoordinate(m,n),w=(C,E)=>(E.y-C.y)/(E.x-C.x);return _.y>1&&y.y>=0?_=new Gt((1-b.y)/w(b,_)+b.x,1):_.y<0&&y.y<=1&&(_=new Gt(-b.y/w(b,_)+b.x,0)),y.y>1&&_.y>=0?y=new Gt((1-v.y)/w(v,y)+v.x,1):y.y<0&&_.y<=1&&(y=new Gt(-v.y/w(v,y)+v.x,0)),new Hr().extend(this.coordinateLocation(_)).extend(this.coordinateLocation(y)).extend(this.coordinateLocation(b)).extend(this.coordinateLocation(v))}_getBoundsRectangularTerrain(){let e=this.elevation;if(!e.visibleDemTiles.length||e.isUsingMockSource())return this._getBoundsRectangular(0,0);let n=e.visibleDemTiles.reduce((i,r)=>{if(r.dem){let o=r.dem.tree;i.min=Math.min(i.min,o.minimums[0]),i.max=Math.max(i.max,o.maximums[0])}return i},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(n.min*e.exaggeration(),n.max*e.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(e=!0){let n=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,i=this.height/2-n*(1-this._horizonShift);return e?Math.max(0,i):i}getMaxBounds(){return this.maxBounds}setMaxBounds(e){this.maxBounds=e,this.minLat=-si,this.maxLat=si,this.minLng=-180,this.maxLng=180,e&&(this.minLat=e.getSouth(),this.maxLat=e.getNorth(),this.minLng=e.getWest(),this.maxLng=e.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=Ii(this.minLng)*this.tileSize,this.worldMaxX=Ii(this.maxLng)*this.tileSize,this.worldMinY=Ai(this.maxLat)*this.tileSize,this.worldMaxY=Ai(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(e,n){return this.projection.createTileMatrix(this,n,e)}calculateDistanceTileData(e){let n=e.key,i=this._distanceTileDataCache;if(i[n])return i[n];let r=e.canonical,o=1/this.height,l=this.cameraWorldSize,u=l/this.zoomScale(r.z),h=(r.x+Math.pow(2,r.z)*e.wrap)*u,p=r.y*u,m=this.point;m.x*=l/this.worldSize,m.y*=l/this.worldSize;let _=this.angle,y=Math.sin(-_),v=-Math.cos(-_);return i[n]={bearing:[y,v],center:[(m.x-h)*o,(m.y-p)*o],scale:u/le*o},i[n]}calculateFogTileMatrix(e){let n=e.key,i=this._fogTileMatrixCache;if(i[n])return i[n];let r=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,e);return ne.multiply(r,this.worldToFogMatrix,r),i[n]=new Float32Array(r),i[n]}calculateProjMatrix(e,n=!1,i=!1){let r=e.key,o;if(o=i?this._expandedProjMatrixCache:n?this._alignedProjMatrixCache:this._projMatrixCache,o[r])return o[r];let l=this.calculatePosMatrix(e,this.worldSize),u;return u=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:i?this.expandedFarZProjMatrix:n?this.alignedProjMatrix:this.projMatrix,ne.multiply(l,u,l),o[r]=new Float32Array(l),o[r]}calculatePixelsToTileUnitsMatrix(e){let n=e.tileID.key,i=this._pixelsToTileUnitsCache;if(i[n])return i[n];let r=function(o,l){let{scale:u}=o.tileTransform,h=u*le/(o.tileSize*Math.pow(2,l.zoom-o.tileID.overscaledZ+o.tileID.canonical.z));return Hc.scale(new Float32Array(4),l.inverseAdjustmentMatrix,[h,h])}(e,this);return i[n]=r,i[n]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){let e=1/this.worldSize,n=ne.fromScaling([],[e,e,e]);return ne.multiply(n,n,this.globeMatrix),n}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;let e=this._elevation;this._updateCameraState();let n=Cn(1,this._center.lat)*this.worldSize,i=this._computeCameraPosition(n),r=this._camera.forward(),o=Cn(1,this._center.lat);i[2]/=o,r[2]/=o,$.normalize(r,r);let l=e.raycast(i,r,e.exaggeration());if(l){let u=$.scaleAndAdd([],i,r,l),h=new Gt(u[0],u[1],Cn(u[2],bi(u[1]))),p=(h.z+$.length([h.x-i[0],h.y-i[1],h.z-i[2]*o]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(p),this._centerAltitude=h.toAltitude(),this._center=this.coordinateLocation(h),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(e=!1){if(!this._elevation)return;let n=this._elevation,i=Cn(1,this._center.lat)*this.worldSize,r=this._computeCameraPosition(i),o=n.getAtPointOrZero(new Gt(...r)),l=this.pixelsPerMeter/this.worldSize*o,u=this._minimumHeightOverTerrain(),h=r[2]-l;if(h<=u)if(h<0||e){let p=this.locationCoordinate(this._center,this._centerAltitude),m=[r[0],r[1],p.z-r[2]],_=$.length(m);m[2]-=(u-h)/this._pixelsPerMercatorPixel;let y=$.length(m);if(y===0)return;$.scale(m,m,_/y*this._pixelsPerMercatorPixel),this._camera.position=[r[0],r[1],p.z*this._pixelsPerMercatorPixel-m[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let e=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||e){let y=this.center;return y.lat=We(y.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!e)&&(y.lng=We(y.lng,this.minLng,this.maxLng)),this.center=y,void(this._constraining=!1)}let n=this._unmodified,{x:i,y:r}=this.point,o=0,l=i,u=r,h=this.width/2,p=this.height/2,m=this.worldMinY*this.scale,_=this.worldMaxY*this.scale;if(r-p<m&&(u=m+p),r+p>_&&(u=_-p),_-m<this.height&&(o=Math.max(o,this.height/(_-m)),u=(_+m)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){let y=this.worldMinX*this.scale,v=this.worldMaxX*this.scale,b=this.worldSize/2-(y+v)/2;l=(i+b+this.worldSize)%this.worldSize-b,l-h<y&&(l=y+h),l+h>v&&(l=v-h),v-y<this.width&&(o=Math.max(o,this.width/(v-y)),l=(v+y)/2)}l===i&&u===r||(this.center=this.unproject(new Q(l,u))),o&&(this.zoom+=this.scaleZoom(o)),this._constrainCamera(),this._unmodified=n,this._constraining=!1}_minZoomForBounds(){let e=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(e=Math.max(e,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),e}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;let e=this.centerOffset,n=this.projection.name==="globe",i=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=Cn(1,this.center.lat)/Cn(1,45));let r=eh(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,r),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;let o=this.projection.zAxisUnit==="meters"?i:1,l=this._camera.getWorldToCamera(this.worldSize,o),u,h=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(h[8]=2*-e.x/this.width,h[9]=2*e.y/this.height,this.isOrthographic){let k=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),L=k*this.aspect,z=-L,B=-k;L-=e.x,z-=e.x,k+=e.y,B+=e.y,u=this._camera.getCameraToClipOrthographic(z,L,B,k,this._nearZ,this._farZ),((G,N,W,Y)=>{for(let te=0;te<16;te++)G[te]=VD(N[te],W[te],Y)})(u,u,h,jD(this.pitch>=15?1:this.pitch/15))}else u=h;let p=ne.mul([],h,l),m=ne.mul([],u,l);if(this.projection.isReprojectedInTileSpace){let k=this.locationCoordinate(this.center),L=ne.identity([]);ne.translate(L,L,[k.x*this.worldSize,k.y*this.worldSize,0]),ne.multiply(L,L,MD(this)),ne.translate(L,L,[-k.x*this.worldSize,-k.y*this.worldSize,0]),ne.multiply(m,m,L),ne.multiply(p,p,L),this.inverseAdjustmentMatrix=function(z){let B=MD(z,!0);return Hc.invert([],[B[0],B[1],B[4],B[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=ne.scale([],m,[this.worldSize,this.worldSize,this.worldSize/o,1]),this.projMatrix=m,this.invProjMatrix=ne.invert(new Float64Array(16),this.projMatrix),n){let k=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);k[8]=2*-e.x/this.width,k[9]=2*e.y/this.height,this.expandedFarZProjMatrix=ne.mul([],k,l)}else this.expandedFarZProjMatrix=this.projMatrix;let _=ne.invert([],u);this.frustumCorners=uv.fromInvProjectionMatrix(_,this.horizonLineFromTop(),this.height),this.cameraFrustum=Ks.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!n);let y=new Float32Array(16);ne.identity(y),ne.scale(y,y,[1,-1,1]),ne.rotateX(y,y,this._pitch),ne.rotateZ(y,y,this.angle);let v=ne.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=ne.clone(v);let b=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;v[8]=2*-e.x/this.width,v[9]=2*(e.y+b)/this.height,this.skyboxMatrix=ne.multiply(y,v,y);let w=this.point,C=w.x,E=w.y,I=this.width%2/2,D=this.height%2/2,S=Math.cos(this.angle),M=Math.sin(this.angle),A=C-Math.round(C)+S*I+M*D,R=E-Math.round(E)+S*D+M*I,F=new Float64Array(m);if(ne.translate(F,F,[A>.5?A-1:A,R>.5?R-1:R,0]),this.alignedProjMatrix=F,m=ne.create(),ne.scale(m,m,[this.width/2,-this.height/2,1]),ne.translate(m,m,[1,-1,0]),this.labelPlaneMatrix=m,m=ne.create(),ne.scale(m,m,[1,-1,1]),ne.translate(m,m,[-1,-1,0]),ne.scale(m,m,[2/this.width,2/this.height,1]),this.glCoordMatrix=m,this.pixelMatrix=ne.multiply(new Float64Array(16),this.labelPlaneMatrix,p),this._calcFogMatrices(),this._distanceTileDataCache={},m=ne.invert(new Float64Array(16),this.pixelMatrix),!m)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=m,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=function(L){let{x:z,y:B}=L.point,{lng:G,lat:N}=L._center;return ZI(z,B,L.worldSize,G,N)}(this);let k=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=$.transformMat4(k,k,l),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=m;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};let e=this.cameraWorldSizeForFog,n=this.cameraPixelsPerMeter,i=this._camera.position,r=1/this.height/this._pixelsPerMercatorPixel,o=[e,e,n];$.scale(o,o,r),$.scale(i,i,-1),$.multiply(i,i,o);let l=ne.create();ne.translate(l,l,i),ne.scale(l,l,o),this.mercatorFogMatrix=l,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(e,n,r)}_computeCameraPosition(e){let n=(e=e||this.pixelsPerMeter)/this.pixelsPerMeter,i=this._camera.forward(),r=this.point,o=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*n-e/this.worldSize*this._centerAltitude;return[r.x/this.worldSize-i[0]*o,r.y/this.worldSize-i[1]*o,e/this.worldSize*this._centerAltitude-i[2]*o]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(e){let n=this._maxCameraBoundsDistance()*Math.cos(this._pitch),i=this._camera.position[2],r=e[2],o=1;this.projection.wrap&&(this.center=this.center.wrap()),r>0&&(o=Math.min((n-i)/r,1)),this._camera.position=$.scaleAndAdd([],this._camera.position,e,o),this._updateStateFromCamera()}_updateStateFromCamera(){let e=this._camera.position,n=this._camera.forward(),{pitch:i,bearing:r}=this._camera.getPitchBearing(),o=Cn(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,l=this._mercatorZfromZoom(this._maxZoom)*Math.cos(Tt(this._maxPitch)),u=Math.max((e[2]-o)/Math.cos(i),l),h=this._zoomFromMercatorZ(u);$.scaleAndAdd(e,e,n,u),this._pitch=We(i,Tt(this.minPitch),Tt(this.maxPitch)),this.angle=hs(r,-Math.PI,Math.PI),this._setZoom(We(h,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new Gt(e[0],e[1],e[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(e){return Math.pow(2,e)*this.tileSize}_mercatorZfromZoom(e){return this.cameraToCenterDistance/this._worldSizeFromZoom(e)}_minimumHeightOverTerrain(){let e=Math.min((this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(e)}_zoomFromMercatorZ(e){return this.scaleZoom(this.cameraToCenterDistance/(e*this.tileSize))}zoomFromMercatorZAdjusted(e){let n=0,i=Fa,r=0,o=1/0;for(;i-n>1e-6&&i>n;){let l=n+.5*(i-n),u=this.tileSize*Math.pow(2,l),h=this.getCameraToCenterDistance(this.projection,l,u),p=this.scaleZoom(h/(e*this.tileSize)),m=Math.abs(l-p);m<o&&(o=m,r=l),l<p?n=l:i=l}return r}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(J("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(e,n){let i=Math.min(e.x,n.x),r=Math.max(e.x,n.x),o=Math.min(e.y,n.y),l=Math.max(e.y,n.y);if(o<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;let u=[new Q(i,o),new Q(r,l),new Q(i,l),new Q(r,o)],h=this.renderWorldCopies?-3:0,p=this.renderWorldCopies?4:1;for(let m of u){let _=this.pointRayIntersection(m);if(_.t<0)return!0;let y=this.rayIntersectionCoordinate(_);if(y.x<h||y.y<0||y.x>p||y.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+ji(this.fovAboveCenter)>88||this.anyCornerOffEdge(new Q(0,0),new Q(this.width,this.height))}zoomDeltaToMovement(e,n){let i=$.length($.sub([],this._camera.position,e)),r=this._zoomFromMercatorZ(i)+n;return i-this._mercatorZfromZoom(r)}getCameraPoint(){if(this.projection.name==="globe"){let e=function([n,i,r],o){let l=[n,i,r,1];vn.transformMat4(l,l,o);let u=l[3]=Math.max(l[3],1e-6);return l[0]/=u,l[1]/=u,l[2]/=u,l}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new Q(e[0],e[1])}{let e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new Q(0,e))}}getCameraToCenterDistance(e,n=this.zoom,i=this.worldSize){let r=eh(e,n,this.width,this.height,1024),o=e.pixelSpaceConversion(this.center.lat,i,r),l=.5/Math.tan(.5*this._fov)*this.height*o;return this.isOrthographic&&(l=VD(1,l,jD(this.pitch>=15?1:this.pitch/15))),l}getWorldToCameraMatrix(){let e=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&ne.multiply(e,e,this.globeMatrix),e}getFrustum(e){return Ks.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,e,this.projection.zAxisUnit==="meters")}}function UD(t,e,n){ne.identity(t),ne.rotateZ(t,t,Tt(e[2])),ne.rotateX(t,t,Tt(e[0])),ne.rotateY(t,t,Tt(e[1])),ne.scale(t,t,n),ne.multiply(t,t,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function cm(t,e,n,i,r,o,l,u){let h=[n[0]-e[0],n[1]-e[1],0],p=[i[0]-e[0],i[1]-e[1],0];if($.length(h)<1e-12||$.length(p)<1e-12)return Xi.identity(t);let m=$.cross([],h,p);$.normalize(m,m),$.subtract(p,i,e),h[2]=(o-r)*u,p[2]=(l-r)*u;let _=h;return $.cross(_,h,p),$.normalize(_,_),Xi.rotationTo(t,m,_)}function $D(t,e,n=!1){let i=Ni(e.zoom),r=function(o,l,u){let h=l.worldSize,p=[o[12],o[13],o[14]],m=bi(p[1]/h),_=qr(p[0]/h),y=ne.identity([]),v=Cn(1,m)*h,b=Cn(1,0)*h*Na(m,l.zoom),w=1/gv(h),C=b*w;if(u){let S=eh(l.projection,l.zoom,l.width,l.height,1024);C=w*l.projection.pixelSpaceConversion(l.center.lat,h,S)}let E=Rr(m,_);$.add(E,E,$.scale([],$.normalize([],E),v*C*p[2]));let I=function(S){let M=[S[0],S[1],S[2]],A=[0,1,0],R=$.cross([],A,M);return $.cross(A,M,R),$.squaredLength(A)===0&&(A=[0,1,0],$.cross(R,M,A)),$.normalize(R,R),$.normalize(A,A),$.normalize(M,M),[R[0],R[1],R[2],0,A[0],A[1],A[2],0,M[0],M[1],M[2],0,S[0],S[1],S[2],1]}(E);ne.scale(y,y,[C,C,C*v]),ne.translate(y,y,[-p[0],-p[1],-p[2]]);let D=ne.multiply([],l.globeMatrix,I);return ne.multiply(D,D,y),ne.multiply(D,D,o),D}(t,e,n);if(i>0){let o=function(l,u){let h=u.worldSize,p=Cn(1,0)*h*Na(u.center.lat,u.zoom)/gv(h),m=Cn(1,u.center.lat)*h,_=ne.identity([]);return ne.rotateY(_,_,Tt(u.center.lng)),ne.rotateX(_,_,Tt(u.center.lat)),ne.translate(_,_,[0,0,xr]),ne.scale(_,_,[p,p,p*m]),ne.translate(_,_,[u.point.x-.5*h,u.point.y-.5*h,0]),ne.multiply(_,_,l),ne.multiply(_,u.globeMatrix,_)}(t,e);return function(l,u,h){let p=(b,w,C)=>{let E=$.length(b),I=$.length(w),D=Js(b,w,C);return $.scale(D,D,1/$.length(D)*ft(E,I,C))},m=p([l[0],l[1],l[2]],[u[0],u[1],u[2]],h),_=p([l[4],l[5],l[6]],[u[4],u[5],u[6]],h),y=p([l[8],l[9],l[10]],[u[8],u[9],u[10]],h),v=Js([l[12],l[13],l[14]],[u[12],u[13],u[14]],h);return[m[0],m[1],m[2],0,_[0],_[1],_[2],0,y[0],y[1],y[2],0,v[0],v[1],v[2],1]}(r,o,i)}return r}let Vl=64,l4=[1,1,1];class GD{constructor(e,n,i,r){this.id=e,this.position=n!=null?new pt(n[0],n[1]):new pt(0,0),this.orientation=i??[0,0,0],this.nodes=r,this.uploaded=!1,this.aabb=new On([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,n){if(ne.multiply(e.matrix,n,e.matrix),e.meshes)for(let i of e.meshes){let r=On.applyTransform(i.aabb,e.matrix);this.aabb.encapsulate(r)}if(e.children)for(let i of e.children)this._applyTransformations(i,e.matrix)}computeBoundsAndApplyParent(){let e=ne.identity([]);for(let n of this.nodes)this._applyTransformations(n,e)}_positionModelOnTerrain(e,n){let i=e.elevation;if(!i)return 0;let r=On.projectAabbCorners(this.aabb,this.matrix),o=Cn(1,this.position.lat)*e.worldSize,l=function(E,I){let D=[0,0,1],S=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(let M of S){let A=E[M.corners[0]],R=E[M.corners[1]],F=E[M.corners[2]],k=[R[0]-A[0],R[1]-A[1],I*(R[2]-A[2])],L=$.cross(k,k,[F[0]-A[0],F[1]-A[1],I*(F[2]-A[2])]);$.normalize(L,L),M.dotProductWithUp=$.dot(L,D)}return S.sort((M,A)=>M.dotProductWithUp-A.dotProductWithUp),S[0].corners}(r,o),u=r[l[0]],h=r[l[1]],p=r[l[2]],m=r[l[3]],_=i.getAtPointOrZero(new Gt(u[0]/e.worldSize,u[1]/e.worldSize),0),y=i.getAtPointOrZero(new Gt(h[0]/e.worldSize,h[1]/e.worldSize),0),v=i.getAtPointOrZero(new Gt(p[0]/e.worldSize,p[1]/e.worldSize),0),b=i.getAtPointOrZero(new Gt(m[0]/e.worldSize,m[1]/e.worldSize),0),w=(_+b)/2,C=(y+v)/2;return w>C?y<v?cm(n,h,m,u,y,b,_,o):cm(n,p,u,m,v,_,b,o):_<b?cm(n,u,h,p,_,y,v,o):cm(n,m,p,h,b,v,y,o),Math.max(w,C)}computeModelMatrix(e,n,i,r,o,l,u=!1){let h=e.transform,p=h.zoom,m=h.project(this.position),_=Na(this.position.lat,p),y=1/_;ne.identity(this.matrix),ne.translate(this.matrix,this.matrix,[m.x+r[0]*y,m.y+r[1]*y,r[2]]);let v=1,b=1,w=h.worldSize;if(u){if(h.projection.name==="mercator"){let D=0;h.elevation&&(D=h.elevation.getAtPointOrZero(new Gt(m.x/w,m.y/w),0));let S=vn.transformMat4([],[m.x,m.y,D,1],h.projMatrix)[3]/h.cameraToCenterDistance;v=S,b=S*Na(h.center.lat,p)}else if(h.projection.name==="globe"){let D=$D(this.matrix,h),S=ne.multiply([],h.projMatrix,D),M=[0,0,0,1];vn.transformMat4(M,M,S);let A=M[3]/h.cameraToCenterDistance,R=Ni(p),F=h.projection.pixelsPerMeter(this.position.lat,w)*Na(this.position.lat,p),k=h.projection.pixelsPerMeter(h.center.lat,w)*Na(h.center.lat,p);v=A/ft(F,iM(h.center.lat),R),b=A*_/F,v*=k,b*=k}}else v=y;ne.scale(this.matrix,this.matrix,[v,v,b]);let C=[...this.matrix],E=this.orientation,I=[];if(UD(I,[E[0]+n[0],E[1]+n[1],E[2]+n[2]],i),ne.multiply(this.matrix,C,I),o&&h.elevation){let D=0,S=[];if(l&&h.elevation){D=this._positionModelOnTerrain(h,S);let M=ne.fromQuat([],S),A=ne.multiply([],M,I);ne.multiply(this.matrix,C,A)}else D=h.elevation.getAtPointOrZero(new Gt(m.x/w,m.y/w),0);D!==0&&(this.matrix[14]+=D)}}upload(e){if(!this.uploaded){for(let n of this.nodes)rx(n,e);for(let n of this.nodes)um(n);this.uploaded=!0}}destroy(){for(let e of this.nodes)dm(e)}}function th(t,e,n=!1){t.uploaded||(t.gfxTexture=new Zn(e,t.image,n?e.gl.R8:e.gl.RGBA,{useMipmap:t.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),t.uploaded=!0,t.image=null)}function c4(t,e,n){t.indexBuffer=e.createIndexBuffer(t.indexArray,!1,!0),t.vertexBuffer=e.createVertexBuffer(t.vertexArray,JB.members,!1,!0),t.normalArray&&(t.normalBuffer=e.createVertexBuffer(t.normalArray,n4.members,!1,!0)),t.texcoordArray&&(t.texcoordBuffer=e.createVertexBuffer(t.texcoordArray,t4.members,!1,!0)),t.colorArray&&(t.colorBuffer=e.createVertexBuffer(t.colorArray,(t.colorArray.bytesPerElement===12?QB:e4).members,!1,!0)),t.featureArray&&(t.pbrBuffer=e.createVertexBuffer(t.featureArray,r4.members,!0)),t.segments=yn.simpleSegment(0,0,t.vertexArray.length,t.indexArray.length);let i=t.material;i.pbrMetallicRoughness.baseColorTexture&&th(i.pbrMetallicRoughness.baseColorTexture,e),i.pbrMetallicRoughness.metallicRoughnessTexture&&th(i.pbrMetallicRoughness.metallicRoughnessTexture,e),i.normalTexture&&th(i.normalTexture,e),i.occlusionTexture&&th(i.occlusionTexture,e,n),i.emissionTexture&&th(i.emissionTexture,e)}function rx(t,e,n){if(t.meshes)for(let i of t.meshes)c4(i,e,n);if(t.children)for(let i of t.children)rx(i,e,n)}function um(t){if(t.meshes)for(let e of t.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(t.children)for(let e of t.children)um(e)}function dm(t){if(t.meshes)for(let n of t.meshes)n.vertexBuffer&&(n.vertexBuffer.destroy(),n.indexBuffer.destroy(),n.normalBuffer&&n.normalBuffer.destroy(),n.texcoordBuffer&&n.texcoordBuffer.destroy(),n.colorBuffer&&n.colorBuffer.destroy(),n.pbrBuffer&&n.pbrBuffer.destroy(),n.segments.destroy(),n.material&&((e=n.material).pbrMetallicRoughness.baseColorTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture&&e.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),e.pbrMetallicRoughness.metallicRoughnessTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&e.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),e.normalTexture&&e.normalTexture.gfxTexture&&e.normalTexture.gfxTexture.destroy(),e.emissionTexture&&e.emissionTexture.gfxTexture&&e.emissionTexture.gfxTexture.destroy(),e.occlusionTexture&&e.occlusionTexture.gfxTexture&&e.occlusionTexture.gfxTexture.destroy()));var e;if(t.children)for(let n of t.children)dm(n)}class HD{constructor(e,n){this.feature=e,this.instancedDataOffset=n,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class qD{constructor(){this.instancedDataArray=new V0,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class WD{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.projection=e.projection,this.index=e.index,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0}}populate(e,n,i,r){this.tileToMeter=zd(i);let o=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(let{feature:l,id:u,index:h,sourceLayerIndex:p}of e){let m=za(l,o);if(!this.layers[0]._featureFilter.filter(new Hn(this.zoom),m,i))continue;let _={id:u,sourceLayerIndex:p,index:h,geometry:o?m.geometry:vs(l,i,r),properties:l.properties,type:l.type,patterns:{}},y=this.addFeature(_,_.geometry,m);y&&n.featureIndex.insert(l,_.geometry,h,p,this.index,this.instancesPerModel[y].instancedDataArray.length)}this.lookup=null}update(e,n,i,r){for(let o in this.instancesPerModel){let l=this.instancesPerModel[o];for(let u in e)l.idToFeaturesIndex.hasOwnProperty(u)&&this.evaluate(l.features[l.idToFeaturesIndex[u]],e[u],l,!0)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(let n in this.instancesPerModel){let i=this.instancesPerModel[n];for(let r of i.features){let o=this.layers[0],l=r.feature,u=this.canonical,h=o.paint.get("model-rotation").evaluate(l,{},u),p=o.paint.get("model-scale").evaluate(l,{},u),m=o.paint.get("model-translation").evaluate(l,{},u);$.exactEquals(r.rotation,h)&&$.exactEquals(r.scale,p)&&$.exactEquals(r.translation,m)||(this.evaluate(r,r.featureStates,i,!0),e=!0)}}return e}isEmpty(){for(let e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(let n in this.instancesPerModel){let i=this.instancesPerModel[n];i.instancedDataArray.length<0||i.instancedDataArray.length===0||(i.instancedDataBuffer?i.instancedDataBuffer.updateData(i.instancedDataArray):i.instancedDataBuffer=e.createVertexBuffer(i.instancedDataArray,i4.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(let e in this.instancesPerModel){let n=this.instancesPerModel[e];n.instancedDataArray.length!==0&&n.instancedDataBuffer&&n.instancedDataBuffer.destroy()}}addFeature(e,n,i){let r=this.layers[0],o=r.layout.get("model-id").evaluate(i,{},this.canonical);if(!o)return J(`modelId is not evaluated for layer ${r.id} and it is not going to get rendered.`),o;this.instancesPerModel[o]||(this.instancesPerModel[o]=new qD);let l=this.instancesPerModel[o],u=l.instancedDataArray,h=new HD(i,u.length);for(let p of n)for(let m of p){if(m.x<0||m.x>=le||m.y<0||m.y>=le)continue;let _=(this.lookupDim-1)/le,y=this.lookupDim*(m.y*_|0)+m.x*_|0;if(this.lookup){if(this.lookup[y]!==0)continue;this.lookup[y]=1}this.instanceCount++;let v=u.length;u.resize(v+1),l.instancesEvaluatedElevation.push(0),u.float32[16*v]=m.x,u.float32[16*v+1]=m.y}return h.instancedDataCount=l.instancedDataArray.length-h.instancedDataOffset,h.instancedDataCount>0&&(e.id&&(l.idToFeaturesIndex[e.id]=l.features.length),l.features.push(h),this.evaluate(h,{},l,!1)),o}evaluate(e,n,i,r){let o=this.layers[0],l=e.feature,u=this.canonical,h=e.rotation=o.paint.get("model-rotation").evaluate(l,n,u),p=e.scale=o.paint.get("model-scale").evaluate(l,n,u),m=e.translation=o.paint.get("model-translation").evaluate(l,n,u),_=o.paint.get("model-color").evaluate(l,n,u);_.a=o.paint.get("model-color-mix-intensity").evaluate(l,n,u);let y=[];this.maxVerticalOffset<m[2]&&(this.maxVerticalOffset=m[2]),this.maxScale=Math.max(Math.max(this.maxScale,p[0]),Math.max(p[1],p[2])),UD(y,h,p);let v=Math.round(100*_.a)+_.b/1.05;for(let b=0;b<e.instancedDataCount;++b){let w=e.instancedDataOffset+b,C=16*w,E=i.instancedDataArray.float32,I=0;r&&(I=E[C+6]-i.instancesEvaluatedElevation[w]);let D=0|E[C+1];E[C]=(0|E[C])+_.r/1.05,E[C+1]=D+_.g/1.05,E[C+2]=v,E[C+3]=1/(u.z>10?this.tileToMeter:zd(u,D)),E[C+4]=m[0],E[C+5]=m[1],E[C+6]=m[2]+I,E[C+7]=y[0],E[C+8]=y[1],E[C+9]=y[2],E[C+10]=y[4],E[C+11]=y[5],E[C+12]=y[6],E[C+13]=y[8],E[C+14]=y[9],E[C+15]=y[10],i.instancesEvaluatedElevation[w]=m[2]}}}Ge(WD,"ModelBucket",{omit:["layers"]}),Ge(qD,"PerModelAttributes"),Ge(HD,"ModelFeature");let u4=new ii({visibility:new be(ie.layout_model.visibility),"model-id":new et(ie.layout_model["model-id"])});var d4={paint:new ii({"model-opacity":new be(ie.paint_model["model-opacity"]),"model-rotation":new et(ie.paint_model["model-rotation"]),"model-scale":new et(ie.paint_model["model-scale"]),"model-translation":new et(ie.paint_model["model-translation"]),"model-color":new et(ie.paint_model["model-color"]),"model-color-mix-intensity":new et(ie.paint_model["model-color-mix-intensity"]),"model-type":new be(ie.paint_model["model-type"]),"model-cast-shadows":new be(ie.paint_model["model-cast-shadows"]),"model-receive-shadows":new be(ie.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new be(ie.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new et(ie.paint_model["model-emissive-strength"]),"model-roughness":new et(ie.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new et(ie.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new be(ie.paint_model["model-cutoff-fade-range"])}),layout:u4};let ox=new Float32Array(262144),jl=new Uint8Array(262144);function ZD(t){let e=0;if(t.meshes)for(let n of t.meshes)e=Math.max(e,n.aabb.max[2]);if(t.children)for(let n of t.children)e=Math.max(e,ZD(n));return e}let XD=["","wall","door","roof","window","lamp","logo"];class YD{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.feature={type:"Point",id:e.id,geometry:[],properties:{height:ZD(e)}}}}class KD{constructor(e,n,i,r){this.nodes=e,this.id=n,this.modelTraits|=1,this.uploaded=!1,this.hasPattern=!1,i&&(this.modelTraits|=4),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=r,this.dirty=!0,this.needsUpload=!1}update(){console.log("Update 3D model bucket")}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;let n=this.getNodesInfo();for(let i of n){let r=i.node;this.uploaded?this.updatePbrBuffer(r):rx(r,e,!0)}for(let i of n)um(i.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let n=!1;if(!e.meshes)return n;for(let i of e.meshes)i.pbrBuffer&&(i.pbrBuffer.updateData(i.featureArray),n=!0);return n}needsReEvaluation(e,n,i){let r=e.transform.projectionOptions,o=e.style.getBrightness(),l=this.brightness!==o;return!!(!this.uploaded||this.dirty||r.name!==this.projection.name||nh(i.paint.get("model-color").value,l)||nh(i.paint.get("model-color-mix-intensity").value,l)||nh(i.paint.get("model-roughness").value,l)||nh(i.paint.get("model-emissive-strength").value,l)||nh(i.paint.get("model-height-based-emissive-strength-multiplier").value,l))&&(this.projection=r,this.brightness=o,!0)}evaluateScale(e,n){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;let i=this.getNodesInfo(),r=this.id.canonical;for(let o of i){let l=o.feature;o.evaluatedScale=n.paint.get("model-scale").evaluate(l,{},r)}}evaluate(e){let n=this.getNodesInfo();for(let i of n){if(!i.node.meshes)continue;let r=i.feature,o=i.node.meshes&&i.node.meshes[0].featureData,l=i.evaluatedColor[2],u=i.evaluatedRMEA[2],h=this.id.canonical;if(i.hasTranslucentParts=!1,o){for(let p=0;p<XD.length;p++){let m=XD[p];m.length&&(r.properties.part=m);let _=e.paint.get("model-color").evaluate(r,{},h),y=e.paint.get("model-color-mix-intensity").evaluate(r,{},h);i.evaluatedColor[p]=[_.r,_.g,_.b,y],i.evaluatedRMEA[p][0]=e.paint.get("model-roughness").evaluate(r,{},h),i.evaluatedRMEA[p][2]=e.paint.get("model-emissive-strength").evaluate(r,{},h),i.evaluatedRMEA[p][3]=_.a,i.emissionHeightBasedParams[p]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(r,{},h),!i.hasTranslucentParts&&_.a<1&&(i.hasTranslucentParts=!0)}delete r.properties.part,f4(i,l!==i.evaluatedColor[2]||u!==i.evaluatedRMEA[2])}i.evaluatedScale=e.paint.get("model-scale").evaluate(r,{},h),this.updatePbrBuffer(i.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,n,i,r){let o=e.findDEMTileFor(i);if(o&&(o.tileID.canonical!==this.terrainTile||n!==this.terrainExaggeration)){if(o.dem&&o.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=o.tileID.overscaledZ;let l=tu.create(e,i,o);if(!l)return;4&this.modelTraits&&this.updateDEM(e,l,i,r);for(let u of this.getNodesInfo()){let h=u.node;if(!h.footprint||!h.footprint.vertices||!h.footprint.vertices.length)continue;let p=h.footprint.vertices,m=l.getElevationAt(p[0].x,p[0].y,!0,!0);for(let _=1;_<p.length;_++)m=Math.min(m,l.getElevationAt(p[_].x,p[_].y,!0,!0));h.elevation=m}}this.terrainTile=o.tileID.canonical,this.terrainExaggeration=n}}updateDEM(e,n,i,r){let o=n._dem._modifiedForSources[r];if(o===void 0&&(n._dem._modifiedForSources[r]=[],o=n._dem._modifiedForSources[r]),o.includes(i.canonical))return;let l=n._dem.dim;o.push(i.canonical);let u=!1;for(let h of this.getNodesInfo()){let p=h.node;if(!p.footprint||!p.footprint.grid)continue;let m=p.footprint.grid,_=n.tileCoordToPixel(m.min.x,m.min.y),y=n.tileCoordToPixel(m.max.x,m.max.y),v=Math.min(Math.min(l-y.y,_.x),Math.min(_.y,l-y.x));if(v<0)continue;let b=We(v,2,5),w=Math.max(0,_.x-b),C=Math.max(0,_.y-b),E=Math.min(y.x+b,l-1),I=Math.min(y.y+b,l-1);for(let A=C;A<=I;++A)for(let R=w;R<=E;++R)jl[A*l+R]=255;let D=0,S=0;for(let A=0;A<m.cellsY;++A)for(let R=0;R<m.cellsX;++R){if(!m.cells[A*m.cellsX+R])continue;let F=n.tileCoordToPixel(m.min.x+R/m.xScale,m.min.y+A/m.yScale),k=n.tileCoordToPixel(m.min.x+(R+1)/m.xScale,m.min.y+(A+1)/m.yScale);for(let L=F.y;L<=Math.min(k.y+1,l-1);++L)for(let z=F.x;z<=Math.min(k.x+1,l-1);++z)jl[L*l+z]===255&&(jl[L*l+z]=0,D+=n.getElevationAtPixel(z,L),S++)}let M=D/S;w=Math.max(1,_.x-b),C=Math.max(1,_.y-b),E=Math.min(y.x+b,l-2),I=Math.min(y.y+b,l-2),u=!0;for(let A=C;A<=I;++A)for(let R=w;R<=E;++R)jl[A*l+R]===0&&(ox[A*l+R]=n._dem.set(R,A,M));for(let A=1;A<b;++A){w=Math.max(1,_.x-A),C=Math.max(1,_.y-A),E=Math.min(y.x+A,l-2),I=Math.min(y.y+A,l-2);for(let R=C;R<=I;++R)for(let F=w;F<=E;++F){let k=R*l+F;if(jl[k]===255){let L=0,z=0,B=-1,G=-1;for(let N=-1;N<=1;++N)for(let W=-1;W<=1;++W){let Y=(R+N)*l+F+W;if(jl[Y]>=A)continue;let te=ox[Y],q=Math.abs(te);q>z&&(L=te,z=q,B=W,G=N)}if(z>.1){let N=1-(A+.5*Math.abs(B*G))/b,W=n._dem.get(F,R)+L*N,Y=n._dem.get(F+B,R+G),te=n._dem.get(F-B,R-G,!0);(W-Y)*(W-te)>0&&(W=(Y+te)/2),ox[k]=n._dem.set(F,R,W),jl[k]=A}}}}}u&&(n._demTile.needsDEMTextureUpload=!0,n._dem._timestamp=yt.now())}getNodesInfo(){if(!this.nodesInfo){this.nodesInfo=[];for(let e of this.nodes)this.nodesInfo.push(new YD(e));this.freeNodes()}return this.nodesInfo}freeNodes(){if(this.nodes){for(let e of this.nodes)dm(e);this.nodes.splice(0,this.nodes.length)}}destroy(){this.freeNodes();let e=this.getNodesInfo();for(let n of e)um(n.node),dm(n.node)}isEmpty(){return!this.nodes.length}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;let i=n.getReplacementRegionsForTile(e.toUnwrapped()),r=this.getNodesInfo();for(let o=0;o<this.nodesInfo.length;o++){let l=r[o].node;r[o].hiddenByReplacement=!!l.footprint&&!i.find(u=>u.footprint===l.footprint)}}getHeightAtTileCoord(e,n){let i=this.getNodesInfo(),r=[];for(let o=0;o<this.nodesInfo.length;o++){let l=i[o],u=l.node.meshes[0];if(e<u.aabb.min[0]||n<u.aabb.min[1]||e>u.aabb.max[0]||n>u.aabb.max[1])continue;let h=(e-u.aabb.min[0])/(u.aabb.max[0]-u.aabb.min[0])*Vl|0,p=Math.min(63,(n-u.aabb.min[1])/(u.aabb.max[1]-u.aabb.min[1])*Vl|0)*Vl+Math.min(63,h);if(!(u.heightmap[p]<0&&l.node.footprint))return l.hiddenByReplacement?void 0:{height:u.heightmap[p],maxHeight:l.feature.properties.height,hidden:!1,verticalScale:l.evaluatedScale[2]};if(l.node.footprint.grid.query(new Q(e,n),new Q(e,n),r),r.length>0)return{height:void 0,maxHeight:l.feature.properties.height,hidden:l.hiddenByReplacement,verticalScale:l.evaluatedScale[2]}}}}function nh(t,e){return!t.isLightConstant&&e}function h4(t,e,n,i,r,o,l,u){let h=(61440&e|(61440&e)>>4)>>8,p=(3840&e|(3840&e)>>4)>>4,m=240&e|(240&e)>>4;n[3]>0&&(h=ft(h,255*n[0],n[3]),p=ft(p,255*n[1],n[3]),m=ft(m,255*n[2],n[3]));let _=h<<8|p,y=m<<8|Math.floor(255*i[3]),v=function(A){let R=We(A,0,2);return Math.min(Math.round(.5*R*255),255)}(i[2])<<8|15*i[0]<<4|15*i[1],b=We(r[0],0,1),w=We(r[1],0,1),C=We(r[2],0,1),E=We(r[3],0,1),I,D,S,M;if(b!==w&&l!==o&&w!==b){let A=l-o;D=1/(A*(w-b)),S=-(o+A*b)/(A*(w-b));let R=We(r[4],-1,1);M=Math.pow(10,R),I=255*C<<8|255*E}else I=65535,D=0,S=1,M=1;if(t.emplaceBack(_,y,v,I,D,S,M),u){let A=u.length;u.clear();for(let R=0;R<A;R++)u.emplaceBack(_,y,v,I,D,S,M)}}function f4(t,e){let n=t.node,i=0;for(let r of n.meshes){if(n.lights&&n.lightMeshIndex===i||!r.featureData)continue;r.featureArray=new dp,r.featureArray.reserve(r.featureData.length);let o=e;for(let l of r.featureData){let u,h=65535&l,p=(15&h)<8?15&h:0,m=l>>16&65535,_=t.evaluatedRMEA[p],y=t.evaluatedColor[p],v=t.emissionHeightBasedParams[p];if(o&&p===2&&n.lights&&(u=new dp,u.resize(10*n.lights.length)),h4(r.featureArray,m,y,_,v,r.aabb.min[2],r.aabb.max[2],u),u&&o){o=!1;let b=n.meshes[n.lightMeshIndex];b.featureArray=u,b.featureArray._trim()}}r.featureArray._trim(),i++}}Ge(KD,"Tiled3dModelBucket",{omit:["layers"]}),Ge(YD,"Tiled3dModelFeature");class p4{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[]}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(e){let n=eS(new Q(0,0),new Q(le,le),e),i=[];for(let r of this._activeRegions){if(r.hiddenByOverlap||!QD(n,r))continue;let o=m4(r.min,r.max,e);i.push({min:o.min,max:o.max,sourceId:this._sourceIds[r.priority],footprint:r.footprint,footprintTileId:r.tileId})}return i}setSources(e){this._setSources(e.map(n=>({getSourceId:()=>n.cache.id,getFootprints:()=>{let i=[];for(let r of n.cache.getVisibleCoordinates()){let o=n.cache.getTile(r).buckets[n.layer];if(o)for(let l of o.getNodesInfo()){let u=l.node;u.footprint&&i.push({footprint:u.footprint,id:r.toUnwrapped()})}}return i}})))}_addSource(e){let n=e.getFootprints();if(n.length!==0){for(let i of n){if(!i.footprint)continue;let r=eS(i.footprint.min,i.footprint.max,i.id);this._activeRegions.push({min:r.min,max:r.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:i.id,footprint:i.footprint})}this._sourceIds.push(e.getSourceId())}}_computeReplacement(){this._activeRegions.sort((n,i)=>n.priority-i.priority||hm(n.min,i.min)||hm(n.max,i.max));let e=this._activeRegions.length!==this._prevRegions.length;if(!e){let n=0,i=0;for(;!e&&n!==this._activeRegions.length;){let r=this._activeRegions[n],o=this._prevRegions[i];e=r.priority!==o.priority||!JD(r,o),++n,++i}}if(e){++this._updateTime;let n=i=>{let r=this._activeRegions;if(i>=r.length)return i;let o=r[i].priority;for(;i<r.length&&r[i].priority===o;)++i;return i};if(this._sourceIds.length>1){let i=0,r=n(i);for(;i!==r;){let o=i,l=i;for(;o!==r;){let u=this._activeRegions[o];u.hiddenByOverlap=!1;for(let h=0;h<l;h++){let p=this._activeRegions[h];if(!p.hiddenByOverlap&&QD(u,p)&&(u.hiddenByOverlap=nS(u.footprint,u.tileId,p.footprint,p.tileId),u.hiddenByOverlap))break}++o}i=r,r=n(i)}}}}_setSources(e){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let n=e.length-1;n>=0;n--)this._addSource(e[n]);this._computeReplacement()}}function hm(t,e){return t.x-e.x||t.y-e.y}function JD(t,e){return hm(t.min,e.min)===0&&hm(t.max,e.max)===0}function QD(t,e){return!(t.min.x>e.max.x||t.max.x<e.min.x||t.min.y>e.max.y||t.max.y<e.min.y)}function eS(t,e,n){let i=1/le,r=1/(1<<n.canonical.z),o=(e.x*i+n.canonical.x)*r+n.wrap,l=(e.y*i+n.canonical.y)*r;return{min:new Q((t.x*i+n.canonical.x)*r+n.wrap,(t.y*i+n.canonical.y)*r),max:new Q(o,l)}}function m4(t,e,n){let i=1<<n.canonical.z,r=((e.x-n.wrap)*i-n.canonical.x)*le,o=(e.y*i-n.canonical.y)*le;return{min:new Q(((t.x-n.wrap)*i-n.canonical.x)*le,(t.y*i-n.canonical.y)*le),max:new Q(r,o)}}function tS(t,e,n,i,r,o,l){let u=t.indices,h=t.vertices,p=[];for(let m=i;m<i+r;m+=3){let _=e[n[m+0]+o],y=e[n[m+1]+o],v=e[n[m+2]+o],b=Math.min(_.x,y.x,v.x),w=Math.max(_.x,y.x,v.x),C=Math.min(_.y,y.y,v.y),E=Math.max(_.y,y.y,v.y);p.length=0,t.grid.query(new Q(b,C),new Q(w,E),p);for(let I=0;I<p.length;I++){let D=p[I];if(Tv(h[u[3*D+0]],h[u[3*D+1]],h[u[3*D+2]],_,y,v,l))return!0}}return!1}function nS(t,e,n,i){if(!t||!n)return!1;let r=t.vertices;if(!e.canonical.equals(i.canonical)||e.wrap!==i.wrap){if(n.vertices.length<t.vertices.length)return nS(n,i,t,e);let o=e.canonical,l=i.canonical,u=Math.pow(2,l.z-o.z);r=t.vertices.map(h=>new Q(h.x*o.x*le*u-l.x*le,h.y*o.y*le*u-l.y*le))}return tS(n,r,t.indices,0,t.indices.length,0,0)}let g4=kp.types,_4=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius"],y4=["fill-extrusion-flood-light-ground-radius"],v4=Math.pow(2,13),x4=Math.pow(2,15)-1,iS=new Q(0,1),Cs=2147483648;function ih(t,e,n,i,r,o,l,u){t.emplaceBack((e<<1)+l,(n<<1)+o,(Math.floor(i*v4)<<1)+r,Math.round(u))}function fm(t,e,n,i,r,o){t.emplaceBack(e.x,e.y,(n.x<<1)+i,(n.y<<1)+r,o)}function rh(t,e,n){t.emplaceBack(e.x,e.y,e.z,n[0]*16384,n[1]*16384,n[2]*16384)}class rS{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class oS{constructor(){this.centroidXY=new Q(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Q(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Q(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0}span(){return new Q(this.max.x-this.min.x,this.max.y-this.min.y)}}class sS{constructor(){this.acc=new Q(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,n){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=n.x,e.min.y=e.max.y=n.y)}appendEdge(e,n,i){this.accCount++,this.acc._add(n);let r=!!this.borders;n.x<e.min.x?(e.min.x=n.x,r=!0):n.x>e.max.x&&(e.max.x=n.x,r=!0),n.y<e.min.y?(e.min.y=n.y,r=!0):n.y>e.max.y&&(e.max.y=n.y,r=!0),((n.x===0||n.x===le)&&n.x===i.x)!=((n.y===0||n.y===le)&&n.y===i.y)&&this.processBorderOverlap(n,i),r&&this.checkBorderIntersection(n,i)}checkBorderIntersection(e,n){n.x<0!=e.x<0&&this.addBorderIntersection(0,ft(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>le!=e.x>le&&this.addBorderIntersection(1,ft(n.y,e.y,(le-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,ft(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>le!=e.y>le&&this.addBorderIntersection(3,ft(n.x,e.x,(le-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);let i=this.borders[e];n<i[0]&&(i[0]=n),n>i[1]&&(i[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;let i=e.x===0?0:1;this.addBorderIntersection(i,n.y),this.addBorderIntersection(i,e.y)}else{let i=e.y===0?2:3;this.addBorderIntersection(i,n.x),this.addBorderIntersection(i,e.x)}}centroid(){return this.accCount===0?new Q(0,0):new Q(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0):0}}function aS(t,e){let n=t.add(e)._unit(),i=We(t.x*n.x+t.y*n.y,-1,1);var r,o,l;return r=Math.acos(i),Math.min(4,Math.max(-4,Math.tan(r)))/4*x4*((o=t).x*(l=e).y-o.y*l.x<0?-1:1)}let b4=[t=>t.x<0,t=>t.x>le,t=>t.y<0,t=>t.y>le];function w4(t,e,n,i){let r=[4];if(i===0)return r;n._mult(i);let o=t.sub(n),l=e.sub(n),u=[t,e,o,l];for(let h=0;h<4;h++)for(let p of u)if(b4[h](p)){r.push(h);break}return r}class lS{constructor(e){this.vertexArray=new D0,this.indexArray=new xi,this.programConfigurations=new Pa(e.layers,e.zoom,n=>y4.includes(n)),this._segments=new yn,this.hiddenByLandmarkVertexArray=new j0,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new yn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,n,i,r=!1){let o=e.length;if(o>2){let l=Math.max(0,this._segments.get().length-1),u=this._segments._prepareSegment(4*o,this.vertexArray.length,2*this._segmentToGroundQuads[l].length),h;l!==this._segments.get().length-1&&(l++,this._segmentToGroundQuads[l]=[],this._segmentToRegionTriCounts[l]=[0,0,0,0,0]);{let p=e[0],m=e[1];h=aS(p.sub(e[o-1])._perp()._unit(),m.sub(p)._perp()._unit())}for(let p=0;p<o;p++){let m=p===o-1?0:p+1,_=e[p],y=e[m],v=e[m===o-1?0:m+1],b=y.sub(_)._perp()._unit(),w=aS(b,v.sub(y)._perp()._unit()),C=h,E=w;if(sx(_,y,n)||r&&dS(_,n)&&dS(y,n)){h=w;continue}let I=u.vertexLength;fm(this.vertexArray,_,y,1,1,C),fm(this.vertexArray,_,y,1,0,C),fm(this.vertexArray,_,y,0,1,E),fm(this.vertexArray,_,y,0,0,E),u.vertexLength+=4;let D=w4(_,y,b,i);for(let S of D)this._segmentToGroundQuads[l].push({id:I,region:S}),this._segmentToRegionTriCounts[l][S]+=2,u.primitiveLength+=2;h=w}}}prepareBorderSegments(){if(!this.hasData())return;let e=this._segments.get(),n=e.length;for(let i=0;i<n;i++)this._segmentToGroundQuads[i].sort((r,o)=>r.region-o.region);for(let i=0;i<n;i++){let r=this._segmentToGroundQuads[i],o=e[i],l=this._segmentToRegionTriCounts[i];l.reduce((h,p)=>h+p,0);let u=0;for(let h=0;h<=4;h++){let p=l[h];if(p!==0){let m=this.regionSegments[h];m||(m=this.regionSegments[h]=new yn);let _={vertexOffset:o.vertexOffset,primitiveOffset:o.primitiveOffset+u,vertexLength:o.vertexLength,primitiveLength:p};m.get().push(_)}u+=p}for(let h=0;h<r.length;h++){let p=r[h].id;this.indexArray.emplaceBack(p,p+1,p+3),this.indexArray.emplaceBack(p,p+3,p+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,n,i,r,o,l){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,n,i,r,o,l)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,WN.members),this.indexBuffer=e.createIndexBuffer(this.indexArray))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,n,i,r,o,l){this.hasData()&&this.programConfigurations.updatePaintArrays(e,n,i,r,o,l)}updateHiddenByLandmark(e){if(!this.hasData())return;let n=e.groundVertexCount+e.groundVertexArrayOffset;if(e.groundVertexCount===0)return;let i=e.flags&Cs?1:0;for(let r=e.groundVertexArrayOffset;r<n;++r)this.hiddenByLandmarkVertexArray.emplace(r,i);this._needsHiddenByLandmarkUpdate=!0}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,XN.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){let n=this.regionSegments[e];n&&n.destroy()}}}}class oh{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new xi,this.footprintVertices=new $r,this.footprintSegments=[],this.layoutVertexArray=new Pl,this.centroidVertexArray=new _T,this.indexArray=new xi,this.programConfigurations=new Pa(e.layers,e.zoom,n=>_4.includes(n)),this.segments=new yn,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.groundEffect=new lS(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[]}populate(e,n,i,r){this.features=[],this.hasPattern=Rv("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=zd(i),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(let{feature:o,id:l,index:u,sourceLayerIndex:h}of e){let p=this.layers[0]._featureFilter.needGeometry,m=za(o,p);if(!this.layers[0]._featureFilter.filter(new Hn(this.zoom),m,i))continue;let _={id:l,sourceLayerIndex:h,index:u,geometry:p?m.geometry:vs(o,i,r),properties:o.properties,type:o.type,patterns:{}},y=this.layoutVertexArray.length;this.hasPattern?this.features.push(Ov("fill-extrusion",this.layers,_,this.zoom,n)):this.addFeature(_,_.geometry,u,i,{},n.availableImages,r,n.brightness),n.featureIndex.insert(o,_.geometry,u,h,this.index,y)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,n,i,r,o,l){for(let u of this.features){let{geometry:h}=u;this.addFeature(u,h,u.index,n,i,r,o,l)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,n,i,r,o){let l=Object.keys(e).length!==0;if(l&&!this.stateDependentLayers.length)return;let u=l?this.stateDependentLayers:this.layers;this.programConfigurations.updatePaintArrays(e,n,u,i,r,o),this.groundEffect.update(e,n,u,i,r,o)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,KN),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,YN.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,ZN.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,i,r,o,l,u,h){let p=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(e,{})/this.tileToMeter,m=[new Q(0,0),new Q(le,le)],_=u.projection,y=_.name==="globe",v=g4[e.type]==="Polygon",b=new sS;b.centroidDataIndex=this.centroidData.length;let w=new oS,C=this.layers[0].paint.get("fill-extrusion-base").evaluate(e,{},r)<=0,E=this.layers[0].paint.get("fill-extrusion-height").evaluate(e,{},r);w.height=E,w.vertexArrayOffset=this.layoutVertexArray.length,w.groundVertexArrayOffset=this.groundEffect.vertexArray.length,y&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new cp);let I=Pv(n,500);for(let F=I.length-1;F>=0;F--){let k=I[F];(k.length===0||(D=k[0]).every(L=>L.x<=0)||D.every(L=>L.x>=le)||D.every(L=>L.y<=0)||D.every(L=>L.y>=le))&&I.splice(F,1)}var D;let S;if(y)S=mS(I,m,r);else{S=[];for(let F of I)S.push({polygon:F,bounds:m})}let M=v?this.edgeRadius:0,A=M>0&&this.zoom<17,R=(F,k)=>{if(F.length===0)return!1;let L=F[F.length-1];return k.x===L.x&&k.y===L.y};for(let{polygon:F,bounds:k}of S){let L=0,z=0;for(let W of F)v&&!W[0].equals(W[W.length-1])&&W.push(W[0]),z+=v?W.length-1:W.length;let B=this.segments.prepareSegment((v?5:4)*z,this.layoutVertexArray,this.indexArray);w.footprintSegIdx<0&&(w.footprintSegIdx=this.footprintSegments.length),w.polygonSegIdx<0&&(w.polygonSegIdx=this.polygonSegments.length);let G={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},N=new rS;if(N.vertexOffset=this.footprintVertices.length,N.indexOffset=3*this.footprintIndices.length,N.ringIndices=[],v){let W=[],Y=[];L=B.vertexLength;for(let q=0;q<F.length;q++){let X=F[q];X.length&&q!==0&&Y.push(W.length/2);let re=[],se,oe;se=X[1].sub(X[0])._perp()._unit(),N.ringIndices.push(X.length-1);for(let ue=1;ue<X.length;ue++){let de=X[ue],pe=X[ue===X.length-1?1:ue+1],ae=de.clone();if(M){oe=pe.sub(de)._perp()._unit();let ge=se.add(oe)._unit(),Ae=M*Math.min(4,1/(se.x*ge.x+se.y*ge.y));ae.x+=Ae*ge.x,ae.y+=Ae*ge.y,ae.x=Math.round(ae.x),ae.y=Math.round(ae.y),se=oe}!C||M!==0&&!A||R(re,ae)||re.push(ae),ih(this.layoutVertexArray,ae.x,ae.y,0,0,1,1,0),B.vertexLength++,this.footprintVertices.emplaceBack(de.x,de.y),W.push(de.x,de.y),y&&rh(this.layoutVertexExtArray,_.projectTilePoint(ae.x,ae.y,r),_.upVector(r,ae.x,ae.y))}C&&(M===0||A)&&(re.length!==0&&R(re,re[0])&&re.pop(),this.groundEffect.addData(re,k,p))}let te=Rp(W,Y);for(let q=0;q<te.length;q+=3)this.footprintIndices.emplaceBack(N.vertexOffset+te[q+0],N.vertexOffset+te[q+1],N.vertexOffset+te[q+2]),this.indexArray.emplaceBack(L+te[q],L+te[q+2],L+te[q+1]),B.primitiveLength++;N.indexCount+=te.length,N.vertexCount+=this.footprintVertices.length-N.vertexOffset}for(let W=0;W<F.length;W++){let Y=F[W];b.startRing(w,Y[0]);let te=Y.length>4&&hS(Y[Y.length-2],Y[0],Y[1]),q=M?C4(Y[Y.length-2],Y[0],Y[1],M):0,X=[],re,se,oe;se=Y[1].sub(Y[0])._perp()._unit();let ue=!0;for(let de=1,pe=0;de<Y.length;de++){let ae=Y[de-1],ge=Y[de],Ae=Y[de===Y.length-1?1:de+1];if(b.appendEdge(w,ge,ae),sx(ge,ae,k)){M&&(se=Ae.sub(ge)._perp()._unit(),ue=!ue);continue}let Pe=ge.sub(ae)._perp(),Ne=Pe.x/(Math.abs(Pe.x)+Math.abs(Pe.y)),Be=Pe.y>0?1:0,lt=ae.dist(ge);if(pe+lt>32768&&(pe=0),M){oe=Ae.sub(ge)._perp()._unit();let ct=uS(ae,ge,Ae,cS(se,oe),M);isNaN(ct)&&(ct=0);let st=ge.sub(ae)._unit();ae=ae.add(st.mult(q))._round(),ge=ge.add(st.mult(-ct))._round(),q=ct,se=oe,C&&this.zoom>=17&&(R(X,ae)||X.push(ae),R(X,ge)||X.push(ge))}let Ye=B.vertexLength,Zt=Y.length>4&&hS(ae,ge,Ae),Bt=fS(pe,te,ue);if(ih(this.layoutVertexArray,ae.x,ae.y,Ne,Be,0,0,Bt),ih(this.layoutVertexArray,ae.x,ae.y,Ne,Be,0,1,Bt),pe+=lt,Bt=fS(pe,Zt,!ue),te=Zt,ih(this.layoutVertexArray,ge.x,ge.y,Ne,Be,0,0,Bt),ih(this.layoutVertexArray,ge.x,ge.y,Ne,Be,0,1,Bt),B.vertexLength+=4,this.indexArray.emplaceBack(Ye+0,Ye+1,Ye+2),this.indexArray.emplaceBack(Ye+1,Ye+3,Ye+2),B.primitiveLength+=2,M){let ct=L+(de===1?Y.length-2:de-2),st=de===1?L:ct+1;if(this.indexArray.emplaceBack(Ye+1,ct,Ye+3),this.indexArray.emplaceBack(ct,st,Ye+3),B.primitiveLength+=2,re===void 0&&(re=Ye),!sx(Ae,Y[de],k)){let Qe=de===Y.length-1?re:B.vertexLength;this.indexArray.emplaceBack(Ye+2,Ye+3,Qe),this.indexArray.emplaceBack(Ye+3,Qe+1,Qe),this.indexArray.emplaceBack(Ye+3,st,Qe+1),B.primitiveLength+=3}ue=!ue}if(y){let ct=this.layoutVertexExtArray,st=_.projectTilePoint(ae.x,ae.y,r),Qe=_.projectTilePoint(ge.x,ge.y,r),Ut=_.upVector(r,ae.x,ae.y),qt=_.upVector(r,ge.x,ge.y);rh(ct,st,Ut),rh(ct,st,Ut),rh(ct,Qe,qt),rh(ct,Qe,qt)}}v&&(L+=Y.length-1),C&&M&&this.zoom>=17&&(X.length!==0&&R(X,X[0])&&X.pop(),this.groundEffect.addData(X,k,p,M>0))}this.footprintSegments.push(N),G.triangleCount=this.indexArray.length-G.triangleArrayOffset,this.polygonSegments.push(G),++w.footprintSegLen,++w.polygonSegLen}if(w.vertexCount=this.layoutVertexArray.length-w.vertexArrayOffset,w.groundVertexCount=this.groundEffect.vertexArray.length-w.groundVertexArrayOffset,w.vertexCount!==0){if(w.centroidXY=b.borders?iS:this.encodeCentroid(b,w),this.centroidData.push(w),b.borders){this.featuresOnBorder.push(b);let F=this.featuresOnBorder.length-1;for(let k=0;k<b.borders.length;k++)b.borders[k][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[k].push(F)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,o,l,r,h),this.groundEffect.addPaintPropertiesData(e,i,o,l,r,h),this.maxHeight=Math.max(this.maxHeight,E)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((n,i)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[i].borders[e][0])}splitToSubtiles(){let e=[];for(let u=0;u<this.centroidData.length;u++){let h=this.centroidData[u],p=+(h.min.y+h.max.y>le),m=2*p+(+(h.min.x+h.max.x>le)^p);for(let _=0;_<h.polygonSegLen;_++){let y=h.polygonSegIdx+_;e.push({centroidIdx:u,subtile:m,polygonSegmentIdx:y,triangleSegmentIdx:this.polygonSegments[y].triangleSegIdx})}}let n=new xi;e.sort((u,h)=>u.triangleSegmentIdx===h.triangleSegmentIdx?u.subtile-h.subtile:u.triangleSegmentIdx-h.triangleSegmentIdx);let i=0,r=0,o=0;for(let u of e){if(u.triangleSegmentIdx!==i)break;o++}let l=e.length;for(;r!==e.length;){i=e[r].triangleSegmentIdx;let u=0,h=r,p=r;for(let m=h;m<o&&e[m].subtile===u;m++)p++;for(;h!==o;){let m=e[h];u=m.subtile;let _=this.centroidData[m.centroidIdx].min.clone(),y=this.centroidData[m.centroidIdx].max.clone(),v={vertexOffset:this.segments.segments[i].vertexOffset,primitiveOffset:n.length,vertexLength:this.segments.segments[i].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let b=h;b<p;b++){let w=e[b],C=this.polygonSegments[w.polygonSegmentIdx],E=this.centroidData[w.centroidIdx].min,I=this.centroidData[w.centroidIdx].max,D=this.indexArray.uint16;for(let S=C.triangleArrayOffset;S<C.triangleArrayOffset+C.triangleCount;S++)n.emplaceBack(D[3*S],D[3*S+1],D[3*S+2]);v.primitiveLength+=C.triangleCount,_.x=Math.min(_.x,E.x),_.y=Math.min(_.y,E.y),y.x=Math.max(y.x,I.x),y.y=Math.max(y.y,I.y)}v.primitiveLength>0&&this.triangleSubSegments.push({segment:v,min:_,max:y}),h=p;for(let b=h;b<o&&e[b].subtile===e[h].subtile;b++)p++}r=o;for(let m=r;m<l&&e[m].triangleSegmentIdx===e[r].triangleSegmentIdx;m++)o++}n._trim(),this.indexArray=n}getVisibleSegments(e,n,i){let r=0,o=0,l=1<<e.canonical.z;if(n){let w=n.getMinMaxForTile(e);w&&(r=w.min,o=w.max)}o+=this.maxHeight;let u=e.toUnwrapped(),h,p=[u.canonical.x/l+u.wrap,u.canonical.y/l],m=[(u.canonical.x+1)/l+u.wrap,(u.canonical.y+1)/l],_=new yn,y=(w,C,E)=>[w[0]*(1-E[0])+C[0]*E[0],w[1]*(1-E[1])+C[1]*E[1]],v=[],b=[];for(let w of this.triangleSubSegments){v[0]=w.min.x/le,v[1]=w.min.y/le,b[0]=w.max.x/le,b[1]=w.max.y/le;let C=y(p,m,v),E=y(p,m,b);if(new On([C[0],C[1],r],[E[0],E[1],o]).intersectsPrecise(i)===0){h&&(_.segments.push(h),h=void 0);continue}let I=w.segment;h&&h.vertexOffset!==I.vertexOffset&&(_.segments.push(h),h=void 0),h?(h.vertexLength+=I.vertexLength,h.primitiveLength+=I.primitiveLength):h={vertexOffset:I.vertexOffset,primitiveLength:I.primitiveLength,vertexLength:I.vertexLength,primitiveOffset:I.primitiveOffset,sortKey:void 0,vaos:{}}}return h&&_.segments.push(h),_}encodeCentroid(e,n){let i=e.centroid(),r=n.span(),o=Math.min(7,Math.round(r.x*this.tileToMeter/10)),l=Math.min(7,Math.round(r.y*this.tileToMeter/10));return new Q(We(i.x,1,le-1)<<3|o,We(i.y,1,le-1)<<3|l)}showCentroid(e){let n=this.centroidData[e.centroidDataIndex];n.flags&=Cs,n.centroidXY.x=0,n.centroidXY.y=0,this.writeCentroidToBuffer(n)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);let n=e.vertexArrayOffset,i=e.vertexCount+e.vertexArrayOffset,r=e.flags&Cs?iS:e.centroidXY,o=this.centroidVertexArray.geta_centroid_pos0(n);if(this.centroidVertexArray.geta_centroid_pos1(n)!==r.y||o!==r.x){for(let l=n;l<i;++l)this.centroidVertexArray.emplace(l,r.x,r.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(let e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,n){if(n.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=n.updateTime;let i=n.getReplacementRegionsForTile(e.toUnwrapped());if(function(o,l){if(o.length!==l.length)return!1;for(let u=0;u<o.length;u++)if(o[u].sourceId!==l[u].sourceId||!JD(o[u],l[u]))return!1;return!0}(this.activeReplacements,i))return;if(this.activeReplacements=i,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(let o of this.centroidData)o.flags&=2147483647;let r=[];for(let o of this.activeReplacements){let l=Math.pow(2,o.footprintTileId.canonical.z-e.canonical.z);for(let u of this.centroidData)if(!(u.flags&Cs||o.min.x>u.max.x||u.min.x>o.max.x||o.min.y>u.max.y||u.min.y>o.max.y))for(let h=0;h<u.footprintSegLen;h++){let p=this.footprintSegments[u.footprintSegIdx+h];if(r.length=0,E4(this.footprintVertices,p.vertexOffset,p.vertexCount,o.footprintTileId.canonical,e.canonical,r),tS(o.footprint,r,this.footprintIndices.uint16,p.indexOffset,p.indexCount,-p.vertexOffset,-l)){u.flags|=Cs;break}}}for(let o of this.centroidData)this.writeCentroidToBuffer(o);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,n,i){let r=!1;for(let o=0;o<i.footprintSegLen;o++){let l=this.footprintSegments[i.footprintSegIdx+o],u=0;for(let h of l.ringIndices){for(let p=u,m=h+u-1;p<h+u;m=p++){let _=this.footprintVertices.int16[2*(p+l.vertexOffset)+0],y=this.footprintVertices.int16[2*(p+l.vertexOffset)+1],v=this.footprintVertices.int16[2*(m+l.vertexOffset)+1];y>n!=v>n&&e<(this.footprintVertices.int16[2*(m+l.vertexOffset)+0]-_)*(n-y)/(v-y)+_&&(r=!r)}u=h}}return r}getHeightAtTileCoord(e,n){let i=Number.NEGATIVE_INFINITY,r=!0,o=4*(e+le)*le+(n+le);if(this.partLookup.hasOwnProperty(o)){let l=this.partLookup[o];return l?{height:l.height,hidden:!!(l.flags&Cs)}:void 0}for(let l of this.centroidData)e>l.max.x||l.min.x>e||n>l.max.y||l.min.y>n||this.footprintContainsPoint(e,n,l)&&l&&l.height>i&&(i=l.height,this.partLookup[o]=l,r=!!(l.flags&Cs));if(i!==Number.NEGATIVE_INFINITY)return{height:i,hidden:r};this.partLookup[o]=void 0}}function cS(t,e){let n=t.add(e)._unit();return t.x*n.x+t.y*n.y}function C4(t,e,n,i){let r=e.sub(t)._perp()._unit(),o=n.sub(e)._perp()._unit();return uS(t,e,n,cS(r,o),i)}function uS(t,e,n,i,r){let o=Math.sqrt(1-i*i);return Math.min(t.dist(e)/3,e.dist(n)/3,r*o/i)}function sx(t,e,n){return t.x<n[0].x&&e.x<n[0].x||t.x>n[1].x&&e.x>n[1].x||t.y<n[0].y&&e.y<n[0].y||t.y>n[1].y&&e.y>n[1].y}function dS(t,e){return t.x<e[0].x||t.x>e[1].x||t.y<e[0].y||t.y>e[1].y}function hS(t,e,n){if(t.x<0||t.x>=le||e.x<0||e.x>=le||n.x<0||n.x>=le)return!1;let i=n.sub(e),r=i.perp(),o=t.sub(e);return(i.x*o.x+i.y*o.y)/Math.sqrt((i.x*i.x+i.y*i.y)*(o.x*o.x+o.y*o.y))>-.866&&r.x*o.x+r.y*o.y<0}function fS(t,e,n){let i=e?2|t:-3&t;return n?1|i:-2&i}function pS(){let t=Math.PI/32,e=Math.tan(t),n=Zc;return n*Math.sqrt(1+2*e*e)-n}function mS(t,e,n){let i=1<<n.z,r=qr(n.x/i),o=qr((n.x+1)/i),l=bi(n.y/i),u=bi((n.y+1)/i);return function(h,p,m,_,y=0,v){let b=[];if(!h.length||!m||!_)return b;let w=(A,R)=>{for(let F of A)b.push({polygon:F,bounds:R})},C=Math.ceil(Math.log2(m)),E=Math.ceil(Math.log2(_)),I=C-E,D=[];for(let A=0;A<Math.abs(I);A++)D.push(I>0?0:1);for(let A=0;A<Math.min(C,E);A++)D.push(0),D.push(1);let S=h;if(S=Lp(S,p[0].y-y,p[1].y+y,1),S=Lp(S,p[0].x-y,p[1].x+y,0),!S.length)return b;let M=[];for(D.length?M.push({polygons:S,bounds:p,depth:0}):w(S,p);M.length;){let A=M.pop(),R=A.depth,F=D[R],k=A.bounds[0],L=A.bounds[1],z=F===0?k.x:k.y,B=F===0?L.x:L.y,G=v?v(F,z,B):.5*(z+B),N=Lp(A.polygons,z-y,G+y,F),W=Lp(A.polygons,G-y,B+y,F);if(N.length){let Y=[k,new Q(F===0?G:L.x,F===1?G:L.y)];D.length>R+1?M.push({polygons:N,bounds:Y,depth:R+1}):w(N,Y)}if(W.length){let Y=[new Q(F===0?G:k.x,F===1?G:k.y),L];D.length>R+1?M.push({polygons:W,bounds:Y,depth:R+1}):w(W,Y)}}return b}(t,e,Math.ceil((o-r)/11.25),Math.ceil((l-u)/11.25),1,(h,p,m)=>{if(h===0)return .5*(p+m);{let _=bi((n.y+p/le)/i);return(Ai(.5*(bi((n.y+m/le)/i)+_))*i-n.y)*le}})}function E4(t,e,n,i,r,o){let l=Math.pow(2,i.z-r.z);for(let u=0;u<n;u++){let h=t.int16[2*(u+e)+0],p=t.int16[2*(u+e)+1];h=(h+r.x*le)*l-i.x*le,p=(p+r.y*le)*l-i.y*le,o.push(new Q(h,p))}}Ge(oh,"FillExtrusionBucket",{omit:["layers","features"]}),Ge(oS,"PartData"),Ge(rS,"FootprintSegment"),Ge(sS,"BorderCentroidData"),Ge(lS,"GroundEffect");let T4=new ii({visibility:new be(ie["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new be(ie["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var I4={paint:new ii({"fill-extrusion-opacity":new be(ie["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new et(ie["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new be(ie["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new be(ie["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new et(ie["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new et(ie["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new et(ie["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new be(ie["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new be(ie["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new be(ie["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new be(ie["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new be(ie["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new be(ie["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new be(ie["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new be(ie["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new et(ie["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new et(ie["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new be(ie["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new be(ie["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new be(ie["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new be(ie["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new be(ie["paint_fill-extrusion"]["fill-extrusion-emissive-strength"])}),layout:T4};class uu extends Q{constructor(e,n,i){super(e,n),this.z=i}}function sh(t,e){return t.x*e.x+t.y*e.y}function gS(t,e){if(t.length===1){let n=0,i=e[n++],r;for(;!r||i.equals(r);)if(r=e[n++],!r)return 1/0;for(;n<e.length;n++){let o=e[n],l=t[0],u=r.sub(i),h=o.sub(i),p=l.sub(i),m=sh(u,u),_=sh(u,h),y=sh(h,h),v=sh(p,u),b=sh(p,h),w=m*y-_*_,C=(y*v-_*b)/w,E=(m*b-_*v)/w,I=i.z*(1-C-E)+r.z*C+o.z*E;if(isFinite(I))return I}return 1/0}{let n=1/0;for(let i of e)n=Math.min(n,i.z);return n}}function _S(t,e,n,i,r,o,l,u){let h=l*r.getElevationAt(t,e,!0,!0),p=o[0]!==0,m=p?o[1]===0?l*(o[0]/7-450):l*function(_,y,v){let b=Math.floor(y[0]/8),w=Math.floor(y[1]/8),C=10*(y[0]-8*b),E=10*(y[1]-8*w),I=_.getElevationAt(b,w,!0,!0),D=_.getMeterToDEM(v),S=Math.floor(.5*(C*D-1)),M=Math.floor(.5*(E*D-1)),A=_.tileCoordToPixel(b,w),R=2*S+1,F=2*M+1,k=function(W,Y,te,q,X){return[W.getElevationAtPixel(Y,te,!0),W.getElevationAtPixel(Y+X,te,!0),W.getElevationAtPixel(Y,te+X,!0),W.getElevationAtPixel(Y+q,te+X,!0)]}(_,A.x-S,A.y-M,R,F),L=Math.abs(k[0]-k[1]),z=Math.abs(k[2]-k[3]),B=Math.abs(k[0]-k[2])+Math.abs(k[1]-k[3]),G=Math.min(.25,.5*D*(L+z)/R),N=Math.min(.25,.5*D*B/F);return I+Math.max(G*C,N*E)}(r,o,u):h;return{base:h+(n===0)?-1:n,top:p?Math.max(m+i,h+n+2):h+i}}let M4=new ii({"line-cap":new et(ie.layout_line["line-cap"]),"line-join":new et(ie.layout_line["line-join"]),"line-miter-limit":new be(ie.layout_line["line-miter-limit"]),"line-round-limit":new be(ie.layout_line["line-round-limit"]),"line-sort-key":new et(ie.layout_line["line-sort-key"]),visibility:new be(ie.layout_line.visibility)});var yS={paint:new ii({"line-opacity":new et(ie.paint_line["line-opacity"]),"line-color":new et(ie.paint_line["line-color"]),"line-translate":new be(ie.paint_line["line-translate"]),"line-translate-anchor":new be(ie.paint_line["line-translate-anchor"]),"line-width":new et(ie.paint_line["line-width"]),"line-gap-width":new et(ie.paint_line["line-gap-width"]),"line-offset":new et(ie.paint_line["line-offset"]),"line-blur":new et(ie.paint_line["line-blur"]),"line-dasharray":new et(ie.paint_line["line-dasharray"]),"line-pattern":new et(ie.paint_line["line-pattern"]),"line-gradient":new Dd(ie.paint_line["line-gradient"]),"line-trim-offset":new be(ie.paint_line["line-trim-offset"]),"line-emissive-strength":new be(ie.paint_line["line-emissive-strength"]),"line-border-width":new et(ie.paint_line["line-border-width"]),"line-border-color":new et(ie.paint_line["line-border-color"])}),layout:M4};let D4=(t,e,n,i,r,o,l)=>{let u=t.transform,h=u.calculatePixelsToTileUnitsMatrix(e);return{u_matrix:xS(t,e,n,i),u_pixels_to_tile_units:h,u_device_pixel_ratio:o,u_units_to_pixels:[1/u.pixelsToGLUnits[0],1/u.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:r,u_texsize:wS(n)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:vS(e,t.transform),u_alpha_discard_threshold:0,u_trim_offset:l,u_emissive_strength:n.paint.get("line-emissive-strength")}},S4=(t,e,n,i,r)=>{let o=t.transform;return{u_matrix:xS(t,e,n,i),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:o.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:r,u_image:0,u_tile_units_to_pixels:vS(e,o),u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function vS(t,e){return 1/Bl(t,1,e.tileZoom)}function xS(t,e,n,i){return t.translatePosMatrix(i||e.tileID.projMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}let bS=t=>{let e=[];wS(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");let n=t.paint.get("line-trim-offset");return n[0]===0&&n[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),t.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER"),e};function wS(t){let e=t.paint.get("line-dasharray").value;return e.value||e.kind!=="constant"}let CS=new class extends et{possiblyEvaluate(t,e){return e=new Hn(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,n,i){return e=$e({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,n,i)}}(yS.paint.properties["line-width"].specification);function ES(t,e){return e>0?e+2*t:t}CS.useIntegerZoom=!0;let A4=new ii({visibility:new be(ie.layout_background.visibility)});var P4={paint:new ii({"background-color":new be(ie.paint_background["background-color"]),"background-pattern":new be(ie.paint_background["background-pattern"]),"background-opacity":new be(ie.paint_background["background-opacity"]),"background-emissive-strength":new be(ie.paint_background["background-emissive-strength"])}),layout:A4};let R4=new ii({visibility:new be(ie.layout_raster.visibility)});var O4={paint:new ii({"raster-opacity":new be(ie.paint_raster["raster-opacity"]),"raster-color":new Dd(ie.paint_raster["raster-color"]),"raster-color-mix":new be(ie.paint_raster["raster-color-mix"]),"raster-color-range":new be(ie.paint_raster["raster-color-range"]),"raster-hue-rotate":new be(ie.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new be(ie.paint_raster["raster-brightness-min"]),"raster-brightness-max":new be(ie.paint_raster["raster-brightness-max"]),"raster-saturation":new be(ie.paint_raster["raster-saturation"]),"raster-contrast":new be(ie.paint_raster["raster-contrast"]),"raster-resampling":new be(ie.paint_raster["raster-resampling"]),"raster-fade-duration":new be(ie.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new be(ie.paint_raster["raster-emissive-strength"]),"raster-array-band":new be(ie.paint_raster["raster-array-band"]),"raster-elevation":new be(ie.paint_raster["raster-elevation"])}),layout:R4};function TS(t,e,n,i,r,o,l,u){let h=[t,n,r,e,i,o,1,1,1],p=[l,u,1],m=Pr.adjoint([],h),[_,y,v]=$.transformMat3(p,p,Pr.transpose(m,m));return Pr.multiply(h,[_,0,0,0,y,0,0,0,v],h)}class Ao extends yi{constructor(e,n,i,r){super(),this.id=e,this.dispatcher=i,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(r),this.options=n,this._dirty=!1}load(e,n){if(this._loaded=n||!1,this.fire(new Ce("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=St(this.map._requestManager.transformRequest(this.url,fe.Image),(i,r)=>{if(this._imageRequest=null,this._loaded=!0,i)this.fire(new mt(i));else if(r){let{HTMLImageElement:o}=x;this.image=r instanceof o?yt.getImageData(r):r,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading()}})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new im(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Ce("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof im||this.texture.destroy()}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let n=e[0][1],i=e[0][1];for(let o of e)o[1]>i&&(i=o[1]),o[1]<n&&(n=o[1]);let r=(i+n)/2;if(r>si?this.onNorthPole=!0:r<-si&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){let o=e.map(Gt.fromLngLat);this.tileID=function(l){let u=1/0,h=1/0,p=-1/0,m=-1/0;for(let b of l)u=Math.min(u,b.x),h=Math.min(h,b.y),p=Math.max(p,b.x),m=Math.max(m,b.y);let _=Math.max(p-u,m-h),y=Math.max(0,Math.floor(-Math.log(_)/Math.LN2)),v=Math.pow(2,y);return new Io(y,Math.floor((u+p)/2*v),Math.floor((h+m)/2*v))}(o),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Ce("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(e){for(let h in this.tiles){let p=this.tiles[h];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture)}if(this._boundsArray)return;let n=zl(this.tileID,this.map.transform.projection),[i,r,o,l]=this.coordinates.map(h=>{let p=n.projection.project(h[0],h[1]);return hD(n,p)._round()});this.perspectiveTransform=function(h,p,m,_,y,v,b,w,C,E){let I=TS(0,0,h,0,0,p,h,p),D=TS(m,_,y,v,b,w,C,E);return Pr.multiply(D,Pr.adjoint(I,I),D),[D[6]/D[8]*h/le,D[7]/D[8]*p/le]}(this.width,this.height,i.x,i.y,r.x,r.y,l.x,l.y,o.x,o.y);let u=this._boundsArray=new Pl;u.emplaceBack(i.x,i.y,0,0),u.emplaceBack(r.x,r.y,le,0),u.emplaceBack(l.x,l.y,0,le),u.emplaceBack(o.x,o.y,le,le),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=e.createVertexBuffer(u,Xv.members),this.boundsSegments=yn.simpleSegment(0,0,4,2)}prepare(){let e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;let n=this.map.painter.context,i=n.gl;!this._dirty||this.texture instanceof im||(this.texture?this.texture.update(this.image):(this.texture=new Zn(n,this.image,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(n)}loadTile(e,n){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},n(null)):(e.state="errored",n(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class F4 extends io{constructor(e){super(e,{}),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isLayerDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}let k4=new ii({visibility:new be(ie.layout_sky.visibility)});var L4={paint:new ii({"sky-type":new be(ie.paint_sky["sky-type"]),"sky-atmosphere-sun":new be(ie.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new be(ie.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new be(ie.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new be(ie.paint_sky["sky-gradient-radius"]),"sky-gradient":new Dd(ie.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new be(ie.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new be(ie.paint_sky["sky-atmosphere-color"]),"sky-opacity":new be(ie.paint_sky["sky-opacity"])}),layout:k4};function ax(t,e,n){let i=[0,0,1],r=Xi.identity([]);return Xi.rotateY(r,r,n?-Tt(t)+Math.PI:Tt(t)),Xi.rotateX(r,r,-Tt(e)),$.transformQuat(i,i,r),$.normalize(i,i)}var N4={paint:new ii({})};let z4={circle:class extends io{constructor(t,e){super(t,wN,e)}createBucket(t){return new wv(t)}queryRadius(t){let e=t;return Yc("circle-radius",this,e)+Yc("circle-stroke-width",this,e)+Ip(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,n,i,r,o,l,u){let h=hM(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,t.pixelToTileUnitsFactor),p=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return pM(t,i,o,l,u,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",h,p)}getProgramIds(){return["circle"]}getDefaultProgramParams(t,e){let n=fM(this);return{config:new Fl(this,e),defines:n,overrideFog:!1}}},heatmap:class extends io{createBucket(t){return new gM(t)}constructor(t,e){super(t,SN,e),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Mp({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return Yc("heatmap-radius",this,t)}queryIntersectsFeature(t,e,n,i,r,o,l,u){let h=this.paint.get("heatmap-radius").evaluate(e,n);return pM(t,i,o,l,u,!0,!0,new Q(0,0),h)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(t,e){return t==="heatmap"?{config:new Fl(this,e),overrideFog:!1}:{}}},hillshade:class extends io{constructor(t,e){super(t,PN,e)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},fill:class extends io{constructor(t,e){super(t,HN,e)}getProgramIds(){let t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getDefaultProgramParams(t,e){return{config:new Fl(this,e),overrideFog:!1}}recalculate(t,e){super.recalculate(t,e);let n=this.paint._values["fill-outline-color"];n.value.kind==="constant"&&n.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Op(t)}queryRadius(){return Ip(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,n,i,r,o){return!t.queryGeometry.isAboveHorizon&&aM(dM(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,t.pixelToTileUnitsFactor),i)}isTileClipped(){return!0}},"fill-extrusion":class extends io{constructor(t,e){super(t,I4,e),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(t){return new oh(t)}queryRadius(){return Ip(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}hasShadowPass(){return!0}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(t,e,n,i,r,o,l,u,h){let p=hM(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),o.angle,t.pixelToTileUnitsFactor),m=this.paint.get("fill-extrusion-height").evaluate(e,n),_=this.paint.get("fill-extrusion-base").evaluate(e,n),y=[0,0],v=u&&o.elevation,b=o.elevation?o.elevation.exaggeration():1,w=t.tile.getBucket(this);if(v&&w instanceof oh){let S=w.centroidVertexArray,M=h+1;M<S.length&&(y[0]=S.geta_centroid_pos0(M),y[1]=S.geta_centroid_pos1(M))}if(y[0]===0&&y[1]===1)return!1;o.projection.name==="globe"&&(i=mS([i],[new Q(0,0),new Q(le,le)],t.tileID.canonical).map(S=>S.polygon).flat());let C=v?u:null,[E,I]=function(S,M,A,R,F,k,L,z,B,G,N){return S.projection.name==="globe"?function(W,Y,te,q,X,re,se,oe,ue,de,pe){let ae=[],ge=[],Ae=W.projection.upVectorScale(pe,W.center.lat,W.worldSize).metersToTile,Pe=[0,0,0,1],Ne=[0,0,0,1],Be=(Ye,Zt,Bt,ct)=>{Ye[0]=Zt,Ye[1]=Bt,Ye[2]=ct,Ye[3]=1},lt=pS();te>0&&(te+=lt),q+=lt;for(let Ye of Y){let Zt=[],Bt=[];for(let ct of Ye){let st=ct.x+X.x,Qe=ct.y+X.y,Ut=W.projection.projectTilePoint(st,Qe,pe),qt=W.projection.upVector(pe,ct.x,ct.y),At=te,En=q;if(se){let ai=_S(st,Qe,te,q,se,oe,ue,de);At+=ai.base,En+=ai.top}te!==0?Be(Pe,Ut.x+qt[0]*Ae*At,Ut.y+qt[1]*Ae*At,Ut.z+qt[2]*Ae*At):Be(Pe,Ut.x,Ut.y,Ut.z),Be(Ne,Ut.x+qt[0]*Ae*En,Ut.y+qt[1]*Ae*En,Ut.z+qt[2]*Ae*En),$.transformMat4(Pe,Pe,re),$.transformMat4(Ne,Ne,re),Zt.push(new uu(Pe[0],Pe[1],Pe[2])),Bt.push(new uu(Ne[0],Ne[1],Ne[2]))}ae.push(Zt),ge.push(Bt)}return[ae,ge]}(S,M,A,R,F,k,L,z,B,G,N):L?function(W,Y,te,q,X,re,se,oe,ue){let de=[],pe=[],ae=[0,0,0,1];for(let ge of W){let Ae=[],Pe=[];for(let Ne of ge){let Be=Ne.x+q.x,lt=Ne.y+q.y,Ye=_S(Be,lt,Y,te,re,se,oe,ue);ae[0]=Be,ae[1]=lt,ae[2]=Ye.base,ae[3]=1,vn.transformMat4(ae,ae,X),ae[3]=Math.max(ae[3],1e-5);let Zt=new uu(ae[0]/ae[3],ae[1]/ae[3],ae[2]/ae[3]);ae[0]=Be,ae[1]=lt,ae[2]=Ye.top,ae[3]=1,vn.transformMat4(ae,ae,X),ae[3]=Math.max(ae[3],1e-5);let Bt=new uu(ae[0]/ae[3],ae[1]/ae[3],ae[2]/ae[3]);Ae.push(Zt),Pe.push(Bt)}de.push(Ae),pe.push(Pe)}return[de,pe]}(M,A,R,F,k,L,z,B,G):function(W,Y,te,q,X){let re=[],se=[],oe=X[8]*Y,ue=X[9]*Y,de=X[10]*Y,pe=X[11]*Y,ae=X[8]*te,ge=X[9]*te,Ae=X[10]*te,Pe=X[11]*te;for(let Ne of W){let Be=[],lt=[];for(let Ye of Ne){let Zt=Ye.x+q.x,Bt=Ye.y+q.y,ct=X[0]*Zt+X[4]*Bt+X[12],st=X[1]*Zt+X[5]*Bt+X[13],Qe=X[2]*Zt+X[6]*Bt+X[14],Ut=X[3]*Zt+X[7]*Bt+X[15],qt=ct+oe,At=st+ue,En=Qe+de,ai=Math.max(Ut+pe,1e-5),xn=ct+ae,Fn=st+ge,fi=Qe+Ae,li=Math.max(Ut+Pe,1e-5);Be.push(new uu(qt/ai,At/ai,En/ai)),lt.push(new uu(xn/li,Fn/li,fi/li))}re.push(Be),se.push(lt)}return[re,se]}(M,A,R,F,k)}(o,i,_,m,p,l,C,y,b,o.center.lat,t.tileID.canonical),D=t.queryGeometry;return function(S,M,A){let R=1/0;aM(A,M)&&(R=gS(A,M[0]));for(let F=0;F<M.length;F++){let k=M[F],L=S[F];for(let z=0;z<k.length-1;z++){let B=k[z],G=[B,k[z+1],L[z+1],L[z],B];sM(A,G)&&(R=Math.min(R,gS(A,G)))}}return R!==1/0&&R}(E,I,D.isPointQuery()?D.screenBounds:D.screenGeometry)}},line:class extends io{constructor(t,e){super(t,yS,e),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if(t==="line-gradient"){let e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Wy,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=CS.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new nm(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(t,e){let n=bS(this);return{config:new Fl(this,e),defines:n,overrideFog:!1}}queryRadius(t){let e=t,n=ES(Yc("line-width",this,e),Yc("line-gap-width",this,e)),i=Yc("line-offset",this,e);return n/2+Math.abs(i)+Ip(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,n,i,r,o){if(t.queryGeometry.isAboveHorizon)return!1;let l=dM(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),o.angle,t.pixelToTileUnitsFactor),u=t.pixelToTileUnitsFactor/2*ES(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),h=this.paint.get("line-offset").evaluate(e,n);return h&&(i=function(p,m){let _=[],y=new Q(0,0);for(let v=0;v<p.length;v++){let b=p[v],w=[];for(let C=0;C<b.length;C++){let E=b[C],I=b[C+1],D=C===0?y:E.sub(b[C-1])._unit()._perp(),S=C===b.length-1?y:I.sub(E)._unit()._perp(),M=D._add(S)._unit();M._mult(1/(M.x*S.x+M.y*S.y)),w.push(M._mult(m)._add(E))}_.push(w)}return _}(i,h*t.pixelToTileUnitsFactor)),function(p,m,_){for(let y=0;y<m.length;y++){let v=m[y];if(p.length>=3){for(let b=0;b<v.length;b++)if(Ba(p,v[b]))return!0}if(yN(p,v,_))return!0}return!1}(l,i,u)}isTileClipped(){return!0}},symbol:Yp,background:class extends io{constructor(t,e){super(t,P4,e)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(t,e){return{overrideFog:!1}}},raster:class extends io{constructor(t,e){super(t,O4,e),this._updateColorRamp()}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}isLayerDraped(t){return!(t&&t._source instanceof Ao)||!t._source.onNorthPole&&!t._source.onSouthPole&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(t){t!=="raster-color"&&t!=="raster-color-range"||this._updateColorRamp()}_updateColorRamp(){if(!this.hasColorMap())return;let t=this._transitionablePaint._values["raster-color"].value.expression,[e,n]=this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0});this.colorRamp=Mp({expression:t,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:e,end:n}],resolution:256}),this.colorRampTexture=null}},sky:class extends io{constructor(t,e){super(t,L4,e),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){t==="sky-gradient"?this._updateColorRamp():t!=="sky-atmosphere-sun"&&t!=="sky-atmosphere-halo-color"&&t!=="sky-atmosphere-color"&&t!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Mp({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){let e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if(this.paint.get("sky-type")==="atmosphere"){let i=this.paint.get("sky-atmosphere-sun"),r=!i,o=t.style.light,l=o.properties.get("position");return r&&o.properties.get("anchor")==="viewport"&&J("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),r?ax(l.azimuthal,90-l.polar,e):ax(i[0],90-i[1],e)}let n=this.paint.get("sky-gradient-center");return ax(n[0],90-n[1],e)}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){let t=this.paint.get("sky-type");return t==="atmosphere"?["skyboxCapture","skybox"]:t==="gradient"?["skyboxGradient"]:null}},slot:class extends io{constructor(t,e){super(t,N4)}},model:class extends io{constructor(t,e){super(t,d4,e)}createBucket(t){return new WD(t)}getProgramIds(){return["model"]}is3D(){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(){return 0}queryIntersectsFeature(){return!1}_handleOverridablePaintPropertyUpdate(t,e,n){return!(!this.layout||e.isDataDriven()||n.isDataDriven()||t!=="model-color"&&t!=="model-color-mix-intensity"&&t!=="model-rotation"&&t!=="model-scale"&&t!=="model-translation"&&t!=="model-emissive-strength")}_isPropertyZoomDependent(t){let e=this._transitionablePaint._values[t];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Ta}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}}};function pm(t,e){return t.type==="custom"?new F4(t):new z4[t.type](t,e)}function B4(t){let{userImage:e}=t;return!!(e&&e.render&&e.render())&&(t.data.replace(new Uint8Array(e.data.buffer)),!0)}class V4 extends yi{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded={},this.requestors=[],this.patterns={},this.atlasImage={},this.atlasTexture={},this.dirty=!0}createScope(e){this.images[e]={},this.loaded[e]=!1,this.updatedImages[e]={},this.patterns[e]={},this.callbackDispatchedThisFrame[e]={},this.atlasImage[e]=new gi({width:1,height:1})}isLoaded(){for(let e in this.loaded)if(!this.loaded[e])return!1;return!0}setLoaded(e,n){if(this.loaded[n]!==e&&(this.loaded[n]=e,e)){for(let{ids:i,callback:r}of this.requestors)this._notify(i,n,r);this.requestors=[]}}hasImage(e,n){return!!this.getImage(e,n)}getImage(e,n){return this.images[n][e]}addImage(e,n,i){this._validate(e,i)&&(this.images[n][e]=i)}_validate(e,n){let i=!0;return this._validateStretch(n.stretchX,n.data&&n.data.width)||(this.fire(new mt(new Error(`Image "${e}" has invalid "stretchX" value`))),i=!1),this._validateStretch(n.stretchY,n.data&&n.data.height)||(this.fire(new mt(new Error(`Image "${e}" has invalid "stretchY" value`))),i=!1),this._validateContent(n.content,n)||(this.fire(new mt(new Error(`Image "${e}" has invalid "content" value`))),i=!1),i}_validateStretch(e,n){if(!e)return!0;let i=0;for(let r of e){if(r[0]<i||r[1]<r[0]||n<r[1])return!1;i=r[1]}return!0}_validateContent(e,n){return!(e&&(e.length!==4||e[0]<0||n.data.width<e[0]||e[1]<0||n.data.height<e[1]||e[2]<0||n.data.width<e[2]||e[3]<0||n.data.height<e[3]||e[2]<e[0]||e[3]<e[1]))}updateImage(e,n,i){i.version=this.images[n][e].version+1,this.images[n][e]=i,this.updatedImages[n][e]=!0}removeImage(e,n){let i=this.images[n][e];delete this.images[n][e],delete this.patterns[n][e],i.userImage&&i.userImage.onRemove&&i.userImage.onRemove()}listImages(e){return Object.keys(this.images[e])}getImages(e,n,i){let r=!0,o=!!this.loaded[n];if(!o)for(let l of e)this.images[n][l]||(r=!1);o||r?this._notify(e,n,i):this.requestors.push({ids:e,scope:n,callback:i})}getUpdatedImages(e){return this.updatedImages[e]}_notify(e,n,i){let r={};for(let o of e){this.images[n][o]||this.fire(new Ce("styleimagemissing",{id:o}));let l=this.images[n][o];l?r[o]={data:l.data.clone(),pixelRatio:l.pixelRatio,sdf:l.sdf,version:l.version,stretchX:l.stretchX,stretchY:l.stretchY,content:l.content,hasRenderCallback:!!(l.userImage&&l.userImage.render)}:J(`Image "${o}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}i(null,r)}getPixelSize(e){let{width:n,height:i}=this.atlasImage[e];return{width:n,height:i}}getPattern(e,n){let i=this.patterns[n][e],r=this.getImage(e,n);if(!r)return null;if(i&&i.position.version===r.version)return i.position;if(i)i.position.version=r.version;else{let o={w:r.data.width+2,h:r.data.height+2,x:0,y:0},l=new jv(o,r);this.patterns[n][e]={bin:o,position:l}}return this._updatePatternAtlas(n),this.patterns[n][e].position}bind(e,n){let i=e.gl,r=this.atlasTexture[n];r?this.dirty&&(r.update(this.atlasImage[n]),this.dirty=!1):(r=new Zn(e,this.atlasImage[n],i.RGBA),this.atlasTexture[n]=r),r.bind(i.LINEAR,i.CLAMP_TO_EDGE)}_updatePatternAtlas(e){let n=[];for(let l in this.patterns[e])n.push(this.patterns[e][l].bin);let{w:i,h:r}=Vv(n),o=this.atlasImage[e];o.resize({width:i||1,height:r||1});for(let l in this.patterns[e]){let{bin:u}=this.patterns[e][l],h=u.x+1,p=u.y+1,m=this.images[e][l].data,_=m.width,y=m.height;gi.copy(m,o,{x:0,y:0},{x:h,y:p},{width:_,height:y}),gi.copy(m,o,{x:0,y:y-1},{x:h,y:p-1},{width:_,height:1}),gi.copy(m,o,{x:0,y:0},{x:h,y:p+y},{width:_,height:1}),gi.copy(m,o,{x:_-1,y:0},{x:h-1,y:p},{width:1,height:y}),gi.copy(m,o,{x:0,y:0},{x:h+_,y:p},{width:1,height:y})}this.dirty=!0}beginFrame(){for(let e in this.images)this.callbackDispatchedThisFrame[e]={}}dispatchRenderCallbacks(e,n){for(let i of e){if(this.callbackDispatchedThisFrame[n][i])continue;this.callbackDispatchedThisFrame[n][i]=!0;let r=this.images[n][i];B4(r)&&this.updateImage(i,n,r)}}}let j4=new ii({anchor:new be(ie.light.anchor),position:new class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return Ve(t.expression.evaluate(e))}interpolate(t,e,n){return{x:ft(t.x,e.x,n),y:ft(t.y,e.y,n),z:ft(t.z,e.z,n),azimuthal:ft(t.azimuthal,e.azimuthal,n),polar:ft(t.polar,e.polar,n)}}}(ie.light.position),color:new be(ie.light.color),intensity:new be(ie.light.intensity)});class IS extends yi{constructor(e,n="flat"){super(),this._transitionable=new Id(j4),this.setLight(e,n),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,n,i={}){this._validate(u3,e,i)||(this._transitionable.setTransitionOrValue(e),this.id=n)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,i){return(!i||i.validate!==!1)&&tp(this,e.call(zc,$e({value:n,style:{glyphs:!0,sprite:!0},styleSpec:ie})))}}let U4=new ii({source:new be(ie.terrain.source),exaggeration:new be(ie.terrain.exaggeration)}),$4=class extends yi{constructor(t,e,n,i){super(),this.scope=n,this._transitionable=new Id(U4,i),this._transitionable.setTransitionOrValue(t,i),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=e}get(){return this._transitionable.serialize()}set(t,e){this._transitionable.setTransitionOrValue(t,e)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}getExaggeration(t){return this._transitioning.possiblyEvaluate(new Hn(t)).get("exaggeration")}isZoomDependent(){let t=this._transitionable._values.exaggeration;return t!=null&&t.value!=null&&t.value.expression!=null&&t.value.expression instanceof Ta}},MS=45,DS=65,Ul=.05;function mm(t,e,n,i){let r=ds(MS,DS,n),[o,l]=SS(t,i),u=1-Math.min(1,Math.exp((e-o)/(l-o)*-6));return u*=u*u,u=Math.min(1,1.00747*u),u*r*t.alpha}function SS(t,e){let n=.5/Math.tan(.5*e);return[t.range[0]+n,t.range[1]+n]}function AS(t,e,n,i,r){let o=$.transformMat4([],[e,n,i],r.mercatorFogMatrix);return mm(t,$.length(o),r.pitch,r._fov)}function PS(t,e,n,i,r,o,l){let u=[[n,i,0],[r,i,0],[r,o,0],[n,o,0]],h=Number.MAX_VALUE,p=-Number.MAX_VALUE;for(let m of u){let _=$.transformMat4([],m,e),y=$.length(_);h=Math.min(h,y),p=Math.max(p,y)}return[mm(t,h,l.pitch,l._fov),mm(t,p,l.pitch,l._fov)]}let G4=new ii({range:new be(ie.fog.range),color:new be(ie.fog.color),"high-color":new be(ie.fog["high-color"]),"space-color":new be(ie.fog["space-color"]),"horizon-blend":new be(ie.fog["horizon-blend"]),"star-intensity":new be(ie.fog["star-intensity"]),"vertical-range":new be(ie.fog["vertical-range"])});class H4 extends yi{constructor(e,n){super(),this._transitionable=new Id(G4),this.set(e),this._transitioning=this._transitionable.untransitioned(),this._transform=n}get state(){let e=this._transform,n=e.projection.name==="globe",i=Ni(e.zoom),r=this.properties.get("range"),o=[.5,3];return{range:n?[ft(o[0],r[0],i),ft(o[1],r[1],i)]:r,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(e,n={}){if(this._validate(f3,e,n))return;let i=$e({},e);for(let r of Object.keys(ie.fog))i[r]===void 0&&(i[r]=ie.fog[r].default);this._transitionable.setTransitionOrValue(i)}getOpacity(e){if(!this._transform.projection.supportsFog)return 0;let n=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:ds(MS,DS,e))*n.a}getOpacityAtLatLng(e,n){return this._transform.projection.supportsFog?function(i,r,o){let l=Gt.fromLngLat(r),u=o.elevation?o.elevation.getAtPointOrZero(l):0;return AS(i,l.x,l.y,u,o)}(this.state,e,n):0}getOpacityForTile(e){if(!this._transform.projection.supportsFog)return[1,1];let n=this._transform.calculateFogTileMatrix(e.toUnwrapped());return PS(this.state,n,0,0,le,le,this._transform)}getOpacityForBounds(e,n,i,r,o){return this._transform.projection.supportsFog?PS(this.state,e,n,i,r,o,this._transform):[1,1]}getFovAdjustedRange(e){return this._transform.projection.supportsFog?SS(this.state,e):[0,1]}isVisibleOnFrustum(e){if(!this._transform.projection.supportsFog)return!1;let n=[4,5,6,7];for(let i of n){let r=e.points[i],o;if(r[2]>=0)o=r;else{let l=e.points[i-4];o=rE(l,r,l[2]/(l[2]-r[2]))}if(AS(this.state,o[0],o[1],0,this._transform)>=Ul)return!0}return!1}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(e,n,i){return(!i||i.validate!==!1)&&tp(this,e.call(zc,$e({value:n,style:{glyphs:!0,sprite:!0},styleSpec:ie})))}}class q4{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class W4{constructor(){this.tasks={},this.taskQueue=[],Ri(["process"],this),this.invoker=new q4(this.process),this.nextId=0}add(e,n){let i=this.nextId++,r=function({type:o,isSymbolTile:l,zoom:u}){return u=u||0,o==="message"?0:o!=="maybePrepare"||l?o!=="parseTile"||l?o==="parseTile"&&l?300-u:o==="maybePrepare"&&l?400-u:500:200-u:100-u}(n);if(r===0){xe();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[i]={fn:e,metadata:n,priority:r,id:i},this.taskQueue.push(i),this.invoker.trigger(),{cancel:()=>{delete this.tasks[i]}}}process(){xe();try{if(this.taskQueue=this.taskQueue.filter(i=>!!this.tasks[i]),!this.taskQueue.length)return;let e=this.pick();if(e===null)return;let n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let r=0;r<this.taskQueue.length;r++){let o=this.tasks[this.taskQueue[r]];o.priority<n&&(n=o.priority,e=r)}if(e===null)return null;let i=this.taskQueue[e];return this.taskQueue.splice(e,1),i}remove(){this.invoker.remove()}}class RS{constructor(e,n,i){this.target=e,this.parent=n,this.mapId=i,this.callbacks={},this.cancelCallbacks={},Ri(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new W4}send(e,n,i,r,o=!1,l){let u=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(i.metadata=l,this.callbacks[u]=i);let h=new Set;return this.target.postMessage({id:u,type:e,hasCallback:!!i,targetMapId:r,mustQueue:o,sourceMapId:this.mapId,data:Vc(n,h)},h),{cancel:()=>{i&&delete this.callbacks[u],this.target.postMessage({id:u,type:"<cancel>",targetMapId:r,sourceMapId:this.mapId})}}}receive(e){let n=e.data,i=n.id;if(i&&(!n.targetMapId||this.mapId===n.targetMapId))if(n.type==="<cancel>"){let r=this.cancelCallbacks[i];delete this.cancelCallbacks[i],r&&r.cancel()}else if(n.mustQueue||xe()){let r=this.callbacks[i];this.cancelCallbacks[i]=this.scheduler.add(()=>this.processTask(i,n),r&&r.metadata||{type:"message"})}else this.processTask(i,n)}processTask(e,n){if(n.type==="<response>"){let i=this.callbacks[e];delete this.callbacks[e],i&&(n.error?i(jc(n.error)):i(null,jc(n.data)))}else{let i=new Set,r=n.hasCallback?(l,u)=>{delete this.cancelCallbacks[e],this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:l?Vc(l):null,data:Vc(u,i)},i)}:l=>{},o=jc(n.data);if(this.parent[n.type])this.parent[n.type](n.sourceMapId,o,r);else if(this.parent.getWorkerSource){let l=n.type.split(".");this.parent.getWorkerSource(n.sourceMapId,l[0],o.source,o.scope)[l[1]](o,r)}else r(new Error(`Could not find function ${n.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}let gm=(()=>{class t{constructor(n,i){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=xc();let r=this.workerPool.acquire(this.id);for(let o=0;o<r.length;o++){let l=new t.Actor(r[o],i,this.id);l.name=`Worker ${o}`,this.actors.push(l)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(n,i,r){vl(this.actors,(o,l)=>{o.send(n,i,l)},r=r||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(n=>{n.remove()}),this.actors=[],this.workerPool.release(this.id)}}return t.Actor=RS,t})();class OS extends yi{constructor(e,n,i,r){super(),this.scope=i,this._options=e,this.properties=new Md(n),this._transitionable=new Id(n,new Map(r)),this._transitionable.setTransitionOrValue(e.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(e){this._transitionable.setTransitionOrValue(this._options.properties,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(e,n){this._options=e,this._transitionable.setTransitionOrValue(e.properties,n)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}let Z4=new ii({color:new be(ie.properties_light_ambient.color),intensity:new be(ie.properties_light_ambient.intensity)}),X4=new ii({direction:new class{constructor(t){this.specification=t}possiblyEvaluate(t,e){return function([n,i]){let r=Ve([1,n,i]);return{x:r.x,y:r.y,z:r.z}}(t.expression.evaluate(e))}interpolate(t,e,n){return{x:ft(t.x,e.x,n),y:ft(t.y,e.y,n),z:ft(t.z,e.z,n)}}}(ie.properties_light_directional.direction),color:new be(ie.properties_light_directional.color),intensity:new be(ie.properties_light_directional.intensity),"cast-shadows":new be(ie.properties_light_directional["cast-shadows"]),"shadow-intensity":new be(ie.properties_light_directional["shadow-intensity"])});class lx{constructor(e,n,i,r){this.screenBounds=e,this.cameraPoint=n,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=i,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,r)}static createFromScreenPoints(e,n){let i,r;if(e instanceof Q||typeof e[0]=="number"){let o=Q.convert(e);i=[o],r=n.isPointAboveHorizon(o)}else{let o=Q.convert(e[0]),l=Q.convert(e[1]);i=[o,l],r=_l(o,l).every(u=>n.isPointAboveHorizon(u))}return new lx(i,n.getCameraPoint(),r,n)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(e){return _l(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],e)}bufferedCameraGeometry(e){let n=this.screenBounds[0],i=this.screenBounds.length===1?this.screenBounds[0].add(new Q(1,1)):this.screenBounds[1],r=_l(n,i,0,!1);return this.cameraPoint.y>i.y&&(this.cameraPoint.x>n.x&&this.cameraPoint.x<i.x?r.splice(3,0,this.cameraPoint):this.cameraPoint.x>=i.x?r[2]=this.cameraPoint:this.cameraPoint.x<=n.x&&(r[3]=this.cameraPoint)),function(o,l){let u=[];for(let h=0;h<o.length;h++){let p=hs(h-1,-1,o.length-1),m=hs(h+1,-1,o.length-1),_=o[h],y=o[m],v=o[p].sub(_).unit(),b=y.sub(_).unit(),w=b.angleWithSep(v.x,v.y),C=v.add(b).unit().mult(-1*l/Math.sin(w/2));u.push(_.add(C))}return u}(r,e)}bufferedCameraGeometryGlobe(e){let n=this.screenBounds[0],i=this.screenBounds.length===1?this.screenBounds[0].add(new Q(1,1)):this.screenBounds[1],r=_l(n,i,e),o=this.cameraPoint.clone();switch(3*((o.y>n.y)+(o.y>i.y))+((o.x>n.x)+(o.x>i.x))){case 0:r[0]=o,r[4]=o.clone();break;case 1:r.splice(1,0,o);break;case 2:r[1]=o;break;case 3:r.splice(4,0,o);break;case 5:r.splice(2,0,o);break;case 6:r[3]=o;break;case 7:r.splice(3,0,o);break;case 8:r[2]=o}return r}containsTile(e,n,i,r=0){let o=e.queryPadding/n._pixelsPerMercatorPixel+1,l=i?this._bufferedCameraMercator(o,n):this._bufferedScreenMercator(o,n),u=e.tileID.wrap+(l.unwrapped?r:0),h=l.polygon.map(C=>hD(e.tileTransform,C,u));if(!uM(h,0,0,le,le))return;u=e.tileID.wrap+(this.screenGeometryMercator.unwrapped?r:0);let p=this.screenGeometryMercator.polygon.map(C=>fD(e.tileTransform,C,u)),m=p.map(C=>new Q(C[0],C[1])),_=n.getFreeCameraOptions().position||new Gt(0,0,0),y=fD(e.tileTransform,_,u),v=p.map(C=>{let E=$.sub(C,C,y);return $.normalize(E,E),new yp(y,E)}),b=Bl(e,1,n.zoom)*n._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:m,tilespaceRays:v,bufferedTilespaceGeometry:h,bufferedTilespaceBounds:(w=cy(h),w.min.x=We(w.min.x,0,le),w.min.y=We(w.min.y,0,le),w.max.x=We(w.max.x,0,le),w.max.y=We(w.max.y,0,le),w),tile:e,tileID:e.tileID,pixelToTileUnitsFactor:b};var w}_bufferedScreenMercator(e,n){let i=FS(e);if(this._screenRaycastCache[i])return this._screenRaycastCache[i];{let r;return r=n.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(e),n):{polygon:this.bufferedScreenGeometry(e).map(o=>n.pointCoordinate3D(o)),unwrapped:!0},this._screenRaycastCache[i]=r,r}}_bufferedCameraMercator(e,n){let i=FS(e);if(this._cameraRaycastCache[i])return this._cameraRaycastCache[i];{let r;return r=n.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(e),n):{polygon:this.bufferedCameraGeometry(e).map(o=>n.pointCoordinate3D(o)),unwrapped:!0},this._cameraRaycastCache[i]=r,r}}_projectAndResample(e,n){let i=function(o,l){let u=ne.multiply([],l.pixelMatrix,l.globeMatrix),h=[0,-xr,0,1],p=[0,xr,0,1],m=[0,0,0,1];vn.transformMat4(h,h,u),vn.transformMat4(p,p,u),vn.transformMat4(m,m,u);let _=new Q(h[0]/h[3],h[1]/h[3]),y=new Q(p[0]/p[3],p[1]/p[3]),v=Ba(o,_)&&h[3]<m[3],b=Ba(o,y)&&p[3]<m[3];if(!v&&!b)return null;let w=function(R,F,k){for(let L=1;L<R.length;L++){let z=ah(F.pointCoordinate3D(R[L-1]).x),B=ah(F.pointCoordinate3D(R[L]).x);if(k<0){if(z<B)return{idx:L,t:-z/(B-1-z)}}else if(B<z)return{idx:L,t:(1-z)/(B+1-z)}}return null}(o,l,v?-1:1);if(!w)return null;let{idx:C,t:E}=w,I=C>1?cx(o.slice(0,C),l):[],D=C<o.length?cx(o.slice(C),l):[];I=I.map(R=>new Q(ah(R.x),R.y)),D=D.map(R=>new Q(ah(R.x),R.y));let S=[...I];S.length===0&&S.push(D[D.length-1]);let M=ft(S[S.length-1].y,(D.length===0?I[0]:D[0]).y,E),A;return A=v?[new Q(0,M),new Q(0,0),new Q(1,0),new Q(1,M)]:[new Q(1,M),new Q(1,1),new Q(0,1),new Q(0,M)],S.push(...A),D.length===0?S.push(I[0]):S.push(...D),{polygon:S.map(R=>new Gt(R.x,R.y)),unwrapped:!1}}(e,n);if(i)return i;let r=function(o,l){let u=!1,h=-1/0,p=0;for(let _=0;_<o.length-1;_++)o[_].x>h&&(h=o[_].x,p=_);for(let _=0;_<o.length-1;_++){let y=(p+_)%(o.length-1),v=o[y],b=o[y+1];Math.abs(v.x-b.x)>.5&&(v.x<b.x?(v.x+=1,y===0&&(o[o.length-1].x+=1)):(b.x+=1,y+1===o.length-1&&(o[0].x+=1)),u=!0)}let m=Ii(l.center.lng);return u&&m<Math.abs(m-1)&&o.forEach(_=>{_.x-=1}),{polygon:o,unwrapped:u}}(cx(e,n).map(o=>new Q(ah(o.x),o.y)),n);return{polygon:r.polygon.map(o=>new Gt(o.x,o.y)),unwrapped:r.unwrapped}}}function cx(t,e){return rM(t,n=>{let i=e.pointCoordinate3D(n);n.x=i.x,n.y=i.y},1/256)}function ah(t){return t<0?1+t%1:t%1}function FS(t){return 100*t|0}function ux(t,e,n,i,r){let o=function(l,u){if(l)return r(l);if(u){t.url&&u.tiles&&t.tiles&&delete t.tiles;let h=Nr($e(u,t),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);u.vector_layers&&(h.vectorLayers=u.vector_layers,h.vectorLayerIds=h.vectorLayers.map(p=>p.id)),h.tiles=e.canonicalizeTileset(h,t.url),r(null,h)}};return t.url?Me(e.transformRequest(e.normalizeSourceURL(t.url,null,n,i),fe.Source),o):yt.frame(()=>o(null,t))}class _m{constructor(e,n,i){this.bounds=Hr.convert(this.validateBounds(e)),this.minzoom=n||0,this.maxzoom=i||24}validateBounds(e){return Array.isArray(e)&&e.length===4?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}contains(e){let n=Math.pow(2,e.z),i=Math.floor(Ii(this.bounds.getWest())*n),r=Math.floor(Ai(this.bounds.getNorth())*n),o=Math.ceil(Ii(this.bounds.getEast())*n),l=Math.ceil(Ai(this.bounds.getSouth())*n);return e.x>=i&&e.x<o&&e.y>=r&&e.y<l}}class kS{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new Qs({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){let i=this.getKey(e,n);return this.positions[i]}trim(){let e=this.width,n=this.height=If(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,i){let r=[],o=e.length%2==1?-e[e.length-1]*i:0,l=e[0]*i,u=!0;r.push({left:o,right:l,isDash:u,zeroLength:e[0]===0});let h=e[0];for(let p=1;p<e.length;p++){u=!u;let m=e[p];o=h*i,h+=m,l=h*i,r.push({left:o,right:l,isDash:u,zeroLength:m===0})}return r}addRoundDash(e,n,i){let r=n/2;for(let o=-i;o<=i;o++){let l=this.width*(this.nextRow+i+o),u=0,h=e[u];for(let p=0;p<this.width;p++){p/h.right>1&&(h=e[++u]);let m=Math.abs(p-h.left),_=Math.abs(p-h.right),y=Math.min(m,_),v,b=o/i*(r+1);if(h.isDash){let w=r-Math.abs(b);v=Math.sqrt(y*y+w*w)}else v=r-Math.sqrt(y*y+b*b);this.image.data[l+p]=Math.max(0,Math.min(255,v+128))}}}addRegularDash(e,n){for(let h=e.length-1;h>=0;--h){let p=e[h],m=e[h+1];p.zeroLength?e.splice(h,1):m&&m.isDash===p.isDash&&(m.left=p.left,e.splice(h,1))}let i=e[0],r=e[e.length-1];i.isDash===r.isDash&&(i.left=r.left-this.width,r.right=i.right+this.width);let o=this.width*this.nextRow,l=0,u=e[l];for(let h=0;h<this.width;h++){h/u.right>1&&(u=e[++l]);let p=Math.abs(h-u.left),m=Math.abs(h-u.right),_=Math.min(p,m);this.image.data[o+h]=Math.max(0,Math.min(255,(u.isDash?_:-_)+n+128))}}addDash(e,n){let i=this.getKey(e,n);if(this.positions[i])return this.positions[i];let r=n==="round",o=r?7:0,l=2*o+1;if(this.nextRow+l>this.height)return J("LineAtlas out of space"),null;e.length===0&&e.push(1);let u=0;for(let m=0;m<e.length;m++)e[m]<0&&(J("Negative value is found in line dasharray, replacing values with 0"),e[m]=0),u+=e[m];if(u!==0){let m=this.width/u,_=this.getDashRanges(e,this.width,m);r?this.addRoundDash(_,m,o):this.addRegularDash(_,n==="square"?.5*m:0)}let h=this.nextRow+o;this.nextRow+=l;let p={tl:[h,o],br:[u,0]};return this.positions[i]=p,p}}Ge(kS,"LineAtlas");let LS=1*Yo;class NS{constructor(e){let n={},i=[];for(let u in e){let h=e[u],p=n[u]={};for(let m in h.glyphs){let _=h.glyphs[+m];if(!_||_.bitmap.width===0||_.bitmap.height===0)continue;let y=_.metrics.localGlyph?LS:1,v={x:0,y:0,w:_.bitmap.width+2*y,h:_.bitmap.height+2*y};i.push(v),p[m]=v}}let{w:r,h:o}=Vv(i),l=new Qs({width:r||1,height:o||1});for(let u in e){let h=e[u];for(let p in h.glyphs){let m=h.glyphs[+p];if(!m||m.bitmap.width===0||m.bitmap.height===0)continue;let _=n[u][p],y=m.metrics.localGlyph?LS:1;Qs.copy(m.bitmap,l,{x:0,y:0},{x:_.x+y,y:_.y+y},m.bitmap)}}this.image=l,this.positions=n}}Ge(NS,"GlyphAtlas");class Y4{constructor(e){this.tileID=new Jt(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.scope=e.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.promoteId=e.promoteId,this.isSymbolTile=e.isSymbolTile,this.tileTransform=zl(e.tileID.canonical,e.projection),this.projection=e.projection,this.brightness=e.brightness,this.extraShadowCaster=!!e.extraShadowCaster}parse(e,n,i,r,o){this.status="parsing",this.data=e,this.collisionBoxArray=new U0;let l=new MM(Object.keys(e.layers).sort()),u=new Lv(this.tileID,this.promoteId);u.bucketLayerIDs=[];let h={},p=new kS(256,256),m={featureIndex:u,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:p,availableImages:i,brightness:this.brightness},_=n.familiesBySource[this.source];for(let I in _){let D=e.layers[I];if(!D)continue;let S=!1,M=!1,A=!1;for(let k of _[I])k[0].type==="symbol"?S=!0:M=!0,k[0].is3D()&&k[0].type!=="model"&&(A=!0);if(this.extraShadowCaster&&!A||this.isSymbolTile===!0&&!S||this.isSymbolTile===!1&&!M)continue;D.version===1&&J(`Vector tile source "${this.source}" layer "${I}" does not use vector tile spec v2 and therefore may have some rendering errors.`);let R=l.encode(I),F=[];for(let k=0;k<D.length;k++){let L=D.feature(k),z=u.getId(L,I);F.push({feature:L,id:z,index:k,sourceLayerIndex:R})}for(let k of _[I]){let L=k[0];(!this.extraShadowCaster||L.is3D()&&L.type!=="model")&&(this.isSymbolTile!==void 0&&L.type==="symbol"!==this.isSymbolTile||L.minzoom&&this.zoom<Math.floor(L.minzoom)||L.maxzoom&&this.zoom>=L.maxzoom||L.visibility!=="none"&&(dx(k,this.zoom,m.brightness,i),(h[L.id]=L.createBucket({index:u.bucketLayerIDs.length,layers:k,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:R,sourceID:this.source,projection:this.projection.spec})).populate(F,m,this.tileID.canonical,this.tileTransform),u.bucketLayerIDs.push(k.map(z=>z.id))))}}let y,v,b,w;p.trim();let C={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},E=()=>{if(y)return this.status="done",o(y);if(this.extraShadowCaster)this.status="done",o(null,{buckets:xl(h).filter(I=>!I.isEmpty()),featureIndex:u,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:m.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(v&&b&&w){let I=new NS(v),D=new iD(b,w);for(let S in h){let M=h[S];M instanceof Kd?(dx(M.layers,this.zoom,m.brightness,i),qz(M,v,I.positions,b,D.iconPositions,this.showCollisionBoxes,i,this.tileID.canonical,this.tileZoom,this.projection,this.brightness)):M.hasPattern&&(M instanceof nm||M instanceof Op||M instanceof oh)&&(dx(M.layers,this.zoom,m.brightness,i),M.addFeatures(m,this.tileID.canonical,D.patternPositions,i,this.tileTransform,this.brightness))}this.status="done",o(null,{buckets:xl(h).filter(S=>!S.isEmpty()),featureIndex:u,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:I.image,lineAtlas:p,imageAtlas:D,brightness:m.brightness})}};if(!this.extraShadowCaster){let I=wc(m.glyphDependencies,M=>Object.keys(M).map(Number));Object.keys(I).length?r.send("getGlyphs",{uid:this.uid,stacks:I,scope:this.scope},(M,A)=>{y||(y=M,v=A,E())},void 0,!1,C):v={};let D=Object.keys(m.iconDependencies);D.length?r.send("getImages",{icons:D,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(M,A)=>{y||(y=M,b=A,E())},void 0,!1,C):b={};let S=Object.keys(m.patternDependencies);S.length?r.send("getImages",{icons:S,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(M,A)=>{y||(y=M,w=A,E())},void 0,!1,C):w={}}E()}}function dx(t,e,n,i){let r=new Hn(e,{brightness:n});for(let o of t)o.recalculate(r,i)}class zS{constructor(e){this.entries={},this.scheduler=e}request(e,n,i,r){let o=this.entries[e]=this.entries[e]||{callbacks:[]};if(o.result){let[l,u]=o.result;return this.scheduler?this.scheduler.add(()=>{r(l,u)},n):r(l,u),()=>{}}return o.callbacks.push(r),o.cancel||(o.cancel=i((l,u)=>{o.result=[l,u];for(let h of o.callbacks)this.scheduler?this.scheduler.add(()=>{h(l,u)},n):h(l,u);setTimeout(()=>delete this.entries[e],3e3)})),()=>{o.result||(o.callbacks=o.callbacks.filter(l=>l!==r),o.callbacks.length||(o.cancel(),delete this.entries[e]))}}}function BS(t,e,n){let i=JSON.stringify(t.request);return t.data&&(this.deduped.entries[i]={result:[null,t.data]}),this.deduped.request(i,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},r=>{let o=Oe(t.request,(l,u,h,p)=>{l?r(l):u&&r(null,{vectorTile:n?void 0:new Fv(new Bp(u)),rawData:u,cacheControl:h,expires:p})});return()=>{o.cancel(),r()}},e)}class VS extends yi{constructor(e,n,i,r){if(super(),this.id=e,this.dispatcher=i,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,$e(this,Nr(n,["url","scheme","tileSize","promoteId"])),this._options=$e({type:"vector"},n),this._collectResourceTiming=!!n.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(r),this._tileWorkers={},this._deduped=new zS}load(e){this._loaded=!1,this.fire(new Ce("dataloading",{dataType:"source"}));let n=Array.isArray(this.map._language)?this.map._language.join():this.map._language,i=this.map._worldview;this._tileJSONRequest=ux(this._options,this.map._requestManager,n,i,(r,o)=>{this._tileJSONRequest=null,this._loaded=!0,r?(n&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${n}`),i&&i.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${i}`),this.fire(new mt(r))):o&&($e(this,o),o.bounds&&(this.tileBounds=new _m(o.bounds,this.minzoom,this.maxzoom)),dy(o.tiles,this.map._requestManager._customAccessToken),this.fire(new Ce("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Ce("data",{dataType:"source",sourceDataType:"content"}))),e&&e(r)})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();let e=hr(this.id,this.scope);this.load(()=>this.map.style.clearSource(e))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return $e({},this._options)}loadTile(e,n){let i=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),r={request:this.map._requestManager.transformRequest(i,fe.Tile),data:void 0,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:yt.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:e.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:e.isExtraShadowCaster};if(r.request.collectResourceTiming=this._collectResourceTiming,e.actor&&e.state!=="expired")e.state==="loading"?e.reloadCallback=n:e.request=e.actor.send("reloadTile",r,o.bind(this));else if(e.actor=this._tileWorkers[i]=this._tileWorkers[i]||this.dispatcher.getActor(),this.dispatcher.ready)e.request=e.actor.send("loadTile",r,o.bind(this),void 0,!0);else{let l=BS.call({deduped:this._deduped},r,(u,h)=>{u||!h?o.call(this,u):(r.data={cacheControl:h.cacheControl,expires:h.expires,rawData:h.rawData.slice(0)},e.actor&&e.actor.send("loadTile",r,o.bind(this),void 0,!0))},!0);e.request={cancel:l}}function o(l,u){return delete e.request,e.aborted?n(null):l&&l.status!==404?n(l):(u&&u.resourceTiming&&(e.resourceTiming=u.resourceTiming),this.map._refreshExpiredTiles&&u&&e.setExpiryData(u),e.loadVectorData(u,this.map.painter),Ec(this.dispatcher),n(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(e){e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope}),e.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class hx extends yi{constructor(e,n,i,r){super(),this.id=e,this.dispatcher=i,this.setEventedParent(r),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=$e({type:"raster"},n),$e(this,Nr(n,["url","scheme","tileSize"]))}load(e){this._loaded=!1,this.fire(new Ce("dataloading",{dataType:"source"})),this._tileJSONRequest=ux(this._options,this.map._requestManager,null,null,(n,i)=>{this._tileJSONRequest=null,this._loaded=!0,n?this.fire(new mt(n)):i&&($e(this,i),i.bounds&&(this.tileBounds=new _m(i.bounds,this.minzoom,this.maxzoom)),dy(i.tiles),this.fire(new Ce("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Ce("data",{dataType:"source",sourceDataType:"content"}))),e&&e(n)})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();let e=hr(this.id,this.scope);this.load(()=>this.map.style.clearSource(e))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return $e({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,n){let i=yt.devicePixelRatio>=2,r=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),i,this.tileSize);e.request=St(this.map._requestManager.transformRequest(r,fe.Tile),(o,l,u,h)=>(delete e.request,e.aborted?(e.state="unloaded",n(null)):o?(e.state="errored",n(o)):l?(this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:u,expires:h}),e.setTexture(l,this.map.painter),e.state="loaded",Ec(this.dispatcher),void n(null)):n(null)))}abortTile(e,n){e.request&&(e.request.cancel(),delete e.request),n()}unloadTile(e,n){e.texture&&e.texture instanceof Zn?(e.destroy(!0),e.texture&&e.texture instanceof Zn&&this.map.painter.saveTileTexture(e.texture)):e.destroy(),n()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function K4(){return Vm.workerClass!=null?new Vm.workerClass:new x.Worker(Vm.workerUrl)}let fx="mapboxgl_preloaded_worker_pool";class du{constructor(){this.active={}}acquire(e){if(!this.workers)for(this.workers=[];this.workers.length<du.workerCount;)this.workers.push(new K4);return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(n=>{n.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[fx]}numActive(){return Object.keys(this.active).length}}let lh;function ch(){return lh||(lh=new du),lh}du.workerCount=2;let ym,px,Qo,mx=null;function jS(){return xe()&&self.worker&&self.worker.dracoUrl?self.worker.dracoUrl:px||O.DRACO_URL}let gx=5123,_x=5126,yx={5120:Int8Array,5121:Uint8Array,5122:Int16Array,[gx]:Uint16Array,5125:Uint32Array,[_x]:Float32Array},J4={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",[gx]:"DT_UINT16",5125:"DT_UINT32",[_x]:"DT_FLOAT32"},vx={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function US(t,e,n){let i=n.json.bufferViews.length,r=n.buffers.length;e.bufferView=i,n.json.bufferViews[i]={buffer:r,byteLength:t.byteLength},n.buffers[r]=t}let xx="KHR_draco_mesh_compression";function Q4(t,e){let n=t.extensions&&t.extensions[xx];if(!n)return;let i=new Qo.Decoder,r=qS(e,n.bufferView),o=new Qo.Mesh;if(!i.DecodeArrayToMesh(r,r.byteLength,o))throw new Error("Failed to decode Draco mesh");let l=e.json.accessors[t.indices],u=yx[l.componentType],h=l.count*u.BYTES_PER_ELEMENT,p=Qo._malloc(h);u===Uint16Array?i.GetTrianglesUInt16Array(o,h,p):i.GetTrianglesUInt32Array(o,h,p),US(Qo.memory.buffer.slice(p,p+h),l,e),Qo._free(p);for(let m of Object.keys(n.attributes)){let _=i.GetAttributeByUniqueId(o,n.attributes[m]),y=e.json.accessors[t.attributes[m]],v=J4[y.componentType],b=y.count*vx[y.type]*yx[y.componentType].BYTES_PER_ELEMENT,w=Qo._malloc(b);i.GetAttributeDataArrayForAllPoints(o,_,Qo[v],b,w),US(Qo.memory.buffer.slice(w,w+b),y,e),Qo._free(w)}i.destroy(),o.destroy(),delete t.extensions[xx]}let $S=1179937895,GS=new TextDecoder("utf8");function HS(t,e){return new URL(t,e).href}function eV(t,e,n,i){return fetch(HS(t.uri,i)).then(r=>r.arrayBuffer()).then(r=>{e.buffers[n]=r})}function qS(t,e){let n=t.json.bufferViews[e];return new Uint8Array(t.buffers[n.buffer],n.byteOffset||0,n.byteLength)}function tV(t,e,n,i){if(t.uri){let r=HS(t.uri,i);return fetch(r).then(o=>o.blob()).then(o=>x.createImageBitmap(o)).then(o=>{e.images[n]=o})}if(t.bufferView!==void 0){let r=qS(e,t.bufferView),o=new x.Blob([r],{type:t.mimeType});return x.createImageBitmap(o).then(l=>{e.images[n]=l})}}function WS(t,e=0,n){let i={json:null,images:[],buffers:[]};if(new Uint32Array(t,e,1)[0]===$S){let p=new Uint32Array(t,e),m=2,_=(p[m++]>>2)-3,y=p[m++]>>2;if(m++,i.json=JSON.parse(GS.decode(p.subarray(m,m+y))),m+=y,m<_){let v=p[m++];m++;let b=e+(m<<2);i.buffers[0]=t.slice(b,b+v)}}else i.json=JSON.parse(GS.decode(new Uint8Array(t,e)));let{buffers:r,images:o,meshes:l,extensionsUsed:u}=i.json,h=Promise.resolve();if(r){let p=[];for(let m=0;m<r.length;m++){let _=r[m];_.uri?p.push(eV(_,i,m,n)):i.buffers[m]||(i.buffers[m]=null)}h=Promise.all(p)}return h.then(()=>{let p=[],m=u&&u.includes(xx);if(m&&p.push(function(){if(!Qo)return ym||(ym=function(_){let y,v=null;function b(){y=new Uint8Array(v.buffer)}function w(){throw new Error("Unexpected Draco error.")}let C={a:{a:w,d:function(E,I,D){return y.copyWithin(E,I,I+D)},c:function(E){let I=y.length,D=Math.max(E>>>0,Math.ceil(1.2*I)),S=Math.ceil((D-I)/65536);try{return v.grow(S),b(),!0}catch{return!1}},b:w}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(_,C):_.then(E=>E.arrayBuffer()).then(E=>WebAssembly.instantiate(E,C))).then(E=>{let{Rb:I,Qb:D,P:S,T:M,X:A,Ja:R,La:F,Qa:k,Va:L,Wa:z,eb:B,jb:G,f:N,e:W,yb:Y,zb:te,Ab:q,Bb:X,Db:re,Gb:se}=E.instance.exports;v=W;let oe=(()=>{let ue=0,de=0,pe=0,ae=0;return ge=>{pe&&(I(ae),I(ue),de+=pe,pe=ue=0),ue||(de+=128,ue=D(de));let Ae=ge.length+7&-8,Pe=ue;Ae>=de&&(pe=Ae,Pe=ae=D(Ae));for(let Ne=0;Ne<ge.length;Ne++)y[Pe+Ne]=ge[Ne];return Pe}})();return b(),N(),{memory:W,_free:I,_malloc:D,Mesh:class{constructor(){this.ptr=S()}destroy(){M(this.ptr)}},Decoder:class{constructor(){this.ptr=R()}destroy(){G(this.ptr)}DecodeArrayToMesh(ue,de,pe){let ae=oe(ue),ge=F(this.ptr,ae,de,pe.ptr);return!!A(ge)}GetAttributeByUniqueId(ue,de){return{ptr:k(this.ptr,ue.ptr,de)}}GetTrianglesUInt16Array(ue,de,pe){L(this.ptr,ue.ptr,de,pe)}GetTrianglesUInt32Array(ue,de,pe){z(this.ptr,ue.ptr,de,pe)}GetAttributeDataArrayForAllPoints(ue,de,pe,ae,ge){B(this.ptr,ue.ptr,de.ptr,pe,ae,ge)}},DT_INT8:Y(),DT_UINT8:te(),DT_INT16:q(),DT_UINT16:X(),DT_UINT32:re(),DT_FLOAT32:se()}})}(fetch(jS())),ym.then(_=>{Qo=_,ym=void 0}))}()),o)for(let _=0;_<o.length;_++)p.push(tV(o[_],i,_,n));return(p.length?Promise.all(p):Promise.resolve()).then(()=>{if(m&&l)for(let{primitives:_}of l)for(let y of _)Q4(y,i);return i})})}function ZS(t){return fetch(t).then(e=>e.arrayBuffer()).then(e=>WS(e,0,t))}class XS{constructor(e,n,i){if(this.triangleCount=n.length/3,this.min=new Q(0,0),this.max=new Q(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0||i===0)return;let r=e.map(m=>m.x),o=e.map(m=>m.y);this.min=new Q(Math.min(...r),Math.min(...o)),this.max=new Q(Math.max(...r),Math.max(...o));let l=this.max.sub(this.min);l.x=Math.max(l.x,1),l.y=Math.max(l.y,1);let u=Math.max(l.x,l.y)/i;this.cellsX=Math.max(1,Math.ceil(l.x/u)),this.cellsY=Math.max(1,Math.ceil(l.y/u)),this.xScale=1/u,this.yScale=1/u;let h=[];for(let m=0;m<this.triangleCount;m++){let _=e[n[3*m+0]].sub(this.min),y=e[n[3*m+1]].sub(this.min),v=e[n[3*m+2]].sub(this.min),b=Wa(Math.floor(Math.min(_.x,y.x,v.x)),this.xScale,this.cellsX),w=Wa(Math.floor(Math.max(_.x,y.x,v.x)),this.xScale,this.cellsX),C=Wa(Math.floor(Math.min(_.y,y.y,v.y)),this.yScale,this.cellsY),E=Wa(Math.floor(Math.max(_.y,y.y,v.y)),this.yScale,this.cellsY),I=new Q(0,0),D=new Q(0,0),S=new Q(0,0),M=new Q(0,0);for(let A=C;A<=E;++A){I.y=D.y=A*u,S.y=M.y=(A+1)*u;for(let R=b;R<=w;++R)I.x=S.x=R*u,D.x=M.x=(R+1)*u,(Tv(_,y,v,I,D,M)||Tv(_,y,v,I,M,S))&&h.push({cellIdx:A*this.cellsX+R,triIdx:m})}}if(h.length===0)return;h.sort((m,_)=>m.cellIdx-_.cellIdx||m.triIdx-_.triIdx);let p=0;for(;p<h.length;){let m=h[p].cellIdx,_={start:this.payload.length,len:0};for(;p<h.length&&h[p].cellIdx===m;)++_.len,this.payload.push(h[p++].triIdx);this.cells[m]=_}}query(e,n,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>n.x||e.y>this.max.y||this.min.y>n.y)return;this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8)));for(let h=0;h<this.lookup.length;h++)this.lookup[h]=0;let r=Wa(e.x-this.min.x,this.xScale,this.cellsX),o=Wa(n.x-this.min.x,this.xScale,this.cellsX),l=Wa(e.y-this.min.y,this.yScale,this.cellsY),u=Wa(n.y-this.min.y,this.yScale,this.cellsY);for(let h=l;h<=u;h++)for(let p=r;p<=o;p++){let m=this.cells[h*this.cellsX+p];if(m)for(let _=0;_<m.len;_++){let y=this.payload[m.start+_],v=Math.floor(y/8),b=1<<y%8;if(!(this.lookup[v]&b)&&(this.lookup[v]|=b,i.push(y),i.length===this.triangleCount))return}}}}function Wa(t,e,n){return Math.max(0,Math.min(n-1,Math.floor(t*e)))}function $l(t,e){let n=t.json.bufferViews[e.bufferView];return new yx[e.componentType](t.buffers[n.buffer],(e.byteOffset||0)+(n.byteOffset||0),e.count*vx[e.type])}function nV(t,e,n){let i=t.indices,r=t.attributes,o={};o.indexArray=new xi;let l=e.json.accessors[i],u=l.count/3;o.indexArray.reserve(u);let h=$l(e,l);for(let y=0;y<u;y++)o.indexArray.emplaceBack(h[3*y],h[3*y+1],h[3*y+2]);o.indexArray._trim(),o.vertexArray=new Ol;let p=e.json.accessors[r.POSITION];o.vertexArray.reserve(p.count);let m=$l(e,p);for(let y=0;y<p.count;y++)o.vertexArray.emplaceBack(m[3*y],m[3*y+1],m[3*y+2]);if(o.vertexArray._trim(),o.aabb=new On(p.min,p.max),o.centroid=function(y,v){let b=[0,0,0],w=y.length;if(w>0){for(let C=0;C<w;C++){let E=3*y[C];b[0]+=v[E],b[1]+=v[E+1],b[2]+=v[E+2]}b[0]/=w,b[1]/=w,b[2]/=w}return b}(h,m),r.COLOR_0!==void 0){let y=e.json.accessors[r.COLOR_0],v=vx[y.type];if(y.componentType===_x){o.colorArray=v===3?new Ol:new Gs,o.colorArray.reserve(y.count);let b=$l(e,y);if(v===3)for(let w=0;w<y.count;w++)o.colorArray.emplaceBack(b[3*w],b[3*w+1],b[3*w+2]);else for(let w=0;w<y.count;w++)o.colorArray.emplaceBack(b[4*w],b[4*w+1],b[4*w+2],b[4*w+3]);o.colorArray._trim()}else if(y.componentType===gx&&v===4){o.colorArray=new Gs,o.colorArray.resize(y.count);let b=$l(e,y),w=1/65535,C=o.colorArray.float32;for(let E=0;E<4*b.length;++E)C[E]=b[E]*w}else J(`glTF color buffer parsing for accessor ${JSON.stringify(y)} is not supported`)}if(r.NORMAL!==void 0){o.normalArray=new Ol;let y=e.json.accessors[r.NORMAL];o.normalArray.reserve(y.count);let v=$l(e,y);for(let b=0;b<y.count;b++)o.normalArray.emplaceBack(v[3*b],v[3*b+1],v[3*b+2]);o.normalArray._trim()}if(r.TEXCOORD_0!==void 0&&n.length>0){o.texcoordArray=new Pd;let y=e.json.accessors[r.TEXCOORD_0];o.texcoordArray.reserve(y.count);let v=$l(e,y);for(let b=0;b<y.count;b++)o.texcoordArray.emplaceBack(v[2*b],v[2*b+1]);o.texcoordArray._trim()}let _=t.material;return o.material=function(y,v){let{emissiveFactor:b=[0,0,0],alphaMode:w="OPAQUE",alphaCutoff:C=.5,normalTexture:E,occlusionTexture:I,emissiveTexture:D,doubleSided:S}=y,{baseColorFactor:M=[1,1,1,1],metallicFactor:A=1,roughnessFactor:R=1,baseColorTexture:F,metallicRoughnessTexture:k}=y.pbrMetallicRoughness||{};return{pbrMetallicRoughness:{baseColorFactor:new Rt(...M),metallicFactor:A,roughnessFactor:R,baseColorTexture:F?v[F.index]:void 0,metallicRoughnessTexture:k?v[k.index]:void 0},doubleSided:S,emissiveFactor:b,alphaMode:w,alphaCutoff:C,normalTexture:E?v[E.index]:void 0,occlusionTexture:I?v[I.index]:void 0,emissionTexture:D?v[D.index]:void 0,defined:y.defined===void 0}}(_!==void 0?e.json.materials[_]:{defined:!1},n),r._FEATURE_RGBA4444!==void 0&&(o.featureData=new Uint32Array($l(e,e.json.accessors[r._FEATURE_RGBA4444]).buffer)),o}function YS(t,e,n){let{matrix:i,rotation:r,translation:o,scale:l,mesh:u,extras:h,children:p}=t,m={};if(m.matrix=i||ne.fromRotationTranslationScale([],r||[0,0,0,1],o||[0,0,0],l||[1,1,1]),u!==void 0){m.meshes=n[u];let _=m.anchor=[0,0];for(let y of m.meshes){let{min:v,max:b}=y.aabb;_[0]+=v[0]+b[0],_[1]+=v[1]+b[1]}_[0]=Math.floor(_[0]/m.meshes.length/2),_[1]=Math.floor(_[1]/m.meshes.length/2)}if(h&&(h.id&&(m.id=h.id),h.lights&&(m.lights=function(_){if(!_.length)return[];let y=function(E){let I=atob(E),D=new Uint8Array(I.length);for(let S=0;S<I.length;S++)D[S]=I.codePointAt(S);return D}(_),v=[],b=y.length/24,w=new Uint16Array(y.buffer),C=new Float32Array(y.buffer);for(let E=0;E<b;E++){let I=w[2*E*6]/30,D=w[2*E*6+1]/30,S=w[2*E*6+10]/100,M=C[6*E+1],A=C[6*E+2],R=C[6*E+3],F=C[6*E+4],k=R-M,L=F-A,z=Math.hypot(k,L);v.push({pos:[M+.5*k,A+.5*L,D],normal:[L/z,-k/z,0],width:z,height:I,depth:S,points:[M,A,R,F]})}return v}(h.lights))),p){let _=[];for(let y of p)_.push(YS(e.json.nodes[y],e,n));m.children=_}return m}function iV(t){if(t.vertices.length===0||t.indices.length===0)return null;let[e,n]=[t.vertices[0].clone(),t.vertices[0].clone()];for(let l=1;l<t.vertices.length;++l){let u=t.vertices[l];e.x=Math.min(e.x,u.x),e.y=Math.min(e.y,u.y),n.x=Math.max(n.x,u.x),n.y=Math.max(n.y,u.y)}let i=Math.ceil(Math.max(n.x-e.x,n.y-e.y)/256),r=Math.max(8,i),o=new XS(t.vertices,t.indices,r);return{vertices:t.vertices,indices:t.indices,grid:o,min:e,max:n}}function rV(t){if(!t.extras||!t.extras.ground)return null;let e=t.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;let n=e[0];if(!n||!Array.isArray(n)||n.length===0)return null;let i=[];for(let l of n){if(!Array.isArray(l)||l.length!==2)continue;let u=l[0],h=l[1];typeof u=="number"&&typeof h=="number"&&i.push(new Q(u,h))}if(i.length<3)return null;i.length>1&&i[i.length-1].equals(i[0])&&i.pop();let r=0;for(let l=0;l<i.length;l++){let u=i[l],h=i[(l+1)%i.length],p=i[(l+2)%i.length];r+=(u.x-h.x)*(p.y-h.y)-(p.x-h.x)*(u.y-h.y)}r>0&&i.reverse();let o=Rp(i.flatMap(l=>[l.x,l.y]),[]);return o.length===0?null:{vertices:i,indices:o}}function oV(t){let e=[],n=[],i=0;for(let r of t){i=e.length;let o=r.vertexArray.float32,l=r.indexArray.uint16;for(let u=0;u<r.vertexArray.length;u++)e.push(new Q(o[3*u+0],o[3*u+1]));for(let u=0;u<3*r.indexArray.length;u++)n.push(l[u]+i)}if(n.length%3!=0)return null;for(let r=0;r<n.length;r+=3){let o=e[n[r+0]],l=e[n[r+1]],u=e[n[r+2]];(o.x-l.x)*(u.y-l.y)-(u.x-l.x)*(o.y-l.y)>0&&([n[r+1],n[r+2]]=[n[r+2],n[r+1]])}return{vertices:e,indices:n}}function bx(t){let e=function(h,p){let m=[],_=x.WebGL2RenderingContext;if(h.json.textures)for(let y of h.json.textures){let v={magFilter:_.LINEAR,minFilter:_.NEAREST,wrapS:_.REPEAT,wrapT:_.REPEAT};y.sampler!==void 0&&Object.assign(v,h.json.samplers[y.sampler]),m.push({image:p[y.source],sampler:v,uploaded:!1})}return m}(t,t.images),n=function(h,p){let m=[];for(let _ of h.json.meshes){let y=[];for(let v of _.primitives)y.push(nV(v,h,p));m.push(y)}return m}(t,e),{scenes:i,scene:r,nodes:o}=t.json,l=i?i[r||0].nodes:o,u=[];for(let h of l)u.push(YS(o[h],t,n));return function(h,p,m){let _={},y=new Set;for(let v=0;v<h.length;v++){let b=m[p[v]];if(!b.extras)continue;let w=b.extras["mapbox:footprint:version"],C=b.extras["mapbox:footprint:id"];(w||C)&&y.add(v),w==="1.0.0"&&C&&(_[C]=v)}for(let v=0;v<h.length;v++){if(y.has(v))continue;let b=h[v],w=m[p[v]];if(!w.extras)continue;let C=null;b.id in _&&(C=oV(h[_[b.id]].meshes)),C||(C=rV(w)),C&&(b.footprint=iV(C))}if(y.size>0){let v=Array.from(y.values()).sort((b,w)=>b-w);for(let b=v.length-1;b>=0;b--)h.splice(v[b],1)}}(u,l,t.json.nodes),u}function sV(t){t.heightmap=new Float32Array(4096),t.heightmap.fill(-1);let e=t.vertexArray.float32,n=t.aabb.min[0]-1,i=t.aabb.min[1]-1,r=Vl/(t.aabb.max[0]-n+2),o=Vl/(t.aabb.max[1]-i+2);for(let l=0;l<e.length;l+=3){let u=e[l+2],h=(e[l+0]-n)*r|0,p=(e[l+1]-i)*o|0;u>t.heightmap[p*Vl+h]&&(t.heightmap[p*Vl+h]=u)}}function aV(t,e){let n={};n.indexArray=new xi,n.indexArray.reserve(4*t.length),n.vertexArray=new Ol,n.vertexArray.reserve(10*t.length),n.colorArray=new Gs,n.vertexArray.reserve(10*t.length);let i=0;for(let l of t){let u=Math.min(10,Math.max(4,1.3*l.height))*e,h=[-l.normal[1],l.normal[0],0],p=Math.min(.29,.1*l.width/l.depth),m=l.width-2*l.depth*e*(p+.01),_=$.scaleAndAdd([],l.pos,h,m/2),y=$.scaleAndAdd([],l.pos,h,-m/2),v=[_[0],_[1],_[2]+l.height],b=[y[0],y[1],y[2]+l.height],w=$.scaleAndAdd([],l.normal,h,p);$.scale(w,w,u);let C=$.scaleAndAdd([],l.normal,h,-p);$.scale(C,C,u),$.add(w,_,w),$.add(C,y,C),_[2]+=.1,y[2]+=.1,n.vertexArray.emplaceBack(w[0],w[1],w[2]),n.vertexArray.emplaceBack(C[0],C[1],C[2]),n.vertexArray.emplaceBack(_[0],_[1],_[2]),n.vertexArray.emplaceBack(y[0],y[1],y[2]),n.vertexArray.emplaceBack(v[0],v[1],v[2]),n.vertexArray.emplaceBack(b[0],b[1],b[2]),n.vertexArray.emplaceBack(_[0],_[1],_[2]),n.vertexArray.emplaceBack(y[0],y[1],y[2]),n.vertexArray.emplaceBack(w[0],w[1],w[2]),n.vertexArray.emplaceBack(C[0],C[1],C[2]);let E=m/u/2;n.colorArray.emplaceBack(-E-p,-1,E,.8),n.colorArray.emplaceBack(E+p,-1,E,.8),n.colorArray.emplaceBack(-E,0,E,1.3),n.colorArray.emplaceBack(E,0,E,1.3),n.colorArray.emplaceBack(E+p,-.8,E,.7),n.colorArray.emplaceBack(E+p,-.8,E,.7),n.colorArray.emplaceBack(0,0,E,1.3),n.colorArray.emplaceBack(0,0,E,1.3),n.colorArray.emplaceBack(E+p,-1.2,E,.8),n.colorArray.emplaceBack(E+p,-1.2,E,.8),n.indexArray.emplaceBack(6+i,4+i,8+i),n.indexArray.emplaceBack(7+i,9+i,5+i),n.indexArray.emplaceBack(0+i,1+i,2+i),n.indexArray.emplaceBack(1+i,3+i,2+i),i+=10}let r={defined:!0,emissiveFactor:[0,0,0]},o={};return o.baseColorFactor=Rt.white,r.pbrMetallicRoughness=o,n.material=r,n.aabb=new On([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),n}Ge(XS,"TriangleGridIndex");let wx={vector:VS,raster:hx,"raster-dem":class extends hx{constructor(t,e,n,i){super(t,e,n,i),this.type="raster-dem",this.maxzoom=22,this._options=$e({type:"raster-dem"},e),this.encoding=e.encoding||"mapbox"}loadTile(t,e){let n=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function i(r,o){r&&(t.state="errored",e(r)),o&&(t.dem=o,t.dem.onDeserialize(),t.needsHillshadePrepare=!0,t.needsDEMTextureUpload=!0,t.state="loaded",e(null))}t.request=St(this.map._requestManager.transformRequest(n,fe.Tile),(function(r,o,l,u){if(delete t.request,t.aborted)t.state="unloaded",e(null);else if(r)t.state="errored",e(r);else if(o){this.map._refreshExpiredTiles&&t.setExpiryData({cacheControl:l,expires:u});let p=x.ImageBitmap&&o instanceof x.ImageBitmap&&PC(),m=1-(o.width-((h=o.width)<=1?1:Math.pow(2,Math.floor(Math.log(h)/Math.LN2))))/2;m<1||t.neighboringTiles||(t.neighboringTiles=this._getNeighboringTiles(t.tileID));let _=p?o:yt.getImageData(o,m),y={uid:t.uid,coord:t.tileID,source:this.id,scope:this.scope,rawImageData:_,encoding:this.encoding,padding:m};t.actor&&t.state!=="expired"||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",y,i.bind(this),void 0,!0))}var h}).bind(this))}_getNeighboringTiles(t){let e=t.canonical,n=Math.pow(2,e.z),i=(e.x-1+n)%n,r=e.x===0?t.wrap-1:t.wrap,o=(e.x+1+n)%n,l=e.x+1===n?t.wrap+1:t.wrap,u={};return u[new Jt(t.overscaledZ,r,e.z,i,e.y).key]={backfilled:!1},u[new Jt(t.overscaledZ,l,e.z,o,e.y).key]={backfilled:!1},e.y>0&&(u[new Jt(t.overscaledZ,r,e.z,i,e.y-1).key]={backfilled:!1},u[new Jt(t.overscaledZ,t.wrap,e.z,e.x,e.y-1).key]={backfilled:!1},u[new Jt(t.overscaledZ,l,e.z,o,e.y-1).key]={backfilled:!1}),e.y+1<n&&(u[new Jt(t.overscaledZ,r,e.z,i,e.y+1).key]={backfilled:!1},u[new Jt(t.overscaledZ,t.wrap,e.z,e.x,e.y+1).key]={backfilled:!1},u[new Jt(t.overscaledZ,l,e.z,o,e.y+1).key]={backfilled:!1}),u}},geojson:class extends yi{constructor(t,e,n,i){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=n.getActor(),this.setEventedParent(i),this._data=e.data,this._options=$e({},e),this._collectResourceTiming=e.collectResourceTiming,e.maxzoom!==void 0&&(this.maxzoom=e.maxzoom),e.type&&(this.type=e.type),e.attribution&&(this.attribution=e.attribution),this.promoteId=e.promoteId;let r=le/this.tileSize;this.workerOptions=$e({source:this.id,scope:this.scope,cluster:e.cluster||!1,geojsonVtOptions:{buffer:(e.buffer!==void 0?e.buffer:128)*r,tolerance:(e.tolerance!==void 0?e.tolerance:.375)*r,extent:le,maxZoom:this.maxzoom,lineMetrics:e.lineMetrics||!1,generateId:e.generateId||!1},superclusterOptions:{maxZoom:e.clusterMaxZoom!==void 0?e.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,e.clusterMinPoints||2),extent:le,radius:(e.clusterRadius!==void 0?e.clusterRadius:50)*r,log:!1,generateId:e.generateId||!1},clusterProperties:e.clusterProperties,filter:e.filter},e.workerOptions)}onAdd(t){this.map=t,this.setData(this._data)}setData(t){return this._data=t,this._updateWorkerData(),this}getClusterExpansionZoom(t,e){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id,scope:this.scope},e),this}getClusterChildren(t,e){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id,scope:this.scope},e),this}getClusterLeaves(t,e,n,i){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:t,limit:e,offset:n},i),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new Ce("dataloading",{dataType:"source"})),this._loaded=!1;let t=$e({},this.workerOptions);t.scope=this.scope;let e=this._data;typeof e=="string"?(t.request=this.map._requestManager.transformRequest(yt.resolveURL(e),fe.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(e),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(n,i)=>{if(this._loaded=!0,this._pendingLoad=null,n)this.fire(new mt(n));else{let r={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&i&&i.resourceTiming&&i.resourceTiming[this.id]&&(r.resourceTiming=i.resourceTiming[this.id]),this.fire(new Ce("data",r)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(t,e){let n=t.actor?"reloadTile":"loadTile";t.actor=this.actor;let i={type:this.type,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,scope:this.scope,pixelRatio:yt.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0};t.request=this.actor.send(n,i,(r,o)=>(delete t.request,t.destroy(),t.aborted?e(null):r?e(r):(t.loadVectorData(o,this.map.painter,n==="reloadTile"),e(null))),void 0,n==="loadTile")}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return $e({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends Ao{constructor(t,e,n,i){super(t,e,n,i),this.roundZoom=!0,this.type="video",this.options=e}load(){this._loaded=!1;let t=this.options;this.urls=[];for(let e of t.urls)this.urls.push(this.map._requestManager.transformRequest(e,fe.Source).url);(function(e,n){let i=x.document.createElement("video");i.muted=!0,i.onloadstart=function(){n(null,i)};for(let r=0;r<e.length;r++){let o=x.document.createElement("source");Le(e[r])||(i.crossOrigin="Anonymous"),o.src=e[r],i.appendChild(o)}})(this.urls,(e,n)=>{this._loaded=!0,e?this.fire(new mt(e)):n&&(this.video=n,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){let e=this.video.seekable;t<e.start(0)||t>e.end(0)?this.fire(new mt(new Ue(`sources.${this.id}`,null,`Playback for this video can be set only between the ${e.start(0)} and ${e.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;let t=this.map.painter.context,e=t.gl;this.texture?this.video.paused||(this.texture.bind(e.LINEAR,e.CLAMP_TO_EDGE),e.texSubImage2D(e.TEXTURE_2D,0,0,0,e.RGBA,e.UNSIGNED_BYTE,this.video)):(this.texture=new Zn(t,this.video,e.RGBA),this.texture.bind(e.LINEAR,e.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(t)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:Ao,model:class extends yi{constructor(t,e,n,i){super(),this.id=t,this.type="model",this.models=[],this._loaded=!1,this._options=e}load(){let t=[];for(let e in this._options.models){let n=this._options.models[e],i=ZS(this.map._requestManager.transformRequest(n.uri,fe.Model).url).then(r=>{if(!r)return;let o=bx(r),l=new GD(e,n.position,n.orientation,o);l.computeBoundsAndApplyParent(),this.models.push(l)}).catch(r=>{this.fire(new mt(new Error(`Could not load model ${e} from ${n.uri}: ${r.message}`)))});t.push(i)}return Promise.allSettled(t).then(()=>{this._loaded=!0,this.fire(new Ce("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(e=>{this.fire(new mt(new Error(`Could not load models: ${e.message}`)))})}onAdd(t){this.map=t,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(t,e){}serialize(){return{type:"model"}}},"batched-model":class extends yi{constructor(t,e,n,i){super(),this.type="batched-model",this.id=t,this.tileSize=512,this._options=e,this.tiles=this._options.tiles,this.maxzoom=e.maxzoom||19,this.minzoom=e.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=n,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(i)}onAdd(t){this.map=t,this.load()}load(t){this._loaded=!1,this.fire(new Ce("dataloading",{dataType:"source"}));let e=Array.isArray(this.map._language)?this.map._language.join():this.map._language,n=this.map._worldview;this._tileJSONRequest=ux(this._options,this.map._requestManager,e,n,(i,r)=>{this._tileJSONRequest=null,this._loaded=!0,i?(e&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${e}`),n&&n.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${n}`),this.fire(new mt(i))):r&&($e(this,r),r.bounds&&(this.tileBounds=new _m(r.bounds,this.minzoom,this.maxzoom)),dy(r.tiles,this.map._requestManager._customAccessToken),this.fire(new Ce("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Ce("data",{dataType:"source",sourceDataType:"content"}))),t&&t(i)})}hasTransition(){return!1}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loaded(){return this._loaded}loadTile(t,e){let n=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),i={request:this.map._requestManager.transformRequest(n,fe.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0};if(t.actor&&t.state!=="expired")if(t.state==="loading")t.reloadCallback=e;else{if(t.buckets){let o=Object.values(t.buckets);for(let l of o)l.dirty=!0;return void(t.state="loaded")}t.request=t.actor.send("reloadTile",i,r.bind(this))}else t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",i,r.bind(this),void 0,!0);function r(o,l){return t.aborted?e(null):o&&o.status!==404?e(o):(l&&(l.resourceTiming&&(t.resourceTiming=l.resourceTiming),this.map._refreshExpiredTiles&&t.setExpiryData(l),t.buckets=rt(rt({},t.buckets),l.buckets)),t.state="loaded",void e(null))}}serialize(){return $e({},this._options)}},canvas:class extends Ao{constructor(t,e,n,i){super(t,e,n,i),e.coordinates?Array.isArray(e.coordinates)&&e.coordinates.length===4&&!e.coordinates.some(r=>!Array.isArray(r)||r.length!==2||r.some(o=>typeof o!="number"))||this.fire(new mt(new Ue(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new mt(new Ue(`sources.${t}`,null,'missing required property "coordinates"'))),e.animate&&typeof e.animate!="boolean"&&this.fire(new mt(new Ue(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),e.canvas?typeof e.canvas=="string"||e.canvas instanceof x.HTMLCanvasElement||this.fire(new mt(new Ue(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new mt(new Ue(`sources.${t}`,null,'missing required property "canvas"'))),this.options=e,this.animate=e.animate===void 0||e.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof x.HTMLCanvasElement?this.options.canvas:x.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new mt(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;let e=this.map.painter.context;this.texture?!t&&!this._playing||this.texture instanceof im||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new Zn(e,this.canvas,e.gl.RGBA,{premultiply:!0}),this._prepareData(e)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(let t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}},custom:class extends yi{constructor(t,e,n,i){super(),this.id=t,this.type="custom",this._dataType="raster",this._dispatcher=n,this._implementation=e,this.setEventedParent(i),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new mt(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new mt(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new _m(this._implementation.bounds,this.minzoom,this.maxzoom)),e.update=this._update.bind(this),e.clearTiles=this._clearTiles.bind(this),e.coveringTiles=this._coveringTiles.bind(this),$e(this,Nr(e,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return Nr(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new Ce("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new Ce("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(t){this._map=t,this._loaded=!1,this.fire(new Ce("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(t),this.load()}onRemove(t){this._implementation.onRemove&&this._implementation.onRemove(t)}hasTile(t){if(this._implementation.hasTile){let{x:e,y:n,z:i}=t.canonical;return this._implementation.hasTile({x:e,y:n,z:i})}return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,e){let{x:n,y:i,z:r}=t.tileID.canonical,o=new x.AbortController;t.request=Promise.resolve(this._implementation.loadTile({x:n,y:i,z:r},{signal:o.signal})).then((function(l){return delete t.request,t.aborted?(t.state="unloaded",e(null)):l===void 0?(t.state="errored",e(null)):l===null?(this.loadTileData(t,{width:this.tileSize,height:this.tileSize,data:null}),t.state="loaded",e(null)):function(u){return u instanceof x.ImageData||u instanceof x.HTMLCanvasElement||u instanceof x.ImageBitmap||u instanceof x.HTMLImageElement}(l)?(this.loadTileData(t,l),t.state="loaded",void e(null)):(t.state="errored",e(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(l=>{l.code!==20&&(t.state="errored",e(l))}),t.request.cancel=()=>o.abort()}loadTileData(t,e){t.setTexture(e,this._map.painter)}unloadTile(t,e){if(t.texture&&t.texture instanceof Zn?(t.destroy(!0),t.texture&&t.texture instanceof Zn&&this._map.painter.saveTileTexture(t.texture)):t.destroy(),this._implementation.unloadTile){let{x:n,y:i,z:r}=t.tileID.canonical;this._implementation.unloadTile({x:n,y:i,z:r})}e()}abortTile(t,e){t.request&&t.request.cancel&&(t.request.cancel(),delete t.request),e()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(t=>({x:t.canonical.x,y:t.canonical.y,z:t.canonical.z}))}_clearTiles(){let t=hr(this.id,this.scope);this._map.style.clearSource(t)}_update(){this.fire(new Ce("data",{dataType:"source",sourceDataType:"content"}))}}},Cx=function(t,e,n,i){let r=new wx[e.type](t,e,n,i);if(r.id!==t)throw new Error(`Expected Source id to be ${t} instead of ${r.id}`);return Ri(["load","abort","unload","serialize","prepare"],r),r};function lV(t,e){let n=ne.identity([]);return ne.scale(n,n,[.5*t.width,.5*-t.height,1]),ne.translate(n,n,[1,-1,0]),ne.multiply(n,n,t.calculateProjMatrix(e.toUnwrapped())),Float32Array.from(n)}function cV(t,e,n,i,r,o,l,u=!1){let h=t.tilesIn(i,l,u);h.sort(KS);let p=[];for(let _ of h)p.push({wrappedTileID:_.tile.tileID.wrapped().key,queryResults:_.tile.queryRenderedFeatures(e,n,t._state,_,r,o,lV(t.transform,_.tile.tileID),u)});let m=function(_){let y={},v={};for(let b of _){let w=b.queryResults,C=b.wrappedTileID,E=v[C]=v[C]||{};for(let I in w){let D=w[I],S=E[I]=E[I]||{},M=y[I]=y[I]||[];for(let A of D)S[A.featureIndex]||(S[A.featureIndex]=!0,M.push(A))}}return y}(p);for(let _ in m)m[_].forEach(y=>{let v=y.feature,b=v.layer;b&&b.type!=="background"&&b.type!=="sky"&&b.type!=="slot"&&(v.source=b.source,b["source-layer"]&&(v.sourceLayer=b["source-layer"]),v.state=v.id!==void 0?t.getFeatureState(b["source-layer"],v.id):{})});return m}function uV(t,e){let n=t.getRenderableIds().map(o=>t.getTileByID(o)),i=[],r={};for(let o=0;o<n.length;o++){let l=n[o],u=l.tileID.canonical.key;r[u]||(r[u]=!0,l.querySourceFeatures(i,e))}return i}function KS(t,e){let n=t.tileID,i=e.tileID;return n.overscaledZ-i.overscaledZ||n.canonical.y-i.canonical.y||n.wrap-i.wrap||n.canonical.x-i.canonical.x}class dV{constructor(e){this.style=e}processLayersChanged(){this.layers=[];for(let e in this.style._mergedLayers){let n=this.style._mergedLayers[e];if(n.type==="fill-extrusion")this.layers.push(n);else if(n.type==="model"){let i=this.style.getLayerSource(n);i&&i.type==="batched-model"&&this.layers.push(n)}}}updateZOffset(e,n){this.currentBuildingBuckets=[];for(let r=0;r<this.layers.length;++r){let o=this.layers[r],l=this.style.getLayerSourceCache(o),u=1;o.type==="fill-extrusion"&&(u=o.paint.get("fill-extrusion-opacity")>0?o.paint.get("fill-extrusion-vertical-scale"):0);let h=l?l.getTile(n):null;if(!h&&l&&n.canonical.z>l.getSource().minzoom){let p=n.scaledTo(Math.min(l.getSource().maxzoom,n.overscaledZ-1));for(;p.overscaledZ>=l.getSource().minzoom&&(h=l.getTile(p),!h&&p.overscaledZ!==0);)p=p.scaledTo(p.overscaledZ-1)}this.currentBuildingBuckets.push({bucket:h?h.getBucket(o):null,tileID:h?h.tileID:n,verticalScale:u})}e.hasAnyZOffset=!1;let i=!1;for(let r=0;r<e.symbolInstances.length;r++){let o=e.symbolInstances.get(r),l=o.zOffset,u=this._getHeightAtTileOffset(n,o.tileAnchorX,o.tileAnchorY);o.zOffset=u!==-1?u:l,i||l===o.zOffset||(i=!0),e.hasAnyZOffset||o.zOffset===0||(e.hasAnyZOffset=!0)}i&&(e.zOffsetBuffersNeedUpload=!0,e.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(e,n,i,r){let o=n,l=i;if(e.canonical.z!==r.canonical.z){let u=r.canonical,h=1/(1<<e.canonical.z-u.z);o=(n+e.canonical.x*le)*h-u.x*le|0,l=(i+e.canonical.y*le)*h-u.y*le|0}return{tileX:o,tileY:l}}_getHeightAtTileOffset(e,n,i){let r;for(let o=0;o<this.layers.length;++o){if(this.layers[o].type!=="fill-extrusion")continue;let{bucket:l,tileID:u,verticalScale:h}=this.currentBuildingBuckets[o];if(!l)continue;let{tileX:p,tileY:m}=this._mapCoordToOverlappingTile(e,n,i,u),_=l.getHeightAtTileCoord(p,m);if(_&&_.height!==void 0){if(!_.hidden)return _.height*h;r=_.height}}for(let o=0;o<this.layers.length;++o){if(this.layers[o].type!=="model")continue;let{bucket:l,tileID:u}=this.currentBuildingBuckets[o];if(!l)continue;let{tileX:h,tileY:p}=this._mapCoordToOverlappingTile(e,n,i,u),m=l.getHeightAtTileCoord(h,p);if(m&&!m.hidden)return m.height===void 0&&r!==void 0?Math.min(m.maxHeight,r)*m.verticalScale:(m.height||0)*m.verticalScale}return-1}}var JS=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function hV(t,e){let n={};for(let i in t)i!=="ref"&&(n[i]=t[i]);return JS.forEach(i=>{i in e&&(n[i]=e[i])}),n}function QS(t){t=t.slice();let e=Object.create(null);for(let n=0;n<t.length;n++)e[t[n].id]=t[n];for(let n=0;n<t.length;n++)"ref"in t[n]&&(t[n]=hV(t[n],e[t[n].ref]));return t}let on={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",setImportUrl:"setImportUrl",setImportData:"setImportData",setImportConfig:"setImportConfig"};function e2(t,e,n){n.push({command:on.addSource,args:[t,e[t]]})}function t2(t,e,n){e.push({command:on.removeSource,args:[t]}),n[t]=!0}function fV(t,e,n,i){t2(t,n,i),e2(t,e,n)}function pV(t,e,n){let i;for(i in t[n])if(t[n].hasOwnProperty(i)&&i!=="data"&&!Wt(t[n][i],e[n][i]))return!1;for(i in e[n])if(e[n].hasOwnProperty(i)&&i!=="data"&&!Wt(t[n][i],e[n][i]))return!1;return!0}function vm(t,e,n,i,r,o){let l;for(l in e=e||{},t=t||{})t.hasOwnProperty(l)&&(Wt(t[l],e[l])||n.push({command:o,args:[i,l,e[l],r]}));for(l in e)e.hasOwnProperty(l)&&!t.hasOwnProperty(l)&&(Wt(t[l],e[l])||n.push({command:o,args:[i,l,e[l],r]}))}function xm(t){return t.id}function bm(t,e){return t[e.id]=e,t}class mV{constructor(e,n){this.reset(e,n)}reset(e,n){this.points=e||[],this._distances=[0];for(let i=1;i<this.points.length;i++)this._distances[i]=this._distances[i-1]+this.points[i].dist(this.points[i-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(n||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(this.points.length===1)return this.points[0];e=We(e,0,1);let n=1,i=this._distances[n],r=e*this.paddedLength+this.padding;for(;i<r&&n<this._distances.length;)i=this._distances[++n];let o=n-1,l=this._distances[o],u=i-l,h=u>0?(r-l)/u:0;return this.points[o].mult(1-h).add(this.points[n].mult(h))}}class n2{constructor(e,n,i){let r=this.boxCells=[],o=this.circleCells=[];this.xCellCount=Math.ceil(e/i),this.yCellCount=Math.ceil(n/i);for(let l=0;l<this.xCellCount*this.yCellCount;l++)r.push([]),o.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=n,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/n,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,n,i,r,o){this._forEachCell(n,i,r,o,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(r),this.bboxes.push(o)}insertCircle(e,n,i,r){this._forEachCell(n-r,i-r,n+r,i+r,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(n),this.circles.push(i),this.circles.push(r)}_insertBoxCell(e,n,i,r,o,l){this.boxCells[o].push(l)}_insertCircleCell(e,n,i,r,o,l){this.circleCells[o].push(l)}_query(e,n,i,r,o,l){if(i<0||e>this.width||r<0||n>this.height)return!o&&[];let u=[];if(e<=0&&n<=0&&this.width<=i&&this.height<=r){if(o)return!0;for(let h=0;h<this.boxKeys.length;h++)u.push({key:this.boxKeys[h],x1:this.bboxes[4*h],y1:this.bboxes[4*h+1],x2:this.bboxes[4*h+2],y2:this.bboxes[4*h+3]});for(let h=0;h<this.circleKeys.length;h++){let p=this.circles[3*h],m=this.circles[3*h+1],_=this.circles[3*h+2];u.push({key:this.circleKeys[h],x1:p-_,y1:m-_,x2:p+_,y2:m+_})}return l?u.filter(l):u}return this._forEachCell(e,n,i,r,this._queryCell,u,{hitTest:o,seenUids:{box:{},circle:{}}},l),o?u.length>0:u}_queryCircle(e,n,i,r,o){let l=e-i,u=e+i,h=n-i,p=n+i;if(u<0||l>this.width||p<0||h>this.height)return!r&&[];let m=[];return this._forEachCell(l,h,u,p,this._queryCellCircle,m,{hitTest:r,circle:{x:e,y:n,radius:i},seenUids:{box:{},circle:{}}},o),r?m.length>0:m}query(e,n,i,r,o){return this._query(e,n,i,r,!1,o)}hitTest(e,n,i,r,o){return this._query(e,n,i,r,!0,o)}hitTestCircle(e,n,i,r){return this._queryCircle(e,n,i,!0,r)}_queryCell(e,n,i,r,o,l,u,h){let p=u.seenUids,m=this.boxCells[o];if(m!==null){let y=this.bboxes;for(let v of m)if(!p.box[v]){p.box[v]=!0;let b=4*v;if(e<=y[b+2]&&n<=y[b+3]&&i>=y[b+0]&&r>=y[b+1]&&(!h||h(this.boxKeys[v]))){if(u.hitTest)return l.push(!0),!0;l.push({key:this.boxKeys[v],x1:y[b],y1:y[b+1],x2:y[b+2],y2:y[b+3]})}}}let _=this.circleCells[o];if(_!==null){let y=this.circles;for(let v of _)if(!p.circle[v]){p.circle[v]=!0;let b=3*v;if(this._circleAndRectCollide(y[b],y[b+1],y[b+2],e,n,i,r)&&(!h||h(this.circleKeys[v]))){if(u.hitTest)return l.push(!0),!0;{let w=y[b],C=y[b+1],E=y[b+2];l.push({key:this.circleKeys[v],x1:w-E,y1:C-E,x2:w+E,y2:C+E})}}}}}_queryCellCircle(e,n,i,r,o,l,u,h){let p=u.circle,m=u.seenUids,_=this.boxCells[o];if(_!==null){let v=this.bboxes;for(let b of _)if(!m.box[b]){m.box[b]=!0;let w=4*b;if(this._circleAndRectCollide(p.x,p.y,p.radius,v[w+0],v[w+1],v[w+2],v[w+3])&&(!h||h(this.boxKeys[b])))return l.push(!0),!0}}let y=this.circleCells[o];if(y!==null){let v=this.circles;for(let b of y)if(!m.circle[b]){m.circle[b]=!0;let w=3*b;if(this._circlesCollide(v[w],v[w+1],v[w+2],p.x,p.y,p.radius)&&(!h||h(this.circleKeys[b])))return l.push(!0),!0}}}_forEachCell(e,n,i,r,o,l,u,h){let p=this._convertToXCellCoord(e),m=this._convertToYCellCoord(n),_=this._convertToXCellCoord(i),y=this._convertToYCellCoord(r);for(let v=p;v<=_;v++)for(let b=m;b<=y;b++)if(o.call(this,e,n,i,r,this.xCellCount*b+v,l,u,h))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,n,i,r,o,l){let u=r-e,h=o-n,p=i+l;return p*p>u*u+h*h}_circleAndRectCollide(e,n,i,r,o,l,u){let h=(l-r)/2,p=Math.abs(e-(r+h));if(p>h+i)return!1;let m=(u-o)/2,_=Math.abs(n-(o+m));if(_>m+i)return!1;if(p<=h||_<=m)return!0;let y=p-h,v=_-m;return y*y+v*v<=i*i}}let Es=100;class gV{constructor(e,n,i=new n2(e.width+200,e.height+200,25),r=new n2(e.width+200,e.height+200,25)){this.transform=e,this.grid=i,this.ignoredGrid=r,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+Es,this.screenBottomBoundary=e.height+Es,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.fogState=n}placeCollisionBox(e,n,i,r,o,l,u,h){let p=i.projectedAnchorX,m=i.projectedAnchorY,_=i.projectedAnchorZ,y=i.elevation,v=i.tileID,b=e.getProjection();if(y&&v){let[A,R,F]=b.upVector(v.canonical,i.tileAnchorX,i.tileAnchorY),k=b.upVectorScale(v.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;p+=A*y*k,m+=R*y*k,_+=F*y*k}let w=this.projectAndGetPerspectiveRatio(u,p,m,_,i.tileID,b.name==="globe"||!!y||this.transform.pitch>0,b),C=l*w.perspectiveRatio,E=(i.x1*n+r.x-i.padding)*C+w.point.x,I=(i.y1*n+r.y-i.padding)*C+w.point.y,D=(i.x2*n+r.x+i.padding)*C+w.point.x,S=(i.y2*n+r.y+i.padding)*C+w.point.y,M=w.perspectiveRatio<=.55||w.occluded;return!this.isInsideGrid(E,I,D,S)||!o&&this.grid.hitTest(E,I,D,S,h)||M?{box:[],offscreen:!1,occluded:w.occluded}:{box:[E,I,D,S],offscreen:this.isOffscreen(E,I,D,S),occluded:!1}}placeCollisionCircles(e,n,i,r,o,l,u,h,p,m,_,y,v,b,w){let C=[],E=this.transform.elevation,I=e.getProjection(),D=E?E.getAtTileOffsetFunc(w,this.transform.center.lat,this.transform.worldSize,I):null,S=new Q(i.tileAnchorX,i.tileAnchorY),{x:M,y:A,z:R}=I.projectTilePoint(S.x,S.y,w.canonical);if(D){let[te,q,X]=D(S);M+=te,A+=q,R+=X}let F=I.name==="globe",k=this.projectAndGetPerspectiveRatio(u,M,A,R,w,F||!!E||this.transform.pitch>0,I),{perspectiveRatio:L}=k,z=(_?l/L:l*L)/zi,B=Jo(M,A,R,h),G=k.signedDistanceFromCamera>0?FD(z,o,i.lineOffsetX*z,i.lineOffsetY*z,!1,B,S,i,r,h,{},E&&!_?D:null,_&&!!E,I,w,_):null,N=!1,W=!1,Y=!0;if(G&&!k.occluded){let te=.5*v*L+b,q=new Q(-100,-100),X=new Q(this.screenRightBoundary,this.screenBottomBoundary),re=new mV,{first:se,last:oe}=G,ue=se.path.length,de=[];for(let ge=ue-1;ge>=1;ge--)de.push(se.path[ge]);for(let ge=1;ge<oe.path.length;ge++)de.push(oe.path[ge]);let pe=2.5*te;p&&(de=de.map(([ge,Ae,Pe],Ne)=>(D&&!F&&(Pe=D(Ne<ue-1?se.tilePath[ue-1-Ne]:oe.tilePath[Ne-ue+2])[2]),Jo(ge,Ae,Pe,p))),de.some(ge=>ge[3]<=0)&&(de=[]));let ae=[];if(de.length>0){let ge=1/0,Ae=-1/0,Pe=1/0,Ne=-1/0;for(let Be of de)ge=Math.min(ge,Be[0]),Pe=Math.min(Pe,Be[1]),Ae=Math.max(Ae,Be[0]),Ne=Math.max(Ne,Be[1]);Ae>=q.x&&ge<=X.x&&Ne>=q.y&&Pe<=X.y&&(ae=[de.map(Be=>new Q(Be[0],Be[1]))],(ge<q.x||Ae>X.x||Pe<q.y||Ne>X.y)&&(ae=nD(ae,q.x,q.y,X.x,X.y)))}for(let ge of ae){re.reset(ge,.25*te);let Ae=0;Ae=re.length<=.5*te?1:Math.ceil(re.paddedLength/pe)+1;for(let Pe=0;Pe<Ae;Pe++){let Ne=Pe/Math.max(Ae-1,1),Be=re.lerp(Ne),lt=Be.x+Es,Ye=Be.y+Es;C.push(lt,Ye,te,0);let Zt=lt-te,Bt=Ye-te,ct=lt+te,st=Ye+te;if(Y=Y&&this.isOffscreen(Zt,Bt,ct,st),W=W||this.isInsideGrid(Zt,Bt,ct,st),!n&&this.grid.hitTestCircle(lt,Ye,te,y)&&(N=!0,!m))return{circles:[],offscreen:!1,collisionDetected:N,occluded:!1}}}}return{circles:!m&&N||!W?[]:C,offscreen:Y,collisionDetected:N,occluded:k.occluded}}queryRenderedSymbols(e){if(e.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};let n=[],i=1/0,r=1/0,o=-1/0,l=-1/0;for(let m of e){let _=new Q(m.x+Es,m.y+Es);i=Math.min(i,_.x),r=Math.min(r,_.y),o=Math.max(o,_.x),l=Math.max(l,_.y),n.push(_)}let u=this.grid.query(i,r,o,l).concat(this.ignoredGrid.query(i,r,o,l)),h={},p={};for(let m of u){let _=m.key;h[_.bucketInstanceId]===void 0&&(h[_.bucketInstanceId]={}),h[_.bucketInstanceId][_.featureIndex]||sM(n,[new Q(m.x1,m.y1),new Q(m.x2,m.y1),new Q(m.x2,m.y2),new Q(m.x1,m.y2)])&&(h[_.bucketInstanceId][_.featureIndex]=!0,p[_.bucketInstanceId]===void 0&&(p[_.bucketInstanceId]=[]),p[_.bucketInstanceId].push(_.featureIndex))}return p}insertCollisionBox(e,n,i,r,o){(n?this.ignoredGrid:this.grid).insert({bucketInstanceId:i,featureIndex:r,collisionGroupID:o},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,n,i,r,o){let l=n?this.ignoredGrid:this.grid,u={bucketInstanceId:i,featureIndex:r,collisionGroupID:o};for(let h=0;h<e.length;h+=4)l.insertCircle(u,e[h],e[h+1],e[h+2])}projectAndGetPerspectiveRatio(e,n,i,r,o,l,u){let h=[n,i,r,1],p=!1;r||this.transform.pitch>0?(vn.transformMat4(h,h,e),this.fogState&&o&&u.name!=="globe"&&(p=function(y,v,b,w,C,E){let I=E.calculateFogTileMatrix(C),D=[v,b,w];return $.transformMat4(D,D,I),mm(y,$.length(D),E.pitch,E._fov)}(this.fogState,n,i,r,o.toUnwrapped(),this.transform)>.9)):BD(h,h,e);let m=h[3];return{point:new Q((h[0]/m+1)/2*this.transform.width+Es,(-h[1]/m+1)/2*this.transform.height+Es),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(u)/m*.5,1.5),signedDistanceFromCamera:m,occluded:l&&h[2]>m||p}}isOffscreen(e,n,i,r){return i<Es||e>=this.screenRightBoundary||r<Es||n>this.screenBottomBoundary}isInsideGrid(e,n,i,r){return i>=0&&e<this.gridRightBoundary&&r>=0&&n<this.gridBottomBoundary}getViewportMatrix(){let e=ne.identity([]);return ne.translate(e,e,[-100,-100,0]),e}}function Ex(t,e,n){let i=e.createTileMatrix(t,t.worldSize,n.toUnwrapped());return ne.multiply(new Float32Array(16),t.projMatrix,i)}function _V(t,e,n){if(e.projection.name===n.projection.name)return t.projMatrix;let i=n.clone();return i.setProjection(e.projection),Ex(i,e.getProjection(),t)}function Tx(t,e,n){return e.name===n.projection.name?t.projMatrix:Ex(n,e,t)}class i2{constructor(e,n,i,r){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?n:-n))):r&&i?1:0,this.placed=i}isHidden(){return this.opacity===0&&!this.placed}}class uh{constructor(e,n,i,r,o,l=!1){this.text=new i2(e?e.text:null,n,i,o),this.icon=new i2(e?e.icon:null,n,r,o),this.clipped=l}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Ix{constructor(e,n,i,r=!1){this.text=e,this.icon=n,this.skipFade=i,this.clipped=r}}class yV{constructor(){this.invProjMatrix=ne.create(),this.viewportMatrix=ne.create(),this.circles=[]}}class vV{constructor(e,n,i,r,o){this.bucketInstanceId=e,this.featureIndex=n,this.sourceLayerIndex=i,this.bucketIndex=r,this.tileID=o}}class xV{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){let n=++this.maxGroupID;this.collisionGroups[e]={ID:n,predicate:i=>i.collisionGroupID===n}}return this.collisionGroups[e]}}function r2(t,e,n,i,r){let{horizontalAlign:o,verticalAlign:l}=Up(t),u=-(o-.5)*e,h=-(l-.5)*n,p=$v(t,i);return new Q(u+p[0]*r,h+p[1]*r)}function Mx(t,e,n,i,r){let o=new Q(t,e);return n&&o._rotate(i?r:-r),o}class bV{constructor(e,n,i,r,o,l){this.transform=e.clone(),this.projection=e.projection.name,this.collisionIndex=new gV(this.transform,o),this.buildingIndex=l,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=n,this.retainedQueryData={},this.collisionGroups=new xV(i),this.collisionCircleArrays={},this.prevPlacement=r,r&&(r.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(e,n,i,r){let o=i.getBucket(n),l=i.latestFeatureIndex;if(!o||!l||n.fqid!==o.layerIds[0])return;let u=o.layers[0].layout,h=i.collisionBoxArray,p=Math.pow(2,this.transform.zoom-i.tileID.overscaledZ),m=i.tileSize/le,_=i.tileID.toUnwrapped();this.transform.setProjection(o.projection);let y=(v=i.tileID,b=o.getProjection(),w=this.transform,b.name===this.projection?w.calculateProjMatrix(v.toUnwrapped()):Ex(w,b,v));var v,b,w;let C=u.get("text-pitch-alignment")==="map",E=u.get("text-rotation-alignment")==="map";n.compileFilter();let I=n.dynamicFilter(),D=n.dynamicFilterNeedsFeature(),S=this.transform.calculatePixelsToTileUnitsMatrix(i),M=PD(y,i.tileID.canonical,C,E,this.transform,o.getProjection(),S),A=null;if(C){let k=RD(y,i.tileID.canonical,C,E,this.transform,o.getProjection(),S);A=ne.multiply([],this.transform.labelPlaneMatrix,k)}let R=null;I&&i.latestFeatureIndex&&(R={unwrappedTileID:_,dynamicFilter:I,dynamicFilterNeedsFeature:D,featureIndex:i.latestFeatureIndex}),this.retainedQueryData[o.bucketInstanceId]=new vV(o.bucketInstanceId,l,o.sourceLayerIndex,o.index,i.tileID);let F={bucket:o,layout:u,posMatrix:y,textLabelPlaneMatrix:M,labelToScreenMatrix:A,clippingData:R,scale:p,textPixelRatio:m,holdingForFade:i.holdingForFade(),collisionBoxArray:h,partiallyEvaluatedTextSize:xs(o.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:xs(o.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(o.sourceID)};if(r)for(let k of o.sortKeyRanges){let{sortKey:L,symbolInstanceStart:z,symbolInstanceEnd:B}=k;e.push({sortKey:L,symbolInstanceStart:z,symbolInstanceEnd:B,parameters:F})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:o.symbolInstances.length,parameters:F})}attemptAnchorPlacement(e,n,i,r,o,l,u,h,p,m,_,y,v,b,w,C,E,I){let{textOffset0:D,textOffset1:S,crossTileID:M}=y,A=[D,S],R=r2(e,i,r,A,o),F=this.collisionIndex.placeCollisionBox(b,o,n,Mx(R.x,R.y,l,u,this.transform.angle),_,h,p,m.predicate);if(C){let k=b.getSymbolInstanceIconSize(I,this.transform.zoom,y.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(b,k,C,Mx(R.x,R.y,l,u,this.transform.angle),_,h,p,m.predicate).box.length===0)return}if(F.box.length>0){let k;return this.prevPlacement&&this.prevPlacement.variableOffsets[M]&&this.prevPlacement.placements[M]&&this.prevPlacement.placements[M].text&&(k=this.prevPlacement.variableOffsets[M].anchor),this.variableOffsets[M]={textOffset:A,width:i,height:r,anchor:e,textScale:o,prevAnchor:k},this.markUsedJustification(b,e,y,w),b.allowVerticalPlacement&&(this.markUsedOrientation(b,w,y),this.placedOrientations[M]=w),{shift:R,placedGlyphBoxes:F}}}placeLayerBucketPart(e,n,i,r){let{bucket:o,layout:l,posMatrix:u,textLabelPlaneMatrix:h,labelToScreenMatrix:p,clippingData:m,textPixelRatio:_,holdingForFade:y,collisionBoxArray:v,partiallyEvaluatedTextSize:b,partiallyEvaluatedIconSize:w,collisionGroup:C}=e.parameters,E=l.get("text-optional"),I=l.get("icon-optional"),D=l.get("text-allow-overlap"),S=l.get("icon-allow-overlap"),M=l.get("text-rotation-alignment")==="map",A=l.get("text-pitch-alignment")==="map",R=l.get("symbol-z-order")==="viewport-y",F=l.get("symbol-z-elevate");this.transform.setProjection(o.projection);let k=D&&(S||!o.hasIconData()||I),L=S&&(D||!o.hasTextData()||E);!o.collisionArrays&&v&&o.deserializeCollisionBoxes(v),i&&r&&o.updateCollisionDebugBuffers(this.transform.zoom,v);let z=(B,G,N)=>{let{crossTileID:W,numVerticalGlyphVertices:Y}=B;if(m){let ct={zoom:this.transform.zoom,pitch:this.transform.pitch},st=null;if(m.dynamicFilterNeedsFeature){let Qe=this.retainedQueryData[o.bucketInstanceId];st=m.featureIndex.loadFeature({featureIndex:B.featureIndex,bucketIndex:Qe.bucketIndex,sourceLayerIndex:Qe.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,m.dynamicFilter)(ct,st,this.retainedQueryData[o.bucketInstanceId].tileID.canonical,new Q(B.tileAnchorX,B.tileAnchorY),this.transform.calculateDistanceTileData(m.unwrappedTileID)))return this.placements[W]=new Ix(!1,!1,!1,!0),void n.add(W)}if(n.has(W))return;if(y)return void(this.placements[W]=new Ix(!1,!1,!1));let te=!1,q=!1,X=!0,re=!1,se=!1,oe=null,ue={box:null,offscreen:null,occluded:null},de={box:null,offscreen:null,occluded:null},pe=null,ae=null,ge=null,Ae=0,Pe=0,Ne=0;N.textFeatureIndex?Ae=N.textFeatureIndex:B.useRuntimeCollisionCircles&&(Ae=B.featureIndex),N.verticalTextFeatureIndex&&(Pe=N.verticalTextFeatureIndex);let Be=ct=>{ct.tileID=this.retainedQueryData[o.bucketInstanceId].tileID;let st=this.transform.elevation;ct.elevation=B.zOffset+(st?st.getAtTileOffset(ct.tileID,ct.tileAnchorX,ct.tileAnchorY):0)},lt=N.textBox;if(lt){Be(lt);let ct=Qe=>{let Ut=jn.horizontal;if(o.allowVerticalPlacement&&!Qe&&this.prevPlacement){let qt=this.prevPlacement.placedOrientations[W];qt&&(this.placedOrientations[W]=qt,Ut=qt,this.markUsedOrientation(o,Ut,B))}return Ut},st=(Qe,Ut)=>{if(o.allowVerticalPlacement&&Y>0&&N.verticalTextBox){for(let qt of o.writingModes)if(qt===jn.vertical?(ue=Ut(),de=ue):ue=Qe(),ue&&ue.box&&ue.box.length)break}else ue=Qe()};if(l.get("text-variable-anchor")){let Qe=l.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[W]){let At=this.prevPlacement.variableOffsets[W];Qe.indexOf(At.anchor)>0&&(Qe=Qe.filter(En=>En!==At.anchor),Qe.unshift(At.anchor))}let Ut=(At,En,ai)=>{let xn=o.getSymbolInstanceTextSize(b,B,this.transform.zoom,G),Fn=(At.x2-At.x1)*xn+2*At.padding,fi=(At.y2-At.y1)*xn+2*At.padding,li=B.hasIconTextFit&&!S?En:null;li&&Be(li);let Bn={box:[],offscreen:!1,occluded:!1},pn=D?2*Qe.length:Qe.length;for(let Gi=0;Gi<pn;++Gi){let Is=this.attemptAnchorPlacement(Qe[Gi%Qe.length],At,Fn,fi,xn,M,A,_,u,C,Gi>=Qe.length,B,G,o,ai,li,b,w);if(Is&&(Bn=Is.placedGlyphBoxes,Bn&&Bn.box&&Bn.box.length)){te=!0,oe=Is.shift;break}}return Bn};st(()=>Ut(lt,N.iconBox,jn.horizontal),()=>{let At=N.verticalTextBox;return At&&Be(At),o.allowVerticalPlacement&&!(ue&&ue.box&&ue.box.length)&&Y>0&&At?Ut(At,N.verticalIconBox,jn.vertical):{box:null,offscreen:null,occluded:null}}),ue&&(te=ue.box,X=ue.offscreen,re=ue.occluded);let qt=ct(!(!ue||!ue.box));if(!te&&this.prevPlacement){let At=this.prevPlacement.variableOffsets[W];At&&(this.variableOffsets[W]=At,this.markUsedJustification(o,At.anchor,B,qt))}}else{let Qe=(Ut,qt)=>{let At=o.getSymbolInstanceTextSize(b,B,this.transform.zoom,G),En=this.collisionIndex.placeCollisionBox(o,At,Ut,new Q(0,0),D,_,u,C.predicate);return En&&En.box&&En.box.length&&(this.markUsedOrientation(o,qt,B),this.placedOrientations[W]=qt),En};st(()=>Qe(lt,jn.horizontal),()=>{let Ut=N.verticalTextBox;return o.allowVerticalPlacement&&Y>0&&Ut?(Be(Ut),Qe(Ut,jn.vertical)):{box:null,offscreen:null,occluded:null}}),ct(!!(ue&&ue.box&&ue.box.length))}}if(pe=ue,te=pe&&pe.box&&pe.box.length>0,X=pe&&pe.offscreen,re=pe&&pe.occluded,B.useRuntimeCollisionCircles){let ct=o.text.placedSymbolArray.get(B.centerJustifiedTextSymbolIndex>=0?B.centerJustifiedTextSymbolIndex:B.verticalPlacedTextSymbolIndex),st=Ud(o.textSizeData,b,ct),Qe=l.get("text-padding");ae=this.collisionIndex.placeCollisionCircles(o,D,ct,o.lineVertexArray,o.glyphOffsetArray,st,u,h,p,i,A,C.predicate,B.collisionCircleDiameter*st/zi,Qe,this.retainedQueryData[o.bucketInstanceId].tileID),te=D||ae.circles.length>0&&!ae.collisionDetected,X=X&&ae.offscreen,re=ae.occluded}if(N.iconFeatureIndex&&(Ne=N.iconFeatureIndex),N.iconBox){let ct=st=>{Be(st);let Qe=B.hasIconTextFit&&oe?Mx(oe.x,oe.y,M,A,this.transform.angle):new Q(0,0),Ut=o.getSymbolInstanceIconSize(w,this.transform.zoom,B.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(o,Ut,st,Qe,S,_,u,C.predicate)};de&&de.box&&de.box.length&&N.verticalIconBox?(ge=ct(N.verticalIconBox),q=ge.box.length>0):(ge=ct(N.iconBox),q=ge.box.length>0),X=X&&ge.offscreen,se=ge.occluded}let Ye=E||B.numHorizontalGlyphVertices===0&&Y===0,Zt=I||B.numIconVertices===0;if(Ye||Zt?Zt?Ye||(q=q&&te):te=q&&te:q=te=q&&te,te&&pe&&pe.box&&this.collisionIndex.insertCollisionBox(pe.box,l.get("text-ignore-placement"),o.bucketInstanceId,de&&de.box&&Pe?Pe:Ae,C.ID),q&&ge&&this.collisionIndex.insertCollisionBox(ge.box,l.get("icon-ignore-placement"),o.bucketInstanceId,Ne,C.ID),ae&&(te&&this.collisionIndex.insertCollisionCircles(ae.circles,l.get("text-ignore-placement"),o.bucketInstanceId,Ae,C.ID),i)){let ct=o.bucketInstanceId,st=this.collisionCircleArrays[ct];st===void 0&&(st=this.collisionCircleArrays[ct]=new yV);for(let Qe=0;Qe<ae.circles.length;Qe+=4)st.circles.push(ae.circles[Qe+0]),st.circles.push(ae.circles[Qe+1]),st.circles.push(ae.circles[Qe+2]),st.circles.push(ae.collisionDetected?1:0)}let Bt=o.projection.name!=="globe";k=k&&(Bt||!re),L=L&&(Bt||!se),this.placements[W]=new Ix(te||k,q||L,X||o.justReloaded),n.add(W)};if(F&&this.buildingIndex&&(this.buildingIndex.updateZOffset(o,this.retainedQueryData[o.bucketInstanceId].tileID),o.updateZOffset()),R){let B=o.getSortedSymbolIndexes(this.transform.angle);for(let G=B.length-1;G>=0;--G){let N=B[G];z(o.symbolInstances.get(N),N,o.collisionArrays[N])}o.hasAnyZOffset&&J(`${o.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(o.hasAnyZOffset){let B=o.getSortedIndexesByZOffset();for(let G=0;G<B.length;++G){let N=B[G];z(o.symbolInstances.get(N),N,o.collisionArrays[N])}}else for(let B=e.symbolInstanceStart;B<e.symbolInstanceEnd;B++)z(o.symbolInstances.get(B),B,o.collisionArrays[B]);if(i&&o.bucketInstanceId in this.collisionCircleArrays){let B=this.collisionCircleArrays[o.bucketInstanceId];ne.invert(B.invProjMatrix,u),B.viewportMatrix=this.collisionIndex.getViewportMatrix()}o.justReloaded=!1}markUsedJustification(e,n,i,r){let{leftJustifiedTextSymbolIndex:o,centerJustifiedTextSymbolIndex:l,rightJustifiedTextSymbolIndex:u,verticalPlacedTextSymbolIndex:h,crossTileID:p}=i,m=Gv(n),_=r===jn.vertical?h:m==="left"?o:m==="center"?l:m==="right"?u:-1;o>=0&&(e.text.placedSymbolArray.get(o).crossTileID=_>=0&&o!==_?0:p),l>=0&&(e.text.placedSymbolArray.get(l).crossTileID=_>=0&&l!==_?0:p),u>=0&&(e.text.placedSymbolArray.get(u).crossTileID=_>=0&&u!==_?0:p),h>=0&&(e.text.placedSymbolArray.get(h).crossTileID=_>=0&&h!==_?0:p)}markUsedOrientation(e,n,i){let r=n===jn.horizontal||n===jn.horizontalOnly?n:0,o=n===jn.vertical?n:0,{leftJustifiedTextSymbolIndex:l,centerJustifiedTextSymbolIndex:u,rightJustifiedTextSymbolIndex:h,verticalPlacedTextSymbolIndex:p}=i,m=e.text.placedSymbolArray;l>=0&&(m.get(l).placedOrientation=r),u>=0&&(m.get(u).placedOrientation=r),h>=0&&(m.get(h).placedOrientation=r),p>=0&&(m.get(p).placedOrientation=o)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;let n=this.prevPlacement,i=!1;this.prevZoomAdjustment=n?n.zoomAdjustment(this.transform.zoom):0;let r=n?n.symbolFadeChange(e):1,o=n?n.opacities:{},l=n?n.variableOffsets:{},u=n?n.placedOrientations:{};for(let h in this.placements){let p=this.placements[h],m=o[h];m?(this.opacities[h]=new uh(m,r,p.text,p.icon,null,p.clipped),i=i||p.text!==m.text.placed||p.icon!==m.icon.placed):(this.opacities[h]=new uh(null,r,p.text,p.icon,p.skipFade,p.clipped),i=i||p.text||p.icon)}for(let h in o){let p=o[h];if(!this.opacities[h]){let m=new uh(p,r,!1,!1);m.isHidden()||(this.opacities[h]=m,i=i||p.text.placed||p.icon.placed)}}for(let h in l)this.variableOffsets[h]||!this.opacities[h]||this.opacities[h].isHidden()||(this.variableOffsets[h]=l[h]);for(let h in u)this.placedOrientations[h]||!this.opacities[h]||this.opacities[h].isHidden()||(this.placedOrientations[h]=u[h]);i?this.lastPlacementChangeTime=e:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=n?n.lastPlacementChangeTime:e)}updateLayerOpacities(e,n){let i=new Set;for(let r of n){let o=r.getBucket(e);o&&r.latestFeatureIndex&&e.fqid===o.layerIds[0]&&(this.updateBucketOpacities(o,i,r.collisionBoxArray),o.layers[0].layout.get("symbol-z-elevate")&&this.buildingIndex&&(this.buildingIndex.updateZOffset(o,r.tileID),o.updateZOffset()))}}updateBucketOpacities(e,n,i){e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();let r=e.layers[0].layout,o=!!e.layers[0].dynamicFilter(),l=new uh(null,0,!1,!1,!0),u=r.get("text-allow-overlap"),h=r.get("icon-allow-overlap"),p=r.get("text-variable-anchor"),m=r.get("text-rotation-alignment")==="map",_=r.get("text-pitch-alignment")==="map",y=new uh(null,0,u&&(h||!e.hasIconData()||r.get("icon-optional")),h&&(u||!e.hasTextData()||r.get("text-optional")),!0);!e.collisionArrays&&i&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(i);let v=(w,C,E)=>{for(let I=0;I<C/4;I++)w.opacityVertexArray.emplaceBack(E)},b=0;for(let w=0;w<e.symbolInstances.length;w++){let C=e.symbolInstances.get(w),{numHorizontalGlyphVertices:E,numVerticalGlyphVertices:I,crossTileID:D,numIconVertices:S}=C,M=n.has(D),A=this.opacities[D];M?A=l:A||(A=y,this.opacities[D]=A),n.add(D);let R=E>0||I>0,F=S>0,k=this.placedOrientations[D],L=k===jn.vertical,z=k===jn.horizontal||k===jn.horizontalOnly;if(!R&&!F||A.isHidden()||b++,R){let B=o2(A.text);v(e.text,E,L?Cm:B),v(e.text,I,z?Cm:B);let G=A.text.isHidden(),{leftJustifiedTextSymbolIndex:N,centerJustifiedTextSymbolIndex:W,rightJustifiedTextSymbolIndex:Y,verticalPlacedTextSymbolIndex:te}=C,q=e.text.placedSymbolArray,X=G||L?1:0;N>=0&&(q.get(N).hidden=X),W>=0&&(q.get(W).hidden=X),Y>=0&&(q.get(Y).hidden=X),te>=0&&(q.get(te).hidden=G||z?1:0);let re=this.variableOffsets[D];re&&this.markUsedJustification(e,re.anchor,C,k);let se=this.placedOrientations[D];se&&(this.markUsedJustification(e,"left",C,se),this.markUsedOrientation(e,se,C))}if(F){let B=o2(A.icon),{placedIconSymbolIndex:G,verticalPlacedIconSymbolIndex:N}=C,W=e.icon.placedSymbolArray,Y=A.icon.isHidden()?1:0;G>=0&&(v(e.icon,S,L?Cm:B),W.get(G).hidden=Y),N>=0&&(v(e.icon,C.numVerticalIconVertices,z?Cm:B),W.get(N).hidden=Y)}if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){let B=e.collisionArrays[w];if(B){let G=new Q(0,0),N=!0;if(B.textBox||B.verticalTextBox){if(p){let Y=this.variableOffsets[D];Y?(G=r2(Y.anchor,Y.width,Y.height,Y.textOffset,Y.textScale),m&&G._rotate(_?this.transform.angle:-this.transform.angle)):N=!1}o&&(N=!A.clipped),B.textBox&&wm(e.textCollisionBox.collisionVertexArray,A.text.placed,!N||L,G.x,G.y),B.verticalTextBox&&wm(e.textCollisionBox.collisionVertexArray,A.text.placed,!N||z,G.x,G.y)}let W=N&&!!(!z&&B.verticalIconBox);B.iconBox&&wm(e.iconCollisionBox.collisionVertexArray,A.icon.placed,W,C.hasIconTextFit?G.x:0,C.hasIconTextFit?G.y:0),B.verticalIconBox&&wm(e.iconCollisionBox.collisionVertexArray,A.icon.placed,!W,C.hasIconTextFit?G.x:0,C.hasIconTextFit?G.y:0)}}}if(e.fullyClipped=b===0,e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.bucketInstanceId in this.collisionCircleArrays){let w=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=w.invProjMatrix,e.placementViewportMatrix=w.viewportMatrix,e.collisionCircleArray=w.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(e){return this.fadeDuration===0?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,n){let i=this.zoomAtLastRecencyCheck===n?1-this.zoomAdjustment(n):1;return this.zoomAtLastRecencyCheck=n,this.commitTime+this.fadeDuration*i>e}setStale(){this.stale=!0}}function wm(t,e,n,i,r){t.emplaceBack(e?1:0,n?1:0,i||0,r||0),t.emplaceBack(e?1:0,n?1:0,i||0,r||0),t.emplaceBack(e?1:0,n?1:0,i||0,r||0),t.emplaceBack(e?1:0,n?1:0,i||0,r||0)}let wV=Math.pow(2,25),CV=Math.pow(2,24),EV=Math.pow(2,17),TV=Math.pow(2,16),IV=Math.pow(2,9),MV=Math.pow(2,8),DV=Math.pow(2,1);function o2(t){if(t.opacity===0&&!t.placed)return 0;if(t.opacity===1&&t.placed)return 4294967295;let e=t.placed?1:0,n=Math.floor(127*t.opacity);return n*wV+e*CV+n*EV+e*TV+n*IV+e*MV+n*DV+e}let Cm=0;class SV{constructor(e){this._sortAcrossTiles=e.layout.get("symbol-z-order")!=="viewport-y"&&e.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(e,n,i,r,o){let l=this._bucketParts;for(;this._currentTileIndex<e.length;)if(n.getBucketParts(l,r,e[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,o())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,l.sort((u,h)=>u.sortKey-h.sortKey));this._currentPartIndex<l.length;){let u=l[this._currentPartIndex];if(n.placeLayerBucketPart(u,this._seenCrossTileIDs,i,u.symbolInstanceStart===0),this._currentPartIndex++,o())return!0}return!1}}class AV{constructor(e,n,i,r,o,l,u,h,p){this.placement=new bV(e,o,l,u,h,p),this._currentPlacementIndex=n.length-1,this._forceFullPlacement=i,this._showCollisionBoxes=r,this._done=!1}isDone(){return this._done}continuePlacement(e,n,i,r){let o=yt.now(),l=()=>{let u=yt.now()-o;return!this._forceFullPlacement&&u>2};for(;this._currentPlacementIndex>=0;){let u=n[e[this._currentPlacementIndex]],h=this.placement.collisionIndex.transform.zoom;if(u.type==="symbol"&&(!u.minzoom||u.minzoom<=h)&&(!u.maxzoom||u.maxzoom>h)){let p=u,m=p.layout.get("symbol-z-elevate"),_=this._inProgressLayer=this._inProgressLayer||new SV(p),y=hr(u.source,u.scope);if(_.continuePlacement(m?r[y]:i[y],this.placement,this._showCollisionBoxes,u,l))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}let s2=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Em{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");let[n,i]=new Uint8Array(e,0,2);if(n!==219)throw new Error("Data does not appear to be in a KDBush format.");let r=i>>4;if(r!==1)throw new Error(`Got v${r} data when expected v1.`);let o=s2[15&i];if(!o)throw new Error("Unrecognized array type.");let[l]=new Uint16Array(e,2,1),[u]=new Uint32Array(e,4,1);return new Em(u,l,o,e)}constructor(e,n=64,i=Float64Array,r){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=i,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;let o=s2.indexOf(this.ArrayType),l=2*e*this.ArrayType.BYTES_PER_ELEMENT,u=e*this.IndexArrayType.BYTES_PER_ELEMENT,h=(8-u%8)%8;if(o<0)throw new Error(`Unexpected typed array class: ${i}.`);r&&r instanceof ArrayBuffer?(this.data=r,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+u+h,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+l+u+h),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+u+h,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+o]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){let i=this._pos>>1;return this.ids[i]=i,this.coords[this._pos++]=e,this.coords[this._pos++]=n,i}finish(){let e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Dx(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,i,r){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:o,coords:l,nodeSize:u}=this,h=[0,o.length-1,0],p=[];for(;h.length;){let m=h.pop()||0,_=h.pop()||0,y=h.pop()||0;if(_-y<=u){for(let C=y;C<=_;C++){let E=l[2*C],I=l[2*C+1];E>=e&&E<=i&&I>=n&&I<=r&&p.push(o[C])}continue}let v=y+_>>1,b=l[2*v],w=l[2*v+1];b>=e&&b<=i&&w>=n&&w<=r&&p.push(o[v]),(m===0?e<=b:n<=w)&&(h.push(y),h.push(v-1),h.push(1-m)),(m===0?i>=b:r>=w)&&(h.push(v+1),h.push(_),h.push(1-m))}return p}within(e,n,i){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");let{ids:r,coords:o,nodeSize:l}=this,u=[0,r.length-1,0],h=[],p=i*i;for(;u.length;){let m=u.pop()||0,_=u.pop()||0,y=u.pop()||0;if(_-y<=l){for(let C=y;C<=_;C++)l2(o[2*C],o[2*C+1],e,n)<=p&&h.push(r[C]);continue}let v=y+_>>1,b=o[2*v],w=o[2*v+1];l2(b,w,e,n)<=p&&h.push(r[v]),(m===0?e-i<=b:n-i<=w)&&(u.push(y),u.push(v-1),u.push(1-m)),(m===0?e+i>=b:n+i>=w)&&(u.push(v+1),u.push(_),u.push(1-m))}return h}}function Dx(t,e,n,i,r,o){if(r-i<=n)return;let l=i+r>>1;a2(t,e,l,i,r,o),Dx(t,e,n,i,l-1,1-o),Dx(t,e,n,l+1,r,1-o)}function a2(t,e,n,i,r,o){for(;r>i;){if(r-i>600){let p=r-i+1,m=n-i+1,_=Math.log(p),y=.5*Math.exp(2*_/3),v=.5*Math.sqrt(_*y*(p-y)/p)*(m-p/2<0?-1:1);a2(t,e,n,Math.max(i,Math.floor(n-m*y/p+v)),Math.min(r,Math.floor(n+(p-m)*y/p+v)),o)}let l=e[2*n+o],u=i,h=r;for(dh(t,e,i,n),e[2*r+o]>l&&dh(t,e,i,r);u<h;){for(dh(t,e,u,h),u++,h--;e[2*u+o]<l;)u++;for(;e[2*h+o]>l;)h--}e[2*i+o]===l?dh(t,e,i,h):(h++,dh(t,e,h,r)),h<=n&&(i=h+1),n<=h&&(r=h-1)}}function dh(t,e,n,i){Sx(t,n,i),Sx(e,2*n,2*i),Sx(e,2*n+1,2*i+1)}function Sx(t,e,n){let i=t[e];t[e]=t[n],t[n]=i}function l2(t,e,n,i){let r=t-n,o=e-i;return r*r+o*o}let Ax=512/le/2;class PV{constructor(e,n,i){this.tileID=e,this.bucketInstanceId=i,this.index=new Em(n.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];let r=e.canonical.x*le,o=e.canonical.y*le;for(let l=0;l<n.length;l++){let{key:u,crossTileID:h,tileAnchorX:p,tileAnchorY:m}=n.get(l),_=Math.floor((r+p)*Ax),y=Math.floor((o+m)*Ax);this.index.add(_,y),this.keys.push(u),this.crossTileIDs.push(h)}this.index.finish()}findMatches(e,n,i){let r=this.tileID.canonical.z<n.canonical.z?1:Math.pow(2,this.tileID.canonical.z-n.canonical.z),o=Ax/Math.pow(2,n.canonical.z-this.tileID.canonical.z),l=n.canonical.x*le,u=n.canonical.y*le;for(let h=0;h<e.length;h++){let p=e.get(h);if(p.crossTileID)continue;let{key:m,tileAnchorX:_,tileAnchorY:y}=p,v=Math.floor((l+_)*o),b=Math.floor((u+y)*o),w=this.index.range(v-r,b-r,v+r,b+r);for(let C of w){let E=this.crossTileIDs[C];if(this.keys[C]===m&&!i.has(E)){i.add(E),p.crossTileID=E;break}}}}}class RV{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class OV{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){let n=Math.round((e-this.lng)/360);if(n!==0)for(let i in this.indexes){let r=this.indexes[i],o={};for(let l in r){let u=r[l];u.tileID=u.tileID.unwrapTo(u.tileID.wrap+n),o[u.tileID.key]=u}this.indexes[i]=o}this.lng=e}addBucket(e,n,i){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===n.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let o=0;o<n.symbolInstances.length;o++)n.symbolInstances.get(o).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]=new Set);let r=this.usedCrossTileIDs[e.overscaledZ];for(let o in this.indexes){let l=this.indexes[o];if(Number(o)>e.overscaledZ)for(let u in l){let h=l[u];h.tileID.isChildOf(e)&&h.findMatches(n.symbolInstances,e,r)}else{let u=l[e.scaledTo(Number(o)).key];u&&u.findMatches(n.symbolInstances,e,r)}}for(let o=0;o<n.symbolInstances.length;o++){let l=n.symbolInstances.get(o);l.crossTileID||(l.crossTileID=i.generate(),r.add(l.crossTileID))}return this.indexes[e.overscaledZ]===void 0&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new PV(e,n.symbolInstances,n.bucketInstanceId),!0}removeBucketCrossTileIDs(e,n){for(let i of n.crossTileIDs)this.usedCrossTileIDs[e].delete(i)}removeStaleBuckets(e){let n=!1;for(let i in this.indexes){let r=this.indexes[i];for(let o in r)e[r[o].bucketInstanceId]||(this.removeBucketCrossTileIDs(i,r[o]),delete r[o],n=!0)}return n}}class FV{constructor(){this.layerIndexes={},this.crossTileIDs=new RV,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,n,i,r){let o=this.layerIndexes[e.fqid];o===void 0&&(o=this.layerIndexes[e.fqid]=new OV);let l=!1,u={};r.name!=="globe"&&o.handleWrapJump(i);for(let h of n){let p=h.getBucket(e);p&&e.fqid===p.layerIds[0]&&(p.bucketInstanceId||(p.bucketInstanceId=++this.maxBucketInstanceId),o.addBucket(h.tileID,p,this.crossTileIDs)&&(l=!0),u[p.bucketInstanceId]=!0)}return o.removeStaleBuckets(u)&&(l=!0),l}pruneUnusedLayers(e){let n={};e.forEach(i=>{n[i]=!0});for(let i in this.layerIndexes)n[i]||delete this.layerIndexes[i]}}var c2=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w-0.0001;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,u2="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",d2=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(
unpack_depth(texture(u_depth,uv-df.xz)),unpack_depth(texture(u_depth,uv+df.xz)),unpack_depth(texture(u_depth,uv-df.zy)),unpack_depth(texture(u_depth,uv+df.zy))
);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }
#endif`,h2=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,f2=`highp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}
#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {
#ifdef FOG_DITHERING
vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);
#else
return color;
#endif
}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,p2=`#ifdef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);vec4 _raTexLinearCoord(vec2 texCoord,vec2 texResolution,out vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return (texCoord.xxyy+vec2(1.5,0.5).xyxy)/texResolution.xxyy;}vec2 _raTexLinearMix(vec2 fxy,vec4 colorMix,float colorOffset,vec4 t00,vec4 t10,vec4 t01,vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec2 fxy;vec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texture(u_image0,c.yz),texture(u_image0,c.xz),texture(u_image0,c.yw),texture(u_image0,c.xw)
);}vec2 raTexture2D_image1_linear(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec2 fxy;vec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texture(u_image1,c.yz),texture(u_image1,c.xz),texture(u_image1,c.yw),texture(u_image1,c.xw)
);}vec2 raTexture2D_image0_nearest(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec4 t=texture(u_image0,texCoord);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(vec2 texCoord,vec2 texResolution,vec4 colorMix,float colorOffset) {vec4 t=texture(u_image1,texCoord);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,m2=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,g2=`#ifdef RENDER_SHADOWS
#ifdef DEPTH_TEXTURE
uniform highp sampler2D u_shadowmap_0;uniform highp sampler2D u_shadowmap_1;
#else
uniform sampler2D u_shadowmap_0;uniform sampler2D u_shadowmap_1;
#endif
uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;highp float shadow_sample_1(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_1,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_1,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}highp float shadow_sample_0(highp vec2 uv,highp float compare) {highp float shadow_depth;
#ifdef DEPTH_TEXTURE
shadow_depth=texture(u_shadowmap_0,uv).r;
#else
shadow_depth=unpack_depth(texture(u_shadowmap_0,uv))*0.5+0.5;
#endif
return step(shadow_depth,compare);}float shadow_occlusion_1(highp vec4 pos,highp float bias) {highp vec2 uv=pos.xy;return shadow_sample_1(uv,pos.z-bias);}float shadow_occlusion_0(highp vec4 pos,highp float bias) {highp float compare0=pos.z-bias;
#ifdef NATIVE
highp vec2 uv=pos.xy;highp vec4 samples=textureGather(u_shadowmap_0,uv,0);lowp vec4 stepSamples=step(samples,vec4(compare0));
#else
highp vec2 uv00=pos.xy-vec2(0.5*u_shadow_texel_size);highp vec2 uv10=uv00+vec2(u_shadow_texel_size,0.0);highp vec2 uv01=uv00+vec2(0.0,u_shadow_texel_size);highp vec2 uv11=uv01+vec2(u_shadow_texel_size,0.0);lowp vec4 stepSamples=vec4(
shadow_sample_0(uv01,compare0),shadow_sample_0(uv11,compare0),shadow_sample_0(uv10,compare0),shadow_sample_0(uv00,compare0)
);
#endif
vec2 f=fract(pos.xy*u_shadow_map_resolution-vec2(0.5));lowp vec2 lerpx=mix(stepSamples.wx,stepSamples.zy,f.xx);return mix(lerpx.x,lerpx.y,f.y);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {
#ifdef SHADOWS_SINGLE_CASCADE
light_view_pos0.xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);
#else
light_view_pos0.xyz/=light_view_pos0.w;light_view_pos1.xyz/=light_view_pos1.w;vec4 uv=vec4(light_view_pos0.xy,light_view_pos1.xy);vec4 abs_bounds=abs(uv);if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {light_view_pos0.xyz=light_view_pos0.xyz*0.5+0.5;return shadow_occlusion_0(light_view_pos0,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}light_view_pos1.xyz=light_view_pos1.xyz*0.5+0.5;float occlusion1=shadow_occlusion_1(light_view_pos1,bias);return mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth));
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;let _2=[];Mm(c2,_2);let Tm={"_prelude_fog.vertex.glsl":h2,"_prelude_terrain.vertex.glsl":d2,"_prelude_shadow.vertex.glsl":m2,"_prelude_fog.fragment.glsl":f2,"_prelude_shadow.fragment.glsl":g2,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":p2},Im={};dn("",d2),dn(f2,h2),dn(g2,m2),dn(p2,"");let y2=dn(`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec2 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color) {
#ifdef INDICATOR_CUTOUT
float holeMinOpacity=u_indicator_cutout_params.x;float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif`,`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`),v2=c2;var x2={background:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),circle:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:dn("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:dn(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:dn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:dn("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in float a_size_scale;in vec2 a_padding;in float a_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;out float v_placed;out float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*(a_z_offset+elevation(a_anchor_pos)),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:dn("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:dn("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),fill:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutline:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;out vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_emissive_strength;in vec2 v_pos;in vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;out vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;in vec2 v_pos;uniform float u_emissive_strength;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;out vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
uniform float u_emissive_strength;in float v_height;void main() {
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,u_emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef RENDER_CUTOFF
color*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#ifdef RENDER_CUTOFF
invariant gl_Position;
#endif
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele;vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);v_flat=vec4(linearProduct(color.rgb,vec3(calculate_NdotL(normal))),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),fillExtrusionDepth:dn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_vertical_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base);pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture(u_image,pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
out vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif 
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:dn(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,v_depth));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0)).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);v_depth=gl_Position.w;
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:dn(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;HANDLE_WIREFRAME_DEBUG;
#endif
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;
#ifdef FORCE_ABS_FL_GROUND_RADIUS
fl_ground_radius=abs(flood_light_ground_radius);
#endif
float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(1.0,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:dn(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trimmed=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=(border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {    
float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color.rgb=mix(border_color.rgb*border_color.a*trimmed,out_color.rgb,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec4 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec4 v_uv;
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);
#else
v_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),linePattern:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;in vec2 v_normal;in vec2 v_width2;in float v_linesofar;in float v_gamma_scale;in float v_width;
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture(u_image,pos);
#ifdef LIGHTING_3D_MODE
color=apply_lighting_ground(color);
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
color=applyCutout(color);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;in float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;out vec2 v_normal;out vec2 v_width2;out float v_linesofar;out float v_gamma_scale;out float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern
#pragma mapbox: define lowp float pixel_ratio
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#else
v_gamma_scale=1.0;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),raster:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform vec4 u_tl_br;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#elif defined(PROJECTION_GLOBE_VIEW)
in vec2 a_pos;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec2 globe_tl=vec2(u_tl_br.x,u_tl_br.y);vec2 globe_br=vec2(u_tl_br.z,u_tl_br.w);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=1.0-((mercatorY-globe_br.y)/(globe_tl.y-globe_br.y));float mercatorX=mercatorXfromLng(latLng[1]);float uvX=(mercatorX-globe_br.x)/(globe_tl.x-globe_br.x);vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);uv=vec2(uvX,uvY);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
uv=a_texture_pos/8192.0;
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),symbolIcon:dn(`#include "_prelude_lighting.glsl"
uniform sampler2D u_texture;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
in float v_fade_opacity;in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
uniform mediump float u_icon_saturation;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
lowp float alpha=opacity*v_fade_opacity;vec4 out_color;
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b)*alpha;
#else
out_color=texture(u_texture,v_tex_a)*alpha;
#endif
#ifdef SATURATION
vec3 luma=vec3(dot(out_color.rgb,vec3(0.2126,0.7152,0.0722)));out_color.rgb=mix(luma,out_color.rgb,u_icon_saturation);
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_fade_opacity;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
v_tex_a=a_tex/u_texsize;
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
v_fade_opacity=out_fade_opacity;}`),symbolSDF:dn(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;in float v_draw_halo;in vec2 v_data0;in vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec2 v_data0;out vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);
#endif
vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,out_fade_opacity);}`),symbolTextAndIcon:dn(`#include "_prelude_lighting.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_halo;in float v_draw_halo;in vec4 v_data0;in vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);vec4 out_color=color*(alpha*opacity*fade_opacity);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out float v_draw_halo;out vec4 v_data0;out vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
float occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;
#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)
projection_transition_fade=1.0-step(EPSILON,u_zoom_transition);
#endif
float out_fade_opacity=interpolated_fade_opacity*projection_transition_fade;float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,hidden);
#else
gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,hidden);
#endif
float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,out_fade_opacity,is_sdf);}`),terrainRaster:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,v_depth,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;
#endif
}`),terrainDepth:dn("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:dn(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,u2),skyboxGradient:dn(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,u2),skyboxCapture:dn(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(raster.rgb*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:dn(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;
#ifndef NATIVE
c=dither(c,gl_FragCoord.xy+u_temporal_offset);
#endif
glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:dn(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform sampler2D u_depthTexture;uniform vec2 u_inv_depth_size;bool isOccluded() {vec2 coord=gl_FragCoord.xy*u_inv_depth_size;highp float depth=unpack_depth(texture(u_depthTexture,coord));return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
texColor.rgb=sRGBToLinear(texColor.rgb);if(u_baseTextureIsAlpha) {if (texColor.w < 0.5) {discard;}albedo*=mix(vec4(texColor.rgb,texColor.a),vec4(texColor.a),float(u_baseTextureIsAlpha));} else {albedo*=texColor;}
#endif
return vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));n=normalize(cross(fdx,fdy))*-1.0;
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 diffuse=getDiffuseShadedColor(getBaseColor().rgb,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(diffuse,1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
ao=(texture(u_occlusionTexture,uv_2f).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);color=mix(color,v_color_mix.rgb,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=u_matrix*pos;pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=local_pos;
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normalize(normal_3f));shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1);v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:dn(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=u_matrix*pos;
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:dn(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`)};function Mm(t,e){let n=t.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let i of n)if(i=i.trim(),i[0]==="#"&&i.includes("if")&&!i.includes("endif")){i=i.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();let r=i.split(" ");for(let o of r)e.includes(o)||e.push(o)}}function dn(t,e){let n=/#include\s+"([^"]+)"/g,i=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,r=e.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);r&&(r=r.map(p=>{let m=p.split(" ");return m[m.length-1]}),r=[...new Set(r)]);let o={},l=[],u=[];t=t.replace(n,(p,m)=>(u.push(m),"")),e=e.replace(n,(p,m)=>(l.push(m),""));let h=[..._2];Mm(t,h),Mm(e,h);for(let p of[...l,...u])Tm[p]||console.error(`Undefined include: ${p}`),Im[p]||(Im[p]=[],Mm(Tm[p],Im[p])),h=[...h,...Im[p]];return{fragmentSource:t=t.replace(i,(p,m,_,y,v)=>(o[v]=!0,m==="define"?`
#ifndef HAS_UNIFORM_u_${v}
in ${_} ${y} ${v};
#else
uniform ${_} ${y} u_${v};
#endif
`:m==="initialize"?`
#ifdef HAS_UNIFORM_u_${v}
    ${_} ${y} ${v} = u_${v};
#endif
`:m==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${v}
    in ${_} ${y} ${v};
#endif
`:m==="initialize-attribute"?"":void 0)),vertexSource:e=e.replace(i,(p,m,_,y,v)=>{let b=y==="float"?"vec2":y,w=v.match(/color/)?"color":b;return m==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${v}
in ${_} ${y} a_${v};
#endif
`:o[v]?m==="define"?`
#ifndef HAS_UNIFORM_u_${v}
uniform lowp float u_${v}_t;
in ${_} ${b} a_${v};
out ${_} ${y} ${v};
#else
uniform ${_} ${y} u_${v};
#endif
`:m==="initialize"?w==="vec4"?`
#ifndef HAS_UNIFORM_u_${v}
    ${v} = a_${v};
#else
    ${_} ${y} ${v} = u_${v};
#endif
`:`
#ifndef HAS_UNIFORM_u_${v}
    ${v} = unpack_mix_${w}(a_${v}, u_${v}_t);
#else
    ${_} ${y} ${v} = u_${v};
#endif
`:m==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${v}
    in ${_} ${y} a_${v};
    out ${_} ${y} ${v};
#endif
`:m==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${v}
    ${v} = a_${v};
#endif
`:void 0:m==="define"?`
#ifndef HAS_UNIFORM_u_${v}
uniform lowp float u_${v}_t;
in ${_} ${b} a_${v};
#else
uniform ${_} ${y} u_${v};
#endif
`:m==="define-instanced"?w==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${v}0;
in vec4 a_${v}1;
in vec4 a_${v}2;
in vec4 a_${v}3;
#else
uniform ${_} ${y} u_${v};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${_} ${b} a_${v};
#else
uniform ${_} ${y} u_${v};
#endif
`:m==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${v}
    ${_} ${y} ${v} = a_${v};
#endif
`:w==="vec4"?`
#ifndef HAS_UNIFORM_u_${v}
    ${_} ${y} ${v} = a_${v};
#else
    ${_} ${y} ${v} = u_${v};
#endif
`:`
#ifndef HAS_UNIFORM_u_${v}
    ${_} ${y} ${v} = unpack_mix_${w}(a_${v}, u_${v}_t);
#else
    ${_} ${y} ${v} = u_${v};
#endif
`}),staticAttributes:r,usedDefines:h,vertexIncludes:l,fragmentIncludes:u}}class kV{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(e,n,i,r,o,l,u,h){this.context=e;let p=this.boundPaintVertexBuffers.length!==r.length;for(let _=0;!p&&_<r.length;_++)this.boundPaintVertexBuffers[_]!==r[_]&&(p=!0);let m=this.boundDynamicVertexBuffers.length!==u.length;for(let _=0;!m&&_<u.length;_++)this.boundDynamicVertexBuffers[_]!==u[_]&&(m=!0);if(!this.vao||this.boundProgram!==n||this.boundLayoutVertexBuffer!==i||p||m||this.boundIndexBuffer!==o||this.boundVertexOffset!==l)this.freshBind(n,i,r,o,l,u,h);else{e.bindVertexArrayOES.set(this.vao);for(let _ of u)_&&(_.bind(),h&&_.instanceCount&&_.setVertexAttribDivisor(e.gl,n,h));o&&o.dynamicDraw&&o.bind()}}freshBind(e,n,i,r,o,l,u){let h=e.numAttributes,p=this.context,m=p.gl;this.vao&&this.destroy(),this.vao=p.gl.createVertexArray(),p.bindVertexArrayOES.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=n,this.boundPaintVertexBuffers=i,this.boundIndexBuffer=r,this.boundVertexOffset=o,this.boundDynamicVertexBuffers=l,n.enableAttributes(m,e),n.bind(),n.setVertexAttribPointers(m,e,o);for(let _ of i)_.enableAttributes(m,e),_.bind(),_.setVertexAttribPointers(m,e,o);for(let _ of l)_&&(_.enableAttributes(m,e),_.bind(),_.setVertexAttribPointers(m,e,o),u&&_.instanceCount&&_.setVertexAttribDivisor(m,e,u));r&&r.bind(),p.currentNumAttributes=h}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function LV(t,e){let n=Math.pow(2,e.canonical.z),i=e.canonical.y;return[new Gt(0,i/n).toLngLat().lat,new Gt(0,(i+1)/n).toLngLat().lat]}function NV(t,e,n,i,r,o,l){let u=t.context,h=u.gl,p=n.hillshadeFBO;if(!p)return;t.prepareDrawTile();let m=t.isTileAffectedByFog(e),_=t.getOrCreateProgram("hillshade",{overrideFog:m});u.activeTexture.set(h.TEXTURE0),h.bindTexture(h.TEXTURE_2D,p.colorAttachment.get());let y=((C,E,I,D)=>{let S=I.paint.get("hillshade-shadow-color"),M=I.paint.get("hillshade-highlight-color"),A=I.paint.get("hillshade-accent-color"),R=I.paint.get("hillshade-emissive-strength"),F=Tt(I.paint.get("hillshade-illumination-direction"));if(I.paint.get("hillshade-illumination-anchor")==="viewport")F-=C.transform.angle;else if(C.style&&C.style.enable3dLights()&&C.style.directionalLight){let L=C.style.directionalLight.properties.get("direction");F=Tt(Ke(L.x,L.y,L.z)[1])}let k=!C.options.moving;return{u_matrix:D||C.transform.calculateProjMatrix(E.tileID.toUnwrapped(),k),u_image:0,u_latrange:LV(0,E.tileID),u_light:[I.paint.get("hillshade-exaggeration"),F],u_shadow:S,u_highlight:M,u_emissive_strength:R,u_accent:A}})(t,n,i,t.terrain?e.projMatrix:null);t.uploadCommonUniforms(u,_,e.toUnwrapped());let{tileBoundsBuffer:v,tileBoundsIndexBuffer:b,tileBoundsSegments:w}=t.getTileBoundsBuffers(n);_.draw(t,h.TRIANGLES,r,o,l,kt.disabled,y,i.id,v,b,w)}function b2(t,e,n){if(!e.needsDEMTextureUpload)return;let i=t.context,r=i.gl;i.pixelStoreUnpackPremultiplyAlpha.set(!1),e.demTexture=e.demTexture||t.getTileTexture(n.stride);let o=n.getPixels();e.demTexture?e.demTexture.update(o,{premultiply:!1}):e.demTexture=new Zn(i,o,r.R32F,{premultiply:!1}),e.needsDEMTextureUpload=!1}function zV(t,e,n){let i=t.context,r=i.gl;if(!e.dem)return;let o=e.dem;if(i.activeTexture.set(r.TEXTURE1),b2(t,e,o),!e.demTexture)return;e.demTexture.bind(r.NEAREST,r.CLAMP_TO_EDGE);let l=o.dim;i.activeTexture.set(r.TEXTURE0);let u=e.hillshadeFBO;if(!u){let y=new Zn(i,{width:l,height:l,data:null},r.RGBA);y.bind(r.LINEAR,r.CLAMP_TO_EDGE),u=e.hillshadeFBO=i.createFramebuffer(l,l,!0,"renderbuffer"),u.colorAttachment.set(y.texture)}i.bindFramebuffer.set(u.framebuffer),i.viewport.set([0,0,l,l]);let{tileBoundsBuffer:h,tileBoundsIndexBuffer:p,tileBoundsSegments:m}=t.getMercatorTileBoundsBuffers(),_=[];t.linearFloatFilteringSupported()&&_.push("TERRAIN_DEM_FLOAT_FORMAT"),t.getOrCreateProgram("hillshadePrepare",{defines:_}).draw(t,r.TRIANGLES,at.disabled,Ot.disabled,Xt.unblended,kt.disabled,((y,v)=>{let b=v.stride,w=ne.create();return ne.ortho(w,0,le,-le,0,0,1),ne.translate(w,w,[0,-le,0]),{u_matrix:w,u_image:1,u_dimension:[b,b],u_zoom:y.overscaledZ}})(e.tileID,o),n.id,h,p,m),e.needsHillshadePrepare=!1}let w2=t=>({u_matrix:new Ct(t),u_image0:new Lt(t),u_skirt_height:new ye(t),u_ground_shadow_factor:new It(t)}),C2=(t,e,n)=>({u_matrix:t,u_image0:0,u_skirt_height:e,u_ground_shadow_factor:n}),E2=(t,e,n,i,r,o,l,u,h,p,m,_,y,v,b)=>({u_proj_matrix:Float32Array.from(t),u_globe_matrix:e,u_normalize_matrix:Float32Array.from(i),u_merc_matrix:n,u_zoom_transition:r,u_merc_center:o,u_image0:0,u_frustum_tl:l,u_frustum_tr:u,u_frustum_br:h,u_frustum_bl:p,u_globe_pos:m,u_globe_radius:_,u_viewport:y,u_grid_matrix:b?Float32Array.from(b):new Float32Array(9),u_skirt_height:v}),hu=(t,e)=>{if(e>0&&t.terrain&&J("Cutoff is currently disabled on terrain"),e<=0||t.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,0]}};let n=t.transform,i=Math.max(Math.abs(n._zoom-(t.minCutoffZoom-1)),1),r=n.isLODDisabled(!1)?ds(60,45,n.pitch):ds(30,15,n.pitch),o=n._farZ-n._nearZ,l=e*n.height,u=((1-(h=r))*(.75*n.cameraToCenterDistance)+h*(n._farZ+l))*i;var h;return{shouldRenderCutoff:r<1,uniformValues:{u_cutoff_params:[n._nearZ,n._farZ,(u-n._nearZ)/o,(u-l-n._nearZ)/o]}}};function T2(t,e){return t!=null&&e!=null&&!(!t.hasData()||!e.hasData())&&t.demTexture!=null&&e.demTexture!=null&&t.tileID.key!==e.tileID.key}let fu=new class{constructor(){this.operations={}}newMorphing(t,e,n,i,r){if(t in this.operations){let o=this.operations[t];o.to.tileID.key!==n.tileID.key&&(o.queued=n)}else this.operations[t]={startTime:i,phase:0,duration:r,from:e,to:n,queued:null}}getMorphValuesForProxy(t){if(!(t in this.operations))return null;let e=this.operations[t];return{from:e.from,to:e.to,phase:e.phase}}update(t){for(let e in this.operations){let n=this.operations[e];for(n.phase=(t-n.startTime)/n.duration;n.phase>=1||!this._validOp(n);)if(!this._nextOp(n,t)){delete this.operations[e];break}}}_nextOp(t,e){return!!t.queued&&(t.from=t.to,t.to=t.queued,t.queued=null,t.phase=0,t.startTime=e,!0)}_validOp(t){return t.from.hasData()&&t.to.hasData()}},I2={0:null,1:"TERRAIN_VERTEX_MORPHING"};function M2(t,e,n){if(e===0)return 0;let i=e<1&&n===514?.25/e:1;return 6*Math.pow(1.5,22-t)*Math.max(e,1)*i}function BV(t,e){let n=1<<t.z;return!e&&(t.x===0||t.x===n-1)||t.y===0||t.y===n-1}let Px=t=>({u_matrix:t});function D2(t,e,n,i,r){if(r>0){let o=yt.now(),l=(o-t.timeAdded)/r,u=e?(o-e.timeAdded)/r:-1,h=n.getSource(),p=i.coveringZoomLevel({tileSize:h.tileSize,roundZoom:h.roundZoom}),m=!e||Math.abs(e.tileID.overscaledZ-p)>Math.abs(t.tileID.overscaledZ-p),_=m&&t.refreshedUponExpiration?1:We(m?l:1-u,0,1);return t.refreshedUponExpiration&&l>=1&&(t.refreshedUponExpiration=!1),e?{opacity:1,mix:1-_}:{opacity:_,mix:0}}return{opacity:1,mix:0}}class VV extends Ko{constructor(e){let n={type:"raster-dem",maxzoom:e.transform.maxZoom},i=new gm(ch(),null),r=Cx("mock-dem",n,i,e.style);super("mock-dem",r,!1),r.setEventedParent(this),this._sourceLoaded=!0}_loadTile(e,n){e.state="loaded",n(null)}}class jV extends Ko{constructor(e){let n=Cx("proxy",{type:"geojson",maxzoom:e.transform.maxZoom},new gm(ch(),null),e.style);super("proxy",n,!1),n.setEventedParent(this),this.map=this.getSource().map=e,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(e,n,i){if(e.freezeTileCoverage)return;this.transform=e;let r=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((o,l)=>{if(o[l.key]="",!this._tiles[l.key]){let u=new Jd(l,this._source.tileSize*l.overscaleFactor(),e.tileZoom);u.state="loaded",this._tiles[l.key]=u}return o},{});for(let o in this._tiles)o in r||(this.freeFBO(o),this._tiles[o].unloadVectorData(),delete this._tiles[o])}freeFBO(e){let n=this.proxyCachedFBO[e];if(n!==void 0){let i=Object.values(n);this.renderCachePool.push(...i),delete this.proxyCachedFBO[e]}}deallocRenderCache(){this.renderCache.forEach(e=>e.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class S2 extends Jt{constructor(e,n,i){super(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y),this.proxyTileKey=n,this.projMatrix=i}}class UV extends xz{constructor(e,n){super(),this.painter=e,this.terrainTileForTile={},this.prevTerrainTileForTile={};let[i,r,o]=function(h){let p=new $r,m=new xi,_=131;p.reserve(17161),m.reserve(33800);let y=le/128,v=le+y/2,b=v+y;for(let C=-y;C<b;C+=y)for(let E=-y;E<b;E+=y){let I=E<0||E>v||C<0||C>v?24575:0,D=We(Math.round(E),0,le),S=We(Math.round(C),0,le);p.emplaceBack(D+I,S)}let w=(C,E)=>{let I=E*_+C;m.emplaceBack(I+1,I,I+_),m.emplaceBack(I+_,I+_+1,I+1)};for(let C=1;C<129;C++)for(let E=1;E<129;E++)w(E,C);return[0,129].forEach(C=>{for(let E=0;E<130;E++)w(E,C),w(C,E)}),[p,m,32768]}(),l=e.context;this.gridBuffer=l.createVertexBuffer(i,Oa.members),this.gridIndexBuffer=l.createIndexBuffer(r),this.gridSegments=yn.simpleSegment(0,0,i.length,r.length),this.gridNoSkirtSegments=yn.simpleSegment(0,0,i.length,o),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new jV(n.map),this.orthoMatrix=ne.create(),ne.ortho(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,le,0,le,0,1);let u=l.gl;this._overlapStencilMode=new Ot({func:u.GEQUAL,mask:255},0,255,u.KEEP,u.KEEP,u.REPLACE),this._previousZoom=e.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=n,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new VV(n.map),this._pendingGroundEffectLayers=[]}set style(e){e.on("data",this._onStyleDataEvent.bind(this)),this._style=e,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(e,n,i){if(e&&e.terrain){this._style!==e&&(this.style=e,this._evaluationZoom=void 0);let r=e.terrain.properties,o=e.terrain.drapeRenderMode===0,l=e.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=yt.now();let u=e.terrain&&e.terrain.scope,h=r.get("source"),p=o?this._mockSourceCache:e.getSourceCache(h,u);if(!p)return void J(`Couldn't find terrain source "${h}".`);if(this.sourceCache=p,this._exaggeration=l?this.calculateExaggeration(n):r.get("exaggeration"),!n.projection.requiresDraping&&l&&this._exaggeration===0)return void this._disable();this.enabled=!0;let m=()=>{this.sourceCache.used&&J(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);let _=this.getScaledDemTileSize();this.sourceCache.update(n,_,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,m(),this._initializing=!0),m(),n.updateElevation(!0,i),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(n),this._emptyDEMTextureDirty=!0,this._previousZoom=n.zoom}else this._disable()}calculateExaggeration(e){let n=this._previousCameraAltitude,i=e.getFreeCameraOptions().position.z/e.pixelsPerMeter*e.worldSize;this._previousCameraAltitude=i;let r=n!=null?i-n:Number.MAX_VALUE;if(Math.abs(r)<2)return this._exaggeration;let o=e.zoom,l=this._style.terrain;if(!this._previousUpdateTimestamp)return l.getExaggeration(o);let u=o-this._previousZoom,h=this._previousUpdateTimestamp,p=o;this._evaluationZoom!=null&&(p=this._evaluationZoom,Math.abs(o-p)>.5&&(u=.5*(o-p+u)),u*r<0&&(p+=u)),this._evaluationZoom=p;let m=l.getExaggeration(p),_=m===l.getExaggeration(Math.max(0,p-.1));if(_&&Math.abs(m-this._exaggeration)<.01)return m;let y=Math.min(.1,.00375*(this._updateTimestamp-h));return(_||m<.1||Math.abs(u)<1e-4)&&(y=Math.min(.2,4*y)),ft(this._exaggeration,m,y)}resetTileLookupCache(e){this._findCoveringTileCache[e]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(e){e.coord&&e.dataType==="source"?this._clearRenderCacheForTile(e.sourceCacheId,e.coord):e.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(let e in this._style._mergedSourceCaches)this._style._mergedSourceCaches[e].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(e=>e.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){let e=2*this.proxySourceCache.getSource().tileSize;return[e,e]}set useVertexMorphing(e){this._useVertexMorphing=e}updateTileBinding(e){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;let n=this.proxySourceCache,i=this.painter.transform;this._initializing&&(this._initializing=i._centerAltitude===0&&this.getAtPointOrZero(Gt.fromLngLat(i.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);let r=this.proxyCoords=n.getIds().map(h=>{let p=n.getTileByID(h).tileID;return p.projMatrix=i.calculateProjMatrix(p.toUnwrapped()),p});(function(h,p){let m=p.transform.pointCoordinate(p.transform.getCameraPoint()),_=new Q(m.x,m.y);h.sort((y,v)=>{if(v.overscaledZ-y.overscaledZ)return v.overscaledZ-y.overscaledZ;let b=new Q(y.canonical.x+(1<<y.canonical.z)*y.wrap,y.canonical.y),w=new Q(v.canonical.x+(1<<v.canonical.z)*v.wrap,v.canonical.y),C=_.mult(1<<y.canonical.z);return C.x-=.5,C.y-=.5,C.distSqr(b)-C.distSqr(w)})})(r,this.painter);let o=this.proxyToSource||{};this.proxyToSource={},r.forEach(h=>{this.proxyToSource[h.key]={}}),this.terrainTileForTile={};let l=this._style._mergedSourceCaches;for(let h in l){let p=l[h];if(!p.used||(p!==this.sourceCache&&this.resetTileLookupCache(p.id),this._setupProxiedCoordsForOrtho(p,e[h],o),p.usedForTerrain))continue;let m=e[h];p.getSource().reparseOverscaled&&this._assignTerrainTiles(m)}this.proxiedCoords[n.id]=r.map(h=>new S2(h,h.key,this.orthoMatrix)),this._assignTerrainTiles(r),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(o),this.renderingToTexture=!1;let u={};this._visibleDemTiles=[];for(let h of this.proxyCoords){let p=this.terrainTileForTile[h.key];if(!p)continue;let m=p.tileID.key;m in u||(this._visibleDemTiles.push(p),u[m]=m)}}_assignTerrainTiles(e){this._initializing||e.forEach(n=>{if(this.terrainTileForTile[n.key])return;let i=this._findTileCoveringTileID(n,this.sourceCache);i&&(this.terrainTileForTile[n.key]=i)})}_prepareDEMTextures(){let e=this.painter.context,n=e.gl;for(let i in this.terrainTileForTile){let r=this.terrainTileForTile[i],o=r.dem;!o||r.demTexture&&!r.needsDEMTextureUpload||(e.activeTexture.set(n.TEXTURE1),b2(this.painter,r,o))}}_prepareDemTileUniforms(e,n,i,r){if(!n||n.demTexture==null)return!1;let o=e.tileID.canonical,l=Math.pow(2,n.tileID.canonical.z-o.z),u=r||"";return i[`u_dem_tl${u}`]=[o.x*l%1,o.y*l%1],i[`u_dem_scale${u}`]=l,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){let e=this.painter.context,n=e.gl;if(!this._emptyDepthBufferTexture){let i=new gi({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new Zn(e,i,n.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let e=0,n=this._visibleDemTiles.reduce((i,r)=>{if(!r.dem)return i;let o=r.dem.tree.minimums[0];return o>0&&e++,i+o},0);return e?n/e:0}_updateEmptyDEMTexture(){let e=this.painter.context,n=e.gl;e.activeTexture.set(n.TEXTURE2);let i=this._getLoadedAreaMinimum(),[r,o]=(()=>{let u=new vM({width:1,height:1},new Float32Array([i]));return[n.R32F,u]})();this._emptyDEMTextureDirty=!1;let l=this._emptyDEMTexture;return l?l.update(o,{premultiply:!1}):l=this._emptyDEMTexture=new Zn(e,o,r,{premultiply:!1}),l}setupElevationDraw(e,n,i){let r=this.painter.context,o=r.gl,l={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0};l.u_exaggeration=this.exaggeration();let u=null,h=null,p=1;if(i&&i.morphing&&this._useVertexMorphing){let y=i.morphing.srcDemTile,v=i.morphing.dstDemTile;p=i.morphing.phase,y&&v&&(this._prepareDemTileUniforms(e,y,l,"_prev")&&(h=y),this._prepareDemTileUniforms(e,v,l)&&(u=v))}let m=y=>y&&y.demTexture&&this.painter.linearFloatFilteringSupported()?o.LINEAR:o.NEAREST,_=y=>{l.u_dem_size=y.size[0]===1?1:y.size[0]-2};if(h&&u)r.activeTexture.set(o.TEXTURE2),u.demTexture.bind(m(u),o.CLAMP_TO_EDGE),r.activeTexture.set(o.TEXTURE4),h.demTexture.bind(m(h),o.CLAMP_TO_EDGE),u.demTexture&&_(u.demTexture),l.u_dem_lerp=p;else{u=this.terrainTileForTile[e.tileID.key],r.activeTexture.set(o.TEXTURE2);let y=this._prepareDemTileUniforms(e,u,l)?u.demTexture:this.emptyDEMTexture;y.bind(m(u),o.CLAMP_TO_EDGE),_(y)}if(r.activeTexture.set(o.TEXTURE3),i&&i.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE),this._depthFBO&&(l.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE),l.u_depth_size_inv=[1,1]),i&&i.useMeterToDem&&u){let y=(1<<u.tileID.canonical.z)*Cn(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;l.u_meter_to_dem=y}if(i&&i.labelPlaneMatrixInv&&(l.u_label_plane_matrix_inv=i.labelPlaneMatrixInv),n.setTerrainUniformValues(r,l),this.painter.transform.projection.name==="globe"){let y=this.globeUniformValues(this.painter.transform,e.tileID.canonical,i&&i.useDenormalizedUpVectorScale);n.setGlobeUniformValues(r,y)}}globeUniformValues(e,n,i){let r=e.projection;return{u_tile_tl_up:r.upVector(n,0,0),u_tile_tr_up:r.upVector(n,le,0),u_tile_br_up:r.upVector(n,le,le),u_tile_bl_up:r.upVector(n,0,le),u_tile_up_scale:i?vp(1):r.upVectorScale(n,e.center.lat,e.worldSize).metersToTile}}renderToBackBuffer(e){let n=this.painter,i=this.painter.context;e.length!==0&&(i.bindFramebuffer.set(null),i.viewport.set([0,0,n.width,n.height]),n.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(r,o,l,u,h){if(r.transform.projection.name==="globe")(function(p,m,_,y,v){let b=p.context,w=b.gl,C,E,I=p.transform,D=KI(p,b,I),S=(G,N)=>{if(E===N)return;let W=[I2[N],"PROJECTION_GLOBE_VIEW"];D&&W.push("CUSTOM_ANTIALIASING");let Y=p.isTileAffectedByFog(G);C=p.getOrCreateProgram("globeRaster",{defines:W,overrideFog:Y}),E=N},M=p.colorModeForRenderPass(),A=new at(w.LEQUAL,at.ReadWrite,p.depthRangeFor3D);fu.update(v);let R=XI(I),F=[Ii(I.center.lng),Ai(I.center.lat)],k=p.globeSharedBuffers,L=[I.width*yt.devicePixelRatio,I.height*yt.devicePixelRatio],z=Float32Array.from(I.globeMatrix),B={useDenormalizedUpVectorScale:!0};{let G=p.transform,N=M2(G.zoom,m.exaggeration(),m.sourceCache._source.tileSize);E=-1;let W=w.TRIANGLES;for(let Y of y){let te=_.getTile(Y),q=Ot.disabled,X=m.prevTerrainTileForTile[Y.key],re=m.terrainTileForTile[Y.key];T2(X,re)&&fu.newMorphing(Y.key,X,re,v,250),b.activeTexture.set(w.TEXTURE0),te.texture&&te.texture.bind(w.LINEAR,w.CLAMP_TO_EDGE);let se=fu.getMorphValuesForProxy(Y.key),oe=se?1:0;se&&Vs(B,{morphing:{srcDemTile:se.from,dstDemTile:se.to,phase:vc(se.phase)}});let ue=xp(Y.canonical),de=cN(ue.getCenter().lat),pe=JI(Y.canonical,ue,de,G.worldSize/G._pixelsPerMercatorPixel),ae=ka(so(Y.canonical)),ge=E2(G.expandedFarZProjMatrix,z,R,ae,Ni(G.zoom),F,G.frustumCorners.TL,G.frustumCorners.TR,G.frustumCorners.BR,G.frustumCorners.BL,G.globeCenterInViewSpace,G.globeRadius,L,N,pe);if(S(Y,oe),C&&(m.setupElevationDraw(te,C,B),p.uploadCommonUniforms(b,C,Y.toUnwrapped()),k)){let[Ae,Pe,Ne]=k.getGridBuffers(de,N!==0);C.draw(p,W,A,q,M,kt.backCCW,ge,"globe_raster",Ae,Pe,Ne)}}}if(k&&(p.renderDefaultNorthPole||p.renderDefaultSouthPole)){let G=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];D&&G.push("CUSTOM_ANTIALIASING"),C=p.getOrCreateProgram("globeRaster",{defines:G});for(let N of y){let{x:W,y:Y,z:te}=N.canonical,q=Y===0,X=Y===(1<<te)-1,[re,se,oe,ue]=k.getPoleBuffers(te,!1);if(ue&&(q||X)){let de=_.getTile(N);b.activeTexture.set(w.TEXTURE0),de.texture&&de.texture.bind(w.LINEAR,w.CLAMP_TO_EDGE);let pe=YI(te,W,I),ae=ka(so(N.canonical)),ge=(Ae,Pe)=>Ae.draw(p,w.TRIANGLES,A,Ot.disabled,M,kt.disabled,E2(I.expandedFarZProjMatrix,pe,pe,ae,0,F,I.frustumCorners.TL,I.frustumCorners.TR,I.frustumCorners.BR,I.frustumCorners.BL,I.globeCenterInViewSpace,I.globeRadius,L,0),"globe_pole_raster",Pe,oe,ue);m.setupElevationDraw(de,C,B),p.uploadCommonUniforms(b,C,N.toUnwrapped()),q&&p.renderDefaultNorthPole&&ge(C,re),X&&p.renderDefaultSouthPole&&(pe=ne.scale(ne.create(),pe,[1,-1,1]),ge(C,se))}}}})(r,o,l,u,h);else{let p=r.context,m=p.gl,_,y,v=r.shadowRenderer,b=hu(r,r.longestCutoffRange),w=M=>{if(y===M)return;let A=[];A.push(I2[M]),b.shouldRenderCutoff&&A.push("RENDER_CUTOFF"),_=r.getOrCreateProgram("terrainRaster",{defines:A}),y=M},C=r.colorModeForRenderPass(),E=new at(m.LEQUAL,at.ReadWrite,r.depthRangeFor3D);fu.update(h);let I=r.transform,D=M2(I.zoom,o.exaggeration(),o.sourceCache._source.tileSize),S=[0,0,0];if(v){let M=r.style.directionalLight,A=r.style.ambientLight;M&&A&&(S=Lx(M,A))}{y=-1;let M=m.TRIANGLES,[A,R]=[o.gridIndexBuffer,o.gridSegments];for(let F of u){let k=l.getTile(F),L=Ot.disabled,z=o.prevTerrainTileForTile[F.key],B=o.terrainTileForTile[F.key];T2(z,B)&&fu.newMorphing(F.key,z,B,h,250),p.activeTexture.set(m.TEXTURE0),k.texture&&k.texture.bind(m.LINEAR,m.CLAMP_TO_EDGE);let G=fu.getMorphValuesForProxy(F.key),N=G?1:0,W;G&&(W={morphing:{srcDemTile:G.from,dstDemTile:G.to,phase:vc(G.phase)}});let Y=C2(F.projMatrix,BV(F.canonical,I.renderWorldCopies)?D/10:D,S);if(w(N),!_)continue;o.setupElevationDraw(k,_,W);let te=F.toUnwrapped();v&&v.setupShadows(te,_),r.uploadCommonUniforms(p,_,te,null,b),_.draw(r,M,E,L,C,kt.backCCW,Y,"terrain_raster",o.gridBuffer,A,R)}}}}(n,this,this.proxySourceCache,e,this._updateTimestamp),this.renderingToTexture=!0,n.gpuTimingDeferredRenderEnd(),e.splice(0,e.length))}renderBatch(e){if(this._drapedRenderBatches.length===0)return e+1;this.renderingToTexture=!0;let n=this.painter,i=this.painter.context,r=this.proxySourceCache,o=this.proxiedCoords[r.id],l=this._drapedRenderBatches.shift(),u=n.style.order,h=[],p=0;for(let m of o){let _=r.getTileByID(m.proxyTileKey),y=r.proxyCachedFBO[m.key]?r.proxyCachedFBO[m.key][e]:void 0,v=y!==void 0?r.renderCache[y]:this.pool[p++],b=y!==void 0;if(_.texture=v.tex,b&&!v.dirty){h.push(_.tileID);continue}let w;i.bindFramebuffer.set(v.fb.framebuffer),this.renderedToTile=!1,v.dirty&&(i.clear({color:Rt.transparent,stencil:0}),v.dirty=!1);for(let C=l.start;C<=l.end;++C){let E=n.style._mergedLayers[u[C]];if(E.isHidden(n.transform.zoom))continue;let I=n.style.getLayerSourceCache(E),D=I?this.proxyToSource[m.key][I.id]:[m];if(!D)continue;let S=D;i.viewport.set([0,0,v.fb.width,v.fb.height]),w!==(I?I.id:null)&&(this._setupStencil(v,D,E,I),w=I?I.id:null),n.renderLayer(n,I,E,S)}if(this._drapedRenderBatches.length===0)for(let C of this._pendingGroundEffectLayers){let E=n.style._mergedLayers[u[C]];if(E.isHidden(n.transform.zoom))continue;let I=n.style.getLayerSourceCache(E),D=I?this.proxyToSource[m.key][I.id]:[m];if(!D)continue;let S=D;i.viewport.set([0,0,v.fb.width,v.fb.height]),w!==(I?I.id:null)&&(this._setupStencil(v,D,E,I),w=I?I.id:null),n.renderLayer(n,I,E,S)}this.renderedToTile?(v.dirty=!0,h.push(_.tileID)):b||--p,p===5&&(p=0,this.renderToBackBuffer(h))}return this.renderToBackBuffer(h),this.renderingToTexture=!1,i.bindFramebuffer.set(null),i.viewport.set([0,0,n.width,n.height]),l.end+1}postRender(){}isLayerOrderingCorrect(e){let n=e.order.length,i=-1,r=n;for(let o=0;o<n;++o)this._style.isLayerDraped(e._mergedLayers[e.order[o]])?i=Math.max(i,o):r=Math.min(r,o);return r>i}getMinElevationBelowMSL(){let e=0;return this._visibleDemTiles.filter(n=>n.dem).forEach(n=>{e=Math.min(e,n.dem.tree.minimums[0])}),e===0?e:(e-30)*this._exaggeration}raycast(e,n,i){if(!this._visibleDemTiles)return null;let r=this._visibleDemTiles.filter(o=>o.dem).map(o=>{let l=o.tileID,u=1<<l.overscaledZ,{x:h,y:p}=l.canonical,m=h/u,_=(h+1)/u,y=p/u,v=(p+1)/u;return{minx:m,miny:y,maxx:_,maxy:v,t:o.dem.tree.raycastRoot(m,y,_,v,e,n,i),tile:o}});r.sort((o,l)=>(o.t!==null?o.t:Number.MAX_VALUE)-(l.t!==null?l.t:Number.MAX_VALUE));for(let o of r){if(o.t==null)return null;let l=o.tile.dem.tree.raycast(o.minx,o.miny,o.maxx,o.maxy,e,n,i);if(l!=null)return l}return null}_createFBO(){let e=this.painter.context,n=e.gl,i=this.drapeBufferSize;e.activeTexture.set(n.TEXTURE0);let r=new Zn(e,{width:i[0],height:i[1],data:null},n.RGBA);r.bind(n.LINEAR,n.CLAMP_TO_EDGE);let o=e.createFramebuffer(i[0],i[1],!0,null);return o.colorAttachment.set(r.texture),o.depthAttachment=new XB(e,o.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=e.createRenderbuffer(e.gl.DEPTH_STENCIL,i[0],i[1]),this._stencilRef=0,o.depthAttachment.set(this._sharedDepthStencil),e.clear({stencil:0})):o.depthAttachment.set(this._sharedDepthStencil),e.extTextureFilterAnisotropic&&n.texParameterf(n.TEXTURE_2D,e.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,e.extTextureFilterAnisotropicMax),{fb:o,tex:r,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.hasLightTransitions())return!0;for(let e in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[e].hasTransition())return!0;return this._style.order.some(e=>{let n=this._style._mergedLayers[e],i=n.isHidden(this.painter.transform.zoom);return n.type==="custom"?!i&&n.shouldRedrape():!i&&n.hasTransition()})}_clearLineLayersFromRenderCache(){let e=!1;for(let i of this._style.getSources())if(i instanceof VS){e=!0;break}if(!e)return;let n={};for(let i=0;i<this._style.order.length;++i){let r=this._style._mergedLayers[this._style.order[i]],o=this._style.getLayerSourceCache(r);if(o&&!n[o.id]&&!r.isHidden(this.painter.transform.zoom)&&r.type==="line"&&r.widthExpression()instanceof Ta){n[o.id]=!0;for(let l of this.proxyCoords){let u=this.proxyToSource[l.key][o.id];if(u)for(let h of u)this._clearRenderCacheForTile(o.id,h)}}}}_clearRasterLayersFromRenderCache(){let e=!1;for(let i in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[i]._source instanceof hx){e=!0;break}if(!e)return;let n={};for(let i=0;i<this._style.order.length;++i){let r=this._style._mergedLayers[this._style.order[i]],o=this._style.getLayerSourceCache(r);if(!o||n[o.id]||r.isHidden(this.painter.transform.zoom)||r.type!=="raster")continue;let l=r.paint.get("raster-fade-duration");for(let u of this.proxyCoords){let h=this.proxyToSource[u.key][o.id];if(h)for(let p of h){let m=D2(o.getTile(p),o.findLoadedParent(p,0),o,this.painter.transform,l);(m.opacity!==1||m.mix!==0)&&this._clearRenderCacheForTile(o.id,p)}}}}_setupDrapedRenderBatches(){let e=this._style.order,n=e.length;if(n===0)return;let i=[];this._pendingGroundEffectLayers=[];let r,o=0,l=this._style._mergedLayers[e[o]];for(;!this._style.isLayerDraped(l)&&l.isHidden(this.painter.transform.zoom)&&++o<n;)l=this._style._mergedLayers[e[o]];for(;o<n;++o){let u=this._style._mergedLayers[e[o]];u.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(u)?r===void 0&&(r=o):(u.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(o),r!==void 0&&(i.push({start:r,end:o-1}),r=void 0)))}if(r!==void 0&&i.push({start:r,end:o-1}),i.length!==0){let u=i[i.length-1];this._pendingGroundEffectLayers.every(p=>p>u.end)||J("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=i}_setupRenderCache(e){let n=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,n.renderCache.length>n.renderCachePool.length){let l=Object.values(n.proxyCachedFBO);n.proxyCachedFBO={};for(let u=0;u<l.length;++u){let h=Object.values(l[u]);n.renderCachePool.push(...h)}}return}this._clearRasterLayersFromRenderCache();let i=this.proxyCoords,r=this._tilesDirty;for(let l=i.length-1;l>=0;l--){let u=i[l];if(n.getTileByID(u.key),n.proxyCachedFBO[u.key]!==void 0){let h=e[u.key],p=this.proxyToSource[u.key],m=0;for(let _ in p){let y=p[_],v=h[_];if(!v||v.length!==y.length||y.some((b,w)=>b!==v[w]||r[_]&&r[_].hasOwnProperty(b.key))){m=-1;break}++m}for(let _ in n.proxyCachedFBO[u.key])n.renderCache[n.proxyCachedFBO[u.key][_]].dirty=m<0||m!==Object.values(h).length}}let o=[...this._drapedRenderBatches];o.sort((l,u)=>u.end-u.start-(l.end-l.start));for(let l of o)for(let u of i){if(n.proxyCachedFBO[u.key])continue;let h=n.renderCachePool.pop();h===void 0&&n.renderCache.length<50&&(h=n.renderCache.length,n.renderCache.push(this._createFBO())),h!==void 0&&(n.proxyCachedFBO[u.key]={},n.proxyCachedFBO[u.key][l.start]=h,n.renderCache[h].dirty=!0)}this._tilesDirty={}}_setupStencil(e,n,i,r){if(!r||!this._sourceTilesOverlap[r.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));let o=this.painter.context,l=o.gl;if(n.length<=1)return void(this._overlapStencilType=!1);let u;if(i.isTileClipped())u=n.length,this._overlapStencilMode.test={func:l.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(n[0].overscaledZ>n[n.length-1].overscaledZ))return void(this._overlapStencilType=!1);u=1,this._overlapStencilMode.test={func:l.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+u>255&&(o.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=u,this._overlapStencilMode.ref=this._stencilRef,i.isTileClipped()&&this._renderTileClippingMasks(n,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(e){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[e.key]),this._overlapStencilMode):Ot.disabled}_renderTileClippingMasks(e,n){let i=this.painter,r=this.painter.context,o=r.gl;i._tileClippingMaskIDs={},r.setColorMode(Xt.disabled),r.setDepthMode(at.disabled);let l=i.getOrCreateProgram("clippingMask");for(let u of e){let h=i._tileClippingMaskIDs[u.key]=--n;l.draw(i,o.TRIANGLES,at.disabled,new Ot({func:o.ALWAYS,mask:0},h,255,o.KEEP,o.KEEP,o.REPLACE),Xt.disabled,kt.disabled,Px(u.projMatrix),"$clipping",i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments)}}pointCoordinate(e){let n=this.painter.transform;if(e.x<0||e.x>n.width||e.y<0||e.y>n.height)return null;let i=[e.x,e.y,1,1];vn.transformMat4(i,i,n.pixelMatrixInverse),vn.scale(i,i,1/i[3]),i[0]/=n.worldSize,i[1]/=n.worldSize;let r=n._camera.position,o=Cn(1,n.center.lat),l=[r[0],r[1],r[2]/o,0],u=$.subtract([],i.slice(0,3),l);$.normalize(u,u);let h=this.raycast(l,u,this._exaggeration);return h!==null&&h?($.scaleAndAdd(l,l,u,h),l[3]=l[2],l[2]*=o,l):null}drawDepth(){let e=this.painter,n=e.context,i=this.proxySourceCache,r=Math.ceil(e.width),o=Math.ceil(e.height);if(!this._depthFBO||this._depthFBO.width===r&&this._depthFBO.height===o||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){let l=n.gl,u=n.createFramebuffer(r,o,!0,"renderbuffer");n.activeTexture.set(l.TEXTURE0);let h=new Zn(n,{width:r,height:o,data:null},l.RGBA);h.bind(l.NEAREST,l.CLAMP_TO_EDGE),u.colorAttachment.set(h.texture);let p=n.createRenderbuffer(n.gl.DEPTH_COMPONENT16,r,o);u.depthAttachment.set(p),this._depthFBO=u,this._depthTexture=h}n.bindFramebuffer.set(this._depthFBO.framebuffer),n.viewport.set([0,0,r,o]),function(l,u,h,p){if(l.transform.projection.name==="globe")return;let m=l.context,_=m.gl;m.clear({depth:1});let y=l.getOrCreateProgram("terrainDepth"),v=new at(_.LESS,at.ReadWrite,l.depthRangeFor3D);for(let b of p){let w=h.getTile(b),C=C2(b.projMatrix,0,[0,0,0]);u.setupElevationDraw(w,y),y.draw(l,_.TRIANGLES,v,Ot.disabled,Xt.unblended,kt.backCCW,C,"terrain_depth",u.gridBuffer,u.gridIndexBuffer,u.gridNoSkirtSegments)}}(e,this,i,this.proxyCoords)}_setupProxiedCoordsForOrtho(e,n,i){if(e.getSource()instanceof Ao)return this._setupProxiedCoordsForImageSource(e,n,i);this._findCoveringTileCache[e.id]=this._findCoveringTileCache[e.id]||{};let r=this.proxiedCoords[e.id]=[],o=this.proxyCoords;for(let u=0;u<o.length;u++){let h=o[u],p=this._findTileCoveringTileID(h,e);if(p){let m=this._createProxiedId(h,p,i[h.key]&&i[h.key][e.id]);r.push(m),this.proxyToSource[h.key][e.id]=[m]}}let l=!1;for(let u=0;u<n.length;u++){let h=e.getTile(n[u]);if(!h||!h.hasData())continue;let p=this._findTileCoveringTileID(h.tileID,this.proxySourceCache);if(p&&p.tileID.canonical.z!==h.tileID.canonical.z){let m=this.proxyToSource[p.tileID.key][e.id],_=this._createProxiedId(p.tileID,h,i[p.tileID.key]&&i[p.tileID.key][e.id]);m?m.splice(m.length-1,0,_):this.proxyToSource[p.tileID.key][e.id]=[_],r.push(_),l=!0}}this._sourceTilesOverlap[e.id]=l}_setupProxiedCoordsForImageSource(e,n,i){if(!e.getSource().loaded())return;let r=this.proxiedCoords[e.id]=[],o=this.proxyCoords,l=e.getSource(),u=l.tileID;if(!u)return;let h=new Q(u.x,u.y)._div(1<<u.z),p=l.coordinates.map(Gt.fromLngLat).reduce((_,y)=>(_.min.x=Math.min(_.min.x,y.x-h.x),_.min.y=Math.min(_.min.y,y.y-h.y),_.max.x=Math.max(_.max.x,y.x-h.x),_.max.y=Math.max(_.max.y,y.y-h.y),_),{min:new Q(Number.MAX_VALUE,Number.MAX_VALUE),max:new Q(-Number.MAX_VALUE,-Number.MAX_VALUE)}),m=(_,y)=>{let v=_.wrap+_.canonical.x/(1<<_.canonical.z),b=_.canonical.y/(1<<_.canonical.z),w=le/(1<<_.canonical.z),C=y.wrap+y.canonical.x/(1<<y.canonical.z),E=y.canonical.y/(1<<y.canonical.z);return v+w<C+p.min.x||v>C+p.max.x||b+w<E+p.min.y||b>E+p.max.y};for(let _=0;_<o.length;_++){let y=o[_];for(let v=0;v<n.length;v++){let b=e.getTile(n[v]);if(!b||!b.hasData()||m(y,b.tileID))continue;let w=this._createProxiedId(y,b,i[y.key]&&i[y.key][e.id]),C=this.proxyToSource[y.key][e.id];C?C.push(w):this.proxyToSource[y.key][e.id]=[w],r.push(w)}}}_createProxiedId(e,n,i){let r=this.orthoMatrix;if(i){let o=i.find(l=>l.key===n.tileID.key);if(o)return o}if(n.tileID.key!==e.key){let o=e.canonical.z-n.tileID.canonical.z,l,u,h;r=ne.create();let p=n.tileID.wrap-e.wrap<<e.overscaledZ;o>0?(l=le>>o,u=l*((n.tileID.canonical.x<<o)-e.canonical.x+p),h=l*((n.tileID.canonical.y<<o)-e.canonical.y)):(l=le<<-o,u=le*(n.tileID.canonical.x-(e.canonical.x+p<<-o)),h=le*(n.tileID.canonical.y-(e.canonical.y<<-o))),ne.ortho(r,0,l,0,l,0,1),ne.translate(r,r,[u,h,0])}return new S2(n.tileID,e.key,r)}_findTileCoveringTileID(e,n){let i=n.getTile(e);if(i&&i.hasData())return i;let r=this._findCoveringTileCache[n.id],o=r[e.key];if(i=o?n.getTileByID(o):null,i&&i.hasData()||o===null)return i;let l=i?i.tileID:e,u=l.overscaledZ,h=n.getSource().minzoom,p=[];if(!o){let _=n.getSource().maxzoom;if(e.canonical.z>=_){let y=e.canonical.z-_;n.getSource().reparseOverscaled?(u=Math.max(e.canonical.z+2,n.transform.tileZoom),l=new Jt(u,e.wrap,_,e.canonical.x>>y,e.canonical.y>>y)):y!==0&&(u=_,l=new Jt(u,e.wrap,_,e.canonical.x>>y,e.canonical.y>>y))}l.key!==e.key&&(p.push(l.key),i=n.getTile(l))}let m=_=>{p.forEach(y=>{r[y]=_}),p.length=0};for(u-=1;u>=h&&(!i||!i.hasData());u--){i&&m(i.tileID.key);let _=l.calculateScaledKey(u);if(i=n.getTileByID(_),i&&i.hasData())break;let y=r[_];if(y===null)break;y===void 0?p.push(_):i=n.getTileByID(y)}return m(i?i.tileID.key:null),i&&i.hasData()?i:null}findDEMTileFor(e){return this.enabled?this._findTileCoveringTileID(e,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(e,n){let i=this._tilesDirty[e];i||(i=this._tilesDirty[e]={}),i[n.key]=!0}}function $V(t,e,n){let i=function(u,h,p){let m=$.dot(h,u),_=$.dot(p,[.2126,.7152,.0722]),y=(b,w,C)=>(1-C)*b+C*w,v=y(1-.3*Math.min(_,1),1,Math.min(m+1,1));return y(.92,1,Math.asin(We(h[2],-1,1))/Math.PI+.5)*v}(t,[0,0,1],e),r=[0,0,0];$.scale(r,n.slice(0,3),i);let o=[0,0,0];$.scale(o,e.slice(0,3),t[2]);let l=[0,0,0];return $.add(l,r,o),di(l)}let GV=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],HV=["stars","fillExtrusion","fillExtrusionGroundEffect","model","symbolSDF","symbolIcon","symbolTextAndIcon"];class A2{static cacheKey(e,n,i,r){let o=`${n}${r?r.cacheKey:""}`;for(let l of i)e.usedDefines.includes(l)&&(o+=`/${l}`);return o}constructor(e,n,i,r,o,l){let u=e.gl;this.program=u.createProgram(),this.configuration=r,this.name=n,this.fixedDefines=[...l];let h=r?r.getBinderAttributes():[],p=(i.staticAttributes||[]).concat(h),m=r?r.defines():[];m=m.concat(l.map(C=>`#define ${C}`));let _=`#version 300 es
`,y=_+m.concat("precision mediump float;",v2,y2.fragmentSource).join(`
`);for(let C of i.fragmentIncludes)y+=`
${Tm[C]}`;y+=`
${i.fragmentSource}`;let v=_+m.concat("precision highp float;",v2,y2.vertexSource).join(`
`);for(let C of i.vertexIncludes)v+=`
${Tm[C]}`;v+=`
${i.vertexSource}`;let b=u.createShader(u.FRAGMENT_SHADER);if(u.isContextLost())return void(this.failedToCreate=!0);u.shaderSource(b,y),u.compileShader(b),u.attachShader(this.program,b);let w=u.createShader(u.VERTEX_SHADER);if(u.isContextLost())this.failedToCreate=!0;else{u.shaderSource(w,v),u.compileShader(w),u.attachShader(this.program,w),this.attributes={},this.numAttributes=p.length;for(let C=0;C<this.numAttributes;C++)if(p[C]){let E=p[C].startsWith("a_")?p[C]:`a_${p[C]}`;u.bindAttribLocation(this.program,C,E),this.attributes[E]=C}u.linkProgram(this.program),u.deleteShader(w),u.deleteShader(b),this.fixedUniforms=o(e),this.binderUniforms=r?r.getUniforms(e):[],l.includes("TERRAIN")&&(this.terrainUniforms=(C=>({u_dem:new Lt(C),u_dem_prev:new Lt(C),u_dem_tl:new Nt(C),u_dem_scale:new ye(C),u_dem_tl_prev:new Nt(C),u_dem_scale_prev:new ye(C),u_dem_size:new ye(C),u_dem_lerp:new ye(C),u_exaggeration:new ye(C),u_depth:new Lt(C),u_depth_size_inv:new Nt(C),u_meter_to_dem:new ye(C),u_label_plane_matrix_inv:new Ct(C)}))(e)),l.includes("GLOBE")&&(this.globeUniforms=(C=>({u_tile_tl_up:new It(C),u_tile_tr_up:new It(C),u_tile_br_up:new It(C),u_tile_bl_up:new It(C),u_tile_up_scale:new ye(C)}))(e)),l.includes("FOG")&&(this.fogUniforms=(C=>({u_fog_matrix:new Ct(C),u_fog_range:new Nt(C),u_fog_color:new Gr(C),u_fog_horizon_blend:new ye(C),u_fog_vertical_limit:new Nt(C),u_fog_temporal_offset:new ye(C),u_frustum_tl:new It(C),u_frustum_tr:new It(C),u_frustum_br:new It(C),u_frustum_bl:new It(C),u_globe_pos:new It(C),u_globe_radius:new ye(C),u_globe_transition:new ye(C),u_is_globe:new Lt(C),u_viewport:new Nt(C)}))(e)),l.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(C=>({u_cutoff_params:new Gr(C)}))(e)),l.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(C=>({u_lighting_ambient_color:new It(C),u_lighting_directional_dir:new It(C),u_lighting_directional_color:new It(C),u_ground_radiance:new It(C)}))(e)),l.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(C=>({u_light_matrix_0:new Ct(C),u_light_matrix_1:new Ct(C),u_fade_range:new Nt(C),u_shadow_normal_offset:new It(C),u_shadow_intensity:new ye(C),u_shadow_texel_size:new ye(C),u_shadow_map_resolution:new ye(C),u_shadow_direction:new It(C),u_shadow_bias:new It(C),u_shadowmap_0:new Lt(C),u_shadowmap_1:new Lt(C)}))(e))}}setTerrainUniformValues(e,n){if(!this.terrainUniforms)return;let i=this.terrainUniforms;if(!this.failedToCreate){e.program.set(this.program);for(let r in n)i[r]&&i[r].set(this.program,r,n[r])}}setGlobeUniformValues(e,n){if(!this.globeUniforms)return;let i=this.globeUniforms;if(!this.failedToCreate){e.program.set(this.program);for(let r in n)i[r]&&i[r].set(this.program,r,n[r])}}setFogUniformValues(e,n){if(!this.fogUniforms)return;let i=this.fogUniforms;if(!this.failedToCreate){e.program.set(this.program);for(let r in n)i[r].set(this.program,r,n[r])}}setCutoffUniformValues(e,n){if(!this.cutoffUniforms)return;let i=this.cutoffUniforms;if(!this.failedToCreate){e.program.set(this.program);for(let r in n)i[r].set(this.program,r,n[r])}}setLightsUniformValues(e,n){if(!this.lightsUniforms)return;let i=this.lightsUniforms;if(!this.failedToCreate){e.program.set(this.program);for(let r in n)i[r].set(this.program,r,n[r])}}setShadowUniformValues(e,n){if(this.failedToCreate||!this.shadowUniforms)return;let i=this.shadowUniforms;e.program.set(this.program);for(let r in n)i[r].set(this.program,r,n[r])}_drawDebugWireframe(e,n,i,r,o,l,u,h,p,m){let _=e.options.wireframe;if(_.terrain===!1&&_.layers2D===!1&&_.layers3D===!1)return;let y=e.context;if(!(!(!_.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!_.layers2D||e._terrain&&e._terrain.renderingToTexture||!GV.includes(this.name))||!(!_.layers3D||!HV.includes(this.name))))return;let v=y.gl,b=e.wireframeDebugCache.getLinesFromTrianglesBuffer(e.frameCounter,o,y);if(!b)return;let w=[...this.fixedDefines];w.push("DEBUG_WIREFRAME");let C=e.getOrCreateProgram(this.name,{config:this.configuration,defines:w});y.program.set(C.program);let E=(S,M,A)=>{if(M[S]&&A[S])for(let R in M[S])A[S][R]&&A[S][R].set(A.program,R,M[S][R].current)};p&&p.setUniforms(C.program,y,C.binderUniforms,u,{zoom:h}),E("fixedUniforms",this,C),E("terrainUniforms",this,C),E("globeUniforms",this,C),E("fogUniforms",this,C),E("lightsUniforms",this,C),E("shadowUniforms",this,C),b.bind(),y.setColorMode(new Xt([v.ONE,v.ONE_MINUS_SRC_ALPHA,v.ZERO,v.ONE],Rt.transparent,[!0,!0,!0,!1])),y.setDepthMode(new at(n.func===v.LESS?v.LEQUAL:n.func,at.ReadOnly,n.range)),y.setStencilMode(Ot.disabled);let I=3*l.primitiveLength*2,D=3*l.primitiveOffset*2*2;m&&m>1?v.drawElementsInstanced(v.LINES,I,v.UNSIGNED_SHORT,D,m):v.drawElements(v.LINES,I,v.UNSIGNED_SHORT,D),o.bind(),y.program.set(this.program),y.setDepthMode(n),y.setStencilMode(i),y.setColorMode(r)}draw(e,n,i,r,o,l,u,h,p,m,_,y,v,b,w,C){let E=e.context,I=E.gl;if(this.failedToCreate)return;E.program.set(this.program),E.setDepthMode(i),E.setStencilMode(r),E.setColorMode(o),E.setCullFace(l);for(let M of Object.keys(this.fixedUniforms))this.fixedUniforms[M].set(this.program,M,u[M]);b&&b.setUniforms(this.program,E,this.binderUniforms,y,{zoom:v});let D={[I.LINES]:2,[I.TRIANGLES]:3,[I.LINE_STRIP]:1}[n],S=C&&C>0?1:void 0;for(let M of _.get()){let A=M.vaos||(M.vaos={});(A[h]||(A[h]=new kV)).bind(E,this,p,b?b.getPaintVertexBuffers():[],m,M.vertexOffset,w||[],S),C&&C>1?I.drawElementsInstanced(n,M.primitiveLength*D,I.UNSIGNED_SHORT,M.primitiveOffset*D*2,C):I.drawElements(n,M.primitiveLength*D,I.UNSIGNED_SHORT,M.primitiveOffset*D*2),n===I.TRIANGLES&&this._drawDebugWireframe(e,i,r,o,m,M,y,v,b,C)}}}function P2(t,e){let n=Math.pow(2,e.tileID.overscaledZ),i=e.tileSize*Math.pow(2,t.transform.tileZoom)/n,r=i*(e.tileID.canonical.x+e.tileID.wrap*n),o=i*e.tileID.canonical.y;return{u_image:0,u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/Bl(e,1,t.transform.tileZoom),u_pixel_coord_upper:[r>>16,o>>16],u_pixel_coord_lower:[65535&r,65535&o]}}let qV=ne.create(),R2=(t,e,n,i,r,o,l,u,h,p,m,_,y,v,b,w)=>{let C=e.style.light,E=C.properties.get("position"),I=[E.x,E.y,E.z],D=Pr.create();C.properties.get("anchor")==="viewport"&&(Pr.fromRotation(D,-e.transform.angle),$.transformMat3(I,I,D));let S=C.properties.get("color"),M=e.transform,A={u_matrix:t,u_lightpos:I,u_lightintensity:C.properties.get("intensity"),u_lightcolor:[S.r,S.g,S.b],u_vertical_gradient:+n,u_opacity:i,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:qV,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:r,u_edge_radius:o,u_flood_light_color:_,u_vertical_scale:y,u_flood_light_intensity:v,u_ground_shadow_factor:b,u_emissive_strength:w};return M.projection.name==="globe"&&(A.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],A.u_zoom_transition=h,A.u_inv_rot_matrix=m,A.u_merc_center=p,A.u_up_dir=M.projection.upVector(new Io(0,0,0),p[0]*le,p[1]*le),A.u_height_lift=u),A},WV=(t,e,n)=>({u_matrix:t,u_edge_radius:e,u_vertical_scale:n}),ZV=(t,e,n,i,r,o,l,u,h,p,m,_,y,v)=>{let b=R2(t,e,n,i,r,o,l,h,p,m,_,y,v,1,[0,0,0],0),w={u_height_factor:-Math.pow(2,l.overscaledZ)/u.tileSize/8};return $e(b,P2(e,u),w)},O2=(t,e)=>({u_matrix:t,u_emissive_strength:e}),F2=(t,e,n,i)=>$e(O2(t,e),P2(n,i)),XV=(t,e,n)=>({u_matrix:t,u_world:n,u_emissive_strength:e}),YV=(t,e,n,i,r)=>$e(F2(t,e,n,i),{u_world:r}),KV=(t,e,n,i)=>{let r=le/n.tileSize;return{u_matrix:t,u_camera_to_center_distance:e.getCameraToCenterDistance(i),u_extrude_scale:[e.pixelsToGLUnits[0]/r,e.pixelsToGLUnits[1]/r]}},k2=(t,e,n=1)=>({u_matrix:t,u_color:e,u_overlay:0,u_overlay_scale:n}),JV=ne.create(),QV=(t,e,n,i,r,o,l)=>{let u=t.transform,h=u.projection.name==="globe",p=h?WI(u.zoom,e.canonical)*u._pixelsPerMercatorPixel:Bl(n,1,o),m={u_matrix:e.projMatrix,u_extrude_scale:p,u_intensity:l,u_inv_rot_matrix:JV,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(h){m.u_inv_rot_matrix=i,m.u_merc_center=r,m.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],m.u_zoom_transition=Ni(u.zoom);let _=r[0]*le,y=r[1]*le;m.u_up_dir=u.projection.upVector(new Io(0,0,0),_,y)}return m},L2=(t,e,n,i,r,o,l,u,h,p,m,_,y,v,b,w,C,E,I,D,S,M)=>{return{u_matrix:t,u_normalize_matrix:e,u_globe_matrix:n,u_merc_matrix:i,u_grid_matrix:r,u_tl_parent:o,u_scale_parent:m,u_fade_t:_.mix,u_opacity:_.opacity*y.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:y.paint.get("raster-brightness-min"),u_brightness_high:y.paint.get("raster-brightness-max"),u_saturation_factor:(R=y.paint.get("raster-saturation"),R>0?1-1/(1.001-R):-R),u_contrast_factor:(A=y.paint.get("raster-contrast"),A>0?1/(1-A):1+A),u_spin_weights:e5(y.paint.get("raster-hue-rotate")),u_perspective_transform:v,u_raster_elevation:b,u_tl_br:l,u_zoom_transition:u,u_merc_center:h,u_cutoff_params:p,u_colorization_mix:t5(C,I),u_colorization_offset:n5(E,I),u_color_ramp:w,u_texture_offset:[S/(D+2*S),D/(D+2*S)],u_texture_res:[D+2*S,D+2*S],u_emissive_strength:M};var A,R};function e5(t){t*=Math.PI/180;let e=Math.sin(t),n=Math.cos(t);return[(2*n+1)/3,(-Math.sqrt(3)*e-n+1)/3,(Math.sqrt(3)*e-n+1)/3]}function t5([t,e,n,i],[r,o]){if(r===o)return[0,0,0,0];let l=259/257/(o-r);return[t*l,e*l,n*l,i*l]}function n5(t,[e,n]){return e===n?0:((t-e)/(n-e)*259-1)/257}let N2=ne.create(),z2=(t,e,n,i,r,o,l,u,h,p,m,_,y,v,b,w,C,E)=>{let I=r.transform,D={u_is_size_zoom_constant:+(t==="constant"||t==="source"),u_is_size_feature_constant:+(t==="constant"||t==="camera"),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:I.getCameraToCenterDistance(w),u_rotate_symbol:+n,u_aspect_ratio:I.width/I.height,u_fade_change:r.options.fadeDuration?r.symbolFadeChange:1,u_matrix:o,u_label_plane_matrix:l,u_coord_matrix:u,u_is_text:+h,u_pitch_with_map:+i,u_texsize:p,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:N2,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:N2,u_up_vector:[0,-1,0],u_icon_transition:E||0,u_icon_saturation:C};return w.name==="globe"&&(D.u_tile_id=[m.canonical.x,m.canonical.y,1<<m.canonical.z],D.u_zoom_transition=_,D.u_inv_rot_matrix=v,D.u_merc_center=y,D.u_camera_forward=I._camera.forward(),D.u_ecef_origin=function(S,M){let A=[0,0,0],R=ka(so(M.canonical));return $.transformMat4(A,A,R),$.transformMat4(A,A,S),A}(I.globeMatrix,m.toUnwrapped()),D.u_tile_matrix=Float32Array.from(I.globeMatrix),D.u_up_vector=b),D},B2=(t,e,n,i,r,o,l,u,h,p,m,_,y,v,b,w,C)=>$e(z2(t,e,n,i,r,o,l,u,h,p,_,y,v,b,w,C,1),{u_gamma_scale:i?r.transform.getCameraToCenterDistance(C)*Math.cos(r.terrain?0:r.transform._pitch):1,u_device_pixel_ratio:yt.devicePixelRatio,u_is_halo:+m,undefined:void 0}),i5=(t,e,n,i,r,o,l,u,h,p,m,_,y,v,b,w)=>$e(B2(t,e,n,i,r,o,l,u,!0,h,!0,m,_,y,v,b,w),{u_texsize_icon:p,u_texture_icon:1}),r5=(t,e,n,i)=>({u_matrix:t,u_emissive_strength:e,u_opacity:n,u_color:i}),o5=(t,e,n,i,r,o,l)=>$e(function(u,h,p,m){let _=p.imageManager.getPattern(u.toString(),h),{width:y,height:v}=p.imageManager.getPixelSize(h),b=Math.pow(2,m.tileID.overscaledZ),w=m.tileSize*Math.pow(2,p.transform.tileZoom)/b,C=w*(m.tileID.canonical.x+m.tileID.wrap*b),E=w*m.tileID.canonical.y;return{u_image:0,u_pattern_tl:_.tl,u_pattern_br:_.br,u_texsize:[y,v],u_pattern_size:_.displaySize,u_tile_units_to_pixels:1/Bl(m,1,p.transform.tileZoom),u_pixel_coord_upper:[C>>16,E>>16],u_pixel_coord_lower:[65535&C,65535&E]}}(r,o,i,l),{u_matrix:t,u_emissive_strength:e,u_opacity:n}),Zr={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,ShadowMap0:10},Rx=(t,e,n,i,r,o,l,u,h,p,m,_,y=[0,0,0])=>{let v=i.style.light,b=v.properties.get("position"),w=[-b.x,-b.y,b.z],C=Pr.create();v.properties.get("anchor")==="viewport"&&(Pr.fromRotation(C,-i.transform.angle),$.transformMat3(w,w,C));let E=p.alphaMode==="MASK",I=v.properties.get("color"),D=_.paint.get("model-ambient-occlusion-intensity"),S=_.paint.get("model-color").constantOr(Rt.white),M=_.paint.get("model-color-mix-intensity").constantOr(0);return{u_matrix:t,u_lighting_matrix:e,u_normal_matrix:n,u_lightpos:w,u_lightintensity:v.properties.get("intensity"),u_lightcolor:[I.r,I.g,I.b],u_camera_pos:y,u_opacity:r,u_baseTextureIsAlpha:0,u_alphaMask:+E,u_alphaCutoff:p.alphaCutoff,u_baseColorFactor:[o.r,o.g,o.b,o.a],u_emissiveFactor:[l[0],l[1],l[2],1],u_metallicFactor:u,u_roughnessFactor:h,u_baseColorTexture:Zr.BaseColor,u_metallicRoughnessTexture:Zr.MetallicRoughness,u_normalTexture:Zr.Normal,u_occlusionTexture:Zr.Occlusion,u_emissionTexture:Zr.Emission,u_color_mix:[S.r,S.g,S.b,M],u_aoIntensity:D,u_emissive_strength:m}},V2=new Float32Array(16),j2=(t,e=V2,n=V2)=>({u_matrix:t,u_instance:e,u_node_matrix:n}),s5={fillExtrusion:t=>({u_matrix:new Ct(t),u_lightpos:new It(t),u_lightintensity:new ye(t),u_lightcolor:new It(t),u_vertical_gradient:new ye(t),u_opacity:new ye(t),u_edge_radius:new ye(t),u_ao:new Nt(t),u_tile_id:new It(t),u_zoom_transition:new ye(t),u_inv_rot_matrix:new Ct(t),u_merc_center:new Nt(t),u_up_dir:new It(t),u_height_lift:new ye(t),u_flood_light_color:new It(t),u_vertical_scale:new ye(t),u_flood_light_intensity:new ye(t),u_ground_shadow_factor:new It(t),u_emissive_strength:new ye(t)}),fillExtrusionDepth:t=>({u_matrix:new Ct(t),u_edge_radius:new ye(t),u_vertical_scale:new ye(t)}),fillExtrusionPattern:t=>({u_matrix:new Ct(t),u_lightpos:new It(t),u_lightintensity:new ye(t),u_lightcolor:new It(t),u_vertical_gradient:new ye(t),u_height_factor:new ye(t),u_edge_radius:new ye(t),u_ao:new Nt(t),u_tile_id:new It(t),u_zoom_transition:new ye(t),u_inv_rot_matrix:new Ct(t),u_merc_center:new Nt(t),u_up_dir:new It(t),u_height_lift:new ye(t),u_image:new Lt(t),u_texsize:new Nt(t),u_pixel_coord_upper:new Nt(t),u_pixel_coord_lower:new Nt(t),u_tile_units_to_pixels:new ye(t),u_opacity:new ye(t)}),fillExtrusionGroundEffect:t=>({u_matrix:new Ct(t),u_opacity:new ye(t),u_ao_pass:new ye(t),u_meter_to_tile:new ye(t),u_ao:new Nt(t),u_flood_light_intensity:new ye(t),u_flood_light_color:new It(t),u_attenuation:new ye(t),u_edge_radius:new ye(t),u_fb:new Lt(t),u_fb_size:new ye(t)}),fill:t=>({u_matrix:new Ct(t),u_emissive_strength:new ye(t)}),fillPattern:t=>({u_matrix:new Ct(t),u_emissive_strength:new ye(t),u_image:new Lt(t),u_texsize:new Nt(t),u_pixel_coord_upper:new Nt(t),u_pixel_coord_lower:new Nt(t),u_tile_units_to_pixels:new ye(t)}),fillOutline:t=>({u_matrix:new Ct(t),u_emissive_strength:new ye(t),u_world:new Nt(t)}),fillOutlinePattern:t=>({u_matrix:new Ct(t),u_emissive_strength:new ye(t),u_world:new Nt(t),u_image:new Lt(t),u_texsize:new Nt(t),u_pixel_coord_upper:new Nt(t),u_pixel_coord_lower:new Nt(t),u_tile_units_to_pixels:new ye(t)}),circle:t=>({u_camera_to_center_distance:new ye(t),u_extrude_scale:new q0(t),u_device_pixel_ratio:new ye(t),u_matrix:new Ct(t),u_inv_rot_matrix:new Ct(t),u_merc_center:new Nt(t),u_tile_id:new It(t),u_zoom_transition:new ye(t),u_up_dir:new It(t),u_emissive_strength:new ye(t)}),collisionBox:t=>({u_matrix:new Ct(t),u_camera_to_center_distance:new ye(t),u_extrude_scale:new Nt(t)}),collisionCircle:t=>({u_matrix:new Ct(t),u_inv_matrix:new Ct(t),u_camera_to_center_distance:new ye(t),u_viewport_size:new Nt(t)}),debug:t=>({u_color:new $c(t),u_matrix:new Ct(t),u_overlay:new Lt(t),u_overlay_scale:new ye(t)}),clippingMask:t=>({u_matrix:new Ct(t)}),heatmap:t=>({u_extrude_scale:new ye(t),u_intensity:new ye(t),u_matrix:new Ct(t),u_inv_rot_matrix:new Ct(t),u_merc_center:new Nt(t),u_tile_id:new It(t),u_zoom_transition:new ye(t),u_up_dir:new It(t)}),heatmapTexture:t=>({u_image:new Lt(t),u_color_ramp:new Lt(t),u_opacity:new ye(t)}),hillshade:t=>({u_matrix:new Ct(t),u_image:new Lt(t),u_latrange:new Nt(t),u_light:new Nt(t),u_shadow:new $c(t),u_highlight:new $c(t),u_emissive_strength:new ye(t),u_accent:new $c(t)}),hillshadePrepare:t=>({u_matrix:new Ct(t),u_image:new Lt(t),u_dimension:new Nt(t),u_zoom:new ye(t)}),line:t=>({u_matrix:new Ct(t),u_pixels_to_tile_units:new q0(t),u_device_pixel_ratio:new ye(t),u_units_to_pixels:new Nt(t),u_dash_image:new Lt(t),u_gradient_image:new Lt(t),u_image_height:new ye(t),u_texsize:new Nt(t),u_tile_units_to_pixels:new ye(t),u_alpha_discard_threshold:new ye(t),u_trim_offset:new Nt(t),u_emissive_strength:new ye(t)}),linePattern:t=>({u_matrix:new Ct(t),u_texsize:new Nt(t),u_pixels_to_tile_units:new q0(t),u_device_pixel_ratio:new ye(t),u_image:new Lt(t),u_units_to_pixels:new Nt(t),u_tile_units_to_pixels:new ye(t),u_alpha_discard_threshold:new ye(t)}),raster:t=>({u_matrix:new Ct(t),u_normalize_matrix:new Ct(t),u_globe_matrix:new Ct(t),u_merc_matrix:new Ct(t),u_grid_matrix:new H0(t),u_tl_parent:new Nt(t),u_scale_parent:new ye(t),u_fade_t:new ye(t),u_opacity:new ye(t),u_image0:new Lt(t),u_image1:new Lt(t),u_brightness_low:new ye(t),u_brightness_high:new ye(t),u_saturation_factor:new ye(t),u_contrast_factor:new ye(t),u_spin_weights:new It(t),u_perspective_transform:new Nt(t),u_raster_elevation:new ye(t),u_tl_br:new Gr(t),u_zoom_transition:new ye(t),u_merc_center:new Nt(t),u_cutoff_params:new Gr(t),u_colorization_mix:new Gr(t),u_colorization_offset:new ye(t),u_color_ramp:new Lt(t),u_texture_offset:new Nt(t),u_texture_res:new Nt(t),u_emissive_strength:new ye(t)}),symbolIcon:t=>({u_is_size_zoom_constant:new Lt(t),u_is_size_feature_constant:new Lt(t),u_size_t:new ye(t),u_size:new ye(t),u_camera_to_center_distance:new ye(t),u_rotate_symbol:new Lt(t),u_aspect_ratio:new ye(t),u_fade_change:new ye(t),u_matrix:new Ct(t),u_label_plane_matrix:new Ct(t),u_coord_matrix:new Ct(t),u_is_text:new Lt(t),u_pitch_with_map:new Lt(t),u_texsize:new Nt(t),u_tile_id:new It(t),u_zoom_transition:new ye(t),u_inv_rot_matrix:new Ct(t),u_merc_center:new Nt(t),u_camera_forward:new It(t),u_tile_matrix:new Ct(t),u_up_vector:new It(t),u_ecef_origin:new It(t),u_texture:new Lt(t),u_icon_transition:new ye(t),u_icon_saturation:new ye(t)}),symbolSDF:t=>({u_is_size_zoom_constant:new Lt(t),u_is_size_feature_constant:new Lt(t),u_size_t:new ye(t),u_size:new ye(t),u_camera_to_center_distance:new ye(t),u_rotate_symbol:new Lt(t),u_aspect_ratio:new ye(t),u_fade_change:new ye(t),u_matrix:new Ct(t),u_label_plane_matrix:new Ct(t),u_coord_matrix:new Ct(t),u_is_text:new Lt(t),u_pitch_with_map:new Lt(t),u_texsize:new Nt(t),u_texture:new Lt(t),u_gamma_scale:new ye(t),u_device_pixel_ratio:new ye(t),u_tile_id:new It(t),u_zoom_transition:new ye(t),u_inv_rot_matrix:new Ct(t),u_merc_center:new Nt(t),u_camera_forward:new It(t),u_tile_matrix:new Ct(t),u_up_vector:new It(t),u_ecef_origin:new It(t),u_is_halo:new Lt(t)}),symbolTextAndIcon:t=>({u_is_size_zoom_constant:new Lt(t),u_is_size_feature_constant:new Lt(t),u_size_t:new ye(t),u_size:new ye(t),u_camera_to_center_distance:new ye(t),u_rotate_symbol:new Lt(t),u_aspect_ratio:new ye(t),u_fade_change:new ye(t),u_matrix:new Ct(t),u_label_plane_matrix:new Ct(t),u_coord_matrix:new Ct(t),u_is_text:new Lt(t),u_pitch_with_map:new Lt(t),u_texsize:new Nt(t),u_texsize_icon:new Nt(t),u_texture:new Lt(t),u_texture_icon:new Lt(t),u_gamma_scale:new ye(t),u_device_pixel_ratio:new ye(t),u_is_halo:new Lt(t)}),background:t=>({u_matrix:new Ct(t),u_emissive_strength:new ye(t),u_opacity:new ye(t),u_color:new $c(t)}),backgroundPattern:t=>({u_matrix:new Ct(t),u_emissive_strength:new ye(t),u_opacity:new ye(t),u_image:new Lt(t),u_pattern_tl:new Nt(t),u_pattern_br:new Nt(t),u_texsize:new Nt(t),u_pattern_size:new Nt(t),u_pixel_coord_upper:new Nt(t),u_pixel_coord_lower:new Nt(t),u_tile_units_to_pixels:new ye(t)}),terrainRaster:w2,terrainDepth:w2,skybox:t=>({u_matrix:new Ct(t),u_sun_direction:new It(t),u_cubemap:new Lt(t),u_opacity:new ye(t),u_temporal_offset:new ye(t)}),skyboxGradient:t=>({u_matrix:new Ct(t),u_color_ramp:new Lt(t),u_center_direction:new It(t),u_radius:new ye(t),u_opacity:new ye(t),u_temporal_offset:new ye(t)}),skyboxCapture:t=>({u_matrix_3f:new H0(t),u_sun_direction:new It(t),u_sun_intensity:new ye(t),u_color_tint_r:new Gr(t),u_color_tint_m:new Gr(t),u_luminance:new ye(t)}),globeRaster:t=>({u_proj_matrix:new Ct(t),u_globe_matrix:new Ct(t),u_normalize_matrix:new Ct(t),u_merc_matrix:new Ct(t),u_zoom_transition:new ye(t),u_merc_center:new Nt(t),u_image0:new Lt(t),u_grid_matrix:new H0(t),u_skirt_height:new ye(t),u_frustum_tl:new It(t),u_frustum_tr:new It(t),u_frustum_br:new It(t),u_frustum_bl:new It(t),u_globe_pos:new It(t),u_globe_radius:new ye(t),u_viewport:new Nt(t)}),globeAtmosphere:t=>({u_frustum_tl:new It(t),u_frustum_tr:new It(t),u_frustum_br:new It(t),u_frustum_bl:new It(t),u_horizon:new ye(t),u_transition:new ye(t),u_fadeout_range:new ye(t),u_color:new Gr(t),u_high_color:new Gr(t),u_space_color:new Gr(t),u_temporal_offset:new ye(t),u_horizon_angle:new ye(t)}),model:t=>({u_matrix:new Ct(t),u_lighting_matrix:new Ct(t),u_normal_matrix:new Ct(t),u_lightpos:new It(t),u_lightintensity:new ye(t),u_lightcolor:new It(t),u_camera_pos:new It(t),u_opacity:new ye(t),u_baseColorFactor:new Gr(t),u_emissiveFactor:new Gr(t),u_metallicFactor:new ye(t),u_roughnessFactor:new ye(t),u_baseTextureIsAlpha:new Lt(t),u_alphaMask:new Lt(t),u_alphaCutoff:new ye(t),u_baseColorTexture:new Lt(t),u_metallicRoughnessTexture:new Lt(t),u_normalTexture:new Lt(t),u_occlusionTexture:new Lt(t),u_emissionTexture:new Lt(t),u_color_mix:new Gr(t),u_aoIntensity:new ye(t),u_emissive_strength:new ye(t)}),modelDepth:t=>({u_matrix:new Ct(t),u_instance:new Ct(t),u_node_matrix:new Ct(t)}),groundShadow:t=>({u_matrix:new Ct(t),u_ground_shadow_factor:new It(t)}),stars:t=>({u_matrix:new Ct(t),u_up:new It(t),u_right:new It(t),u_intensity_multiplier:new ye(t)})},Dm;function U2(t,e,n,i,r,o,l){let u=t.context,h=u.gl,p=t.transform,m=t.getOrCreateProgram("collisionBox"),_=[],y=0,v=0;for(let S=0;S<i.length;S++){let M=i[S],A=e.getTile(M),R=A.getBucket(n);if(!R)continue;let F=_V(M,R,p),k=F;r[0]===0&&r[1]===0||(k=t.translatePosMatrix(F,A,r,o));let L=l?R.textCollisionBox:R.iconCollisionBox,z=R.collisionCircleArray;if(z.length>0){let B=ne.create(),G=k;ne.mul(B,R.placementInvProjMatrix,p.glCoordMatrix),ne.mul(B,B,R.placementViewportMatrix),_.push({circleArray:z,circleOffset:v,transform:G,invTransform:B,projection:R.getProjection()}),y+=z.length/4,v=y}L&&(t.terrain&&t.terrain.setupElevationDraw(A,m),m.draw(t,h.LINES,at.disabled,Ot.disabled,t.colorModeForRenderPass(),kt.disabled,KV(k,p,A,R.getProjection()),n.id,L.layoutVertexBuffer,L.indexBuffer,L.segments,null,p.zoom,null,[L.collisionVertexBuffer,L.collisionVertexBufferExt]))}if(!l||!_.length)return;let b=t.getOrCreateProgram("collisionCircle"),w=new F0;w.resize(4*y),w._trim();let C=0;for(let S of _)for(let M=0;M<S.circleArray.length/4;M++){let A=4*M,R=S.circleArray[A+0],F=S.circleArray[A+1],k=S.circleArray[A+2],L=S.circleArray[A+3];w.emplace(C++,R,F,k,L,0),w.emplace(C++,R,F,k,L,1),w.emplace(C++,R,F,k,L,2),w.emplace(C++,R,F,k,L,3)}(!Dm||Dm.length<2*y)&&(Dm=function(S){let M=2*S,A=new xi;A.resize(M),A._trim();for(let R=0;R<M;R++){let F=6*R;A.uint16[F+0]=4*R+0,A.uint16[F+1]=4*R+1,A.uint16[F+2]=4*R+2,A.uint16[F+3]=4*R+2,A.uint16[F+4]=4*R+3,A.uint16[F+5]=4*R+0}return A}(y));let E=u.createIndexBuffer(Dm,!0),I=u.createVertexBuffer(w,Sz.members,!0);for(let S of _){let M={u_matrix:S.transform,u_inv_matrix:S.invTransform,u_camera_to_center_distance:(D=p).getCameraToCenterDistance(S.projection),u_viewport_size:[D.width,D.height]};b.draw(t,h.TRIANGLES,at.disabled,Ot.disabled,t.colorModeForRenderPass(),kt.disabled,M,n.id,I,E,yn.simpleSegment(0,2*S.circleOffset,S.circleArray.length,S.circleArray.length/2),null,p.zoom)}var D;I.destroy(),E.destroy()}let $2=ne.create();function a5({width:t,height:e,anchor:n,textOffset:i,textScale:r},o){let{horizontalAlign:l,verticalAlign:u}=Up(n),h=-(l-.5)*t,p=-(u-.5)*e,m=$v(n,i);return new Q((h/r+m[0])*o,(p/r+m[1])*o)}function l5(t,e,n,i,r,o,l,u,h,p,m){let _=t.text.placedSymbolArray,y=t.text.dynamicLayoutVertexArray,v=t.icon.dynamicLayoutVertexArray,b={},w=t.getProjection(),C=Tx(u,w,o),E=o.elevation,I=w.upVectorScale(u.canonical,o.center.lat,o.worldSize).metersToTile;y.clear();for(let D=0;D<_.length;D++){let S=_.get(D),{tileAnchorX:M,tileAnchorY:A,numGlyphs:R}=S,F=S.hidden||!S.crossTileID||t.allowVerticalPlacement&&!S.placedOrientation?null:i[S.crossTileID];if(F){let k=0,L=0,z=0;if(E){let re=E?E.getAtTileOffset(u,M,A):0,[se,oe,ue]=w.upVector(u.canonical,M,A);k=re*se*I,L=re*oe*I,z=re*ue*I}let[B,G,N,W]=Jo(S.projectedAnchorX+k,S.projectedAnchorY+L,S.projectedAnchorZ+z,n?C:l),Y=OD(o.getCameraToCenterDistance(w),W),te=r.evaluateSizeForFeature(t.textSizeData,p,S)*Y/zi;n&&(te*=t.tilePixelRatio/h);let q=a5(F,te);n?({x:B,y:G,z:N}=w.projectTilePoint(M+q.x,A+q.y,u.canonical),[B,G,N]=Jo(B+k,G+L,N+z,l)):(e&&q._rotate(-o.angle),B+=q.x,G+=q.y,N=0);let X=t.allowVerticalPlacement&&S.placedOrientation===jn.vertical?Math.PI/2:0;for(let re=0;re<R;re++)au(y,B,G,N,X);m&&S.associatedIconIndex>=0&&(b[S.associatedIconIndex]={x:B,y:G,z:N,angle:X})}else cu(R,y)}if(m){v.clear();let D=t.icon.placedSymbolArray;for(let S=0;S<D.length;S++){let M=D.get(S),{numGlyphs:A}=M,R=b[S];if(M.hidden||!R)cu(A,v);else{let{x:F,y:k,z:L,angle:z}=R;for(let B=0;B<A;B++)au(v,F,k,L,z)}}t.icon.dynamicLayoutVertexBuffer.updateData(v)}t.text.dynamicLayoutVertexBuffer.updateData(y)}function c5(t,e,n){return n.iconsInText&&e?"symbolTextAndIcon":t?"symbolSDF":"symbolIcon"}function G2(t,e,n,i,r,o,l,u,h,p,m,_,y){let v=t.context,b=v.gl,w=t.transform,C=u==="map",E=h==="map",I=C&&n.layout.get("symbol-placement")!=="point",D=C&&!E&&!I,S=n.layout.get("symbol-sort-key").constantOr(1)!==void 0,M=!1,A=t.depthModeForSublayer(0,at.ReadOnly),R=[Ii(w.center.lng),Ai(w.center.lat)],F=n.layout.get("text-variable-anchor"),k=w.projection.name==="globe",L=[],z=[0,-1,0],B=z;!k&&!w.mercatorFromTransition||C||(B=function(G){let N=G._camera.getWorldToCamera(G.worldSize,1),W=ne.multiply([],N,G.globeMatrix);ne.invert(W,W);let Y=[0,0,0],te=[0,1,0,0];return vn.transformMat4(te,te,W),Y[0]=te[0],Y[1]=te[1],Y[2]=te[2],$.normalize(Y,Y),Y}(w));for(let G of i){let N=e.getTile(G),W=N.getBucket(n);if(!W||W.projection.name==="mercator"&&k)continue;let Y=r?W.text:W.icon;if(!Y||W.fullyClipped||!Y.segments.get().length)continue;let te=Y.programConfigurations.get(n.id),q=r||W.sdfIcons,X=r?W.textSizeData:W.iconSizeData,re=E||w.pitch!==0,se=xs(X,w.zoom),oe,ue,de,pe,ae=[0,0],ge=null;if(r)ue=N.glyphAtlasTexture?N.glyphAtlasTexture:null,de=b.LINEAR,oe=N.glyphAtlasTexture?N.glyphAtlasTexture.size:[0,0],W.iconsInText&&(ae=N.imageAtlasTexture?N.imageAtlasTexture.size:[0,0],ge=N.imageAtlasTexture?N.imageAtlasTexture:null,pe=re||t.options.rotating||t.options.zooming||X.kind==="composite"||X.kind==="camera"?b.LINEAR:b.NEAREST);else{let Bn=n.layout.get("icon-size").constantOr(0)!==1||W.iconsNeedLinear;ue=N.imageAtlasTexture?N.imageAtlasTexture:null,de=q||t.options.rotating||t.options.zooming||Bn||re?b.LINEAR:b.NEAREST,oe=N.imageAtlasTexture?N.imageAtlasTexture.size:[0,0]}let Ae=W.projection.name==="globe",Pe=Ae?B:z,Ne=Ae?Ni(w.zoom):0,Be=Tx(G,W.getProjection(),w),lt=w.calculatePixelsToTileUnitsMatrix(N),Ye=am(Be,N.tileID.canonical,E,C,w,W.getProjection(),lt),Zt=t.terrain&&E&&I?ne.invert(ne.create(),Ye):$2,Bt=RD(Be,N.tileID.canonical,E,C,w,W.getProjection(),lt),ct=F&&W.hasTextData(),st=W.hasIconTextFit()&&ct&&W.hasIconData();if(I){let Bn=w.elevation,pn=Bn?Bn.getAtTileOffsetFunc(G,w.center.lat,w.worldSize,W.getProjection()):null,Gi=PD(Be,N.tileID.canonical,E,C,w,W.getProjection(),lt);a4(W,Be,t,r,Gi,Bt,E,p,pn,G)}let Qe=I||r&&F||st,Ut=t.translatePosMatrix(Be,N,o,l),qt=Qe?$2:Ye,At=t.translatePosMatrix(Bt,N,o,l,!0),En=W.getProjection().createInversionMatrix(w,G.canonical),ai=n.paint.get("icon-image-cross-fade").constantOr(0),xn=[];t.terrainRenderModeElevated()&&E&&xn.push("PITCH_WITH_MAP_TERRAIN"),Ae&&(xn.push("PROJECTION_GLOBE_VIEW"),Qe&&xn.push("PROJECTED_POS_ON_VIEWPORT")),ai>0&&xn.push("ICON_TRANSITION"),Y.zOffsetVertexBuffer&&xn.push("Z_OFFSET");let Fn=q&&n.paint.get(r?"text-halo-width":"icon-halo-width").constantOr(1)!==0,fi;q?fi=W.iconsInText?i5(X.kind,se,D,E,t,Ut,qt,At,oe,ae,G,Ne,R,En,Pe,W.getProjection()):B2(X.kind,se,D,E,t,Ut,qt,At,r,oe,!0,G,Ne,R,En,Pe,W.getProjection()):(m<1&&xn.push("SATURATION"),fi=z2(X.kind,se,D,E,t,Ut,qt,At,r,oe,G,Ne,R,En,Pe,W.getProjection(),m,ai));let li={program:t.getOrCreateProgram(c5(q,r,W),{config:te,defines:xn}),buffers:Y,uniformValues:fi,atlasTexture:ue,atlasTextureIcon:ge,atlasInterpolation:de,atlasInterpolationIcon:pe,isSDF:q,hasHalo:Fn,tile:N,labelPlaneMatrixInv:Zt};if(S&&W.canOverlap){M=!0;let Bn=Y.segments.get();for(let pn of Bn)L.push({segments:new yn([pn]),sortKey:pn.sortKey,state:li})}else L.push({segments:Y.segments,sortKey:0,state:li})}M&&L.sort((G,N)=>G.sortKey-N.sortKey);for(let G of L){let N=G.state;if(t.terrain&&t.terrain.setupElevationDraw(N.tile,N.program,{useDepthForOcclusion:w.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:N.labelPlaneMatrixInv}),v.activeTexture.set(b.TEXTURE0),N.atlasTexture&&N.atlasTexture.bind(N.atlasInterpolation,b.CLAMP_TO_EDGE),N.atlasTextureIcon&&(v.activeTexture.set(b.TEXTURE1),N.atlasTextureIcon&&N.atlasTextureIcon.bind(N.atlasInterpolationIcon,b.CLAMP_TO_EDGE)),t.uploadCommonLightUniforms(t.context,N.program),N.hasHalo){let W=N.uniformValues;W.u_is_halo=1,Ox(N.buffers,G.segments,n,t,N.program,A,_,y,W,2),W.u_is_halo=0}else{if(N.isSDF){let W=N.uniformValues;N.hasHalo&&(W.u_is_halo=1,Ox(N.buffers,G.segments,n,t,N.program,A,_,y,W,1)),W.u_is_halo=0}Ox(N.buffers,G.segments,n,t,N.program,A,_,y,N.uniformValues,1)}}}function Ox(t,e,n,i,r,o,l,u,h,p){let m=[t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer,t.iconTransitioningVertexBuffer,t.globeExtVertexBuffer,t.zOffsetVertexBuffer];r.draw(i,i.context.gl.TRIANGLES,o,l,u,kt.disabled,h,n.id,t.layoutVertexBuffer,t.indexBuffer,e,n.paint,i.transform.zoom,t.programConfigurations.get(n.id),m,p)}function H2(t,e,n,i,r,o,l){let u=t.context.gl,h=n.paint.get("fill-pattern"),p=h&&h.constantOr(1),m,_,y,v,b;l?(_=p&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",m=u.LINES):(_=p?"fillPattern":"fill",m=u.TRIANGLES);for(let w of i){let C=e.getTile(w);if(p&&!C.patternsLoaded())continue;let E=C.getBucket(n);if(!E)continue;t.prepareDrawTile();let I=E.programConfigurations.get(n.id),D=t.isTileAffectedByFog(w),S=t.getOrCreateProgram(_,{config:I,overrideFog:D});p&&(t.context.activeTexture.set(u.TEXTURE0),C.imageAtlasTexture&&C.imageAtlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),I.updatePaintBuffers());let M=h.constantOr(null);if(M&&C.imageAtlas){let F=C.imageAtlas.patternPositions[M.toString()];F&&I.setConstantPatternPositions(F)}let A=t.translatePosMatrix(w.projMatrix,C,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor")),R=n.paint.get("fill-emissive-strength");if(l){v=E.indexBuffer2,b=E.segments2;let F=t.terrain&&t.terrain.renderingToTexture?t.terrain.drapeBufferSize:[u.drawingBufferWidth,u.drawingBufferHeight];y=_==="fillOutlinePattern"&&p?YV(A,R,t,C,F):XV(A,R,F)}else v=E.indexBuffer,b=E.segments,y=p?F2(A,R,t,C):O2(A,R);t.uploadCommonUniforms(t.context,S,w.toUnwrapped()),S.draw(t,m,r,t.stencilModeForClipping(w),o,kt.disabled,y,n.id,E.layoutVertexBuffer,v,b,n.paint,t.transform.zoom,I,void 0)}}function Sm(t,e,n,i,r,o,l,u){n.resetLayerRenderingStats();let h=t.context,p=h.gl,m=t.transform,_=n.paint.get("fill-extrusion-pattern"),y=_.constantOr(1),v=n.paint.get("fill-extrusion-opacity"),b=t.style.enable3dLights(),w=n.paint.get(b&&!y?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),C=[n.paint.get("fill-extrusion-ambient-occlusion-intensity"),w],E=n.layout.get("fill-extrusion-edge-radius"),I=E>0&&!n.paint.get("fill-extrusion-rounded-roof"),D=I?0:E,S=m.projection.name==="globe"?pS():0,M=m.projection.name==="globe",A=M?Ni(m.zoom):0,R=[Ii(m.center.lng),Ai(m.center.lat)],F=n.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),k=n.paint.get("fill-extrusion-flood-light-intensity"),L=n.paint.get("fill-extrusion-vertical-scale"),z=hu(t,n.paint.get("fill-extrusion-cutoff-fade-range")),B=n.paint.get("fill-extrusion-emissive-strength"),G=[],N;M&&G.push("PROJECTION_GLOBE_VIEW"),C[0]>0&&G.push("FAUX_AO"),I&&G.push("ZERO_ROOF_RADIUS"),u&&G.push("HAS_CENTROID"),k>0&&G.push("FLOOD_LIGHT"),z.shouldRenderCutoff&&G.push("RENDER_CUTOFF");let W=t.renderPass==="shadow",Y=t.shadowRenderer,te=W&&!!Y;t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!0);let q=[0,0,0];if(Y){let se=t.style.directionalLight,oe=t.style.ambientLight;se&&oe&&(q=Lx(se,oe)),N=G.concat(["SHADOWS_SINGLE_CASCADE"])}let X=te?"fillExtrusionDepth":y?"fillExtrusionPattern":"fillExtrusion",re=n.getLayerRenderingStats();for(let se of i){let oe=e.getTile(se),ue=oe.getBucket(n);if(!ue||ue.projection.name!==m.projection.name)continue;let de=!1;Y&&(de=Y.getMaxCascadeForTile(se.toUnwrapped())===0);let pe=t.isTileAffectedByFog(se),ae=ue.programConfigurations.get(n.id),ge=t.getOrCreateProgram(X,{config:ae,defines:de?N:G,overrideFog:pe});if(t.terrain&&t.terrain.setupElevationDraw(oe,ge,{useMeterToDem:!0}),!ue.centroidVertexBuffer){let Ye=ge.attributes.a_centroid_pos;Ye!==void 0&&p.vertexAttrib2f(Ye,0,0)}!W&&Y&&Y.setupShadows(oe.tileID.toUnwrapped(),ge,"vector-tile",oe.tileID.overscaledZ),y&&(t.context.activeTexture.set(p.TEXTURE0),oe.imageAtlasTexture&&oe.imageAtlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE),ae.updatePaintBuffers());let Ae=_.constantOr(null);if(Ae&&oe.imageAtlas){let Ye=oe.imageAtlas.patternPositions[Ae.toString()];Ye&&ae.setConstantPatternPositions(Ye)}let Pe=n.paint.get("fill-extrusion-vertical-gradient"),Ne;if(W&&Y){if(p5(oe.tileID,ue,t))continue;let Ye=Y.calculateShadowPassMatrixFromTile(oe.tileID.toUnwrapped());Ne=WV(Ye,D,L)}else{let Ye=t.translatePosMatrix(se.expandedProjMatrix,oe,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),Zt=m.projection.createInversionMatrix(m,se.canonical);Ne=y?ZV(Ye,t,Pe,v,C,D,se,oe,S,A,R,Zt,F,L):R2(Ye,t,Pe,v,C,D,se,S,A,R,Zt,F,L,k,q,B)}t.uploadCommonUniforms(h,ge,se.toUnwrapped(),null,z);let Be=ue.segments;if(m.projection.name==="mercator"&&!W&&(Be=ue.getVisibleSegments(oe.tileID,t.terrain,t.transform.getFrustum(0)),!Be.get().length))continue;if(re)if(W)for(let Ye of Be.get())re.numRenderedVerticesInShadowPass+=Ye.primitiveLength;else for(let Ye of Be.get())re.numRenderedVerticesInTransparentPass+=Ye.primitiveLength;let lt=[];(t.terrain||u)&&lt.push(ue.centroidVertexBuffer),M&&lt.push(ue.layoutVertexExtBuffer),ge.draw(t,h.gl.TRIANGLES,r,o,l,kt.backCCW,Ne,n.id,ue.layoutVertexBuffer,ue.indexBuffer,Be,n.paint,t.transform.zoom,ae,lt)}t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!1)}function pu(t,e,n,i,r,o,l,u,h,p,m,_,y,v,b,w,C,E,I){let D=t.context,S=D.gl,M=t.transform,A=t.transform.zoom,R=[],F=hu(t,n.paint.get("fill-extrusion-cutoff-fade-range"));p==="clear"?(R.push("CLEAR_SUBPASS"),I&&(R.push("CLEAR_FROM_TEXTURE"),D.activeTexture.set(S.TEXTURE0),I.bind(S.LINEAR,S.CLAMP_TO_EDGE))):p==="sdf"&&R.push("SDF_SUBPASS"),C&&R.push("HAS_CENTROID"),F.shouldRenderCutoff&&R.push("RENDER_CUTOFF");let k=n.layout.get("fill-extrusion-edge-radius"),L=(z,B,G,N,W)=>{let Y=B.programConfigurations.get(n.id),te=t.isTileAffectedByFog(z),q=t.getOrCreateProgram("fillExtrusionGroundEffect",{config:Y,defines:R,overrideFog:te}),X=((se,oe,ue,de,pe,ae,ge,Ae,Pe,Ne,Be)=>({u_matrix:oe,u_opacity:ue,u_ao_pass:de?1:0,u_meter_to_tile:pe,u_ao:ae,u_flood_light_intensity:ge,u_flood_light_color:Ae,u_attenuation:Pe,u_edge_radius:Ne,u_fb:0,u_fb_size:Be}))(0,N,m,h,W,[_,y*W],v,b,w,A>=17?0:k*W,I?I.size[0]:0),re=[];C&&re.push(B.hiddenByLandmarkVertexBuffer),t.uploadCommonUniforms(D,q,z.toUnwrapped(),null,F),q.draw(t,D.gl.TRIANGLES,r,o,l,u,X,n.id,B.vertexBuffer,B.indexBuffer,G,n.paint,A,Y,re)};for(let z of i){let B=e.getTile(z),G=B.getBucket(n);if(!G||G.projection.name!==M.projection.name||!G.groundEffect||G.groundEffect&&!G.groundEffect.hasData())continue;let N=G.groundEffect,W=1/G.tileToMeter;{let Y=t.translatePosMatrix(z.projMatrix,B,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),te=N.getDefaultSegment();L(z,N,te,Y,W)}if(E)for(let Y=0;Y<4;Y++){let te=BI[Y](z),q=e.getTile(te);if(!q)continue;let X=q.getBucket(n);if(!X||X.projection.name!==M.projection.name||!X.groundEffect||X.groundEffect&&!X.groundEffect.hasData())continue;let re=X.groundEffect,se,oe;Y===0?(se=[-le,0,0],oe=1):Y===1?(se=[le,0,0],oe=0):Y===2?(se=[0,-le,0],oe=3):(se=[0,le,0],oe=2);let ue=re.regionSegments[oe];if(!ue)continue;let de=new Float32Array(16);ne.translate(de,z.projMatrix,se),L(z,re,ue,t.translatePosMatrix(de,B,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),W)}}}function u5(t,e,n,i,r,o,l){i.centroidVertexArray.length===0&&i.createCentroidsBuffer();let u=o?o.findDEMTileFor(n):null;if(!(u&&u.dem||l))return;let h=E=>{let I=e.getSource().minzoom,D=M=>{let A=e.getTileByID(M);if(A&&A.hasData())return A.getBucket(r)},S=[0,-1,1];for(let M of S){if(E.overscaledZ+M<I)continue;let A=D(E.calculateScaledKey(E.overscaledZ+M));if(A)return A}},p=[0,0,0],m=(E,I)=>(p[0]=Math.min(E.min.y,I.min.y),p[1]=Math.max(E.max.y,I.max.y),p[2]=le-I.min.x>E.max.x?I.min.x-le:E.max.x,p),_=(E,I)=>(p[0]=Math.min(E.min.x,I.min.x),p[1]=Math.max(E.max.x,I.max.x),p[2]=le-I.min.y>E.max.y?I.min.y-le:E.max.y,p),y=[(E,I)=>m(E,I),(E,I)=>m(I,E),(E,I)=>_(E,I),(E,I)=>_(I,E)],v=(E,I,D,S,M,A,R)=>{if(!o)return 0;let F=[[A?D:E,A?E:D,0],[A?D:I,A?I:D,0]],k=R<0?le+R:R,L=[A?k:(E+I)/2,A?(E+I)/2:k,0];return D===0&&R<0||D!==0&&R>0?o.getForTilePoints(M,[L],!0,S):F.push(L),o.getForTilePoints(n,F,!0,u),Math.max(F[0][2],F[1][2],L[2])/o.exaggeration()};for(let E=0;E<4;E++){let I=i.borderFeatureIndices[E];if(I.length===0)continue;let D=BI[E](n),S=h(D);if(!(S&&S instanceof oh)||i.borderDoneWithNeighborZ[E]===S.canonical.z)continue;S.centroidVertexArray.length===0&&S.createCentroidsBuffer();let M=o?o.findDEMTileFor(D):null;if(!(M&&M.dem||l))continue;let A=(E<2?1:5)-E,R=S.borderDoneWithNeighborZ[A]!==i.canonical.z,F=S.borderFeatureIndices[A],k=0;if(i.canonical.z!==S.canonical.z){for(let L of I)i.showCentroid(i.featuresOnBorder[L]);if(R)for(let L of F)S.showCentroid(S.featuresOnBorder[L]);i.borderDoneWithNeighborZ[E]=S.canonical.z,S.borderDoneWithNeighborZ[A]=i.canonical.z}for(let L of I){let z=i.featuresOnBorder[L],B=i.centroidData[z.centroidDataIndex],G=z.borders[E],N;for(;k<F.length;){N=S.featuresOnBorder[F[k]];let W=N.borders[A];if(W[1]>G[0]+3||W[0]>G[0]-3)break;S.showCentroid(N),k++}if(N&&k<F.length){let W=k,Y=0;for(;!(N.borders[A][0]>G[1]-3)&&(Y++,++k!==F.length);)N=S.featuresOnBorder[F[k]];if(N=S.featuresOnBorder[F[W]],Y>1){let X=N.borders[A];Math.abs(G[0]-X[0])<3&&Math.abs(G[1]-X[1])<3&&(Y=1,k=W+1)}else if(Y===0){i.showCentroid(z);continue}let te=S.centroidData[N.centroidDataIndex];l&&Y===1&&(((w=B).flags|(C=te).flags)&Cs?(w.flags|=Cs,C.flags|=Cs):(w.flags&=2147483647,C.flags&=2147483647));let q=new Q(0,0);if(Y>1)k=W;else if(M&&M.dem&&!(z.intersectsCount()>1||N.intersectsCount()>1)){let X=y[E](B,te),re=E%2?le-1:0;b=v(X[0],Math.min(le-1,X[1]),re,M,D,E<2,X[2]),q=new Q(Math.ceil(7*(b+450)),0)}B.centroidXY=te.centroidXY=q,i.writeCentroidToBuffer(B),S.writeCentroidToBuffer(te)}else i.showCentroid(z)}i.borderDoneWithNeighborZ[E]=S.canonical.z,S.borderDoneWithNeighborZ[A]=i.canonical.z}var b,w,C;(i.needsCentroidUpdate||!i.centroidVertexBuffer&&i.centroidVertexArray.length!==0)&&i.uploadCentroid(t)}let d5=[1,0,0],h5=[0,1,0],f5=[0,0,1];function p5(t,e,n){let i=n.transform,r=n.shadowRenderer;if(!r)return!0;let o=t.toUnwrapped(),l=i.tileSize*r._cascades[n.currentShadowCascade].scale,u=e.maxHeight;if(i.elevation){let w=i.elevation.getMinMaxForTile(t);w&&(u+=w.max)}let h=[...r.shadowDirection];h[2]=-h[2];let p=r.computeSimplifiedTileShadowVolume(o,u,l,h);if(!p)return!1;let m=[d5,h5,f5,h,[h[0],0,h[2]],[0,h[1],h[2]]],_=i.projection.name==="globe",y=i.scaleZoom(l),v=Ks.fromInvProjectionMatrix(i.invProjMatrix,i.worldSize,y,!_),b=r.getCurrentCascadeFrustum();return v.intersectsPrecise(p.vertices,p.planes,m)===0||b.intersectsPrecise(p.vertices,p.planes,m)===0}function m5(t){let e=t._nearZ,n=t.projection.farthestPixelDistance(t),i=n-e,r=.2*t.height,o=e+r;return[e,n,(o-r-e)/i,(o-e)/i]}let g5=new Rt(1,0,0,1),_5=new Rt(0,1,0,1),y5=new Rt(0,0,1,1),v5=new Rt(1,0,1,1),x5=new Rt(0,1,1,1);function b5(t,e,n){let i=t.context,r=t.transform,o=i.gl,l=r.projection.name==="globe",u=l?["PROJECTION_GLOBE_VIEW"]:[],h=n.projMatrix;if(l&&Ni(r.zoom)>0){let L=mv(GI(n.canonical,r));h=ne.multiply(new Float32Array(16),r.globeMatrix,L),ne.multiply(h,r.projMatrix,h)}let p=t.getOrCreateProgram("debug",{defines:u}),m=e.getTileByID(n.key);t.terrain&&t.terrain.setupElevationDraw(m,p);let _=at.disabled,y=Ot.disabled,v=t.colorModeForRenderPass(),b="$debug";i.activeTexture.set(o.TEXTURE0),t.emptyTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE),l?m._makeGlobeTileDebugBuffers(t.context,r):m._makeDebugTileBoundsBuffers(t.context,r.projection);let w=m._tileDebugBuffer||t.debugBuffer,C=m._tileDebugIndexBuffer||t.debugIndexBuffer,E=m._tileDebugSegments||t.debugSegments;p.draw(t,o.LINE_STRIP,_,y,v,kt.disabled,k2(h,Rt.red),b,w,C,E,null,null,null,[m._globeTileDebugBorderBuffer]);let I=m.latestRawTileData,D=Math.floor((I&&I.byteLength||0)/1024),S=e.getTile(n).tileSize,M=512/Math.min(S,512)*(n.overscaledZ/r.zoom)*.5,A=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(A+=` => ${n.overscaledZ}`),A+=` ${D}kb`,function(L,z){L.initDebugOverlayCanvas();let B=L.debugOverlayCanvas,G=L.context.gl,N=L.debugOverlayCanvas.getContext("2d");N.clearRect(0,0,B.width,B.height),N.shadowColor="white",N.shadowBlur=2,N.lineWidth=1.5,N.strokeStyle="white",N.textBaseline="top",N.font="bold 36px Open Sans, sans-serif",N.fillText(z,5,5),N.strokeText(z,5,5),L.debugOverlayTexture.update(B),L.debugOverlayTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE)}(t,A);let R=m._tileDebugTextBuffer||t.debugBuffer,F=m._tileDebugTextIndexBuffer||t.quadTriangleIndexBuffer,k=m._tileDebugTextSegments||t.debugSegments;p.draw(t,o.TRIANGLES,_,y,Xt.alphaBlended,kt.disabled,k2(h,Rt.transparent,M),b,R,F,k,null,null,null,[m._globeTileDebugTextBuffer])}function q2(t,e,n,i){Am(t,0,e+n/2,t.transform.width,n,i)}function W2(t,e,n,i){Am(t,e-n/2,0,n,t.transform.height,i)}function Am(t,e,n,i,r,o){let l=t.context,u=l.gl;u.enable(u.SCISSOR_TEST),u.scissor(e*yt.devicePixelRatio,n*yt.devicePixelRatio,i*yt.devicePixelRatio,r*yt.devicePixelRatio),l.clear({color:o}),u.disable(u.SCISSOR_TEST)}let w5=ln([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:C5}=w5;function Za(t,e,n,i){t.emplaceBack(e,n,i)}class Z2{constructor(e){this.vertexArray=new Ol,this.indices=new xi,Za(this.vertexArray,-1,-1,1),Za(this.vertexArray,1,-1,1),Za(this.vertexArray,-1,1,1),Za(this.vertexArray,1,1,1),Za(this.vertexArray,-1,-1,-1),Za(this.vertexArray,1,-1,-1),Za(this.vertexArray,-1,1,-1),Za(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=e.createVertexBuffer(this.vertexArray,C5),this.indexBuffer=e.createIndexBuffer(this.indices),this.segment=yn.simpleSegment(0,0,36,12)}}function mu(t,e,n,i,r,o){let l=t.context.gl,u=e.paint.get("sky-atmosphere-color"),h=e.paint.get("sky-atmosphere-halo-color"),p=e.paint.get("sky-atmosphere-sun-intensity"),m=((_,y,v,b,w)=>({u_matrix_3f:_,u_sun_direction:y,u_sun_intensity:v,u_color_tint_r:[b.r,b.g,b.b,b.a],u_color_tint_m:[w.r,w.g,w.b,w.a],u_luminance:5e-5}))(Pr.fromMat4(Pr.create(),i),r,p,u,h);l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_CUBE_MAP_POSITIVE_X+o,e.skyboxTexture,0),n.draw(t,l.TRIANGLES,at.disabled,Ot.disabled,Xt.unblended,kt.frontCW,m,"skyboxCapture",e.skyboxGeometry.vertexBuffer,e.skyboxGeometry.indexBuffer,e.skyboxGeometry.segment)}let E5=ln([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class T5{constructor(e){let n=new Rl;n.emplaceBack(-1,1,1,0,0),n.emplaceBack(1,1,1,1,0),n.emplaceBack(1,-1,1,1,1),n.emplaceBack(-1,-1,1,0,1);let i=new xi;i.emplaceBack(0,1,2),i.emplaceBack(2,3,0),this.vertexBuffer=e.createVertexBuffer(n,E5.members),this.indexBuffer=e.createIndexBuffer(i),this.segments=yn.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}let I5=ln([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class M5{constructor(){this.colorModeAlphaBlendedWriteRGB=new Xt([1,om,1,om],Rt.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Xt([1,0,1,0],Rt.transparent,[!1,!1,!1,!0])}update(e){let n=e.context;if(!this.atmosphereBuffer){this.atmosphereBuffer=new T5(n);let i=100,r=200,o=function(m){let _=a0(30),y=[];for(let v=0;v<16e3;++v){let b=2*Math.PI*_(),w=Math.acos(1-2*_())-.5*Math.PI;y.push($.fromValues(Math.cos(w)*Math.cos(b),Math.cos(w)*Math.sin(b),Math.sin(w)))}return y}(),l=a0(300),u=new z0,h=new xi,p=0;for(let m=0;m<o.length;++m){let _=$.scale([],o[m],200),y=Math.max(0,1+.01*i*(1*l()-.5)),v=Math.max(0,1+.01*r*(1*l()-.5));u.emplaceBack(_[0],_[1],_[2],-1,-1,y,v),u.emplaceBack(_[0],_[1],_[2],1,-1,y,v),u.emplaceBack(_[0],_[1],_[2],1,1,y,v),u.emplaceBack(_[0],_[1],_[2],-1,1,y,v),h.emplaceBack(p+0,p+1,p+2),h.emplaceBack(p+0,p+2,p+3),p+=4}this.starsVx=n.createVertexBuffer(u,I5.members),this.starsIdx=n.createIndexBuffer(h),this.starsSegments=yn.simpleSegment(0,0,u.length,h.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(e,n){let i=e.context,r=i.gl,o=e.transform,l=new at(r.LEQUAL,at.ReadOnly,[0,1]),u=Ni(o.zoom),h=n.properties.get("color").toArray01(),p=n.properties.get("high-color").toArray01(),m=n.properties.get("space-color").toArray01PremultipliedAlpha(),_=5e-4,y=We((n.properties.get("horizon-blend")-0)/1*.2495+_,5e-4,.25),v=KI(e,i,o)&&y===_?o.worldSize/(2*Math.PI*1.025)-1:o.globeRadius,b=e.frameCounter/1e3%1,w=$.length(o.globeCenterInViewSpace),C=Math.sqrt(Math.pow(w,2)-Math.pow(v,2)),E=Math.acos(C/w),I=D=>{let S=o.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];D&&S.push("ALPHA_PASS");let M=e.getOrCreateProgram("globeAtmosphere",{defines:S}),A=((F,k,L,z,B,G,N,W,Y,te,q,X)=>({u_frustum_tl:F,u_frustum_tr:k,u_frustum_br:L,u_frustum_bl:z,u_horizon:B,u_transition:G,u_fadeout_range:N,u_color:W,u_high_color:Y,u_space_color:te,u_temporal_offset:q,u_horizon_angle:X}))(o.frustumCorners.TL,o.frustumCorners.TR,o.frustumCorners.BR,o.frustumCorners.BL,o.frustumCorners.horizon,u,y,h,p,m,b,E);e.uploadCommonUniforms(i,M);let R=this.atmosphereBuffer;R&&M.draw(e,r.TRIANGLES,l,Ot.disabled,D?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,kt.backCW,A,D?"atmosphere_glow_alpha":"atmosphere_glow",R.vertexBuffer,R.indexBuffer,R.segments)};I(!1),I(!0)}drawStars(e,n){let i=We(n.properties.get("star-intensity"),0,1);if(i===0)return;let r=e.context,o=r.gl,l=e.transform,u=e.getOrCreateProgram("stars"),h=Xi.identity([]);Xi.rotateX(h,h,-l._pitch),Xi.rotateZ(h,h,-l.angle),Xi.rotateX(h,h,Tt(l._center.lat)),Xi.rotateY(h,h,-Tt(l._center.lng));let p=ne.fromQuat(new Float32Array(16),h),m=ne.multiply([],l.starsProjMatrix,p),_=Pr.fromMat4([],p),y=Pr.invert([],_),v=[0,1,0];$.transformMat3(v,v,y),$.scale(v,v,.15);let b=[1,0,0];$.transformMat3(b,b,y),$.scale(b,b,.15);let w=((C,E,I,D)=>({u_matrix:Float32Array.from(C),u_up:E,u_right:I,u_intensity_multiplier:D}))(m,v,b,i);e.uploadCommonUniforms(r,u),this.starsVx&&this.starsIdx&&u.draw(e,o.TRIANGLES,at.disabled,Ot.disabled,this.colorModeAlphaBlendedWriteRGB,kt.disabled,w,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}function X2(t,e){let n=[...t],i=e.cameraWorldSizeForFog/e.worldSize,r=ne.identity([]);return ne.scale(r,r,[i,i,1]),ne.multiply(n,r,n),ne.multiply(n,e.worldToFogMatrix,n),n}function Fx(t,e,n,i){let r=n.material,o=i.context,{baseColorTexture:l,metallicRoughnessTexture:u}=r.pbrMetallicRoughness,{normalTexture:h,occlusionTexture:p,emissionTexture:m}=r;function _(y,v,b){if(y&&(t.push(v),o.activeTexture.set(o.gl.TEXTURE0+b),y.gfxTexture)){let{minFilter:w,magFilter:C,wrapS:E,wrapT:I}=y.sampler;y.gfxTexture.bindExtraParam(w,C,E,I)}}_(l,"HAS_TEXTURE_u_baseColorTexture",Zr.BaseColor),_(u,"HAS_TEXTURE_u_metallicRoughnessTexture",Zr.MetallicRoughness),_(h,"HAS_TEXTURE_u_normalTexture",Zr.Normal),_(p,"HAS_TEXTURE_u_occlusionTexture",Zr.Occlusion),_(m,"HAS_TEXTURE_u_emissionTexture",Zr.Emission),n.texcoordBuffer&&(t.push("HAS_ATTRIBUTE_a_uv_2f"),e.push(n.texcoordBuffer)),n.colorBuffer&&(t.push(n.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),e.push(n.colorBuffer)),n.normalBuffer&&(t.push("HAS_ATTRIBUTE_a_normal_3f"),e.push(n.normalBuffer)),n.pbrBuffer&&(t.push("HAS_ATTRIBUTE_a_pbr"),t.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),e.push(n.pbrBuffer)),r.alphaMode!=="OPAQUE"&&r.alphaMode!=="MASK"||t.push("UNPREMULT_TEXTURE_IN_SHADER"),r.defined||t.push("DIFFUSE_SHADED"),t.push("USE_STANDARD_DERIVATIVES")}function Pm(t,e,n,i,r,o){let l=n.paint.get("model-opacity"),u=e.context,h=new at(e.context.gl.LEQUAL,at.ReadWrite,e.depthRangeFor3D),p=e.transform,m=t.mesh,_=m.material,y=_.pbrMetallicRoughness,v=e.style.fog,b;b=e.transform.projection.zAxisUnit==="pixels"?[...t.nodeModelMatrix]:ne.multiply([],i.zScaleMatrix,t.nodeModelMatrix),ne.multiply(b,i.negCameraPosMatrix,b);let w=ne.invert([],b);ne.transpose(w,w);let C=n.paint.get("model-emissive-strength").constantOr(0),E=Rx(new Float32Array(t.worldViewProjection),new Float32Array(b),new Float32Array(w),e,l,y.baseColorFactor,_.emissiveFactor,y.metallicFactor,y.roughnessFactor,_,C,n),I={defines:[]},D=[];Fx(I.defines,D,m,e);let S=e.shadowRenderer;S&&(S.useNormalOffset=!1);let M=null;if(v){let F=X2(t.nodeModelMatrix,e.transform);if(M=new Float32Array(F),p.projection.name!=="globe"){let k=m.aabb.min,L=m.aabb.max,[z,B]=v.getOpacityForBounds(F,k[0],k[1],L[0],L[1]);I.overrideFog=z>=Ul||B>=Ul}}let A=hu(e,n.paint.get("model-cutoff-fade-range"));A.shouldRenderCutoff&&I.defines.push("RENDER_CUTOFF");let R=e.getOrCreateProgram("model",I);e.uploadCommonUniforms(u,R,null,M,A),e.renderPass!=="shadow"&&S&&S.setupShadowsFromMatrix(t.nodeModelMatrix,R),R.draw(e,u.gl.TRIANGLES,h,r,o,m.material.doubleSided?kt.disabled:kt.backCCW,E,n.id,m.vertexBuffer,m.indexBuffer,m.segments,n.paint,e.transform.zoom,void 0,D)}function Y2(t,e,n,i,r,o,l){let u;u=t.projection.name==="globe"?$D(n,t):[...n],ne.multiply(u,u,e.matrix);let h=ne.multiply([],i,u);if(e.meshes)for(let p of e.meshes){if(p.material.alphaMode!=="BLEND"){l.push({mesh:p,depth:0,modelIndex:r,worldViewProjection:h,nodeModelMatrix:u});continue}let m=$.transformMat4([],p.centroid,h);m[2]>0&&o.push({mesh:p,depth:m[2],modelIndex:r,worldViewProjection:h,nodeModelMatrix:u})}if(e.children)for(let p of e.children)Y2(t,p,n,i,r,o,l)}function kx(t,e,n,i){let r=n.shadowRenderer;if(!r)return;let o=r.getShadowPassDepthMode(),l=r.getShadowPassColorMode(),u=r.calculateShadowPassMatrixFromMatrix(e),h=j2(u);n.getOrCreateProgram("modelDepth",{defines:["DEPTH_TEXTURE"]}).draw(n,n.context.gl.TRIANGLES,o,Ot.disabled,l,kt.backCCW,h,i.id,t.vertexBuffer,t.indexBuffer,t.segments,i.paint,n.transform.zoom,void 0,void 0)}function D5(t,e,n){let i=e.updateZoomBasedPaintProperties(),r=function(o,l,u){let h,p,m,_=o.terrain?o.terrain.exaggeration():0;if(o.terrain&&_>0){let y=o.terrain,v=y.findDEMTileFor(u);v&&v.dem?h=tu.create(y,u,v):_=0}if(_===0&&(l.terrainElevationMin=0,l.terrainElevationMax=0),_===l.validForExaggeration&&(_===0||h&&h._demTile&&h._demTile.tileID===l.validForDEMTile.id&&h._dem._timestamp===l.validForDEMTile.timestamp))return!1;for(let y in l.instancesPerModel){let v=l.instancesPerModel[y];for(let b=0;b<v.instancedDataArray.length;++b){let w=(h?_*h.getElevationAt(0|v.instancedDataArray.float32[16*b],0|v.instancedDataArray.float32[16*b+1],!0,!0):0)+v.instancesEvaluatedElevation[b];v.instancedDataArray.float32[16*b+6]=w,p=p?Math.min(l.terrainElevationMin,w):w,m=m?Math.max(l.terrainElevationMax,w):w}}return l.terrainElevationMin=p||0,l.terrainElevationMax=m||0,l.validForExaggeration=_,l.validForDEMTile=h&&h._demTile?{id:h._demTile.tileID,timestamp:h._dem._timestamp}:{id:void 0,timestamp:0},!0}(t,e,n);(i||r)&&(e.uploaded=!1,e.upload(t.context))}let Ts={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new On([0,0,0],[le,le,0])};function S5(t,e){let n=1<<t.canonical.z,i=e.getFreeCameraOptions().position,r=e.elevation,o=t.canonical.x/n,l=(t.canonical.x+1)/n,u=t.canonical.y/n,h=(t.canonical.y+1)/n,p=e._centerAltitude;if(r){let v=r.getMinMaxForTile(t);v&&v.max>p&&(p=v.max)}let m=We(i.x,o,l)-i.x,_=We(i.y,u,h)-i.y,y=Cn(p,e.center.lat)-i.z;return e._zoomFromMercatorZ(Math.sqrt(m*m+_*_+y*y))}function K2(t,e,n,i,r,o,l){let u=t.context,h=t.renderPass==="shadow",p=t.shadowRenderer,m=h&&p?p.getShadowPassDepthMode():new at(u.gl.LEQUAL,at.ReadWrite,t.depthRangeFor3D),_=t.isTileAffectedByFog(o);if(n.meshes)for(let y of n.meshes){let v=["MODEL_POSITION_ON_GPU"],b=[],w,C,E;i.instancedDataArray.length>20&&v.push("INSTANCED_ARRAYS");let I=hu(t,e.paint.get("model-cutoff-fade-range"));if(I.shouldRenderCutoff&&v.push("RENDER_CUTOFF"),h&&p)w=t.getOrCreateProgram("modelDepth",{defines:v}),C=j2(l.shadowTileMatrix,l.shadowTileMatrix,Float32Array.from(n.matrix)),E=p.getShadowPassColorMode();else{Fx(v,b,y,t),w=t.getOrCreateProgram("model",{defines:v,overrideFog:_});let S=y.material,M=S.pbrMetallicRoughness,A=e.paint.get("model-opacity"),R=e.paint.get("model-emissive-strength").constantOr(0);C=Rx(o.expandedProjMatrix,Float32Array.from(n.matrix),new Float32Array(16),t,A,M.baseColorFactor,S.emissiveFactor,M.metallicFactor,M.roughnessFactor,S,R,e,r),p&&(l.shadowUniformsInitialized?w.setShadowUniformValues(u,p.getShadowUniformValues()):(p.setupShadows(o.toUnwrapped(),w,"model-tile",o.overscaledZ),l.shadowUniformsInitialized=!0)),E=I.shouldRenderCutoff||A<1||S.alphaMode!=="OPAQUE"?Xt.alphaBlended:Xt.unblended}t.uploadCommonUniforms(u,w,o.toUnwrapped(),null,I);let D=y.material.doubleSided?kt.disabled:kt.backCCW;if(i.instancedDataArray.length>20)b.push(i.instancedDataBuffer),w.draw(t,u.gl.TRIANGLES,m,Ot.disabled,E,D,C,e.id,y.vertexBuffer,y.indexBuffer,y.segments,e.paint,t.transform.zoom,void 0,b,i.instancedDataArray.length);else{let S=h?"u_instance":"u_normal_matrix";for(let M=0;M<i.instancedDataArray.length;++M)C[S]=new Float32Array(i.instancedDataArray.arrayBuffer,64*M,16),w.draw(t,u.gl.TRIANGLES,m,Ot.disabled,E,D,C,e.id,y.vertexBuffer,y.indexBuffer,y.segments,e.paint,t.transform.zoom,void 0,b)}}if(n.children)for(let y of n.children)K2(t,e,y,i,r,o,l)}let A5=[1,-1,1];function P5(t,e,n,i){if(!n.modelManager)return!0;let r=n.modelManager;if(!n.shadowRenderer)return!0;let o=n.shadowRenderer,l=e.aabb,u=!0,h=t.maxHeight;if(h===0){let m=0;for(let _ in t.instancesPerModel){let y=r.getModel(_,i);y?m=Math.max(m,Math.max(Math.max(y.aabb.max[0],y.aabb.max[1]),y.aabb.max[2])):u=!1}h=t.maxScale*m*1.41+t.maxVerticalOffset,u&&(t.maxHeight=h)}l.max[2]=h,l.min[2]+=t.terrainElevationMin,l.max[2]+=t.terrainElevationMax,$.transformMat4(l.min,l.min,e.tileMatrix),$.transformMat4(l.max,l.max,e.tileMatrix);let p=l.intersects(o.getCurrentCascadeFrustum());return n.currentShadowCascade===0&&(t.isInsideFirstShadowMapFrustum=p===2),p===0}class R5{}class O5{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(e,n,i){{let _=this._storage.get(n.id);if(_)return _.lastUsedFrameIdx=e,_.buf}let r=i.gl,o=r.getBufferParameter(r.ELEMENT_ARRAY_BUFFER,r.BUFFER_SIZE),l=new ArrayBuffer(o),u=new Int16Array(l);r.getBufferSubData(r.ELEMENT_ARRAY_BUFFER,0,new Int16Array(l));let h=new Sa;for(let _=0;_<o/2;_+=3){let y=u[_],v=u[_+1],b=u[_+2];h.emplaceBack(y,v),h.emplaceBack(v,b),h.emplaceBack(b,y)}let p=i.bindVertexArrayOES.current,m=new R5;return m.buf=new bD(i,h),m.lastUsedFrameIdx=e,this._storage.set(n.id,m),i.bindVertexArrayOES.set(p),m.buf}update(e){for(let[n,i]of this._storage)e-i.lastUsedFrameIdx>30&&(i.buf.destroy(),this._storage.delete(n))}destroy(){for(let[e,n]of this._storage)n.buf.destroy(),this._storage.delete(e)}}let J2={symbol:function(t,e,n,i,r){if(t.renderPass!=="translucent")return;let o=Ot.disabled,l=t.colorModeForRenderPass();n.layout.get("text-variable-anchor")&&function(u,h,p,m,_,y,v){let b=h.transform,w=_==="map",C=y==="map";for(let E of u){let I=m.getTile(E),D=I.getBucket(p);if(!D||!D.text||!D.text.segments.get().length)continue;let S=xs(D.textSizeData,b.zoom),M=Tx(E,D.getProjection(),b),A=b.calculatePixelsToTileUnitsMatrix(I),R=am(M,I.tileID.canonical,C,w,b,D.getProjection(),A),F=D.hasIconTextFit()&&D.hasIconData();if(S){let k=Math.pow(2,b.zoom-I.tileID.overscaledZ);l5(D,w,C,v,Az,b,R,E,k,S,F)}}}(i,t,n,e,n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),r),n.paint.get("icon-opacity").constantOr(1)!==0&&G2(t,e,n,i,!1,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),n.layout.get("icon-rotation-alignment"),n.layout.get("icon-pitch-alignment"),n.layout.get("icon-keep-upright"),n.paint.get("icon-color-saturation"),o,l),n.paint.get("text-opacity").constantOr(1)!==0&&G2(t,e,n,i,!0,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),n.layout.get("text-keep-upright"),n.paint.get("icon-color-saturation"),o,l),e.map.showCollisionBoxes&&(U2(t,e,n,i,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),!0),U2(t,e,n,i,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),!1))},circle:function(t,e,n,i){if(t.renderPass!=="translucent")return;let r=n.paint.get("circle-opacity"),o=n.paint.get("circle-stroke-width"),l=n.paint.get("circle-stroke-opacity"),u=n.layout.get("circle-sort-key").constantOr(1)!==void 0,h=n.paint.get("circle-emissive-strength");if(r.constantOr(1)===0&&(o.constantOr(1)===0||l.constantOr(1)===0))return;let p=t.context,m=p.gl,_=t.transform,y=t.depthModeForSublayer(0,at.ReadOnly),v=Ot.disabled,b=t.colorModeForDrapableLayerRenderPass(h),w=_.projection.name==="globe",C=[Ii(_.center.lng),Ai(_.center.lat)],E=[];for(let D=0;D<i.length;D++){let S=i[D],M=e.getTile(S),A=M.getBucket(n);if(!A||A.projection.name!==_.projection.name)continue;let R=A.programConfigurations.get(n.id),F=fM(n),k=t.isTileAffectedByFog(S);w&&F.push("PROJECTION_GLOBE_VIEW");let L=t.getOrCreateProgram("circle",{config:R,defines:F,overrideFog:k}),z=A.layoutVertexBuffer,B=A.globeExtVertexBuffer,G=A.indexBuffer,N=_.projection.createInversionMatrix(_,S.canonical),W={programConfiguration:R,program:L,layoutVertexBuffer:z,globeExtVertexBuffer:B,indexBuffer:G,uniformValues:EN(t,S,M,N,C,n),tile:M};if(u){let Y=A.segments.get();for(let te of Y)E.push({segments:new yn([te]),sortKey:te.sortKey,state:W})}else E.push({segments:A.segments,sortKey:0,state:W})}u&&E.sort((D,S)=>D.sortKey-S.sortKey);let I={useDepthForOcclusion:_.depthOcclusionForSymbolsAndCircles};for(let D of E){let{programConfiguration:S,program:M,layoutVertexBuffer:A,globeExtVertexBuffer:R,indexBuffer:F,uniformValues:k,tile:L}=D.state,z=D.segments;t.terrain&&t.terrain.setupElevationDraw(L,M,I),t.uploadCommonUniforms(p,M,L.tileID.toUnwrapped()),M.draw(t,m.TRIANGLES,y,v,b,kt.disabled,k,n.id,A,F,z,n.paint,_.zoom,S,[R])}},heatmap:function(t,e,n,i){if(n.paint.get("heatmap-opacity")!==0)if(t.renderPass==="offscreen"){let r=t.context,o=r.gl,l=Ot.disabled,u=new Xt([o.ONE,o.ONE,o.ONE,o.ONE],Rt.transparent,[!0,!0,!0,!0]);(function(v,b,w,C){let E=v.gl,I=b.width*C,D=b.height*C;v.activeTexture.set(E.TEXTURE1),v.viewport.set([0,0,I,D]);let S=w.heatmapFbo;if(!S||S&&(S.width!==I||S.height!==D)){S&&S.destroy();let M=E.createTexture();E.bindTexture(E.TEXTURE_2D,M),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_S,E.CLAMP_TO_EDGE),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_WRAP_T,E.CLAMP_TO_EDGE),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MIN_FILTER,E.LINEAR),E.texParameteri(E.TEXTURE_2D,E.TEXTURE_MAG_FILTER,E.LINEAR),S=w.heatmapFbo=v.createFramebuffer(I,D,!0,null),function(A,R,F,k,L,z){let B=A.gl;B.texImage2D(B.TEXTURE_2D,0,A.extRenderToTextureHalfFloat?B.RGBA16F:B.RGBA,L,z,0,B.RGBA,A.extRenderToTextureHalfFloat?B.HALF_FLOAT:B.UNSIGNED_BYTE,null),k.colorAttachment.set(F)}(v,0,M,S,I,D)}else E.bindTexture(E.TEXTURE_2D,S.colorAttachment.get()),v.bindFramebuffer.set(S.framebuffer)})(r,t,n,t.transform.projection.name==="globe"?.5:.25),r.clear({color:Rt.transparent});let h=t.transform,p=h.projection.name==="globe",m=p?["PROJECTION_GLOBE_VIEW"]:[],_=p?kt.frontCCW:kt.disabled,y=[Ii(h.center.lng),Ai(h.center.lat)];for(let v=0;v<i.length;v++){let b=i[v];if(e.hasRenderableParent(b))continue;let w=e.getTile(b),C=w.getBucket(n);if(!C||C.projection.name!==h.projection.name)continue;let E=t.isTileAffectedByFog(b),I=C.programConfigurations.get(n.id),D=t.getOrCreateProgram("heatmap",{config:I,defines:m,overrideFog:E}),{zoom:S}=t.transform;t.terrain&&t.terrain.setupElevationDraw(w,D),t.uploadCommonUniforms(r,D,b.toUnwrapped());let M=h.projection.createInversionMatrix(h,b.canonical);D.draw(t,o.TRIANGLES,at.disabled,l,u,_,QV(t,b,w,M,y,S,n.paint.get("heatmap-intensity")),n.id,C.layoutVertexBuffer,C.indexBuffer,C.segments,n.paint,t.transform.zoom,I,p?[C.globeExtVertexBuffer]:null)}r.viewport.set([0,0,t.width,t.height])}else t.renderPass==="translucent"&&(t.context.setColorMode(t.colorModeForRenderPass()),function(r,o){let l=r.context,u=l.gl,h=o.heatmapFbo;if(!h)return;l.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,h.colorAttachment.get()),l.activeTexture.set(u.TEXTURE1);let p=o.colorRampTexture;p||(p=o.colorRampTexture=new Zn(l,o.colorRamp,u.RGBA)),p.bind(u.LINEAR,u.CLAMP_TO_EDGE),r.getOrCreateProgram("heatmapTexture").draw(r,u.TRIANGLES,at.disabled,Ot.disabled,r.colorModeForRenderPass(),kt.disabled,((m,_,y,v)=>({u_image:0,u_color_ramp:1,u_opacity:_.paint.get("heatmap-opacity")}))(0,o),o.id,r.viewportBuffer,r.quadTriangleIndexBuffer,r.viewportSegments,o.paint,r.transform.zoom)}(t,n))},line:function(t,e,n,i){if(t.renderPass!=="translucent")return;let r=n.paint.get("line-opacity"),o=n.paint.get("line-width");if(r.constantOr(1)===0||o.constantOr(1)===0)return;let l=n.paint.get("line-emissive-strength"),u=t.depthModeForSublayer(0,at.ReadOnly),h=t.colorModeForDrapableLayerRenderPass(l),p=t.terrain&&t.terrain.renderingToTexture?1:yt.devicePixelRatio,m=n.paint.get("line-dasharray"),_=m.constantOr(1),y=n.layout.get("line-cap"),v=n.paint.get("line-pattern"),b=v.constantOr(1),w=n.paint.get("line-pattern").constantOr(1),C=n.paint.get("line-opacity").constantOr(1)!==1,E=!w&&C,I=n.paint.get("line-gradient"),D=b?"linePattern":"line",S=t.context,M=S.gl,A=bS(n);t.terrain&&t.terrain.clipOrMaskOverlapStencilType()&&(E=!1);for(let R of i){let F=e.getTile(R);if(b&&!F.patternsLoaded())continue;let k=F.getBucket(n);if(!k)continue;t.prepareDrawTile();let L=k.programConfigurations.get(n.id),z=t.isTileAffectedByFog(R),B=t.getOrCreateProgram(D,{config:L,defines:A,overrideFog:z}),G=v.constantOr(null);if(G&&F.imageAtlas){let se=F.imageAtlas.patternPositions[G.toString()];se&&L.setConstantPatternPositions(se)}let N=m.constantOr(null),W=y.constantOr(null);if(!b&&N&&W&&F.lineAtlas){let se=F.lineAtlas.getDash(N,W);se&&L.setConstantPatternPositions(se)}let[Y,te]=n.paint.get("line-trim-offset");(W==="round"||W==="square")&&Y!==te&&(Y===0&&(Y-=1),te===1&&(te+=1));let q=t.terrain?R.projMatrix:null,X=b?S4(t,F,n,q,p):D4(t,F,n,q,k.lineClipsArray.length,p,[Y,te]);if(I){let se=k.gradients[n.id],oe=se.texture;if(n.gradientVersion!==se.version){let ue=256;if(n.stepInterpolant){let de=e.getSource().maxzoom,pe=R.canonical.z===de?Math.ceil(1<<t.transform.maxZoom-R.canonical.z):1;ue=We(If(k.maxLineLength/le*1024*pe),256,S.maxTextureSize)}se.gradient=Mp({expression:n.gradientExpression(),evaluationKey:"lineProgress",resolution:ue,image:se.gradient||void 0,clips:k.lineClipsArray}),se.texture?se.texture.update(se.gradient):se.texture=new Zn(S,se.gradient,M.RGBA),se.version=n.gradientVersion,oe=se.texture}S.activeTexture.set(M.TEXTURE1),oe.bind(n.stepInterpolant?M.NEAREST:M.LINEAR,M.CLAMP_TO_EDGE)}_&&(S.activeTexture.set(M.TEXTURE0),F.lineAtlasTexture&&F.lineAtlasTexture.bind(M.LINEAR,M.REPEAT),L.updatePaintBuffers()),b&&(S.activeTexture.set(M.TEXTURE0),F.imageAtlasTexture&&F.imageAtlasTexture.bind(M.LINEAR,M.CLAMP_TO_EDGE),L.updatePaintBuffers()),t.uploadCommonUniforms(S,B,R.toUnwrapped());let re=se=>{B.draw(t,M.TRIANGLES,u,se,h,kt.disabled,X,n.id,k.layoutVertexBuffer,k.indexBuffer,k.segments,n.paint,t.transform.zoom,L,[k.layoutVertexBuffer2])};if(E){let se=t.stencilModeForClipping(R).ref;se===0&&t.terrain&&S.clear({stencil:0});let oe={func:M.EQUAL,mask:255};X.u_alpha_discard_threshold=.8,re(new Ot(oe,se,255,M.KEEP,M.KEEP,M.INVERT)),X.u_alpha_discard_threshold=0,re(new Ot(oe,se,255,M.KEEP,M.KEEP,M.KEEP))}else re(t.stencilModeForClipping(R))}E&&(t.resetStencilClippingMasks(),t.terrain&&S.clear({stencil:0}))},fill:function(t,e,n,i){let r=n.paint.get("fill-color"),o=n.paint.get("fill-opacity");if(o.constantOr(1)===0)return;let l=n.paint.get("fill-emissive-strength"),u=t.colorModeForDrapableLayerRenderPass(l),h=n.paint.get("fill-pattern"),p=t.opaquePassEnabledForLayer()&&!h.constantOr(1)&&r.constantOr(Rt.transparent).a===1&&o.constantOr(0)===1?"opaque":"translucent";if(t.renderPass===p){let m=t.depthModeForSublayer(1,t.renderPass==="opaque"?at.ReadWrite:at.ReadOnly);H2(t,e,n,i,m,u,!1)}if(t.renderPass==="translucent"&&n.paint.get("fill-antialias")){let m=t.depthModeForSublayer(n.getPaintProperty("fill-outline-color")?2:0,at.ReadOnly);H2(t,e,n,i,m,u,!0)}},"fill-extrusion":function(t,e,n,i){let r=n.paint.get("fill-extrusion-opacity"),o=t.context,l=o.gl,u=t.terrain,h=u&&u.renderingToTexture,p=n.paint.get("fill-extrusion-cutoff-fade-range");if(r===0)return;let m=t.conflationActive&&t.layerUsedInConflation(n,e.getSource());if(m&&function(_,y,v,b){for(let w of b){let C=y.getTile(w).getBucket(v);C&&(C.updateReplacement(w,_.replacementSource),C.uploadCentroid(_.context))}}(t,e,n,i),u||m)for(let _ of i){let y=e.getTile(_).getBucket(n);y&&u5(t.context,e,_,y,n,u,m)}if(t.renderPass==="shadow"&&t.shadowRenderer){let _=t.shadowRenderer;if(u&&r<.65&&n._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof Ta)return;let y=_.getShadowPassDepthMode(),v=_.getShadowPassColorMode();Sm(t,e,n,i,y,Ot.disabled,v,m)}else if(t.renderPass==="translucent"){let _=!n.paint.get("fill-extrusion-pattern").constantOr(1);if(!h){let y=new at(t.context.gl.LEQUAL,at.ReadWrite,t.depthRangeFor3D);p===0&&r===1&&_?Sm(t,e,n,i,y,Ot.disabled,Xt.unblended,m):(Sm(t,e,n,i,y,Ot.disabled,Xt.disabled,m),Sm(t,e,n,i,y,t.stencilModeFor3D(),t.colorModeForRenderPass(),m),t.resetStencilClippingMasks())}if(t.style.enable3dLights()&&_&&(!u&&t.transform.projection.name!=="globe"||h)){let y=n.paint.get("fill-extrusion-opacity"),v=n.paint.get("fill-extrusion-ambient-occlusion-intensity"),b=n.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),w=n.paint.get("fill-extrusion-flood-light-intensity"),C=n.paint.get("fill-extrusion-flood-light-color").toArray01().slice(0,3),E=v>0&&b>0,I=w>0,D=(M,A,R)=>(1-R)*M+R*A,S=M=>{let A=t.depthModeForSublayer(1,at.ReadOnly,l.LEQUAL,!0),R=n.paint.get(M?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),F=D(.1,3,R),k=t._showOverdrawInspector;if(!k){let L=new Ot({func:l.ALWAYS,mask:255},255,255,l.KEEP,l.KEEP,l.REPLACE),z=new Xt([l.ONE,l.ONE,l.ONE,l.ONE],Rt.transparent,[!1,!1,!1,!0],l.MIN);pu(t,e,n,i,A,L,z,kt.disabled,M,"sdf",y,v,b,w,C,F,m,!1)}{let L=k?Ot.disabled:new Ot({func:l.EQUAL,mask:255},255,255,l.KEEP,l.DECR,l.DECR),z=k?t.colorModeForRenderPass():new Xt([l.ONE_MINUS_DST_ALPHA,l.DST_ALPHA,l.ONE,l.ONE],Rt.transparent,[!0,!0,!0,!0]);pu(t,e,n,i,A,L,z,kt.disabled,M,"color",y,v,b,w,C,F,m,!1)}};if(h){let M=(A,R,F)=>{let k=t.depthModeForSublayer(1,at.ReadOnly,l.LEQUAL,!1),L=n.paint.get(A?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),z=D(.1,3,L);{let B=new Xt([l.ONE,l.ONE,l.ONE,l.ONE],Rt.transparent,[!1,!1,!1,!0]);pu(t,e,n,i,k,Ot.disabled,B,kt.disabled,A,"clear",y,v,b,w,C,z,m,R)}{let B=new Ot({func:l.ALWAYS,mask:255},255,255,l.KEEP,l.KEEP,l.REPLACE),G=new Xt([l.ONE,l.ONE,l.ONE,l.ONE],Rt.transparent,[!1,!1,!1,!0],l.MIN);pu(t,e,n,i,k,B,G,kt.disabled,A,"sdf",y,v,b,w,C,z,m,R)}{let B=A?l.ZERO:l.ONE_MINUS_DST_ALPHA,G=new Ot({func:l.EQUAL,mask:255},255,255,l.KEEP,l.DECR,l.DECR),N=new Xt([B,l.DST_ALPHA,l.ONE_MINUS_DST_ALPHA,l.ZERO],Rt.transparent,[!0,!0,!0,!0]);pu(t,e,n,i,k,G,N,kt.disabled,A,"color",y,v,b,w,C,z,m,R)}{let B=new Xt([l.ONE,l.ONE,l.ONE,A?l.ZERO:l.ONE],Rt.transparent,[!1,!1,!1,!0],A?l.FUNC_ADD:l.MAX);pu(t,e,n,i,k,Ot.disabled,B,kt.disabled,A,"clear",y,v,b,w,C,z,m,R,F)}};if(E||I){let A;if(t.prepareDrawTile(),u){let R=u.drapeBufferSize[0],F=u.drapeBufferSize[1];A=u.framebufferCopyTexture,A&&(!A||A.size[0]===R&&A.size[1]===F)||(A&&A.destroy(),A=u.framebufferCopyTexture=new Zn(o,new gi({width:R,height:F}),l.RGBA)),A.bind(l.LINEAR,l.CLAMP_TO_EDGE),l.copyTexImage2D(l.TEXTURE_2D,0,l.RGBA,0,0,R,F,0)}E&&M(!0,!1,A),I&&M(!1,!0,A)}}else E&&S(!0),I&&S(!1)}}},hillshade:function(t,e,n,i){if(t.renderPass!=="offscreen"&&t.renderPass!=="translucent"||t.style.disableElevatedTerrain)return;let r=t.context,o=t.terrain&&t.terrain.renderingToTexture,[l,u]=t.renderPass!=="translucent"||o?[{},i]:t.stencilConfigForOverlap(i);for(let h of u){let p=e.getTile(h);if(p.needsHillshadePrepare&&t.renderPass==="offscreen")zV(t,p,n);else if(t.renderPass==="translucent"){let m=t.depthModeForSublayer(0,at.ReadOnly),_=n.paint.get("hillshade-emissive-strength"),y=t.colorModeForDrapableLayerRenderPass(_),v=o&&t.terrain?t.terrain.stencilModeForRTTOverlap(h):l[h.overscaledZ];NV(t,h,p,n,m,v,y)}}r.viewport.set([0,0,t.width,t.height]),t.resetStencilClippingMasks()},raster:function(t,e,n,i,r,o){if(t.renderPass!=="translucent"||n.paint.get("raster-opacity")===0)return;let l=t.context,u=l.gl,h=e.getSource(),p=function(R,F,k){let L=R.paint.get("raster-color"),z=[],B=R.paint.get("raster-resampling"),G=R.paint.get("raster-color-mix"),N=R.paint.get("raster-color-range"),W=[G[0],G[1],G[2],0],Y=G[3],te=B==="nearest"?k.NEAREST:k.LINEAR;if(L&&z.push("RASTER_COLOR"),L){F.activeTexture.set(k.TEXTURE2);let q=R.colorRampTexture;q||(q=R.colorRampTexture=new Zn(F,R.colorRamp,k.RGBA)),q.bind(k.LINEAR,k.CLAMP_TO_EDGE)}return{mix:W,range:N,offset:Y,defines:z,resampling:te}}(n,l,u),m=p.defines,_=t.transform.projection.name==="globe",y=!1;if(h instanceof Ao&&!i.length){if(!_)return;if(h.onNorthPole)y=!0,m.push("GLOBE_POLES");else{if(!h.onSouthPole)return;y=!0,m.push("GLOBE_POLES")}}let v=n.paint.get("raster-emissive-strength"),b=t.colorModeForDrapableLayerRenderPass(v),w=t.terrain&&t.terrain.renderingToTexture,C=h instanceof Ao&&n.paint.get("raster-elevation")!==0,E=!t.options.moving,I=n.paint.get("raster-resampling")==="nearest"?u.NEAREST:u.LINEAR;if(y){let R=e.getSource();if(!(R instanceof Ao))return;let F=R.texture;if(!F)return;let k=t.globeSharedBuffers;if(!k)return;let L=new at(u.LEQUAL,at.ReadWrite,t.depthRangeFor3D),z=Float32Array.from(t.transform.expandedFarZProjMatrix),B=YI(0,0,t.transform),G=Float32Array.from(ka(so(new Io(0,0,0)))),N={opacity:1,mix:0};t.terrain&&t.terrain.prepareDrawTile(),l.activeTexture.set(u.TEXTURE0),F.bind(I,u.CLAMP_TO_EDGE),l.activeTexture.set(u.TEXTURE1),F.bind(I,u.CLAMP_TO_EDGE),F.useMipmap&&l.extTextureFilterAnisotropic&&t.transform.pitch>20&&u.texParameterf(u.TEXTURE_2D,l.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,l.extTextureFilterAnisotropicMax);let[W,Y,te,q]=k.getPoleBuffers(0,!0),X;R.onNorthPole?(X=W,t.renderDefaultNorthPole=!1):(B=ne.scale(ne.create(),B,[1,-1,1]),X=Y,t.renderDefaultSouthPole=!1);let re=((oe,ue,de,pe,ae,ge,Ae,Pe,Ne,Be,lt,Ye)=>L2(oe,ue,de,new Float32Array(16),new Float32Array(9),[0,0],[0,0,0,0],0,[0,0],[0,0,0,0],1,pe,ae,ge||[0,0],Ae,2,Ne,Be,lt,1,0,Ye))(z,G,B,N,n,R.perspectiveTransform||[0,0],n.paint.get("raster-elevation"),0,p.mix,p.offset,p.range,v),se=t.getOrCreateProgram("raster",{defines:p.defines});return t.uploadCommonUniforms(l,se,null),void se.draw(t,u.TRIANGLES,L,Ot.disabled,b,kt.disabled,re,n.id,X,te,q)}if(!i.length)return;let[D,S]=h instanceof Ao||w?[{},i]:t.stencilConfigForOverlap(i),M=S[S.length-1].overscaledZ,A=C&&_;A&&p.defines.push("PROJECTION_GLOBE_VIEW"),C&&p.defines.push("RENDER_CUTOFF");for(let R of S){let F=R.toUnwrapped(),k=e.getTile(R);if(w&&(!k||!k.hasData())||!k.texture)continue;let L,z;w?(L=at.disabled,z=R.projMatrix):C?(L=new at(u.LEQUAL,at.ReadWrite,t.depthRangeFor3D),z=_?Float32Array.from(t.transform.expandedFarZProjMatrix):t.transform.calculateProjMatrix(F,E)):(L=t.depthModeForSublayer(R.overscaledZ-M,n.paint.get("raster-opacity")===1?at.ReadWrite:at.ReadOnly,u.LESS),z=t.transform.calculateProjMatrix(F,E));let B=t.terrain&&w?t.terrain.stencilModeForRTTOverlap(R):D[R.overscaledZ],G=o?0:n.paint.get("raster-fade-duration");k.registerFadeDuration(G);let N=e.findLoadedParent(R,0),W=D2(k,N,e,t.transform,G),Y,te;t.terrain&&t.terrain.prepareDrawTile(),l.activeTexture.set(u.TEXTURE0),k.texture&&k.texture.bind(I,u.CLAMP_TO_EDGE),l.activeTexture.set(u.TEXTURE1),N?(N.texture&&N.texture.bind(I,u.CLAMP_TO_EDGE),Y=Math.pow(2,N.tileID.overscaledZ-k.tileID.overscaledZ),te=[k.tileID.canonical.x*Y%1,k.tileID.canonical.y*Y%1]):k.texture&&k.texture.bind(I,u.CLAMP_TO_EDGE),k.texture&&k.texture.useMipmap&&l.extTextureFilterAnisotropic&&t.transform.pitch>20&&u.texParameterf(u.TEXTURE_2D,l.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,l.extTextureFilterAnisotropicMax);let q=t.transform,X=h instanceof Ao?h.perspectiveTransform:[0,0],re=C?m5(q):[0,0,0,0],se,oe,ue,de,pe,ae;if(A&&h instanceof Ao&&h.coordinates.length>3){se=Float32Array.from(ka(so(new Io(0,0,0)))),oe=Float32Array.from(q.globeMatrix),ue=Float32Array.from(XI(q)),de=[Ii(q.center.lng),Ai(q.center.lat)],ae=[Ii(h.coordinates[1][0]),Ai(h.coordinates[1][1]),Ii(h.coordinates[3][0]),Ai(h.coordinates[3][1])];let Ne=new Hr(h.coordinates[1],h.coordinates[3]);pe=Float32Array.from(JI(new Io(0,0,0),Ne,0,q.worldSize/t.transform._pixelsPerMercatorPixel))}else se=new Float32Array(16),oe=new Float32Array(9),ue=new Float32Array(16),de=[0,0],pe=new Float32Array(16),ae=[0,0,0,0];let ge=L2(z,se,oe,ue,pe,te||[0,0],ae,Ni(t.transform.zoom),de,re,Y||1,W,n,X,C?n.paint.get("raster-elevation"):0,2,p.mix,p.offset,p.range,1,0,v),Ae=t.isTileAffectedByFog(R),Pe=t.getOrCreateProgram("raster",{defines:p.defines,overrideFog:Ae});if(t.uploadCommonUniforms(l,Pe,F),h instanceof Ao){if(w||!_)h.boundsBuffer&&h.boundsSegments&&Pe.draw(t,u.TRIANGLES,L,Ot.disabled,b,kt.disabled,ge,n.id,h.boundsBuffer,t.quadTriangleIndexBuffer,h.boundsSegments);else if(t.globeSharedBuffers){let[Ne,Be,lt]=t.globeSharedBuffers.getGridBuffers(0,!1);Pe.draw(t,u.TRIANGLES,L,Ot.disabled,b,kt.frontCCW,ge,n.id,Ne,Be,lt),Pe.draw(t,u.TRIANGLES,L,Ot.disabled,b,kt.backCCW,ge,n.id,Ne,Be,lt)}}else{let{tileBoundsBuffer:Ne,tileBoundsIndexBuffer:Be,tileBoundsSegments:lt}=t.getTileBoundsBuffers(k);Pe.draw(t,u.TRIANGLES,L,B,b,kt.disabled,ge,n.id,Ne,Be,lt)}}t.resetStencilClippingMasks()},background:function(t,e,n,i){let r=n.paint.get("background-color"),o=n.paint.get("background-opacity"),l=n.paint.get("background-emissive-strength");if(o===0)return;let u=t.context,h=u.gl,p=t.transform,m=p.tileSize,_=n.paint.get("background-pattern");if(t.isPatternMissing(_,n.scope))return;let y=!_&&r.a===1&&o===1&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass!==y)return;let v=Ot.disabled,b=t.depthModeForSublayer(0,y==="opaque"?at.ReadWrite:at.ReadOnly),w=t.colorModeForDrapableLayerRenderPass(l),C=_?"backgroundPattern":"background",E,I=i;I||(E=t.getBackgroundTiles(),I=Object.values(E).map(D=>D.tileID)),_&&(u.activeTexture.set(h.TEXTURE0),t.imageManager.bind(t.context,n.scope));for(let D of I){let S=t.isTileAffectedByFog(D),M=t.getOrCreateProgram(C,{overrideFog:S}),A=D.toUnwrapped(),R=i?D.projMatrix:t.transform.calculateProjMatrix(A);t.prepareDrawTile();let F=e?e.getTile(D):E?E[D.key]:new Jd(D,m,p.zoom,t),k=_?o5(R,l,o,t,_,n.scope,{tileID:D,tileSize:m}):r5(R,l,o,r);t.uploadCommonUniforms(u,M,A);let{tileBoundsBuffer:L,tileBoundsIndexBuffer:z,tileBoundsSegments:B}=t.getTileBoundsBuffers(F);M.draw(t,h.TRIANGLES,b,v,w,kt.disabled,k,n.id,L,z,B)}},sky:function(t,e,n){let i=t._atmosphere?Ni(t.transform.zoom):1,r=n.paint.get("sky-opacity")*i;if(r===0)return;let o=t.context,l=n.paint.get("sky-type"),u=new at(o.gl.LEQUAL,at.ReadOnly,[0,1]),h=t.frameCounter/1e3%1;l==="atmosphere"?t.renderPass==="offscreen"?n.needsSkyboxCapture(t)&&(function(p,m,_,y){let v=p.context,b=v.gl,w=m.skyboxFbo;if(!w){w=m.skyboxFbo=v.createFramebuffer(32,32,!0,null),m.skyboxGeometry=new Z2(v),m.skyboxTexture=v.gl.createTexture(),b.bindTexture(b.TEXTURE_CUBE_MAP,m.skyboxTexture),b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_WRAP_S,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_WRAP_T,b.CLAMP_TO_EDGE),b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_MIN_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_CUBE_MAP,b.TEXTURE_MAG_FILTER,b.LINEAR);for(let D=0;D<6;++D)b.texImage2D(b.TEXTURE_CUBE_MAP_POSITIVE_X+D,0,b.RGBA,32,32,0,b.RGBA,b.UNSIGNED_BYTE,null)}v.bindFramebuffer.set(w.framebuffer),v.viewport.set([0,0,32,32]);let C=m.getCenter(p,!0),E=p.getOrCreateProgram("skyboxCapture"),I=new Float64Array(16);ne.identity(I),ne.rotateY(I,I,.5*-Math.PI),mu(p,m,E,I,C,0),ne.identity(I),ne.rotateY(I,I,.5*Math.PI),mu(p,m,E,I,C,1),ne.identity(I),ne.rotateX(I,I,.5*-Math.PI),mu(p,m,E,I,C,2),ne.identity(I),ne.rotateX(I,I,.5*Math.PI),mu(p,m,E,I,C,3),ne.identity(I),mu(p,m,E,I,C,4),ne.identity(I),ne.rotateY(I,I,Math.PI),mu(p,m,E,I,C,5),v.viewport.set([0,0,p.width,p.height])}(t,n),n.markSkyboxValid(t)):t.renderPass==="sky"&&function(p,m,_,y,v){let b=p.context,w=b.gl,C=p.transform,E=p.getOrCreateProgram("skybox");b.activeTexture.set(w.TEXTURE0),w.bindTexture(w.TEXTURE_CUBE_MAP,m.skyboxTexture);let I=((D,S,M,A,R)=>({u_matrix:D,u_sun_direction:S,u_cubemap:0,u_opacity:A,u_temporal_offset:R}))(C.skyboxMatrix,m.getCenter(p,!1),0,y,v);p.uploadCommonUniforms(b,E),E.draw(p,w.TRIANGLES,_,Ot.disabled,p.colorModeForRenderPass(),kt.backCW,I,"skybox",m.skyboxGeometry.vertexBuffer,m.skyboxGeometry.indexBuffer,m.skyboxGeometry.segment)}(t,n,u,r,h):l==="gradient"&&t.renderPass==="sky"&&function(p,m,_,y,v){let b=p.context,w=b.gl,C=p.transform,E=p.getOrCreateProgram("skyboxGradient");m.skyboxGeometry||(m.skyboxGeometry=new Z2(b)),b.activeTexture.set(w.TEXTURE0);let I=m.colorRampTexture;I||(I=m.colorRampTexture=new Zn(b,m.colorRamp,w.RGBA)),I.bind(w.LINEAR,w.CLAMP_TO_EDGE);let D=((S,M,A,R,F)=>({u_matrix:S,u_color_ramp:0,u_center_direction:M,u_radius:Tt(A),u_opacity:R,u_temporal_offset:F}))(C.skyboxMatrix,m.getCenter(p,!1),m.paint.get("sky-gradient-radius"),y,v);p.uploadCommonUniforms(b,E),E.draw(p,w.TRIANGLES,_,Ot.disabled,p.colorModeForRenderPass(),kt.backCW,D,"skyboxGradient",m.skyboxGeometry.vertexBuffer,m.skyboxGeometry.indexBuffer,m.skyboxGeometry.segment)}(t,n,u,r,h)},debug:function(t,e,n){for(let i=0;i<n.length;i++)b5(t,e,n[i])},custom:function(t,e,n,i){let r=t.context,o=n.implementation;if(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes("custom")||t.terrain&&(t.terrain.renderingToTexture||t.renderPass==="offscreen")&&n.isLayerDraped(e)){if(t.renderPass==="offscreen"){let l=o.prerender;if(l){if(t.setCustomLayerDefaults(),r.setColorMode(t.colorModeForRenderPass()),t.transform.projection.name==="globe"){let u=t.transform.pointMerc;l.call(o,r.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),Ni(t.transform.zoom),[u.x,u.y],t.transform.pixelsPerMeterRatio)}else l.call(o,r.gl,t.transform.customLayerMatrix());r.setDirty(),t.setBaseState()}}else if(t.renderPass==="translucent"){if(t.terrain&&t.terrain.renderingToTexture){let u=o.renderToTile;if(u){let h=i[0].canonical,p=new Gt(h.x+i[0].wrap*(1<<h.z),h.y,h.z);r.setDepthMode(at.disabled),r.setStencilMode(Ot.disabled),r.setColorMode(t.colorModeForRenderPass()),t.setCustomLayerDefaults(),u.call(o,r.gl,p),r.setDirty(),t.setBaseState()}return}t.setCustomLayerDefaults(),r.setColorMode(t.colorModeForRenderPass()),r.setStencilMode(Ot.disabled);let l=o.renderingMode==="3d"?new at(t.context.gl.LEQUAL,at.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,at.ReadOnly);if(r.setDepthMode(l),t.transform.projection.name==="globe"){let u=t.transform.pointMerc;o.render(r.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),Ni(t.transform.zoom),[u.x,u.y],t.transform.pixelsPerMeterRatio)}else o.render(r.gl,t.transform.customLayerMatrix());r.setDirty(),t.setBaseState(),r.bindFramebuffer.set(null)}}else J("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(t,e,n,i){if(t.renderPass==="opaque")return;let r=n.paint.get("model-opacity");if(r===0)return;let o=n.paint.get("model-cast-shadows");if(t.renderPass==="shadow"&&(!o||t.terrain&&r<.65&&n._transitionablePaint._values["model-opacity"].value.expression instanceof Ta))return;let l=t.shadowRenderer,u=n.paint.get("model-receive-shadows");l&&(l.useNormalOffset=!0,u||(l.enabled=!1));let h=()=>{l&&(l.useNormalOffset=!0,u||(l.enabled=!0))},p=e.getSource();if(t.renderPass==="light-beam"&&p.type!=="batched-model")return;if(p.type==="vector"||p.type==="geojson")return function(E,I,D,S){let M=E.transform;if(M.projection.name!=="mercator")return void J(`Drawing 3D models for ${M.projection.name} projection is not yet implemented`);let A=M.getFreeCameraOptions().position;if(!E.modelManager)return;let R=E.modelManager,F=E.shadowRenderer;if(!D._unevaluatedLayout._values.hasOwnProperty("model-id"))return;let k=D._unevaluatedLayout._values["model-id"],L=rt({},D.layout.get("model-id").parameters);for(let z of S){let B=I.getTile(z).getBucket(D);if(!B||B.projection.name!==M.projection.name)continue;let G=S5(z,M);L.zoom=G;let N=k.possiblyEvaluate(L);if(D5(E,B,z),Ts.shadowUniformsInitialized=!1,Ts.useSingleShadowCascade=!!F&&F.getMaxCascadeForTile(z.toUnwrapped())===0,E.renderPass==="shadow"&&F){if(E.currentShadowCascade===1&&B.isInsideFirstShadowMapFrustum)continue;let te=M.calculatePosMatrix(z.toUnwrapped(),M.worldSize);if(Ts.tileMatrix.set(te),Ts.shadowTileMatrix=Float32Array.from(F.calculateShadowPassMatrixFromMatrix(te)),Ts.aabb.min.fill(0),Ts.aabb.max[0]=Ts.aabb.max[1]=le,Ts.aabb.max[2]=0,P5(B,Ts,E,D.scope))continue}let W=1<<z.canonical.z,Y=[((A.x-z.wrap)*W-z.canonical.x)*le,(A.y*W-z.canonical.y)*le,A.z*W*le];for(let te in B.instancesPerModel){let q=B.instancesPerModel[te];q.features.length>0&&(te=N.evaluate(q.features[0].feature,{}));let X=R.getModel(te,D.scope);if(X&&X.uploaded)for(let re of X.nodes)K2(E,D,re,q,Y,z,Ts)}}}(t,e,n,i),void h();if(!p.loaded())return;if(p.type==="batched-model")return function(E,I,D,S){let M=E.context,A=E.transform,R=E.style.fog,F=E.shadowRenderer;if(A.projection.name!=="mercator")return void J(`Drawing 3D landmark models for ${A.projection.name} projection is not yet implemented`);let k=E.transform.getFreeCameraOptions().position,L=$.scale([],[k.x,k.y,k.z],E.transform.worldSize);$.negate(L,L);let z=ne.identity([]),B=Na(A.center.lat,A.zoom),G=ne.fromScaling([],[1,1,1/B]);ne.translate(z,z,L);let N=D.paint.get("model-opacity"),W=new at(M.gl.LEQUAL,at.ReadWrite,E.depthRangeFor3D),Y=new at(M.gl.LEQUAL,at.ReadOnly,E.depthRangeFor3D),te=function(q,X){for(let re of S){let se=I.getTile(re).getBucket(D);if(!se||!se.uploaded)continue;let oe=!1;F&&(oe=F.getMaxCascadeForTile(re.toUnwrapped())===0);let ue=A.calculatePosMatrix(re.toUnwrapped(),A.worldSize),de=se.modelTraits;for(let pe of se.getNodesInfo()){if(pe.hiddenByReplacement||!pe.node.meshes)continue;let ae=pe.node,ge=E.renderPass==="light-beam",Ae=[...ue],Pe=pe.evaluatedScale,Ne=0;E.terrain&&ae.elevation&&(Ne=ae.elevation*E.terrain.exaggeration()),ne.translate(Ae,Ae,[(ae.anchor?ae.anchor[0]:0)*(Pe[0]-1),(ae.anchor?ae.anchor[1]:0)*(Pe[1]-1),Ne]),Pe!==l4&&ne.scale(Ae,Ae,Pe),ne.multiply(Ae,Ae,ae.matrix);let Be=ne.multiply([],G,Ae);ne.multiply(Be,z,Be);let lt=ne.invert([],Be);ne.transpose(lt,lt),ne.scale(lt,lt,A5);let Ye=ne.multiply([],A.expandedFarZProjMatrix,Ae);for(let Zt=0;Zt<ae.meshes.length;++Zt){let Bt=ae.meshes[Zt],ct=Zt===ae.lightMeshIndex;if(ct){if(!ge&&!E.terrain&&E.shadowRenderer){E.currentLayer<E.firstLightBeamLayer&&(E.firstLightBeamLayer=E.currentLayer);continue}}else if(ge)continue;let st={defines:[]},Qe=[];Fx(st.defines,Qe,Bt,E),4&de||st.defines.push("DIFFUSE_SHADED"),oe&&st.defines.push("SHADOWS_SINGLE_CASCADE");let Ut=E.renderPass==="shadow";if(Ut){kx(Bt,Ae,E,D);continue}let qt=null;if(R){let fi=X2(Ae,E.transform);if(qt=new Float32Array(fi),A.projection.name!=="globe"){let li=Bt.aabb.min,Bn=Bt.aabb.max,[pn,Gi]=R.getOpacityForBounds(fi,li[0],li[1],Bn[0],Bn[1]);st.overrideFog=pn>=Ul||Gi>=Ul}}let At=E.getOrCreateProgram("model",st);!Ut&&F&&(F.useNormalOffset=!!Bt.normalBuffer,F.setupShadowsFromMatrix(Ae,At,F.useNormalOffset)),E.uploadCommonUniforms(M,At,re.toUnwrapped(),qt);let En=Bt.material,ai=En.pbrMetallicRoughness;ai.metallicFactor=.9,ai.roughnessFactor=.5;let xn=0,Fn=Rx(new Float32Array(Ye),new Float32Array(Be),new Float32Array(lt),E,N,ai.baseColorFactor,En.emissiveFactor,ai.metallicFactor,ai.roughnessFactor,En,xn,D);At.draw(E,M.gl.TRIANGLES,X&&!ct?W:Y,Ot.disabled,q?ct||N<1||pe.hasTranslucentParts?Xt.alphaBlended:Xt.unblended:Xt.disabled,kt.backCCW,Fn,D.id,Bt.vertexBuffer,Bt.indexBuffer,Bt.segments,D.paint,E.transform.zoom,void 0,Qe)}}}};(function(q,X,re,se){let oe=q.terrain?q.terrain.exaggeration():0,ue=q.transform.zoom;for(let de of se){let pe=X.getTile(de).getBucket(re);pe&&(q.conflationActive&&pe.updateReplacement(de,q.replacementSource),pe.evaluateScale(q,re),q.terrain&&oe>0&&pe.elevationUpdate(q.terrain,oe,de,re.source),pe.needsReEvaluation(q,ue,re)&&pe.evaluate(re))}})(E,I,D,S),N===1?te(!0,!0):(te(!1,!0),te(!0,!1))}(t,e,n,i),void h();let m=p.getModels(),_=[],y=t.transform.getFreeCameraOptions().position,v=$.scale([],[y.x,y.y,y.z],t.transform.worldSize);$.negate(v,v);let b=[],w=[],C=0;for(let E of m){let I=n.paint.get("model-rotation").constantOr(null),D=n.paint.get("model-scale").constantOr(null),S=n.paint.get("model-translation").constantOr(null);E.computeModelMatrix(t,I,D,S,!0,!0,!1);let M=ne.identity([]),A=Na(E.position.lat,t.transform.zoom),R=ne.fromScaling([],[1,1,1/A]);ne.translate(M,M,v),_.push({zScaleMatrix:R,negCameraPosMatrix:M});for(let F of E.nodes)Y2(t.transform,F,E.matrix,t.transform.expandedFarZProjMatrix,C,b,w);C++}if(b.sort((E,I)=>I.depth-E.depth),t.renderPass!=="shadow"){if(r===1)for(let E of w)Pm(E,t,n,_[E.modelIndex],Ot.disabled,t.colorModeForRenderPass());else{for(let E of w)Pm(E,t,n,_[E.modelIndex],Ot.disabled,Xt.disabled);for(let E of w)Pm(E,t,n,_[E.modelIndex],t.stencilModeFor3D(),t.colorModeForRenderPass());t.resetStencilClippingMasks()}for(let E of b)Pm(E,t,n,_[E.modelIndex],Ot.disabled,t.colorModeForRenderPass());h()}else{for(let E of w)kx(E.mesh,E.nodeModelMatrix,t,n);for(let E of b)kx(E.mesh,E.nodeModelMatrix,t,n);h()}}},Q2={modelUpload:function(t,e,n){let i=e.getSource();if(!i.loaded())return;if(i.type==="vector"||i.type==="geojson")return void(t.modelManager&&t.modelManager.upload(t,n));if(i.type==="batched-model")return;let r=i.getModels();for(let o of r)o.upload(t.context)}};class F5{constructor(e,n,i){this.context=new KB(e,n),this.transform=i,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=Ko.maxUnderzooming+Ko.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new p4,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new N5(this),this._wireframeDebugCache=new O5,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0}updateTerrain(e,n){let i=!!e&&!!e.terrain&&this.transform.projection.supportsTerrain;if(!(i||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new UV(this,e));let r=this._terrain;this.transform.elevation=i?r:null,r.update(e,this.transform,n),this.transform.elevation&&!r.enabled&&(this.transform.elevation=null)}_updateFog(e){let n=e.fog;if(!n||this.transform.projection.name==="globe"||n.getOpacity(this.transform.pitch)<1||n.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);let[i,r]=n.getFovAdjustedRange(this.transform._fov);if(i>r)return void(this.transform.fogCullDistSq=null);let o=i+.78*(r-i);this.transform.fogCullDistSq=o*o}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(e,n){if(this.width=e*yt.devicePixelRatio,this.height=n*yt.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(let i of this.style.order)this.style._mergedLayers[i].resize()}setup(){let e=this.context,n=new $r;n.emplaceBack(0,0),n.emplaceBack(le,0),n.emplaceBack(0,le),n.emplaceBack(le,le),this.tileExtentBuffer=e.createVertexBuffer(n,Oa.members),this.tileExtentSegments=yn.simpleSegment(0,0,4,2);let i=new $r;i.emplaceBack(0,0),i.emplaceBack(le,0),i.emplaceBack(0,le),i.emplaceBack(le,le),this.debugBuffer=e.createVertexBuffer(i,Oa.members),this.debugSegments=yn.simpleSegment(0,0,4,5);let r=new $r;r.emplaceBack(-1,-1),r.emplaceBack(1,-1),r.emplaceBack(-1,1),r.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(r,Oa.members),this.viewportSegments=yn.simpleSegment(0,0,4,2);let o=new Pl;o.emplaceBack(0,0,0,0),o.emplaceBack(le,0,le,0),o.emplaceBack(0,le,0,le),o.emplaceBack(le,le,le,le),this.mercatorBoundsBuffer=e.createVertexBuffer(o,Xv.members),this.mercatorBoundsSegments=yn.simpleSegment(0,0,4,2);let l=new xi;l.emplaceBack(0,1,2),l.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(l);let u=new Ad;for(let p of[0,1,3,2,0])u.emplaceBack(p);this.debugIndexBuffer=e.createIndexBuffer(u),this.emptyTexture=new Zn(e,new gi({width:1,height:1},Uint8Array.of(0,0,0,0)),e.gl.RGBA),this.identityMat=ne.create();let h=this.context.gl;this.stencilClearMode=new Ot({func:h.ALWAYS,mask:0},0,255,h.ZERO,h.ZERO,h.ZERO),this.loadTimeStamps.push(x.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(e){return e._makeTileBoundsBuffers(this.context,this.transform.projection),e._tileBoundsBuffer?{tileBoundsBuffer:e._tileBoundsBuffer,tileBoundsIndexBuffer:e._tileBoundsIndexBuffer,tileBoundsSegments:e._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){let e=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,e.TRIANGLES,at.disabled,this.stencilClearMode,Xt.disabled,kt.disabled,Px(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(e,n,i){if(!n||this.currentStencilSource===n.id||!e.isTileClipped()||!i||i.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let u=!1;for(let h of i)if(this._tileClippingMaskIDs[h.key]===void 0){u=!0;break}if(!u)return}this.currentStencilSource=n.id;let r=this.context,o=r.gl;this.nextStencilID+i.length>256&&this.clearStencil(),r.setColorMode(Xt.disabled),r.setDepthMode(at.disabled);let l=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(let u of i){let h=n.getTile(u),p=this._tileClippingMaskIDs[u.key]=this.nextStencilID++,{tileBoundsBuffer:m,tileBoundsIndexBuffer:_,tileBoundsSegments:y}=this.getTileBoundsBuffers(h);l.draw(this,o.TRIANGLES,at.disabled,new Ot({func:o.ALWAYS,mask:0},p,255,o.KEEP,o.KEEP,o.REPLACE),Xt.disabled,kt.disabled,Px(u.projMatrix),"$clipping",m,_,y)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();let e=this.nextStencilID++,n=this.context.gl;return new Ot({func:n.NOTEQUAL,mask:255},e,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(e){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(e);let n=this.context.gl;return new Ot({func:n.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(e){let n=this.context.gl,i=e.sort((l,u)=>u.overscaledZ-l.overscaledZ),r=i[i.length-1].overscaledZ,o=i[0].overscaledZ-r+1;if(o>1){this.currentStencilSource=void 0,this.nextStencilID+o>256&&this.clearStencil();let l={};for(let u=0;u<o;u++)l[u+r]=new Ot({func:n.GEQUAL,mask:255},u+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=o,[l,i]}return[{[r]:Ot.disabled},i]}colorModeForRenderPass(){let e=this.context.gl;return this._showOverdrawInspector?new Xt([e.CONSTANT_COLOR,e.ONE,e.CONSTANT_COLOR,e.ONE],new Rt(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Xt.unblended:Xt.alphaBlended}colorModeForDrapableLayerRenderPass(e){let n=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Xt([n.ONE,n.ONE_MINUS_SRC_ALPHA,n.CONSTANT_ALPHA,n.ONE_MINUS_SRC_ALPHA],new Rt(0,0,0,e===void 0?0:e),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(e,n,i,r=!1){if(!this.opaquePassEnabledForLayer()&&!r)return at.disabled;let o=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new at(i||this.context.gl.LEQUAL,n,[o,o])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,n){this._wireframeDebugCache.update(this.frameCounter),this.style=e,this.options=n;let i=this.style._mergedLayers,r=this.style.order,o=r.map(M=>i[M]),l=this.style._mergedSourceCaches;this.imageManager=e.imageManager,this.modelManager=e.modelManager,this.symbolFadeChange=e.placement.symbolFadeChange(yt.now()),this.imageManager.beginFrame();let u=0,h=!1;for(let M in l){let A=l[M];A.used&&(A.prepare(this.context),A.getSource().usedInConflation&&++u)}let p={},m={},_={},y={},v={};for(let M in l){let A=l[M];p[M]=A.getVisibleCoordinates(),m[M]=p[M].slice().reverse(),_[M]=A.getVisibleCoordinates(!0).reverse(),y[M]=A.getShadowCasterCoordinates(),v[M]=A.sortCoordinatesByDistance(p[M])}let b=M=>{let A=this.style.getLayerSourceCache(M);return A&&A.used?A.getSource():null};if(u){let M=[];for(let A of o)this.layerUsedInConflation(A,b(A))&&M.push(A);if(M&&M.length>1){let A=[];for(let R of M){let F=this.style.getLayerSourceCache(R);F&&F.used&&F.getSource().usedInConflation&&A.push({layer:R.fqid,cache:F})}this.replacementSource.setSources(A),h=!0}}h||this.replacementSource.clear(),this.conflationActive=h,this.minCutoffZoom=0,this.longestCutoffRange=0;for(let M of o){let A=M.cutoffRange();if(this.longestCutoffRange=Math.max(A,this.longestCutoffRange),A>0){let R=b(M);R&&(this.minCutoffZoom=Math.max(R.minzoom,this.minCutoffZoom)),M.minzoom&&(this.minCutoffZoom=Math.max(M.minzoom,this.minCutoffZoom))}}this.opaquePassCutoff=1/0;for(let M=0;M<o.length;M++)if(o[M].is3D()){this.opaquePassCutoff=M;break}let w=this.style&&this.style.fog;w?(this._fogVisible=w.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=w.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(_),this.opaquePassCutoff=0);let C=this._shadowRenderer;if(C){C.updateShadowParameters(this.transform,this.style.directionalLight);for(let M in l)for(let A of p[M]){let R={min:0,max:0};this.terrain&&(R=this.terrain.getMinMaxForTile(A)||R),C.addShadowReceiver(A.toUnwrapped(),R.min,R.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new hN(this.context));for(let M of o){if(M.isHidden(this.transform.zoom))continue;let A=e.getLayerSourceCache(M);this.uploadLayer(this,M,A)}if(this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new M5),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),!Df.has(this.context.gl))return;this.renderPass="offscreen";for(let M of o){let A=e.getLayerSourceCache(M);if(!M.hasOffscreenPass()||M.isHidden(this.transform.zoom))continue;let R=A?m[A.id]:void 0;(M.type==="custom"||M.type==="raster"||M.isSky()||R&&R.length)&&this.renderLayer(this,A,M,R)}this.depthRangeFor3D=[0,1-(o.length+2)*this.numSublayers*this.depthEpsilon];let E=this.terrain;E&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&!this.transform.isOrthographic&&E.drawDepth(),this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,y)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let I=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),D=(()=>{if(n.showOverdrawInspector)return Rt.black;if(this.style.fog&&this.transform.projection.supportsFog&&!I){let M=this.style.fog.properties.get("color").toArray01();return new Rt(...M)}if(this.style.fog&&this.transform.projection.supportsFog&&I){let M=this.style.fog.properties.get("space-color").toArray01();return new Rt(...M)}return Rt.transparent})();if(this.context.clear({color:D,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&I&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=r.length-1;this.currentLayer>=0;this.currentLayer--){let M=o[this.currentLayer],A=e.getLayerSourceCache(M);if(M.isSky())continue;let R=A?(M.is3D()?v:m)[A.id]:void 0;this._renderTileClippingMasks(M,A,R),this.renderLayer(this,A,M,R)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&I&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||Ni(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<r.length;this.currentLayer++){let M=o[this.currentLayer],A=e.getLayerSourceCache(M);M.isSky()&&this.renderLayer(this,A,M,A?m[A.id]:void 0)}this.renderPass="translucent",this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let S=0;for(C&&(S=C.getShadowCastingLayerCount());this.currentLayer<r.length;){let M=o[this.currentLayer],A=e.getLayerSourceCache(M);if(M.isSky()){++this.currentLayer;continue}if(E&&this.style.isLayerDraped(M)){if(M.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=E.renderBatch(this.currentLayer);continue}let R;if(A&&(R=(M.type==="symbol"?_:M.is3D()?v:m)[A.id]),this._renderTileClippingMasks(M,A,A?p[A.id]:void 0),this.renderLayer(this,A,M,R),!E&&C&&S>0&&M.hasShadowPass()&&--S==0&&(C.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer)){let F=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=F;this.currentLayer++){let k=o[this.currentLayer];if(!k.hasLightBeamPass())continue;let L=e.getLayerSourceCache(k);this.renderLayer(this,L,k,L?m[L.id]:void 0)}this.currentLayer=F,this.renderPass="translucent"}++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let M=null;o.forEach(A=>{let R=e.getLayerSourceCache(A);R&&!A.isHidden(this.transform.zoom)&&R.getVisibleCoordinates().length&&(!M||M.getSource().maxzoom<R.getSource().maxzoom)&&(M=R)}),M&&this.options.showTileBoundaries&&J2.debug(this,M,M.getVisibleCoordinates())}this.options.showPadding&&function(M){let A=M.transform.padding;q2(M,M.transform.height-(A.top||0),3,g5),q2(M,A.bottom||0,3,_5),W2(M,A.left||0,3,y5),W2(M,M.transform.width-(A.right||0),3,v5);let R=M.transform.centerPoint;(function(F,k,L,z){Am(F,k-1,L-10,2,20,z),Am(F,k-10,L-1,20,2,z)})(M,R.x,M.transform.height-R.y,x5)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(x.performance.now()),this.saveCanvasCopy()),h||(this.conflationActive=!1)}uploadLayer(e,n,i){this.gpuTimingStart(n),(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes(n.type)||e.terrain&&n.type==="custom")&&Q2[`${n.type}Upload`]&&Q2[`${n.type}Upload`](e,i,n.scope),this.gpuTimingEnd()}renderLayer(e,n,i,r){i.isHidden(this.transform.zoom)||(i.type==="background"||i.type==="sky"||i.type==="custom"||i.type==="model"||i.type==="raster"||r&&r.length)&&(this.id=i.id,this.gpuTimingStart(i),(!e.transform.projection.unsupportedLayers||!e.transform.projection.unsupportedLayers.includes(i.type)||e.terrain&&i.type==="custom")&&J2[i.type](e,n,i,r,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(e){if(!this.options.gpuTiming)return;let n=this.context.extTimerQuery,i=this.context.gl,r=this.gpuTimers[e.id];r||(r=this.gpuTimers[e.id]={calls:0,cpuTime:0,query:i.createQuery()}),r.calls++,i.beginQuery(n.TIME_ELAPSED_EXT,r.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){let e=this.context.extTimerQuery,n=this.context.gl,i=n.createQuery();this.deferredRenderGpuTimeQueries.push(i),n.beginQuery(e.TIME_ELAPSED_EXT,i)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){let e=this.gpuTimers;return this.gpuTimers={},e}collectDeferredRenderGpuQueries(){let e=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],e}queryGpuTimers(e){let n={};for(let i in e){let r=e[i],o=this.context.extTimerQuery,l=o.getQueryParameter(r.query,this.context.gl.QUERY_RESULT)/1e6;o.deleteQueryEXT(r.query),n[i]=l}return n}queryGpuTimeDeferredRender(e){if(!this.options.gpuTimingDeferredRender)return 0;let n=this.context.extTimerQuery,i=this.context.gl,r=0;for(let o of e)r+=n.getQueryParameter(o,i.QUERY_RESULT)/1e6,n.deleteQueryEXT(o);return r}translatePosMatrix(e,n,i,r,o){if(!i[0]&&!i[1])return e;let l=o?r==="map"?this.transform.angle:0:r==="viewport"?-this.transform.angle:0;if(l){let p=Math.sin(l),m=Math.cos(l);i=[i[0]*m-i[1]*p,i[0]*p+i[1]*m]}let u=[o?i[0]:Bl(n,i[0],this.transform.zoom),o?i[1]:Bl(n,i[1],this.transform.zoom),0],h=new Float32Array(16);return ne.translate(h,e,u),h}saveTileTexture(e){let n=e.size[0],i=this._tileTextures[n];i?i.push(e):this._tileTextures[n]=[e]}getTileTexture(e){let n=this._tileTextures[e];return n&&n.length>0?n.pop():null}isPatternMissing(e,n){return e===null||e!==void 0&&!this.imageManager.getPattern(e.toString(),n)}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(e,n,i){let r=i===void 0?this.terrain&&this.terrain.renderingToTexture:i,o=this.terrain&&this.terrain.exaggeration()===0,l=[];return this.style&&this.style.enable3dLights()&&(e==="globeRaster"||e==="terrainRaster"?(l.push("LIGHTING_3D_MODE"),l.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):r||l.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"?this._shadowMapDebug||l.push("DEPTH_TEXTURE"):this.shadowRenderer&&(this.shadowRenderer.useNormalOffset?l.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"):l.push("RENDER_SHADOWS","DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(l.push("TERRAIN"),this.linearFloatFilteringSupported()&&l.push("TERRAIN_DEM_FLOAT_FORMAT"),o&&l.push("ZERO_EXAGGERATION")),this.transform.projection.name==="globe"&&l.push("GLOBE"),!this._fogVisible||r||n!==void 0&&!n||l.push("FOG","FOG_DITHERING"),r&&l.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&l.push("OVERDRAW_INSPECTOR"),l}getOrCreateProgram(e,n){this.cache=this.cache||{};let i=n&&n.defines||[],r=n&&n.config,o=this.currentGlobalDefines(e,n&&n.overrideFog,n&&n.overrideRtt).concat(i),l=A2.cacheKey(x2[e],e,o,r);return this.cache[l]||(this.cache[l]=new A2(this.context,e,x2[e],r,s5[e],o)),this.cache[l]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){let e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=x.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new Zn(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(e,n){if(this.style.enable3dLights()){let i=this.style.directionalLight,r=this.style.ambientLight;if(i&&r){let o=((l,u)=>{let h=l.properties.get("direction"),p=l.properties.get("color").toArray01(),m=l.properties.get("intensity"),_=u.properties.get("color").toArray01(),y=u.properties.get("intensity"),v=[h.x,h.y,h.z],b=ti(_,y),w=ti(p,m);return{u_lighting_ambient_color:b,u_lighting_directional_dir:v,u_lighting_directional_color:w,u_ground_radiance:$V(v,w,b)}})(i,r);n.setLightsUniformValues(e,o)}}}uploadCommonUniforms(e,n,i,r,o){if(this.uploadCommonLightUniforms(e,n),this.terrain&&this.terrain.renderingToTexture)return;let l=this.style.fog;if(l){let u=l.getOpacity(this.transform.pitch),h=((p,m,_,y,v,b,w,C,E,I,D,S)=>{let M=p.transform,A=m.properties.get("color").toArray01();A[3]=y;let R=p.frameCounter/1e3%1,[F,k]=m.properties.get("vertical-range");return{u_fog_matrix:_?M.calculateFogTileMatrix(_):S||p.identityMat,u_fog_range:m.getFovAdjustedRange(M._fov),u_fog_color:A,u_fog_horizon_blend:m.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(F,k),k],u_fog_temporal_offset:R,u_frustum_tl:v,u_frustum_tr:b,u_frustum_br:w,u_frustum_bl:C,u_globe_pos:E,u_globe_radius:I,u_viewport:D,u_globe_transition:Ni(M.zoom),u_is_globe:+(M.projection.name==="globe")}})(this,l,i,u,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*yt.devicePixelRatio,this.transform.height*yt.devicePixelRatio],r);n.setFogUniformValues(e,h)}o&&n.setCutoffUniformValues(e,o.uniformValues)}setTileLoadedFlag(e){this.tileLoaded=e}saveCanvasCopy(){let e=this.canvasCopy();e&&(this.frameCopies.push(e),this.tileLoaded=!1)}canvasCopy(){let e=this.context.gl,n=e.createTexture();return e.bindTexture(e.TEXTURE_2D,n),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,0,0,e.drawingBufferWidth,e.drawingBufferHeight,0),n}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;let e=this.style&&this.style.fog;return!!e&&e.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){let e=this._backgroundTiles,n=this._backgroundTiles={},i=this.transform.coveringTiles({tileSize:512});for(let r of i)n[r.key]=e[r.key]||new Jd(r,512,this.transform.tileZoom,this);return n}clearBackgroundTiles(){this._backgroundTiles={}}layerUsedInConflation(e,n){return!(!e.is3D()||e.minzoom&&e.minzoom>this.transform.zoom||e.sourceLayer!=="building"&&(!n||n.type!=="batched-model"))}isTileAffectedByFog(e){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let n=this._cachedTileFogOpacities[e.key];return n||(this._cachedTileFogOpacities[e.key]=n=this.style.fog.getOpacityForTile(e)),n[0]>=Ul||n[1]>=Ul}}let Gl=2048;class k5{constructor(e,n){this.aabb=e,this.lastCascade=n}}class L5{add(e,n){let i=this.receivers[e.key];i!==void 0?(i.aabb.min[0]=Math.min(i.aabb.min[0],n.min[0]),i.aabb.min[1]=Math.min(i.aabb.min[1],n.min[1]),i.aabb.min[2]=Math.min(i.aabb.min[2],n.min[2]),i.aabb.max[0]=Math.max(i.aabb.max[0],n.max[0]),i.aabb.max[1]=Math.max(i.aabb.max[1],n.max[1]),i.aabb.max[2]=Math.max(i.aabb.max[2],n.max[2])):this.receivers[e.key]=new k5(n,null)}clear(){this.receivers={}}get(e){return this.receivers[e.key]}computeRequiredCascades(e,n,i){let r=On.fromPoints(e.points),o=0;for(let l in this.receivers){let u=this.receivers[l];if(!u||!r.intersectsAabb(u.aabb))continue;u.aabb.min=r.closestPoint(u.aabb.min),u.aabb.max=r.closestPoint(u.aabb.max);let h=u.aabb.getCorners();for(let p=0;p<i.length;p++){let m=!0;for(let _ of h){let y=[_[0]*n,_[1]*n,_[2]];if($.transformMat4(y,y,i[p].matrix),y[0]<-1||y[0]>1||y[1]<-1||y[1]>1){m=!1;break}}if(u.lastCascade=p,o=Math.max(o,p),m)break}}return o+1}}class N5{constructor(e){this.painter=e,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new L5,this._depthMode=new at(e.context.gl.LEQUAL,at.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this.useNormalOffset=!1}destroy(){for(let e of this._cascades)e.texture.destroy(),e.framebuffer.destroy();this._cascades=[]}updateShadowParameters(e,n){let i=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!n||!n.properties)return;let r=n.properties.get("shadow-intensity");if(!n.shadowsEnabled()||r<=0||(this._shadowLayerCount=i.style.order.reduce((v,b)=>{let w=i.style._mergedLayers[b];return v+(w.hasShadowPass()&&!w.isHidden(e.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this._enabled))return;let o=i.context,l=Gl,u=Gl;if(this._cascades.length===0)for(let v=0;v<2;++v){let b=i._shadowMapDebug,w=o.gl,C=o.createFramebuffer(l,u,b,"texture"),E=new Zn(o,{width:l,height:u,data:null},w.DEPTH_COMPONENT);if(C.depthAttachment.set(E.texture),b){let I=new Zn(o,{width:l,height:u,data:null},w.RGBA);C.colorAttachment.set(I.texture)}this._cascades.push({framebuffer:C,texture:E,matrix:[],far:0,boundingSphereRadius:0,frustum:new Ks,scale:0})}this.shadowDirection=eA(n);let h=0;if(e.elevation){let v=e.elevation,b=[1e4,-1e4];v.visibleDemTiles.filter(w=>w.dem).forEach(w=>{let C=w.dem.tree;b[0]=Math.min(b[0],C.minimums[0]),b[1]=Math.max(b[1],C.maximums[0])}),b[0]!==1e4&&(h=(b[1]-b[0])*v.exaggeration())}let p=1.5*e.cameraToCenterDistance,m=3*p,_=new Float64Array(16);for(let v=0;v<2;++v){let b=this._cascades[v],w=e.height/50,C=1;v===0?C=p:(w=p,C=m);let[E,I]=z5(e,this.shadowDirection,w,C,Gl,h);b.scale=e.scale,b.matrix=E,b.boundingSphereRadius=I,ne.invert(_,b.matrix),b.frustum=Ks.fromInvProjectionMatrix(_,1,0,!0),b.far=C}this._uniformValues.u_fade_range=[.75*this._cascades[1].far,this._cascades[1].far],this._uniformValues.u_shadow_intensity=r,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=Gl,this._uniformValues.u_shadowmap_0=Zr.ShadowMap0,this._uniformValues.u_shadowmap_1=Zr.ShadowMap0+1,this._groundShadowTiles=i.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});let y=i.transform.elevation;for(let v of this._groundShadowTiles){let b={min:0,max:0};if(y){let w=y.getMinMaxForTile(v);w&&(b=w)}this.addShadowReceiver(v.toUnwrapped(),b.min,b.max)}}get enabled(){return this._enabled}set enabled(e){this._enabled=e}drawShadowPass(e,n){if(!this._enabled)return;let i=this.painter,r=i.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(i.transform.getFrustum(0),i.transform.worldSize,this._cascades),r.viewport.set([0,0,Gl,Gl]);for(let o=0;o<this._numCascadesToRender;++o){i.currentShadowCascade=o,r.bindFramebuffer.set(this._cascades[o].framebuffer.framebuffer),r.clear({color:Rt.white,depth:1});for(let l of e.order){let u=e._mergedLayers[l];if(!u.hasShadowPass()||u.isHidden(i.transform.zoom))continue;let h=e.getLayerSourceCache(u),p=h?n[h.id]:void 0;(u.type==="model"||p&&p.length)&&i.renderLayer(i,h,u,p)}}i.currentShadowCascade=0}drawGroundShadows(){if(!this._enabled)return;let e=this.painter,n=e.style,i=e.context,r=n.directionalLight,o=n.ambientLight;if(!r||!o)return;let l=[],u=hu(e,e.longestCutoffRange);u.shouldRenderCutoff&&l.push("RENDER_CUTOFF");let h=Lx(r,o),p=new at(i.gl.LEQUAL,at.ReadOnly,e.depthRangeFor3D);for(let m of this._groundShadowTiles){let _=m.toUnwrapped(),y=e.isTileAffectedByFog(m),v=e.getOrCreateProgram("groundShadow",{defines:l,overrideFog:y});this.setupShadows(_,v),e.uploadCommonUniforms(i,v,_,null,u);let b={u_matrix:e.transform.calculateProjMatrix(_),u_ground_shadow_factor:h};v.draw(e,i.gl.TRIANGLES,p,Ot.disabled,Xt.multiply,kt.disabled,b,"ground_shadow",e.tileExtentBuffer,e.quadTriangleIndexBuffer,e.tileExtentSegments,{},e.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Xt.unblended:Xt.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(e){let n=this.painter.transform,i=n.calculatePosMatrix(e,n.worldSize);return ne.multiply(i,this._cascades[this.painter.currentShadowCascade].matrix,i),Float32Array.from(i)}calculateShadowPassMatrixFromMatrix(e){return ne.multiply(e,this._cascades[this.painter.currentShadowCascade].matrix,e),Float32Array.from(e)}setupShadows(e,n,i,r=0){if(!this._enabled)return;let o=this.painter.transform,l=this.painter.context,u=l.gl,h=this._uniformValues,p=new Float64Array(16),m=o.calculatePosMatrix(e,o.worldSize);for(let _=0;_<2;_++)ne.multiply(p,this._cascades[_].matrix,m),h[_===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(p),l.activeTexture.set(u.TEXTURE0+Zr.ShadowMap0+_),this._cascades[_].texture.bind(u.NEAREST,u.CLAMP_TO_EDGE);if(this.useNormalOffset=!!i,this.useNormalOffset){let _=zd(e.canonical),y=2/o.tileSize*le/Gl,v=y*this._cascades[0].boundingSphereRadius,b=y*this._cascades[1].boundingSphereRadius,w=(i==="vector-tile"?1:3)/Math.pow(2,r-e.canonical.z-(1-o.zoom+Math.floor(o.zoom)));h.u_shadow_normal_offset=[_,v*w,b*w],h.u_shadow_bias=[6e-5,.0012,.012]}else h.u_shadow_bias=[36e-5,.0012,.012];n.setShadowUniformValues(l,h)}setupShadowsFromMatrix(e,n,i=!1){if(!this._enabled)return;let r=this.painter.context,o=r.gl,l=this._uniformValues,u=new Float64Array(16);for(let h=0;h<2;h++)ne.multiply(u,this._cascades[h].matrix,e),l[h===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(u),r.activeTexture.set(o.TEXTURE0+Zr.ShadowMap0+h),this._cascades[h].texture.bind(o.NEAREST,o.CLAMP_TO_EDGE);this.useNormalOffset=i,i?(l.u_shadow_normal_offset=[1,5,5],l.u_shadow_bias=[6e-5,.0012,.012]):l.u_shadow_bias=[36e-5,.0012,.012],n.setShadowUniformValues(r,l)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(e,n,i,r){if(r[2]>=0)return{};let o=function(h,p,m){let _=m/(1<<h.canonical.z);return new On([h.canonical.x*_+h.wrap*m,h.canonical.y*_+h.wrap*m,0],[(h.canonical.x+1)*_+h.wrap*m,(h.canonical.y+1)*_+h.wrap*m,p])}(e,n,i).getCorners(),l=n/-r[2];r[0]<0?($.add(o[0],o[0],[r[0]*l,0,0]),$.add(o[3],o[3],[r[0]*l,0,0])):r[0]>0&&($.add(o[1],o[1],[r[0]*l,0,0]),$.add(o[2],o[2],[r[0]*l,0,0])),r[1]<0?($.add(o[0],o[0],[0,r[1]*l,0]),$.add(o[1],o[1],[0,r[1]*l,0])):r[1]>0&&($.add(o[2],o[2],[0,r[1]*l,0]),$.add(o[3],o[3],[0,r[1]*l,0]));let u={};return u.vertices=o,u.planes=[Rm(o[1],o[0],o[4]),Rm(o[2],o[1],o[5]),Rm(o[3],o[2],o[6]),Rm(o[0],o[3],o[7])],u}addShadowReceiver(e,n,i){this._receivers.add(e,On.fromTileIdAndHeight(e,n,i))}getMaxCascadeForTile(e){let n=this._receivers.get(e);return n&&n.lastCascade?n.lastCascade:0}}function Rm(t,e,n){let i=$.sub([],n,e),r=$.sub([],t,e),o=$.cross([],i,r),l=$.length(o);return l===0?[0,0,1,0]:($.scale(o,o,1/l),[o[0],o[1],o[2],-$.dot(o,e)])}function eA(t){let e=t.properties.get("direction"),n=Ke(e.x,e.y,e.z);n[2]=We(n[2],0,75);let i=Ve([n[0],n[1],n[2]]);return $.fromValues(i.x,i.y,i.z)}function Lx(t,e){let n=t.properties.get("color"),i=t.properties.get("intensity"),r=t.properties.get("direction"),o=[r.x,r.y,r.z],l=e.properties.get("color"),u=e.properties.get("intensity"),h=Math.max($.dot([0,0,1],o),0),p=[0,0,0];$.scale(p,l.toArray01Linear().slice(0,3),u);let m=[0,0,0];return $.scale(m,n.toArray01Linear().slice(0,3),h*i),di([p[0]>0?p[0]/(p[0]+m[0]):0,p[1]>0?p[1]/(p[1]+m[1]):0,p[2]>0?p[2]/(p[2]+m[2]):0])}function z5(t,e,n,i,r,o){let l=t.zoom,u=t.scale,h=t.worldSize,p=1/h,m=t.aspect,_=Math.sqrt(1+m*m)*Math.tan(.5*t.fovX),y=_*_,v=i-n,b=i+n,w,C;y>v/b?(w=i,C=i*_):(w=.5*b*(1+y),C=.5*Math.sqrt(v*v+2*(i*i+n*n)*y+b*b*y*y));let E=t.projection.pixelsPerMeter(t.center.lat,h),I=t._camera.getCameraToWorldMercator(),D=[0,0,-w*p];$.transformMat4(D,D,I);let S=C*p,M=t._edgeInsets;if(!(M.left===0&&M.top===0&&M.right===0&&M.bottom===0||M.left===M.right&&M.top===M.bottom)){let se=t._camera.getWorldToCamera(t.worldSize,t.projection.zAxisUnit==="meters"?E:1),oe=t._camera.getCameraToClipPerspective(t._fov,t.width/t.height,n,i);oe[8]=2*-t.centerOffset.x/t.width,oe[9]=2*t.centerOffset.y/t.height;let ue=new Float64Array(16);ne.mul(ue,oe,se);let de=new Float64Array(16);ne.invert(de,ue);let pe=Ks.fromInvProjectionMatrix(de,h,l,!0);for(let ae of pe.points){let ge=((A=ae)[0]/=u,A[1]/=u,A[2]=Cn(A[2],t._center.lat),A);S=Math.max(S,$.len($.subtract([],D,ge)))}}var A;S*=r/(r-1);let R=Math.acos(e[2]),F=Math.atan2(-e[0],-e[1]),k=new sm;k.position=D,k.setPitchBearing(R,F);let L=k.getWorldToCamera(h,E),z=S*h,B=Math.min(t._mercatorZfromZoom(17)*h*-2,-2*z),G=k.getCameraToClipOrthographic(-z,z,-z,z,B,(z+o*E)/e[2]),N=new Float64Array(16);ne.multiply(N,G,L);let W=$.fromValues(Math.floor(1e6*D[0])/1e6*h,Math.floor(1e6*D[1])/1e6*h,0),Y=.5*r,te=[0,0,0];$.transformMat4(te,W,N),$.scale(te,te,Y);let q=[Math.floor(te[0]),Math.floor(te[1]),Math.floor(te[2])],X=[0,0,0];$.sub(X,te,q),$.scale(X,X,-1/Y);let re=new Float64Array(16);return ne.identity(re),ne.translate(re,re,X),ne.multiply(N,re,N),[N,z]}class B5 extends yi{constructor(e){super(),this.requestManager=e,this.models={"":{}},this.numModelsLoading={}}loadModel(e,n){return ZS(this.requestManager.transformRequest(n,fe.Model).url).then(i=>{if(!i)return;let r=bx(i),o=new GD(e,void 0,void 0,r);return o.computeBoundsAndApplyParent(),o}).catch(i=>{this.fire(new mt(new Error(`Could not load model ${e} from ${n}: ${i.message}`)))})}load(e,n){this.models[n]||(this.models[n]={});let i=Object.keys(e);this.numModelsLoading[n]=(this.numModelsLoading[n]||0)+i.length;let r=[];for(let o of i)r.push(this.loadModel(o,e[o]));Promise.allSettled(r).then(o=>{for(let l=0;l<o.length;l++){let{status:u,value:h}=o[l];u==="fulfilled"&&h&&(this.models[n][i[l]]=h)}this.numModelsLoading[n]-=i.length,this.fire(new Ce("data",{dataType:"style"}))}).catch(o=>{this.fire(new mt(new Error(`Could not load models: ${o.message}`)))})}isLoaded(){for(let e in this.numModelsLoading)if(this.numModelsLoading[e]>0)return!1;return!0}hasModel(e,n){return!!this.getModel(e,n)}getModel(e,n){return this.models[n]||(this.models[n]={}),this.models[n][e]}addModel(e,n,i){this.models[i]||(this.models[i]={}),this.hasModel(e,i)&&this.removeModel(e,i),this.load({[e]:this.requestManager.normalizeModelURL(n)},i)}addModels(e,n){let i={};for(let r in e)i[r]=this.requestManager.normalizeModelURL(e[r]);this.load(i,n)}removeModel(e,n){this.models[n]||(this.models[n]={});let i=this.models[n][e];delete this.models[n][e],i.destroy()}listModels(e){return this.models[e]||(this.models[e]={}),Object.keys(this.models[e])}upload(e,n){this.models[n]||(this.models[n]={});for(let i in this.models[n])this.models[n][i].upload(e.context)}}let hh=(t,e)=>tp(t,e&&e.filter(n=>n.identifier!=="source.canvas")),V5=Nr(on,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection","setCamera","addImport","removeImport","setImportUrl","setImportData","setImportConfig"]),j5=Nr(on,["setCenter","setZoom","setBearing","setPitch"]),tA={version:8,layers:[],sources:{}},nA={duration:300,delay:0},U5=new Set(["fill","line","background","hillshade","raster"]);class es extends yi{constructor(e,n={}){super(),this.map=e,this.scope=n.scope||"",this.fragments=[],this.importDepth=n.importDepth||0,this.importsCache=n.importsCache||new Map,this.resolvedImports=n.resolvedImports||new Set,this.transition=$e({},nA),this._buildingIndex=new dV(this),this.crossTileSymbolIndex=new FV,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=n.styleChanges||new E3,this.dispatcher=n.dispatcher?n.dispatcher:new gm(ch(),this),n.imageManager?this.imageManager=n.imageManager:(this.imageManager=new V4,this.imageManager.setEventedParent(this)),this.imageManager.createScope(this.scope),this.glyphManager=n.glyphManager?n.glyphManager:new iu(e._requestManager,n.localFontFamily?2:n.localIdeographFontFamily?1:0,n.localFontFamily||n.localIdeographFontFamily),n.modelManager?this.modelManager=n.modelManager:(this.modelManager=new B5(e._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._order=[],this._markersNeedUpdate=!1,this.options=new Map,this._configDependentLayers=new Set,this._config=n.config,this.dispatcher.broadcast("setReferrer",we());let i=this;this._rtlTextPluginCallback=es.registerForPluginStateChange(r=>{i.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:r.pluginStatus,pluginURL:r.pluginURL},(o,l)=>{if(tT(o),l&&l.every(u=>u))for(let u in i._sourceCaches){let h=i._sourceCaches[u],p=h.getSource().type;p!=="vector"&&p!=="geojson"||h.reload()}})}),this.on("data",r=>{if(r.dataType!=="source"||r.sourceDataType!=="metadata")return;let o=this.getOwnSource(r.sourceId);if(o&&o.vectorLayerIds)for(let l in this._layers){let u=this._layers[l];u.source===o.id&&this._validateLayer(u)}})}loadURL(e,n={}){this.fire(new Ce("dataloading",{dataType:"style"}));let i=typeof n.validate=="boolean"?n.validate:!gn(e);e=this.map._requestManager.normalizeStyleURL(e,n.accessToken),this.resolvedImports.add(e);let r=this.importsCache.get(e);if(r)return this._load(r,i);let o=this.map._requestManager.transformRequest(e,fe.Style);this._request=Me(o,(l,u)=>{if(this._request=null,l)this.fire(new mt(l));else if(u)return this.importsCache.set(e,u),this._load(u,i)})}loadJSON(e,n={}){this.fire(new Ce("dataloading",{dataType:"style"})),this._request=yt.frame(()=>{this._request=null,this._load(e,n.validate!==!1)})}loadEmpty(){this.fire(new Ce("dataloading",{dataType:"style"})),this._load(tA,!1)}_loadImports(e,n){if(this.importDepth>=4)return J("Style doesn't support nesting deeper than 5"),Promise.resolve();let i=[];for(let r of e){let o=this._createFragmentStyle(r),l=new Promise(h=>{o.once("style.import.load",h),o.once("error",h)}).then(()=>this.mergeAll());if(i.push(l),this.resolvedImports.has(r.url)){o.loadEmpty();continue}let u=r.data||this.importsCache.get(r.url);u?o.loadJSON(u,{validate:n}):r.url?o.loadURL(r.url,{validate:n}):o.loadEmpty(),this.fragments.push({style:o,id:r.id,config:r.config})}return Promise.allSettled(i)}_createFragmentStyle(e){let n=this.scope?hr(e.id,this.scope):e.id,i=new es(this.map,{scope:n,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:e.config});return i.setEventedParent(this.map,{style:i}),i}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options});let e=this.isRootStyle();this._shouldPrecompile=e,this.fire(new Ce(e?"style.load":"style.import.load"))}_load(e,n){let i=e.schema;if(this.isRootStyle()&&(e.fragment||i&&e.fragment!==!1)){let l=$e({},tA,{imports:[{id:"basemap",data:e,url:""}]});return void this._load(l,n)}if(this.setConfig(this._config,i),n&&hh(this,zc(e)))return;this._loaded=!0,this.stylesheet=V(e);for(let l in e.sources)this.addSource(l,e.sources[l],{validate:!1,isInitialLoad:!0});e.sprite?this._loadSprite(e.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),this.glyphManager.setURL(e.glyphs,this.scope);let r=QS(this.stylesheet.layers);if(this._order=r.map(l=>l.id),this.stylesheet.light&&J("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){let l=this.stylesheet.lights[0];this.light=new IS(l.properties,l.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new IS(this.stylesheet.light)),this._layers={},this._serializedLayers={};for(let l of r){let u=pm(l,this.options);u.setScope(this.scope),u.isConfigDependent&&this._configDependentLayers.add(u.fqid),u.setEventedParent(this,{layer:{id:u.id}}),this._layers[u.id]=u,this._serializedLayers[u.id]=u.serialize();let h=this.getOwnLayerSourceCache(u),p=!!this.directionalLight&&this.directionalLight.shadowsEnabled();h&&u.canCastShadows()&&p&&(h.castsShadows=!0)}this.stylesheet.models&&this.modelManager.addModels(this.stylesheet.models,this.scope);let o=this.stylesheet.terrain;o&&(this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=yt.hasCanvasFingerprintNoise()),this.disableElevatedTerrain?J("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."):this.terrainSetForDrapingOnly()||this._createTerrain(o,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new Ce("data",{dataType:"style"})),e.imports?this._loadImports(e.imports,n).then(()=>this._reloadImports()):this._reloadImports()}isRootStyle(){return this.importDepth===0}mergeAll(){let e,n,i,r,o,l,u,h;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(p=>{if(p.stylesheet){if(p.light!=null&&(e=p.light),p.stylesheet.lights)for(let m of p.stylesheet.lights)m.type==="ambient"&&p.ambientLight!=null&&(n=p.ambientLight),m.type==="directional"&&p.directionalLight!=null&&(i=p.directionalLight);r=this._prioritizeTerrain(r,p.terrain,p.stylesheet.terrain),p.stylesheet.fog&&p.fog!=null&&(o=p.fog),p.stylesheet.camera!=null&&(h=p.stylesheet.camera),p.stylesheet.projection!=null&&(l=p.stylesheet.projection),p.stylesheet.transition!=null&&(u=p.stylesheet.transition)}}),this.light=e,this.ambientLight=n,this.directionalLight=i,this.fog=o,r===null?delete this.terrain:this.terrain=r,this.camera=h||{"camera-projection":"perspective"},this.projection=l||{name:"mercator"},this.transition=$e({},nA,u),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(e){let n=i=>{for(let r of i.fragments)n(r.style);e(i)};n(this)}_prioritizeTerrain(e,n,i){let r=e&&e.drapeRenderMode===0;return i===null?n&&n.drapeRenderMode===0?n:r?e:null:n!=null&&(!e||r||n&&n.drapeRenderMode===1)?n:e}mergeTerrain(){let e;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(n=>{e=this._prioritizeTerrain(e,n.terrain,n.stylesheet.terrain)}),e===null?delete this.terrain:this.terrain=e}mergeProjection(){let e;this.forEachFragmentStyle(n=>{n.stylesheet.projection!=null&&(e=n.stylesheet.projection)}),this.projection=e||{name:"mercator"}}mergeSources(){let e={},n={},i={};this.forEachFragmentStyle(r=>{for(let o in r._sourceCaches){let l=hr(o,r.scope);e[l]=r._sourceCaches[o]}for(let o in r._otherSourceCaches){let l=hr(o,r.scope);n[l]=r._otherSourceCaches[o]}for(let o in r._symbolSourceCaches){let l=hr(o,r.scope);i[l]=r._symbolSourceCaches[o]}}),this._mergedSourceCaches=e,this._mergedOtherSourceCaches=n,this._mergedSymbolSourceCaches=i}mergeLayers(){let e={},n=[],i={};this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(o=>{for(let l of o._order){let u=o._layers[l];if(u.type==="slot"){let h=op(l);if(e[h])continue;e[h]=[]}u.slot&&e[u.slot]?e[u.slot].push(u):n.push(u)}}),this._mergedOrder=[];let r=(o=[])=>{for(let l of o)if(l.type==="slot"){let u=op(l.id);e[u]&&r(e[u])}else{let u=hr(l.id,l.scope);this._mergedOrder.push(u),i[u]=l,l.is3D()&&(this._has3DLayers=!0),l.type==="circle"&&(this._hasCircleLayers=!0),l.type==="symbol"&&(this._hasSymbolLayers=!0)}};r(n),this._mergedLayers=i,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(e){return this.stylesheet.camera=$e({},this.stylesheet.camera,e),this.camera=this.stylesheet.camera,this}setProjection(e){e?this.stylesheet.projection=e:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(e){this._spriteRequest=function(n,i,r){let o,l,u,h=yt.devicePixelRatio>1?"@2x":"",p=Me(i.transformRequest(i.normalizeSpriteURL(n,h,".json"),fe.SpriteJSON),(y,v)=>{p=null,u||(u=y,o=v,_())}),m=St(i.transformRequest(i.normalizeSpriteURL(n,h,".png"),fe.SpriteImage),(y,v)=>{m=null,u||(u=y,l=v,_())});function _(){if(u)r(u);else if(o&&l){let y=yt.getImageData(l),v={};for(let b in o){let{width:w,height:C,x:E,y:I,sdf:D,pixelRatio:S,stretchX:M,stretchY:A,content:R}=o[b],F=new gi({width:w,height:C});gi.copy(y,F,{x:E,y:I},{x:0,y:0},{width:w,height:C}),v[b]={data:F,pixelRatio:S,sdf:D,stretchX:M,stretchY:A,content:R}}r(null,v)}}return{cancel(){p&&(p.cancel(),p=null),m&&(m.cancel(),m=null)}}}(e,this.map._requestManager,(n,i)=>{if(this._spriteRequest=null,n)this.fire(new mt(n));else if(i)for(let r in i)this.imageManager.addImage(r,this.scope,i[r]);this.imageManager.setLoaded(!0,this.scope),this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new Ce("data",{dataType:"style"}))})}_validateLayer(e){let n=this.getOwnSource(e.source);if(!n)return;let i=e.sourceLayer;i&&(n.type==="geojson"||n.vectorLayerIds&&n.vectorLayerIds.indexOf(i)===-1)&&this.fire(new mt(new Error(`Source layer "${i}" does not exist on source "${n.id}" as specified by style layer "${e.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(let e in this._sourceCaches)if(!this._sourceCaches[e].loaded())return!1;if(!this.imageManager.isLoaded()||!this.modelManager.isLoaded())return!1;for(let{style:e}of this.fragments)if(!e.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((e,n)=>{let i=this.fragments[n];return i&&i.style&&(e.data=i.style.serialize()),e})}_serializeSources(){let e={};for(let n in this._sourceCaches){let i=this._sourceCaches[n].getSource();e[i.id]||(e[i.id]=i.serialize())}return e}_serializeLayers(e){let n=[];for(let i of e){let r=this._layers[i];r&&r.type!=="custom"&&n.push(r.serialize())}return n}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition())return!0;for(let e in this._sourceCaches)if(this._sourceCaches[e].hasTransition())return!0;for(let e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}isLayerDraped(e){return!!this.terrain&&(typeof e.isLayerDraped=="function"?e.isLayerDraped(this.getLayerSourceCache(e)):U5.has(e.type))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(e){let n=this.getOwnLayer(e);if(n)return n;this.fire(new mt(new Error(`The layer '${e}' does not exist in the map's style.`)))}_checkSource(e){let n=this.getOwnSource(e);if(n)return n;this.fire(new mt(new Error(`The source '${e}' does not exist in the map's style.`)))}update(e){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(e),this.directionalLight&&this.directionalLight.recalculate(e);let n=this.calculateLightsBrightness();e.brightness=n||0,n!==this._brightness&&(this._brightness=n,this.dispatcher.broadcast("setBrightness",n));let i=this._changes.isDirty();if(this._changes.isDirty()){let o=this._changes.getLayerUpdatesByScope();for(let l in o){let{updatedIds:u,removedIds:h}=o[l];(u||h)&&this._updateWorkerLayers(l,u,h)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(e),this.light&&this.light.updateTransitions(e),this.ambientLight&&this.ambientLight.updateTransitions(e),this.directionalLight&&this.directionalLight.updateTransitions(e),this.fog&&this.fog.updateTransitions(e),this._changes.reset()}let r={};for(let o in this._mergedSourceCaches){let l=this._mergedSourceCaches[o];r[o]=l.used,l.used=!1}for(let o of this._mergedOrder){let l=this._mergedLayers[o];if(l.recalculate(e,this._availableImages),!l.isHidden(e.zoom)){let u=this.getLayerSourceCache(l);u&&(u.used=!0)}if(!this._precompileDone&&this._shouldPrecompile)for(let u=l.minzoom||0;u<(l.maxzoom||25.5);u++){let h=this.map.painter;if(h){let p=l.getProgramIds();if(!p)continue;for(let m of p){let _=l.getDefaultProgramParams(m,e.zoom);_&&(h.style=this,this.fog&&(h._fogVisible=!0,_.overrideFog=!0,h.getOrCreateProgram(m,_)),h._fogVisible=!1,_.overrideFog=!1,h.getOrCreateProgram(m,_),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(_.overrideRtt=!0,h.getOrCreateProgram(m,_)))}}}}this._shouldPrecompile&&(this._precompileDone=!0);for(let o in r){let l=this._mergedSourceCaches[o];r[o]!==l.used&&l.getSource().fire(new Ce("data",{sourceDataType:"visibility",dataType:"source",sourceId:l.getSource().id}))}this.light&&this.light.recalculate(e),this.terrain&&this.terrain.recalculate(e),this.fog&&this.fog.recalculate(e),this.z=e.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),i&&this.fire(new Ce("data",{dataType:"style"}))}_updateTilesForChangedImages(){let e=this._changes.getUpdatedImages();if(e.length){for(let n in this._sourceCaches)this._sourceCaches[n].reloadTilesForDependencies(["icons","patterns"],e);this._changes.resetUpdatedImages()}}_updateWorkerLayers(e,n,i){let r=this.getFragmentStyle(e);r&&this.dispatcher.broadcast("updateLayers",{layers:n?r._serializeLayers(n):[],scope:e,removedIds:i||[],options:r.options})}setState(e){if(this._checkLoaded(),hh(this,zc(e)))return!1;(e=V(e)).layers=QS(e.layers);let n=function(r,o){if(!r)return[{command:on.setStyle,args:[o]}];let l=[];try{if(!Wt(r.version,o.version))return[{command:on.setStyle,args:[o]}];Wt(r.center,o.center)||l.push({command:on.setCenter,args:[o.center]}),Wt(r.zoom,o.zoom)||l.push({command:on.setZoom,args:[o.zoom]}),Wt(r.bearing,o.bearing)||l.push({command:on.setBearing,args:[o.bearing]}),Wt(r.pitch,o.pitch)||l.push({command:on.setPitch,args:[o.pitch]}),Wt(r.sprite,o.sprite)||l.push({command:on.setSprite,args:[o.sprite]}),Wt(r.glyphs,o.glyphs)||l.push({command:on.setGlyphs,args:[o.glyphs]}),Wt(r.imports,o.imports)||function(_=[],y=[],v){y=y||[];let b=(_=_||[]).map(xm),w=y.map(xm),C=_.reduce(bm,{}),E=y.reduce(bm,{}),I=b.slice(),D,S,M,A;for(D=0,S=0;D<b.length;D++)M=b[D],E.hasOwnProperty(M)?S++:(v.push({command:on.removeImport,args:[M]}),I.splice(I.indexOf(M,S),1));for(D=0,S=0;D<w.length;D++)M=w[w.length-1-D],I[I.length-1-D]!==M&&(C.hasOwnProperty(M)?(v.push({command:on.removeImport,args:[M]}),I.splice(I.lastIndexOf(M,I.length-S),1)):S++,A=I[I.length-D],v.push({command:on.addImport,args:[E[M],A]}),I.splice(I.length-D,0,M));for(let R of y){let F=C[R.id];if(!F||Wt(F,R))continue;Wt(F.config,R.config)||v.push({command:on.setImportConfig,args:[R.id,R.config]}),Wt(F.url,R.url)||v.push({command:on.setImportUrl,args:[R.id,R.url]});let k=R.data;Wt(F&&F.data,k)||v.push({command:on.setImportData,args:[R.id,k]})}}(r.imports,o.imports,l),Wt(r.transition,o.transition)||l.push({command:on.setTransition,args:[o.transition]}),Wt(r.light,o.light)||l.push({command:on.setLight,args:[o.light]}),Wt(r.fog,o.fog)||l.push({command:on.setFog,args:[o.fog]}),Wt(r.projection,o.projection)||l.push({command:on.setProjection,args:[o.projection]}),Wt(r.lights,o.lights)||l.push({command:on.setLights,args:[o.lights]}),Wt(r.camera,o.camera)||l.push({command:on.setCamera,args:[o.camera]});let u={},h=[];(function(_,y,v,b){let w;for(w in y=y||{},_=_||{})_.hasOwnProperty(w)&&(y.hasOwnProperty(w)||t2(w,v,b));for(w in y){if(!y.hasOwnProperty(w))continue;let C=y[w];_.hasOwnProperty(w)?Wt(_[w],C)||(_[w].type==="geojson"&&C.type==="geojson"&&pV(_,y,w)?v.push({command:on.setGeoJSONSourceData,args:[w,C.data]}):fV(w,y,v,b)):e2(w,y,v)}})(r.sources,o.sources,h,u);let p=[];r.layers&&r.layers.forEach(_=>{_.source&&u[_.source]?l.push({command:on.removeLayer,args:[_.id]}):p.push(_)});let m=r.terrain;m&&u[m.source]&&(l.push({command:on.setTerrain,args:[void 0]}),m=void 0),l=l.concat(h),Wt(m,o.terrain)||l.push({command:on.setTerrain,args:[o.terrain]}),function(_,y,v){y=y||[];let b=(_=_||[]).map(xm),w=y.map(xm),C=_.reduce(bm,{}),E=y.reduce(bm,{}),I=b.slice(),D=Object.create(null),S,M,A,R,F,k,L;for(S=0,M=0;S<b.length;S++)A=b[S],E.hasOwnProperty(A)?M++:(v.push({command:on.removeLayer,args:[A]}),I.splice(I.indexOf(A,M),1));for(S=0,M=0;S<w.length;S++)A=w[w.length-1-S],I[I.length-1-S]!==A&&(C.hasOwnProperty(A)?(v.push({command:on.removeLayer,args:[A]}),I.splice(I.lastIndexOf(A,I.length-M),1)):M++,k=I[I.length-S],v.push({command:on.addLayer,args:[E[A],k]}),I.splice(I.length-S,0,A),D[A]=!0);for(S=0;S<w.length;S++)if(A=w[S],R=C[A],F=E[A],!D[A]&&!Wt(R,F))if(Wt(R.source,F.source)&&Wt(R["source-layer"],F["source-layer"])&&Wt(R.type,F.type)){for(L in vm(R.layout,F.layout,v,A,null,on.setLayoutProperty),vm(R.paint,F.paint,v,A,null,on.setPaintProperty),Wt(R.slot,F.slot)||v.push({command:on.setSlot,args:[A,F.slot]}),Wt(R.filter,F.filter)||v.push({command:on.setFilter,args:[A,F.filter]}),Wt(R.minzoom,F.minzoom)&&Wt(R.maxzoom,F.maxzoom)||v.push({command:on.setLayerZoomRange,args:[A,F.minzoom,F.maxzoom]}),R)R.hasOwnProperty(L)&&L!=="layout"&&L!=="paint"&&L!=="filter"&&L!=="metadata"&&L!=="minzoom"&&L!=="maxzoom"&&L!=="slot"&&(L.indexOf("paint.")===0?vm(R[L],F[L],v,A,L.slice(6),on.setPaintProperty):Wt(R[L],F[L])||v.push({command:on.setLayerProperty,args:[A,L,F[L]]}));for(L in F)F.hasOwnProperty(L)&&!R.hasOwnProperty(L)&&L!=="layout"&&L!=="paint"&&L!=="filter"&&L!=="metadata"&&L!=="minzoom"&&L!=="maxzoom"&&L!=="slot"&&(L.indexOf("paint.")===0?vm(R[L],F[L],v,A,L.slice(6),on.setPaintProperty):Wt(R[L],F[L])||v.push({command:on.setLayerProperty,args:[A,L,F[L]]}))}else v.push({command:on.removeLayer,args:[A]}),k=I[I.lastIndexOf(A)+1],v.push({command:on.addLayer,args:[F,k]})}(p,o.layers,l)}catch(u){console.warn("Unable to compute style diff:",u),l=[{command:on.setStyle,args:[o]}]}return l}(this.serialize(),e).filter(r=>!(r.command in j5));if(n.length===0)return!1;let i=n.filter(r=>!(r.command in V5));if(i.length>0)throw new Error(`Unimplemented: ${i.map(r=>r.command).join(", ")}.`);return n.forEach(r=>{this[r.command].apply(this,r.args)}),this.stylesheet=e,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}addImage(e,n){return this.getImage(e)?this.fire(new mt(new Error("An image with this name already exists."))):(this.imageManager.addImage(e,this.scope,n),this._afterImageUpdated(e),this)}updateImage(e,n){this.imageManager.updateImage(e,this.scope,n)}getImage(e){return this.imageManager.getImage(e,this.scope)}removeImage(e){return this.getImage(e)?(this.imageManager.removeImage(e,this.scope),this._afterImageUpdated(e),this):this.fire(new mt(new Error("No image with this name exists.")))}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(this.scope),this._changes.updateImage(e),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages}),this.fire(new Ce("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModel(e,n,i={}){return this._checkLoaded(),this._validate(_3,`models.${e}`,n,null,i)||(this.modelManager.addModel(e,n,this.scope),this._changes.setDirty()),this}hasModel(e){return this.modelManager.hasModel(e,this.scope)}removeModel(e){return this.hasModel(e)?(this.modelManager.removeModel(e,this.scope),this):this.fire(new mt(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(e,n,i={}){if(this._checkLoaded(),this.getOwnSource(e)!==void 0)throw new Error(`There is already a source with ID "${e}".`);if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(c3,`sources.${e}`,n,null,i))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);let r=Cx(e,n,this.dispatcher,this);r.scope=this.scope,r.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(r.id),source:r.serialize(),sourceId:r.id}));let o=l=>{let u=(l?"symbol:":"other:")+r.id,h=hr(u,this.scope),p=this._sourceCaches[u]=new Ko(h,r,l);(l?this._symbolSourceCaches:this._otherSourceCaches)[r.id]=p,p.onAdd(this.map)};o(!1),n.type!=="vector"&&n.type!=="geojson"||o(!0),r.onAdd&&r.onAdd(this.map),i.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(e){this._checkLoaded();let n=this.getOwnSource(e);if(!n)throw new Error("There is no source with this ID");for(let r in this._layers)if(this._layers[r].source===e)return this.fire(new mt(new Error(`Source "${e}" cannot be removed while layer "${r}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===e)return this.fire(new mt(new Error(`Source "${e}" cannot be removed while terrain is using it.`)));let i=this.getOwnSourceCaches(e);for(let r of i){let o=op(r.id);delete this._sourceCaches[o],this._changes.discardSourceCacheUpdate(r.id),r.fire(new Ce("data",{sourceDataType:"metadata",dataType:"source",sourceId:r.getSource().id})),r.setEventedParent(null),r.clearTiles()}return delete this._otherSourceCaches[e],delete this._symbolSourceCaches[e],this.mergeSources(),n.setEventedParent(null),n.onRemove&&n.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(e,n){this._checkLoaded(),this.getOwnSource(e).setData(n),this._changes.setDirty()}getOwnSource(e){let n=this.getOwnSourceCache(e);return n&&n.getSource()}getOwnSources(){let e=[];for(let n in this._otherSourceCaches){let i=this.getOwnSourceCache(n);i&&e.push(i.getSource())}return e}setLights(e){if(this._checkLoaded(),!e)return delete this.ambientLight,void delete this.directionalLight;let n=this._getTransitionParameters();for(let r of e){if(this._validate(d3,"lights",r))return;switch(r.type){case"ambient":if(this.ambientLight){let o=this.ambientLight;o.set(r),o.updateTransitions(n)}else this.ambientLight=new OS(r,Z4,this.scope,this.options);break;case"directional":if(this.directionalLight){let o=this.directionalLight;o.set(r),o.updateTransitions(n)}else this.directionalLight=new OS(r,X4,this.scope,this.options)}}let i=new Hn(this.z||0,n);this.ambientLight&&this.ambientLight.recalculate(i),this.directionalLight&&this.directionalLight.recalculate(i),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){let e=this.directionalLight,n=this.ambientLight;if(!e||!n)return;let i=_=>.2126*(_[0]<=.03928?_[0]/12.92:Math.pow((_[0]+.055)/1.055,2.4))+.7152*(_[1]<=.03928?_[1]/12.92:Math.pow((_[1]+.055)/1.055,2.4))+.0722*(_[2]<=.03928?_[2]/12.92:Math.pow((_[2]+.055)/1.055,2.4)),r=e.properties.get("color").toArray01(),o=e.properties.get("intensity"),l=e.properties.get("direction"),u=1-Ke(l.x,l.y,l.z)[2]/90,h=i(r)*o*u,p=n.properties.get("color").toArray01(),m=n.properties.get("intensity");return(h+i(p)*m)/2}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;let e=[];return this.directionalLight&&e.push(this.directionalLight.get()),this.ambientLight&&e.push(this.ambientLight.get()),e}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(e){if(!e)return this;if(oT(e)){let n=function(o){let l=o.indexOf(rp);return l>=0?o.slice(l+1):""}(e),i=this.fragments.find(({id:o})=>o===n);if(!i)throw new Error(`Style import not found: ${e}`);let r=op(e);return i.style.getFragmentStyle(r)}{let n=this.fragments.find(({id:i})=>i===e);if(!n)throw new Error(`Style import not found: ${e}`);return n.style}}getConfigProperty(e,n){let i=this.getFragmentStyle(e);if(!i)return null;let r=i.options.get(n),o=r?r.value||r.default:null;return o?o.serialize():null}setConfigProperty(e,n,i){let r=Ea(i);if(r.result!=="success")return void hh(this,r.value);let o=r.value.expression,l=this.getFragmentStyle(e);if(!l)return;let u=l.options.get(n);u&&(l.options.set(n,Qn(rt({},u),{value:o})),l.updateConfigDependencies())}setConfig(e,n){if(this._config=e,e||n)if(n){this.options.clear();for(let i in n){let r,o,l=Ea(n[i].default);if(l.result==="success"&&(r=l.value.expression),e&&e[i]!==void 0){let y=Ea(e[i]);y.result==="success"&&(o=y.value.expression)}let{minValue:u,maxValue:h,stepValue:p,type:m,values:_}=n[i];r?this.options.set(i,{default:r,value:o,minValue:u,maxValue:h,stepValue:p,type:m,values:_}):this.fire(new mt(new Error(`No schema defined for config option "${i}".`)))}}else this.fire(new mt(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(){for(let e of this._configDependentLayers){let n=this.getLayer(e);n&&(n.possiblyEvaluateVisibility(),this._updateLayer(n))}this.ambientLight&&this.ambientLight.scope===this.scope&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.scope===this.scope&&this.directionalLight.updateConfig(this.options),this._changes.setDirty()}addLayer(e,n,i={}){this._checkLoaded();let r=e.id;if(this._layers[r])return void this.fire(new mt(new Error(`Layer with id "${r}" already exists on this map`)));let o;if(e.type==="custom"){if(hh(this,function(m){let _=[],y=m.id;return y===void 0&&_.push({message:`layers.${y}: missing required property "id"`}),m.render===void 0&&_.push({message:`layers.${y}: missing required method "render"`}),m.renderingMode&&m.renderingMode!=="2d"&&m.renderingMode!=="3d"&&_.push({message:`layers.${y}: property "renderingMode" must be either "2d" or "3d"`}),_}(e)))return;o=pm(e,this.options)}else{if(typeof e.source=="object"&&(this.addSource(r,e.source),e=$e(e=V(e),{source:r})),this._validate(p3,`layers.${r}`,e,{arrayIndex:-1},i))return;o=pm(e,this.options),this._validateLayer(o),o.setEventedParent(this,{layer:{id:r}}),this._serializedLayers[o.id]=o.serialize()}o.isConfigDependent&&this._configDependentLayers.add(o.fqid),o.setScope(this.scope);let l=this._order.length;if(n){let m=this._order.indexOf(n);if(m===-1)return void this.fire(new mt(new Error(`Layer with id "${n}" does not exist on this map.`)));o.slot===this._layers[n].slot?l=m:J(`Layer with id "${n}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(l,0,r),this._layerOrderChanged=!0,this._layers[r]=o;let u=this.getOwnLayerSourceCache(o),h=!!this.directionalLight&&this.directionalLight.shadowsEnabled();u&&o.canCastShadows()&&h&&(u.castsShadows=!0);let p=this._changes.getRemovedLayer(o);if(p&&o.source&&u&&o.type!=="custom"){this._changes.discardLayerRemoval(o);let m=hr(o.source,o.scope);p.type!==o.type?this._changes.updateSourceCache(m,"clear"):(this._changes.updateSourceCache(m,"reload"),u.pause())}this._updateLayer(o),o.onAdd&&o.onAdd(this.map),o.scope=this.scope,this.mergeLayers()}moveLayer(e,n){this._checkLoaded();let i=this._checkLayer(e);if(!i||e===n)return;let r=this._order.indexOf(e);this._order.splice(r,1);let o=this._order.length;if(n){let l=this._order.indexOf(n);if(l===-1)return void this.fire(new mt(new Error(`Layer with id "${n}" does not exist on this map.`)));i.slot===this._layers[n].slot?o=l:J(`Layer with id "${n}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(o,0,e),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(e){this._checkLoaded();let n=this._checkLayer(e);if(!n)return;n.setEventedParent(null);let i=this._order.indexOf(e);this._order.splice(i,1),delete this._layers[e],delete this._serializedLayers[e],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(n.fqid),this._changes.removeLayer(n);let r=this.getOwnLayerSourceCache(n);if(r&&r.castsShadows){let o=!1;for(let l in this._layers)if(this._layers[l].source===n.source&&this._layers[l].canCastShadows()){o=!0;break}r.castsShadows=o}n.onRemove&&n.onRemove(this.map),this.mergeLayers()}getOwnLayer(e){return this._layers[e]}hasLayer(e){return e in this._mergedLayers}hasLayerType(e){for(let n in this._layers)if(this._layers[n].type===e)return!0;return!1}setLayerZoomRange(e,n,i){this._checkLoaded();let r=this._checkLayer(e);r&&(r.minzoom===n&&r.maxzoom===i||(n!=null&&(r.minzoom=n),i!=null&&(r.maxzoom=i),this._updateLayer(r)))}setSlot(e,n){this._checkLoaded();let i=this._checkLayer(e);i&&i.slot!==n&&(i.slot=n,this._updateLayer(i))}setFilter(e,n,i={}){this._checkLoaded();let r=this._checkLayer(e);if(r&&!Wt(r.filter,n))return n==null?(r.filter=void 0,void this._updateLayer(r)):void(this._validate(_0,`layers.${r.id}.filter`,n,{layerType:r.type},i)||(r.filter=V(n),this._updateLayer(r)))}getFilter(e){let n=this._checkLayer(e);if(n)return V(n.filter)}setLayoutProperty(e,n,i,r={}){this._checkLoaded();let o=this._checkLayer(e);o&&(Wt(o.getLayoutProperty(n),i)||(o.setLayoutProperty(n,i,r),o.isConfigDependent&&this._configDependentLayers.add(o.fqid),this._updateLayer(o)))}getLayoutProperty(e,n){let i=this._checkLayer(e);if(i)return i.getLayoutProperty(n)}setPaintProperty(e,n,i,r={}){this._checkLoaded();let o=this._checkLayer(e);if(!o||Wt(o.getPaintProperty(n),i))return;let l=o.setPaintProperty(n,i,r);o.isConfigDependent&&this._configDependentLayers.add(o.fqid),l&&this._updateLayer(o),this._changes.updatePaintProperties(o)}getPaintProperty(e,n){let i=this._checkLayer(e);if(i)return i.getPaintProperty(n)}setFeatureState(e,n){this._checkLoaded();let i=e.source,r=e.sourceLayer,o=this._checkSource(i);if(!o)return;let l=o.type;if(l==="geojson"&&r)return void this.fire(new mt(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(l==="vector"&&!r)return void this.fire(new mt(new Error("The sourceLayer parameter must be provided for vector source types.")));e.id===void 0&&this.fire(new mt(new Error("The feature id parameter must be provided.")));let u=this.getOwnSourceCaches(i);for(let h of u)h.setFeatureState(r,e.id,n)}removeFeatureState(e,n){this._checkLoaded();let i=e.source,r=this._checkSource(i);if(!r)return;let o=r.type,l=o==="vector"?e.sourceLayer:void 0;if(o==="vector"&&!l)return void this.fire(new mt(new Error("The sourceLayer parameter must be provided for vector source types.")));if(n&&typeof e.id!="string"&&typeof e.id!="number")return void this.fire(new mt(new Error("A feature id is required to remove its specific state property.")));let u=this.getOwnSourceCaches(i);for(let h of u)h.removeFeatureState(l,e.id,n)}getFeatureState(e){this._checkLoaded();let n=e.source,i=e.sourceLayer,r=this._checkSource(n);if(r){if(r.type!=="vector"||i)return e.id===void 0&&this.fire(new mt(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(n)[0].getFeatureState(i,e.id);this.fire(new mt(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(e){return this.stylesheet.transition=$e({},this.stylesheet.transition,e),this.transition=this.stylesheet.transition,this}getTransition(){return $e({},this.stylesheet.transition)}serialize(){this._checkLoaded();let e=this.getTerrain(),n=e&&this.terrain&&this.terrain.scope===this.scope?e:this.stylesheet.terrain;return Te({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:n,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},i=>i!==void 0)}_updateLayer(e){this._changes.updateLayer(e);let n=this.getLayerSourceCache(e),i=hr(e.source,e.scope),r=this._changes.getUpdatedSourceCaches();e.source&&!r[i]&&n&&n.getSource().type!=="raster"&&(this._changes.updateSourceCache(i,"reload"),n.pause()),e.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(e){let n=u=>this._mergedLayers[u].type==="fill-extrusion",i=this.order,r={},o=[];for(let u=i.length-1;u>=0;u--){let h=i[u];if(n(h)){r[h]=u;for(let p of e){let m=p[h];if(m)for(let _ of m)o.push(_)}}}o.sort((u,h)=>h.intersectionZ-u.intersectionZ);let l=[];for(let u=i.length-1;u>=0;u--){let h=i[u];if(n(h))for(let p=o.length-1;p>=0;p--){let m=o[p].feature;if(r[m.layer.id]<u)break;l.push(m),o.pop()}else for(let p of e){let m=p[h];if(m)for(let _ of m)l.push(_.feature)}}return l}queryRenderedFeatures(e,n,i){n&&n.filter&&this._validate(_0,"queryRenderedFeatures.filter",n.filter,null,n),n.scope=this.scope,n.availableImages=this._availableImages,n.serializedLayers=this._serializedLayers;let r={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new mt(new Error("parameters.layers must be an Array."))),[];for(let p of n.layers){let m=this._mergedLayers[p];if(!m)return this.fire(new mt(new Error(`The layer '${p}' does not exist in the map's style and cannot be queried for features.`))),[];r[m.source]=!0}}let o=[],l=n.serializedLayers||{},u=n&&n.layers?n.layers.some(p=>{let m=this.getLayer(p);return m&&m.is3D()}):this.has3DLayers(),h=lx.createFromScreenPoints(e,i);for(let p in this._mergedSourceCaches){let m=this._mergedSourceCaches[p].getSource();if(!m||m.scope!==n.scope)continue;let _=this._mergedSourceCaches[p].getSource().id;n.layers&&!r[_]||o.push(cV(this._mergedSourceCaches[p],this._mergedLayers,l,h,n,i,u,!!this.map._showQueryGeometry))}return this.placement&&o.push(function(p,m,_,y,v,b,w){let C={},E=b.queryRenderedSymbols(y),I=[];for(let D of Object.keys(E).map(Number))I.push(w[D]);I.sort(KS);for(let D of I){let S=D.featureIndex.lookupSymbolFeatures(E[D.bucketInstanceId],m,D.bucketIndex,D.sourceLayerIndex,v.filter,v.layers,v.availableImages,p);for(let M in S){let A=C[M]=C[M]||[],R=S[M];R.sort((F,k)=>{let L=D.featureSortOrder;if(L){let z=L.indexOf(F.featureIndex);return L.indexOf(k.featureIndex)-z}return k.featureIndex-F.featureIndex});for(let F of R)A.push(F)}}for(let D in C)C[D].forEach(S=>{let M=S.feature,A=_(p[D]);if(!A)return;let R=A.getFeatureState(M.layer["source-layer"],M.id);M.source=M.layer.source,M.layer["source-layer"]&&(M.sourceLayer=M.layer["source-layer"]),M.state=R});return C}(this._mergedLayers,l,this.getLayerSourceCache.bind(this),h.screenGeometry,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(o)}querySourceFeatures(e,n){n&&n.filter&&this._validate(_0,"querySourceFeatures.filter",n.filter,null,n);let i=this.getOwnSourceCaches(e),r=[];for(let o of i)r=r.concat(uV(o,n));return r}addSourceType(e,n,i){return es.getSourceType(e)?i(new Error(`A source type called "${e}" already exists.`)):(es.setSourceType(e,n),n.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:n.workerSourceURL},i):i(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(e,n,i={}){this._checkLoaded();let r=this.light.getLight(),o=!1;for(let u in e)if(!Wt(e[u],r[u])){o=!0;break}if(!o)return;let l=this._getTransitionParameters();this.light.setLight(e,n,i),this.light.updateTransitions(l)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(e,n=1){if(this._checkLoaded(),!e)return delete this.terrain,e===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let i=e,r=e.source==null;if(n===1){if(typeof i.source=="object"){let u="terrain-dem-src";this.addSource(u,i.source),i=V(i),i=$e(i,{source:u})}let o=$e({},i),l={};if(this.terrain&&r){o.source=this.terrain.get().source;let u=this.terrain?this.getFragmentStyle(this.terrain.scope):null;u&&(l.style=u.serialize())}if(this._validate(h3,"terrain",o,l))return}if(!this.terrain||this.terrain.scope!==this.scope&&!r||this.terrain&&n!==this.terrain.drapeRenderMode){if(!i)return;this._createTerrain(i,n),this.fire(new Ce("data",{dataType:"style"}))}else{let o=this.terrain,l=o.get();for(let u of Object.keys(ie.terrain))!i.hasOwnProperty(u)&&ie.terrain[u].default&&(i[u]=ie.terrain[u].default);for(let u in e)if(!Wt(e[u],l[u])){o.set(e,this.options),this.stylesheet.terrain=e;let h=this._getTransitionParameters({duration:0});o.updateTransitions(h),this.fire(new Ce("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(e){let n=this.fog=new H4(e,this.map.transform);this.stylesheet.fog=n.get();let i=this._getTransitionParameters({duration:0});n.updateTransitions(i)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(let e of this.map._markers)e._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(e){if(this._checkLoaded(),!e)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){let n=this.fog;if(!Wt(n.get(),e)){n.set(e),this.stylesheet.fog=n.get();let i=this._getTransitionParameters({duration:0});n.updateTransitions(i)}}else this._createFog(e);this._markersNeedUpdate=!0}_getTransitionParameters(e){return{now:yt.now(),transition:$e(this.transition,e)}}updateDrapeFirstLayers(){if(!this.terrain)return;let e=[],n=[];for(let i in this._mergedLayers)this.isLayerDraped(this._mergedLayers[i])?e.push(i):n.push(i);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...e),this._drapedFirstOrder.push(...n)}_createTerrain(e,n){let i=this.terrain=new $4(e,n,this.scope,this.options);n===1&&(this.stylesheet.terrain=e),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();let r=this._getTransitionParameters({duration:0});i.updateTransitions(r)}_force3DLayerUpdate(){for(let e in this._layers){let n=this._layers[e];n.type==="fill-extrusion"&&this._updateLayer(n)}}_forceSymbolLayerUpdate(){for(let e in this._layers){let n=this._layers[e];n.type==="symbol"&&this._updateLayer(n)}}_validate(e,n,i,r,o={}){if(o&&o.validate===!1)return!1;let l=$e({},this.serialize());return hh(this,e.call(zc,$e({key:n,style:l,value:i,styleSpec:ie},r)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),T0.off("pluginStateChange",this._rtlTextPluginCallback);for(let e in this._mergedLayers)this._mergedLayers[e].setEventedParent(null);for(let e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles(),this._mergedSourceCaches[e].setEventedParent(null);this.setEventedParent(null),delete this.fog,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.modelManager.setEventedParent(null),this.dispatcher.remove())}clearSource(e){let n=this.getSourceCaches(e);for(let i of n)i.clearTiles()}clearSources(){for(let e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles()}reloadSource(e){let n=this.getSourceCaches(e);for(let i of n)i.resume(),i.reload()}reloadSources(){for(let e of this.getSources())e.reload&&e.reload()}updateSources(e){let n;this.directionalLight&&(n=eA(this.directionalLight));for(let i in this._mergedSourceCaches)this._mergedSourceCaches[i].update(e,void 0,void 0,n)}_generateCollisionBoxes(){for(let e in this._sourceCaches){let n=this._sourceCaches[e];n.resume(),n.reload()}}_updatePlacement(e,n,i,r,o=!1){let l=!1,u=!1,h={},p={};for(let m of this._mergedOrder){let _=this._mergedLayers[m];if(_.type!=="symbol")continue;let y=hr(_.source,_.scope),v=h[y];if(!v){let w=this.getLayerSourceCache(_);if(!w)continue;let C=w.getRenderableIds(!0).map(E=>w.getTileByID(E));p[y]=C.slice(),v=h[y]=C.sort((E,I)=>I.tileID.overscaledZ-E.tileID.overscaledZ||(E.tileID.isLessThan(I.tileID)?-1:1))}let b=this.crossTileSymbolIndex.addLayer(_,v,e.center.lng,e.projection);l=l||b}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),o=o||this._layerOrderChanged||i===0,this._layerOrderChanged&&this.fire(new Ce("neworder")),(o||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(yt.now(),e.zoom))&&(this.pauseablePlacement=new AV(e,this._mergedOrder,o,n,i,r,this.placement,this.fog&&e.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,h,p),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(yt.now()),u=!0),l&&this.pauseablePlacement.placement.setStale()),u||l)for(let m of this._mergedOrder){let _=this._mergedLayers[m];_.type==="symbol"&&this.placement.updateLayerOpacities(_,h[hr(_.source,_.scope)])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(yt.now())}_releaseSymbolFadeTiles(){for(let e in this._sourceCaches)this._sourceCaches[e].releaseSymbolFadeTiles()}addImport(e){this._checkLoaded();let n=this.stylesheet.imports=this.stylesheet.imports||[];return n.findIndex(({id:r})=>r===e.id)!==-1?this.fire(new mt(new Error(`Import with id '${e.id}' already exists in the map's style.`))):(n.push(e),this._loadImports([e],!0),this)}setImportUrl(e,n){this._checkLoaded();let i=this.stylesheet.imports||[],r=this.getImportIndex(e);if(r===-1)return this;i[r].url=n;let o=this.fragments[r];return o.style=this._createFragmentStyle(i[r]),o.style.on("style.import.load",()=>this.mergeAll()),o.style.loadURL(n),this}setImportData(e,n){this._checkLoaded();let i=this.getImportIndex(e),r=this.stylesheet.imports||[];return i===-1?this:n?(this.fragments[i].style.setState(n),this._reloadImports(),this):(delete r[i].data,this.setImportUrl(e,r[i].url))}setImportConfig(e,n){this._checkLoaded();let i=this.getImportIndex(e),r=this.stylesheet.imports||[];if(i===-1)return this;n?r[i].config=n:delete r[i].config;let o=this.fragments[i],l=o.style.stylesheet&&o.style.stylesheet.schema;return o.config=n,o.style.setConfig(n,l),o.style.updateConfigDependencies(),this}removeImport(e){this._checkLoaded();let n=this.stylesheet.imports||[],i=this.getImportIndex(e);return i===-1||(n.splice(i,1),this.fragments[i].style._remove(),this.fragments.splice(i,1),this._reloadImports()),this}getImportIndex(e){let n=(this.stylesheet.imports||[]).findIndex(i=>i.id===e);return n===-1&&this.fire(new mt(new Error(`Import '${e}' does not exist in the map's style and cannot be updated.`))),n}getLayer(e){return this._mergedLayers[e]}getSources(){let e=[];for(let n in this._mergedOtherSourceCaches){let i=this._mergedOtherSourceCaches[n];i&&e.push(i.getSource())}return e}getSource(e,n){let i=this.getSourceCache(e,n);return i&&i.getSource()}getLayerSource(e){let n=this.getLayerSourceCache(e);return n&&n.getSource()}getSourceCache(e,n){let i=hr(e,n);return this._mergedOtherSourceCaches[i]}getLayerSourceCache(e){let n=hr(e.source,e.scope);return e.type==="symbol"?this._mergedSymbolSourceCaches[n]:this._mergedOtherSourceCaches[n]}getSourceCaches(e){let n=[];return this._mergedOtherSourceCaches[e]&&n.push(this._mergedOtherSourceCaches[e]),this._mergedSymbolSourceCaches[e]&&n.push(this._mergedSymbolSourceCaches[e]),n}updateSourceCaches(){let e=this._changes.getUpdatedSourceCaches();for(let n in e){let i=e[n];i==="reload"?this.reloadSource(n):i==="clear"&&this.clearSource(n)}}updateLayers(e){let n=this._changes.getUpdatedPaintProperties();for(let i of n){let r=this.getLayer(i);r&&r.updateTransitions(e)}}getImages(e,n,i){this.imageManager.getImages(n.icons,n.scope,i),this._updateTilesForChangedImages();let r=o=>{o&&o.setDependencies(n.tileID.key,n.type,n.icons)};r(this._otherSourceCaches[n.source]),r(this._symbolSourceCaches[n.source])}getGlyphs(e,n,i){this.glyphManager.getGlyphs(n.stacks,n.scope,i)}getResource(e,n,i){return Ie(n,i)}getOwnSourceCache(e){return this._otherSourceCaches[e]}getOwnLayerSourceCache(e){return e.type==="symbol"?this._symbolSourceCaches[e.source]:this._otherSourceCaches[e.source]}getOwnSourceCaches(e){let n=[];return this._otherSourceCaches[e]&&n.push(this._otherSourceCaches[e]),this._symbolSourceCaches[e]&&n.push(this._symbolSourceCaches[e]),n}_isSourceCacheLoaded(e){let n=this.getOwnSourceCaches(e);return n.length===0?(this.fire(new mt(new Error(`There is no source with ID '${e}'`))),!1):n.every(i=>i.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}function iA(t,e){let n=!1,i=null,r=()=>{i=null,n&&(t(),i=setTimeout(r,e),n=!1)};return()=>(n=!0,i||r(),i)}es.getSourceType=function(t){return wx[t]},es.setSourceType=function(t,e){wx[t]=e},es.registerForPluginStateChange=function(t){return t({pluginStatus:Ur,pluginURL:Ma}),T0.on("pluginStateChange",t),t};class $5{constructor(e){this._hashName=e&&encodeURIComponent(e),Ri(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=iA(this._updateHashUnthrottled.bind(this),300)}addTo(e){return this._map=e,x.addEventListener("hashchange",this._onHashChange,!1),e.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),x.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){let e=this._map;if(!e)return"";let n=rA(e);if(this._hashName){let i=this._hashName,r=!1,o=x.location.hash.slice(1).split("&").map(l=>{let u=l.split("=")[0];return u===i?(r=!0,`${u}=${n}`):l}).filter(l=>l);return r||o.push(`${i}=${n}`),`#${o.join("&")}`}return`#${n}`}_getCurrentHash(){let e=x.location.hash.replace("#","");if(this._hashName){let n;return e.split("&").map(i=>i.split("=")).forEach(i=>{i[0]===this._hashName&&(n=i)}),(n&&n[1]||"").split("/")}return e.split("/")}_onHashChange(){let e=this._map;if(!e)return!1;let n=this._getCurrentHash();if(n.length>=3&&!n.some(i=>isNaN(i))){let i=e.dragRotate.isEnabled()&&e.touchZoomRotate.isEnabled()?+(n[3]||0):e.getBearing();return e.jumpTo({center:[+n[2],+n[1]],zoom:+n[0],bearing:i,pitch:+(n[4]||0)}),!0}return!1}_updateHashUnthrottled(){let e=x.location.href.replace(/(#.+)?$/,this.getHashString());x.history.replaceState(x.history.state,null,e)}}function rA(t,e){let n=t.getCenter(),i=Math.round(100*t.getZoom())/100,r=Math.ceil((i*Math.LN2+Math.log(512/360/.5))/Math.LN10),o=Math.pow(10,r),l=Math.round(n.lng*o)/o,u=Math.round(n.lat*o)/o,h=t.getBearing(),p=t.getPitch(),m=e?`/${l}/${u}/${i}`:`${i}/${u}/${l}`;return(h||p)&&(m+="/"+Math.round(10*h)/10),p&&(m+=`/${Math.round(p)}`),m}let Om={linearity:.3,easing:yl(0,0,.3,1)},G5=$e({deceleration:2500,maxSpeed:1400},Om),H5=$e({deceleration:20,maxSpeed:1400},Om),q5=$e({deceleration:1e3,maxSpeed:360},Om),W5=$e({deceleration:1e3,maxSpeed:90},Om);class Z5{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:yt.now(),settings:e})}_drainInertiaBuffer(){let e=this._inertiaBuffer,n=yt.now();for(;e.length>0&&n-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;let n={zoom:0,bearing:0,pitch:0,pan:new Q(0,0),pinchAround:void 0,around:void 0};for(let{settings:o}of this._inertiaBuffer)n.zoom+=o.zoomDelta||0,n.bearing+=o.bearingDelta||0,n.pitch+=o.pitchDelta||0,o.panDelta&&n.pan._add(o.panDelta),o.around&&(n.around=o.around),o.pinchAround&&(n.pinchAround=o.pinchAround);let i=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,r={};if(n.pan.mag()){let o=km(n.pan.mag(),i,$e({},G5,e||{}));r.offset=n.pan.mult(o.amount/n.pan.mag()),r.center=this._map.transform.center,Fm(r,o)}if(n.zoom){let o=km(n.zoom,i,H5);r.zoom=this._map.transform.zoom+o.amount,Fm(r,o)}if(n.bearing){let o=km(n.bearing,i,q5);r.bearing=this._map.transform.bearing+We(o.amount,-179,179),Fm(r,o)}if(n.pitch){let o=km(n.pitch,i,W5);r.pitch=this._map.transform.pitch+o.amount,Fm(r,o)}if(r.zoom||r.bearing){let o=n.pinchAround===void 0?n.around:n.pinchAround;r.around=o?this._map.unproject(o):this._map.getCenter()}return this.clear(),r.noMoveStart=!0,r}}function Fm(t,e){(!t.duration||t.duration<e.duration)&&(t.duration=e.duration,t.easing=e.easing)}function km(t,e,n){let{maxSpeed:i,linearity:r,deceleration:o}=n,l=We(t*r/(e/1e3),-i,i),u=Math.abs(l)/(o*r);return{easing:n.easing,duration:1e3*u,amount:l*(u/2)}}class ao extends Ce{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,i,r={}){let o=ld(n.getCanvasContainer(),i);super(e,$e({point:o,lngLat:n.unproject(o),originalEvent:i},r)),this._defaultPrevented=!1,this.target=n}}class Lm extends Ce{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,i){let r=e==="touchend"?i.changedTouches:i.touches,o=Rf(n.getCanvasContainer(),r),l=o.map(h=>n.unproject(h)),u=o.reduce((h,p,m,_)=>h.add(p.div(_.length)),new Q(0,0));super(e,{points:o,point:u,lngLats:l,lngLat:n.unproject(u),originalEvent:i}),this._defaultPrevented=!1}}class X5 extends Ce{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,i){super(e,{originalEvent:i}),this._defaultPrevented=!1}}class Y5{constructor(e,n){this._map=e,this._clickTolerance=n.clickTolerance}reset(){this._mousedownPos=void 0}wheel(e){return this._firePreventable(new X5(e.type,this._map,e))}mousedown(e,n){return this._mousedownPos=n,this._firePreventable(new ao(e.type,this._map,e))}mouseup(e){this._map.fire(new ao(e.type,this._map,e))}preclick(e){let n=$e({},e);n.type="preclick",this._map.fire(new ao(n.type,this._map,n))}click(e,n){this._mousedownPos&&this._mousedownPos.dist(n)>=this._clickTolerance||(this.preclick(e),this._map.fire(new ao(e.type,this._map,e)))}dblclick(e){return this._firePreventable(new ao(e.type,this._map,e))}mouseover(e){this._map.fire(new ao(e.type,this._map,e))}mouseout(e){this._map.fire(new ao(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Lm(e.type,this._map,e))}touchmove(e){this._map.fire(new Lm(e.type,this._map,e))}touchend(e){this._map.fire(new Lm(e.type,this._map,e))}touchcancel(e){this._map.fire(new Lm(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class K5{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(e){this._map.fire(new ao(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ao("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._map.fire(new ao(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class J5{constructor(e,n){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=n.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,n){this.isEnabled()&&e.shiftKey&&e.button===0&&(OC(),this._startPos=this._lastPos=n,this._active=!0)}mousemoveWindow(e,n){if(!this._active)return;let i=n,r=this._startPos,o=this._lastPos;if(!r||!o||o.equals(i)||!this._box&&i.dist(r)<this._clickTolerance)return;this._lastPos=i,this._box||(this._box=Sn("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",e));let l=Math.min(r.x,i.x),u=Math.max(r.x,i.x),h=Math.min(r.y,i.y),p=Math.max(r.y,i.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${l}px,${h}px)`,this._box.style.width=u-l+"px",this._box.style.height=p-h+"px")})}mouseupWindow(e,n){if(!this._active)return;let i=this._startPos,r=n;if(i&&e.button===0){if(this.reset(),_y(),i.x!==r.x||i.y!==r.y)return this._map.fire(new Ce("boxzoomend",{originalEvent:e})),{cameraAnimation:o=>o.fitScreenCoordinates(i,r,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",e)}}keydown(e){this._active&&e.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",e))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),FC(),delete this._startPos,delete this._lastPos}_fireEvent(e,n){return this._map.fire(new Ce(e,{originalEvent:n}))}}function Nx(t,e){let n={};for(let i=0;i<t.length;i++)n[t[i].identifier]=e[i];return n}class Q5{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(e,n,i){(this.centroid||i.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=e.timeStamp),i.length===this.numTouches&&(this.centroid=function(r){let o=new Q(0,0);for(let l of r)o._add(l);return o.div(r.length)}(n),this.touches=Nx(i,n)))}touchmove(e,n,i){if(this.aborted||!this.centroid)return;let r=Nx(i,n);for(let o in this.touches){let l=r[o];(!l||l.dist(this.touches[o])>30)&&(this.aborted=!0)}}touchend(e,n,i){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),i.length===0){let r=!this.aborted&&this.centroid;if(this.reset(),r)return r}}}class zx{constructor(e){this.singleTap=new Q5(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(e,n,i){this.singleTap.touchstart(e,n,i)}touchmove(e,n,i){this.singleTap.touchmove(e,n,i)}touchend(e,n,i){let r=this.singleTap.touchend(e,n,i);if(r){let o=e.timeStamp-this.lastTime<500,l=!this.lastTap||this.lastTap.dist(r)<30;if(o&&l||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}}}class ej{constructor(){this._zoomIn=new zx({numTouches:1,numTaps:2}),this._zoomOut=new zx({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,n,i){this._zoomIn.touchstart(e,n,i),this._zoomOut.touchstart(e,n,i)}touchmove(e,n,i){this._zoomIn.touchmove(e,n,i),this._zoomOut.touchmove(e,n,i)}touchend(e,n,i){let r=this._zoomIn.touchend(e,n,i),o=this._zoomOut.touchend(e,n,i);return r?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:l=>l.easeTo({duration:300,zoom:l.getZoom()+1,around:l.unproject(r)},{originalEvent:e})}):o?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:l=>l.easeTo({duration:300,zoom:l.getZoom()-1,around:l.unproject(o)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}let tj={0:1,2:2};class Bx{constructor(e){this.reset(),this._clickTolerance=e.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(e,n){return!1}_move(e,n){return{}}mousedown(e,n){if(this._lastPoint)return;let i=kC(e);this._correctButton(e,i)&&(this._lastPoint=n,this._eventButton=i)}mousemoveWindow(e,n){let i=this._lastPoint;if(i){if(e.preventDefault(),this._eventButton!=null&&function(r,o){let l=tj[o];return r.buttons===void 0||(r.buttons&l)!==l}(e,this._eventButton))this.reset();else if(this._moved||!(n.dist(i)<this._clickTolerance))return this._moved=!0,this._lastPoint=n,this._move(i,n)}}mouseupWindow(e){this._lastPoint&&kC(e)===this._eventButton&&(this._moved&&_y(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class nj extends Bx{mousedown(e,n){super.mousedown(e,n),this._lastPoint&&(this._active=!0)}_correctButton(e,n){return n===0&&!e.ctrlKey}_move(e,n){return{around:n,panDelta:n.sub(e)}}}class oA extends Bx{_correctButton(e,n){return n===0&&e.ctrlKey||n===2}_move(e,n){let i=.8*(n.x-e.x);if(i)return this._active=!0,{bearingDelta:i}}contextmenu(e){e.preventDefault()}}class sA extends Bx{_correctButton(e,n){return n===0&&e.ctrlKey||n===2}_move(e,n){let i=-.5*(n.y-e.y);if(i)return this._active=!0,{pitchDelta:i}}contextmenu(e){e.preventDefault()}}class ij{constructor(e,n){this._map=e,this._el=e.getCanvasContainer(),this._minTouches=1,this._clickTolerance=n.clickTolerance||1,this.reset(),Ri(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new Q(0,0)}touchstart(e,n,i){return this._calculateTransform(e,n,i)}touchmove(e,n,i){if(this._active&&!(i.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(i.length===1&&!_t())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return e.cancelable&&e.preventDefault(),this._calculateTransform(e,n,i)}}touchend(e,n,i){this._calculateTransform(e,n,i),this._active&&i.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,n,i){i.length>0&&(this._active=!0);let r=Nx(i,n),o=new Q(0,0),l=new Q(0,0),u=0;for(let p in r){let m=r[p],_=this._touches[p];_&&(o._add(m),l._add(m.sub(_)),u++,r[p]=m)}if(this._touches=r,u<this._minTouches||!l.mag())return;let h=l.div(u);return this._sum._add(h),this._sum.mag()<this._clickTolerance?void 0:{around:o.div(u),panDelta:h}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Sn("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Vx{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(e){}_move(e,n,i){return{}}touchstart(e,n,i){this._firstTwoTouches||i.length<2||(this._firstTwoTouches=[i[0].identifier,i[1].identifier],this._start([n[0],n[1]]))}touchmove(e,n,i){let r=this._firstTwoTouches;if(!r)return;e.preventDefault();let[o,l]=r,u=Nm(i,n,o),h=Nm(i,n,l);if(!u||!h)return;let p=this._aroundCenter?null:u.add(h).div(2);return this._move([u,h],p,e)}touchend(e,n,i){if(!this._firstTwoTouches)return;let[r,o]=this._firstTwoTouches,l=Nm(i,n,r),u=Nm(i,n,o);l&&u||(this._active&&_y(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&e.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Nm(t,e,n){for(let i=0;i<t.length;i++)if(t[i].identifier===n)return e[i]}function aA(t,e){return Math.log(t/e)/Math.LN2}class rj extends Vx{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,n){let i=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(aA(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:aA(this._distance,i),pinchAround:n}}}function lA(t,e){return 180*t.angleWith(e)/Math.PI}class oj extends Vx{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,n){let i=this._vector;if(this._vector=e[0].sub(e[1]),i&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:lA(this._vector,i),pinchAround:n}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());let n=25/(Math.PI*this._minDiameter)*360,i=this._startVector;if(!i)return!1;let r=lA(e,i);return Math.abs(r)<n}}function jx(t){return Math.abs(t.y)>Math.abs(t.x)}class sj extends Vx{constructor(e){super(),this._map=e}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(e){this._lastPoints=e,jx(e[0].sub(e[1]))&&(this._valid=!1)}_move(e,n,i){let r=this._lastPoints;if(!r)return;let o=e[0].sub(r[0]),l=e[1].sub(r[1]);return this._map._cooperativeGestures&&!_t()&&i.touches.length<3||(this._valid=this.gestureBeginsVertically(o,l,i.timeStamp),!this._valid)?void 0:(this._lastPoints=e,this._active=!0,{pitchDelta:(o.y+l.y)/2*-.5})}gestureBeginsVertically(e,n,i){if(this._valid!==void 0)return this._valid;let r=e.mag()>=2,o=n.mag()>=2;if(!r&&!o)return;if(!r||!o)return this._firstMove==null&&(this._firstMove=i),i-this._firstMove<100&&void 0;let l=e.y>0==n.y>0;return jx(e)&&jx(n)&&l}}let aj={panStep:100,bearingStep:15,pitchStep:10};class lj{constructor(){let e=aj;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let n=0,i=0,r=0,o=0,l=0;switch(e.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:e.shiftKey?i=-1:(e.preventDefault(),o=-1);break;case 39:e.shiftKey?i=1:(e.preventDefault(),o=1);break;case 38:e.shiftKey?r=1:(e.preventDefault(),l=-1);break;case 40:e.shiftKey?r=-1:(e.preventDefault(),l=1);break;default:return}return this._rotationDisabled&&(i=0,r=0),{cameraAnimation:u=>{let h=u.getZoom();u.easeTo({duration:300,easeId:"keyboardHandler",easing:cj,zoom:n?Math.round(h)+n*(e.shiftKey?2:1):h,bearing:u.getBearing()+i*this._bearingStep,pitch:u.getPitch()+r*this._pitchStep,offset:[-o*this._panStep,-l*this._panStep],center:u.getCenter()},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function cj(t){return t*(2-t)}let cA=4.000244140625;class uj{constructor(e,n){this._map=e,this._el=e.getCanvasContainer(),this._handler=n,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,Ri(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&e.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(e){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(e.ctrlKey||e.metaKey||this.isZooming()||_t()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let n=e.deltaMode===x.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY,i=yt.now(),r=i-(this._lastWheelEventTime||0);this._lastWheelEventTime=i,n!==0&&n%cA==0?this._type="wheel":n!==0&&Math.abs(n)<4?this._type="trackpad":r>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(r*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),e.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=e,this._delta-=n,this._active||this._start(e)),e.preventDefault()}_onTimeout(e){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);let n=ld(this._el,e);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:n,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;let e=this._map.transform;this._type==="wheel"&&e.projection.wrap&&(e._center.lng>=180||e._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);let n=()=>e._terrainEnabled()&&this._aroundCoord?e.computeZoomRelativeTo(this._aroundCoord):e.zoom;if(this._delta!==0){let p=this._type==="wheel"&&Math.abs(this._delta)>cA?this._wheelZoomRate:this._defaultZoomRate,m=2/(1+Math.exp(-Math.abs(this._delta*p)));this._delta<0&&m!==0&&(m=1/m);let _=n(),y=Math.pow(2,_),v=typeof this._targetZoom=="number"?e.zoomScale(this._targetZoom):y;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(v*m))),this._type==="wheel"&&(this._startZoom=_,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}let i=typeof this._targetZoom=="number"?this._targetZoom:n(),r=this._startZoom,o=this._easing,l,u=!1;if(this._type==="wheel"&&r&&o){let p=Math.min((yt.now()-this._lastWheelEventTime)/200,1);l=ft(r,i,o(p)),p<1?this._frameId||(this._frameId=!0):u=!0}else l=i,u=!0;this._active=!0,u&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let h=l-n();return h*this._lastDelta<0&&(h=0),{noInertia:!0,needsRenderFrame:!u,zoomDelta:h,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let n=vo;if(this._prevEase){let i=this._prevEase,r=(yt.now()-i.start)/i.duration,o=i.easing(r+.01)-i.easing(r),l=.27/Math.sqrt(o*o+1e-4)*.01;n=yl(l,Math.sqrt(.0729-l*l),.25,1)}return this._prevEase={start:yt.now(),duration:e,easing:n},n}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Sn("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(x.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class dj{constructor(e,n){this._clickZoom=e,this._tapZoom=n}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class hj{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(e,n){return e.preventDefault(),{cameraAnimation:i=>{i.easeTo({duration:300,zoom:i.getZoom()+(e.shiftKey?-1:1),around:i.unproject(n)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class fj{constructor(){this._tap=new zx({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(e,n,i){this._swipePoint||(this._tapTime&&e.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?i.length>0&&(this._swipePoint=n[0],this._swipeTouch=i[0].identifier):this._tap.touchstart(e,n,i))}touchmove(e,n,i){if(this._tapTime){if(this._swipePoint){if(i[0].identifier!==this._swipeTouch)return;let r=n[0],o=r.y-this._swipePoint.y;return this._swipePoint=r,e.preventDefault(),this._active=!0,{zoomDelta:o/128}}}else this._tap.touchmove(e,n,i)}touchend(e,n,i){this._tapTime?this._swipePoint&&i.length===0&&this.reset():this._tap.touchend(e,n,i)&&(this._tapTime=e.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class pj{constructor(e,n,i){this._el=e,this._mousePan=n,this._touchPan=i}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class mj{constructor(e,n,i){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=n,this._mousePitch=i}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class gj{constructor(e,n,i,r){this._el=e,this._touchZoom=n,this._touchRotate=i,this._tapDragZoom=r,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}let zm=t=>t.zoom||t.drag||t.pitch||t.rotate;class _j extends Ce{}class yj{constructor(){this.constants=[1,1,.01],this.radius=0}setup(e,n){let i=$.sub([],n,e);this.radius=$.length(i[2]<0?$.div([],i,this.constants):[i[0],i[1],0])}projectRay(e){$.div(e,e,this.constants),$.normalize(e,e),$.mul(e,e,this.constants);let n=$.scale([],e,this.radius);if(n[2]>0){let i=$.scale([],[0,0,1],$.dot(n,[0,0,1])),r=$.scale([],$.normalize([],[n[0],n[1],0]),this.radius),o=$.add([],n,$.scale([],$.sub([],$.add([],r,i),n),2));n[0]=o[0],n[1]=o[1]}return n}}function Bm(t){return t.panDelta&&t.panDelta.mag()||t.zoomDelta||t.bearingDelta||t.pitchDelta}class vj{constructor(e,n){this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Z5(e),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new yj,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(n),Ri(["handleEvent","handleWindowEvent"],this);let i=this._el;this._listeners=[[i,"touchstart",{passive:!0}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[x.document,"mousemove",{capture:!0}],[x.document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[x,"blur",void 0]];for(let[r,o,l]of this._listeners)r.addEventListener(o,r===x.document?this.handleWindowEvent:this.handleEvent,l)}destroy(){for(let[e,n,i]of this._listeners)e.removeEventListener(n,e===x.document?this.handleWindowEvent:this.handleEvent,i)}_addDefaultHandlers(e){let n=this._map,i=n.getCanvasContainer();this._add("mapEvent",new Y5(n,e));let r=n.boxZoom=new J5(n,e);this._add("boxZoom",r);let o=new ej,l=new hj;n.doubleClickZoom=new dj(l,o),this._add("tapZoom",o),this._add("clickZoom",l);let u=new fj;this._add("tapDragZoom",u);let h=n.touchPitch=new sj(n);this._add("touchPitch",h);let p=new oA(e),m=new sA(e);n.dragRotate=new mj(e,p,m),this._add("mouseRotate",p,["mousePitch"]),this._add("mousePitch",m,["mouseRotate"]);let _=new nj(e),y=new ij(n,e);n.dragPan=new pj(i,_,y),this._add("mousePan",_),this._add("touchPan",y,["touchZoom","touchRotate"]);let v=new oj,b=new rj;n.touchZoomRotate=new gj(i,b,v,u),this._add("touchRotate",v,["touchPan","touchZoom"]),this._add("touchZoom",b,["touchPan","touchRotate"]),this._add("blockableMapEvent",new K5(n));let w=n.scrollZoom=new uj(n,this);this._add("scrollZoom",w,["mousePan"]);let C=n.keyboard=new lj;this._add("keyboard",C);for(let E of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])e.interactive&&e[E]&&n[E].enable(e[E])}_add(e,n,i){this._handlers.push({handlerName:e,handler:n,allowed:i}),this._handlersById[e]=n}stop(e){if(!this._updatingCamera){for(let{handler:n}of this._handlers)n.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[],this._originalZoom=void 0}}isActive(){for(let{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!zm(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(e,n,i){for(let r in e)if(r!==i&&(!n||n.indexOf(r)<0))return!0;return!1}handleWindowEvent(e){this.handleEvent(e,`${e.type}Window`)}_getMapTouches(e){let n=[];for(let i of e)this._el.contains(i.target)&&n.push(i);return n}handleEvent(e,n){this._updatingCamera=!0;let i=e.type==="renderFrame",r=i?void 0:e,o={needsRenderFrame:!1},l={},u={},h=e.touches?this._getMapTouches(e.touches):void 0,p=h?Rf(this._el,h):i?void 0:ld(this._el,e);for(let{handlerName:y,handler:v,allowed:b}of this._handlers){if(!v.isEnabled())continue;let w;this._blockedByActive(u,b,y)?v.reset():v[n||e.type]&&(w=v[n||e.type](e,p,h),this.mergeHandlerResult(o,l,w,y,r),w&&w.needsRenderFrame&&this._triggerRenderFrame()),(w||v.isActive())&&(u[y]=v)}let m={};for(let y in this._previousActiveHandlers)u[y]||(m[y]=r);this._previousActiveHandlers=u,(Object.keys(m).length||Bm(o))&&(this._changes.push([o,l,m]),this._triggerRenderFrame()),(Object.keys(u).length||Bm(o))&&this._map._stop(!0),this._updatingCamera=!1;let{cameraAnimation:_}=o;_&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],_(this._map))}mergeHandlerResult(e,n,i,r,o){if(!i)return;$e(e,i);let l={handlerName:r,originalEvent:i.originalEvent||o};i.zoomDelta!==void 0&&(n.zoom=l),i.panDelta!==void 0&&(n.drag=l),i.pitchDelta!==void 0&&(n.pitch=l),i.bearingDelta!==void 0&&(n.rotate=l)}_applyChanges(){let e={},n={},i={};for(let[r,o,l]of this._changes)r.panDelta&&(e.panDelta=(e.panDelta||new Q(0,0))._add(r.panDelta)),r.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+r.zoomDelta),r.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+r.bearingDelta),r.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+r.pitchDelta),r.around!==void 0&&(e.around=r.around),r.aroundCoord!==void 0&&(e.aroundCoord=r.aroundCoord),r.pinchAround!==void 0&&(e.pinchAround=r.pinchAround),r.noInertia&&(e.noInertia=r.noInertia),$e(n,o),$e(i,l);this._updateMapTransform(e,n,i),this._changes=[]}_updateMapTransform(e,n,i){let r=this._map,o=r.transform,l=I=>[I.x,I.y,I.z];if((I=>{let D=this._eventsInProgress.drag;return D&&!this._handlersById[D.handlerName].isActive()})()&&!Bm(e)){let I=o.zoom;o.cameraElevationReference="sea",this._originalZoom!=null&&o._orthographicProjectionAtLowPitch&&o.projection.name!=="globe"&&o.pitch===0?(o.cameraElevationReference="ground",o.zoom=this._originalZoom):(o.recenterOnTerrain(),o.cameraElevationReference="ground"),I!==o.zoom&&this._map._update(!0)}if(o._isCameraConstrained&&r._stop(!0),!Bm(e))return void this._fireEvents(n,i,!0);let{panDelta:u,zoomDelta:h,bearingDelta:p,pitchDelta:m,around:_,aroundCoord:y,pinchAround:v}=e;o._isCameraConstrained&&(h>0&&(h=0),o._isCameraConstrained=!1),v!==void 0&&(_=v),(h||(I=>n[I]&&!this._eventsInProgress[I])("drag"))&&_&&(this._dragOrigin=l(o.pointCoordinate3D(_)),this._originalZoom=o.zoom,this._trackingEllipsoid.setup(o._camera.position,this._dragOrigin)),o.cameraElevationReference="sea",r._stop(!0),_=_||r.transform.centerPoint,p&&(o.bearing+=p),m&&(o.pitch+=m),o._updateCameraState();let b=[0,0,0];if(u)if(o.projection.name==="mercator"){let I=this._trackingEllipsoid.projectRay(o.screenPointToMercatorRay(_).dir),D=this._trackingEllipsoid.projectRay(o.screenPointToMercatorRay(_.sub(u)).dir);b[0]=D[0]-I[0],b[1]=D[1]-I[1]}else{let I=o.pointCoordinate(_);if(o.projection.name==="globe"){u=u.rotate(-o.angle);let D=o._pixelsPerMercatorPixel/o.worldSize;b[0]=-u.x*yv(bi(I.y))*D,b[1]=-u.y*yv(o.center.lat)*D}else{let D=o.pointCoordinate(_.sub(u));I&&D&&(b[0]=D.x-I.x,b[1]=D.y-I.y)}}let w=o.zoom,C=[0,0,0];if(h){let I=l(y||o.pointCoordinate3D(_)),D={dir:$.normalize([],$.sub([],I,o._camera.position))};if(D.dir[2]<0){let S=o.zoomDeltaToMovement(I,h);$.scale(C,D.dir,S)}}let E=$.add(b,b,C);o._translateCameraConstrained(E),h&&Math.abs(o.zoom-w)>1e-4&&o.recenterOnTerrain(),o.cameraElevationReference="ground",this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(n,i,!0)}_fireEvents(e,n,i){let r=zm(this._eventsInProgress),o=zm(e),l={};for(let m in e){let{originalEvent:_}=e[m];this._eventsInProgress[m]||(l[`${m}start`]=_),this._eventsInProgress[m]=e[m]}!r&&o&&this._fireEvent("movestart",o.originalEvent);for(let m in l)this._fireEvent(m,l[m]);o&&this._fireEvent("move",o.originalEvent);for(let m in e){let{originalEvent:_}=e[m];this._fireEvent(m,_)}let u={},h;for(let m in this._eventsInProgress){let{handlerName:_,originalEvent:y}=this._eventsInProgress[m];this._handlersById[_].isActive()||(delete this._eventsInProgress[m],h=n[_]||y,u[`${m}end`]=h)}for(let m in u)this._fireEvent(m,u[m]);let p=zm(this._eventsInProgress);if(i&&(r||o)&&!p){this._updatingCamera=!0;let m=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),_=y=>y!==0&&-this._bearingSnap<y&&y<this._bearingSnap;m?(_(m.bearing||this._map.getBearing())&&(m.bearing=0),this._map.easeTo(m,{originalEvent:h})):(this._map.fire(new Ce("moveend",{originalEvent:h})),_(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(e,n){this._map.fire(new Ce(e,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{this._frameId=void 0,this.handleEvent(new _j("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}let uA="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class xj extends yi{constructor(e,n){super(),this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=n.bearingSnap,this._respectPrefersReducedMotion=n.respectPrefersReducedMotion!==!1,Ri(["_renderFrameCallback"],this)}getCenter(){return new pt(this.transform.center.lng,this.transform.center.lat)}setCenter(e,n){return this.jumpTo({center:e},n)}panBy(e,n,i){return e=Q.convert(e).mult(-1),this.panTo(this.transform.center,$e({offset:e},n),i)}panTo(e,n,i){return this.easeTo($e({center:e},n),i)}getZoom(){return this.transform.zoom}setZoom(e,n){return this.jumpTo({zoom:e},n),this}zoomTo(e,n,i){return this.easeTo($e({zoom:e},n),i)}zoomIn(e,n){return this.zoomTo(this.getZoom()+1,e,n),this}zoomOut(e,n){return this.zoomTo(this.getZoom()-1,e,n),this}getBearing(){return this.transform.bearing}setBearing(e,n){return this.jumpTo({bearing:e},n),this}getPadding(){return this.transform.padding}setPadding(e,n){return this.jumpTo({padding:e},n),this}rotateTo(e,n,i){return this.easeTo($e({bearing:e},n),i)}resetNorth(e,n){return this.rotateTo(0,$e({duration:1e3},e),n),this}resetNorthPitch(e,n){return this.easeTo($e({bearing:0,pitch:0,duration:1e3},e),n),this}snapToNorth(e,n){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,n):this}getPitch(){return this.transform.pitch}setPitch(e,n){return this.jumpTo({pitch:e},n),this}cameraForBounds(e,n){e=Hr.convert(e);let i=n&&n.bearing||0,r=n&&n.pitch||0,o=e.getNorthWest(),l=e.getSouthEast();return this._cameraForBounds(this.transform,o,l,i,r,n)}_extendCameraOptions(e){let n={top:0,bottom:0,right:0,left:0};if(typeof(e=$e({padding:n,offset:[0,0],maxZoom:this.transform.maxZoom},e)).padding=="number"){let i=e.padding;e.padding={top:i,bottom:i,right:i,left:i}}return e.padding=$e(n,e.padding),e}_minimumAABBFrustumDistance(e,n){let i=n.max[0]-n.min[0],r=n.max[1]-n.min[1];return i/r>e.aspect?i/(2*Math.tan(.5*e.fovX)*e.aspect):r/(2*Math.tan(.5*e.fovY)*e.aspect)}_cameraForBoundsOnGlobe(e,n,i,r,o,l){let u=e.clone(),h=this._extendCameraOptions(l);u.bearing=r,u.pitch=o;let p=pt.convert(n),m=pt.convert(i),_=.5*(p.lat+m.lat),y=.5*(p.lng+m.lng),v=Rr(_,y),b=$.normalize([],v),w=$.normalize([],$.cross([],b,[0,1,0])),C=$.cross([],w,b),E=[w[0],w[1],w[2],0,C[0],C[1],C[2],0,b[0],b[1],b[2],0,0,0,0,1],I=[v,Rr(p.lat,p.lng),Rr(m.lat,p.lng),Rr(m.lat,m.lng),Rr(p.lat,m.lng),Rr(_,p.lng),Rr(_,m.lng),Rr(p.lat,y),Rr(m.lat,y)],D=On.fromPoints(I.map(X=>[$.dot(w,X),$.dot(C,X),$.dot(b,X)])),S=$.transformMat4([],D.center,E);$.squaredLength(S)===0&&$.set(S,0,0,1),$.normalize(S,S),$.scale(S,S,xr),u.center=function([X,re,se]){let oe=Math.hypot(X,re,se),ue=Math.atan2(X,se),de=.5*Math.PI-Math.acos(-re/oe);return new pt(ji(ue),ji(de))}(S);let M=u.getWorldToCameraMatrix(),A=ne.invert(new Float64Array(16),M);D=On.applyTransform(D,ne.multiply([],M,E)),$.transformMat4(S,S,M);let R=.5*(D.max[2]-D.min[2]),F=this._minimumAABBFrustumDistance(u,D),k=$.scale([],[0,0,1],R),L=$.add(k,S,k),z=F+(u.pitch===0?0:$.distance(S,L)),B=u.globeCenterInViewSpace,G=$.sub([],S,[B[0],B[1],B[2]]);$.normalize(G,G),$.scale(G,G,z);let N=$.add([],S,G);$.transformMat4(N,N,A);let W=Zc/xr,Y=$.length(N),te=Cn(Math.max(Y*W-Zc,Number.EPSILON),0),q=Math.min(u.zoomFromMercatorZAdjusted(te),h.maxZoom);return q>.5*(Ld+Fa)?(u.setProjection({name:"mercator"}),u.zoom=q,this._cameraForBounds(u,n,i,r,o,l)):{center:u.center,zoom:q,bearing:r,pitch:o}}queryTerrainElevation(e,n){let i=this.transform.elevation;return i?(n=$e({},{exaggerated:!0},n),i.getAtPoint(Gt.fromLngLat(e),null,n.exaggerated)):null}_cameraForBounds(e,n,i,r,o,l){if(e.projection.name==="globe")return this._cameraForBoundsOnGlobe(e,n,i,r,o,l);let u=e.clone(),h=this._extendCameraOptions(l),p=u.padding;u.bearing=r,u.pitch=o;let m=pt.convert(n),_=pt.convert(i),y=new pt(m.lng,_.lat),v=new pt(_.lng,m.lat),b=u.project(m),w=u.project(_),C=this.queryTerrainElevation(m),E=this.queryTerrainElevation(_),I=this.queryTerrainElevation(y),D=this.queryTerrainElevation(v),S=[[b.x,b.y,Math.min(C||0,E||0,I||0,D||0)],[w.x,w.y,Math.max(C||0,E||0,I||0,D||0)]],M=On.fromPoints(S),A=u.getWorldToCameraMatrix(),R=ne.invert(new Float64Array(16),A);M=On.applyTransform(M,A);let F=$.sub([],M.max,M.min),k=p.left||0,L=p.right||0,z=p.bottom||0,B=p.top||0,{left:G,right:N,top:W,bottom:Y}=h.padding,te=.5*(k+L),q=.5*(B+z),X=Math.min(u.scaleZoom(u.scale*Math.min((u.width-(k+L+G+N))/F[0],(u.height-(z+B+Y+W))/F[1])),h.maxZoom),re=u.scale/u.zoomScale(X);M=new On([M.min[0]-(G+te)*re,M.min[1]-(Y+q)*re,M.min[2]],[M.max[0]+(N+te)*re,M.max[1]+(W+q)*re,M.max[2]]);let se=.5*F[2],oe=this._minimumAABBFrustumDistance(u,M),ue=[0,0,1,0];vn.transformMat4(ue,ue,A),vn.normalize(ue,ue);let de=$.scale([],ue,oe+se),pe=$.add([],M.center,de),ae=(typeof h.offset.x=="number"&&typeof h.offset.y=="number"?new Q(h.offset.x,h.offset.y):Q.convert(h.offset)).rotate(-Tt(r));M.center[0]-=ae.x*re,M.center[1]+=ae.y*re,$.transformMat4(M.center,M.center,R),$.transformMat4(pe,pe,R);let ge=[M.center[0],M.center[1],pe[2]*u.pixelsPerMeter];$.scale(ge,ge,1/u.worldSize);let Ae=qr(ge[0]),Pe=bi(ge[1]),Ne=Math.min(u._zoomFromMercatorZ(ge[2]),h.maxZoom),Be=new pt(Ae,Pe);return u.mercatorFromTransition&&Ne<.5*(Ld+Fa)?(u.setProjection({name:"globe"}),u.zoom=Ne,this._cameraForBounds(u,n,i,r,o,l)):{center:Be,zoom:Ne,bearing:r,pitch:o}}fitBounds(e,n,i){let r=this.cameraForBounds(e,n);return this._fitInternal(r,n,i)}fitScreenCoordinates(e,n,i,r,o){let l=Q.convert(e),u=Q.convert(n),h=new Q(Math.min(l.x,u.x),Math.min(l.y,u.y)),p=new Q(Math.max(l.x,u.x),Math.max(l.y,u.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(l,u))return this;let m=this.transform.pointLocation3D(h),_=this.transform.pointLocation3D(p),y=this.transform.pointLocation3D(new Q(h.x,p.y)),v=this.transform.pointLocation3D(new Q(p.x,h.y)),b=[Math.min(m.lng,_.lng,y.lng,v.lng),Math.min(m.lat,_.lat,y.lat,v.lat)],w=[Math.max(m.lng,_.lng,y.lng,v.lng),Math.max(m.lat,_.lat,y.lat,v.lat)],C=r&&r.pitch?r.pitch:this.getPitch(),E=this._cameraForBounds(this.transform,b,w,i,C,r);return this._fitInternal(E,r,o)}_fitInternal(e,n,i){return e?(delete(n=$e(e,n)).padding,n.linear?this.easeTo(n,i):this.flyTo(n,i)):this}jumpTo(e,n){this.stop();let i=e.preloadOnly?this.transform.clone():this.transform,r=!1,o=!1,l=!1;return"zoom"in e&&i.zoom!==+e.zoom&&(r=!0,i.zoom=+e.zoom),e.center!==void 0&&(i.center=pt.convert(e.center)),"bearing"in e&&i.bearing!==+e.bearing&&(o=!0,i.bearing=+e.bearing),"pitch"in e&&i.pitch!==+e.pitch&&(l=!0,i.pitch=+e.pitch),e.padding==null||i.isPaddingEqual(e.padding)||(i.padding=e.padding),e.preloadOnly?(this._preloadTiles(i),this):(this.fire(new Ce("movestart",n)).fire(new Ce("move",n)),r&&this.fire(new Ce("zoomstart",n)).fire(new Ce("zoom",n)).fire(new Ce("zoomend",n)),o&&this.fire(new Ce("rotatestart",n)).fire(new Ce("rotate",n)).fire(new Ce("rotateend",n)),l&&this.fire(new Ce("pitchstart",n)).fire(new Ce("pitch",n)).fire(new Ce("pitchend",n)),this.fire(new Ce("moveend",n)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||J(uA),this.transform.getFreeCameraOptions()}setFreeCameraOptions(e,n){let i=this.transform;if(!i.projection.supportsFreeCamera)return J(uA),this;this.stop();let r=i.zoom,o=i.pitch,l=i.bearing;i.setFreeCameraOptions(e);let u=r!==i.zoom,h=o!==i.pitch,p=l!==i.bearing;return this.fire(new Ce("movestart",n)).fire(new Ce("move",n)),u&&this.fire(new Ce("zoomstart",n)).fire(new Ce("zoom",n)).fire(new Ce("zoomend",n)),p&&this.fire(new Ce("rotatestart",n)).fire(new Ce("rotate",n)).fire(new Ce("rotateend",n)),h&&this.fire(new Ce("pitchstart",n)).fire(new Ce("pitch",n)).fire(new Ce("pitchend",n)),this.fire(new Ce("moveend",n)),this}easeTo(e,n){this._stop(!1,e.easeId),((e=$e({offset:[0,0],duration:500,easing:vo},e)).animate===!1||this._prefersReducedMotion(e))&&(e.duration=0);let i=this.transform,r=this.getZoom(),o=this.getBearing(),l=this.getPitch(),u=this.getPadding(),h="zoom"in e?+e.zoom:r,p="bearing"in e?this._normalizeBearing(e.bearing,o):o,m="pitch"in e?+e.pitch:l,_="padding"in e?e.padding:i.padding,y=Q.convert(e.offset),v,b,w;if(i.projection.name==="globe"){let k=Gt.fromLngLat(i.center),L=y.rotate(-i.angle);k.x+=L.x/i.worldSize,k.y+=L.y/i.worldSize;let z=k.toLngLat(),B=pt.convert(e.center||z);this._normalizeCenter(B),v=i.centerPoint.add(L),b=new Q(k.x,k.y).mult(i.worldSize),w=new Q(Ii(B.lng),Ai(B.lat)).mult(i.worldSize).sub(b)}else{v=i.centerPoint.add(y);let k=i.pointLocation(v),L=pt.convert(e.center||k);this._normalizeCenter(L),b=i.project(k),w=i.project(L).sub(b)}let C=i.zoomScale(h-r),E,I;e.around&&(E=pt.convert(e.around),I=i.locationPoint(E));let D=this._zooming||h!==r,S=this._rotating||o!==p,M=this._pitching||m!==l,A=!i.isPaddingEqual(_),R=k=>L=>{if(D&&(k.zoom=ft(r,h,L)),S&&(k.bearing=ft(o,p,L)),M&&(k.pitch=ft(l,m,L)),A&&(k.interpolatePadding(u,_,L),v=k.centerPoint.add(y)),E)k.setLocationAtPoint(E,I);else{let z=k.zoomScale(k.zoom-r),B=h>r?Math.min(2,C):Math.max(.5,C),G=Math.pow(B,1-L),N=k.unproject(b.add(w.mult(L*G)).mult(z));k.setLocationAtPoint(k.renderWorldCopies?N.wrap():N,v)}return e.preloadOnly||this._fireMoveEvents(n),k};if(e.preloadOnly){let k=this._emulate(R,e.duration,i);return this._preloadTiles(k),this}let F={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=D,this._rotating=S,this._pitching=M,this._padding=A,this._easeId=e.easeId,this._prepareEase(n,e.noMoveStart,F),this._ease(R(i),k=>{i.cameraElevationReference==="sea"&&i.recenterOnTerrain(),this._afterEase(n,k)},e),this}_prepareEase(e,n,i={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),n||i.moving||this.fire(new Ce("movestart",e)),this._zooming&&!i.zooming&&this.fire(new Ce("zoomstart",e)),this._rotating&&!i.rotating&&this.fire(new Ce("rotatestart",e)),this._pitching&&!i.pitching&&this.fire(new Ce("pitchstart",e))}_fireMoveEvents(e){this.fire(new Ce("move",e)),this._zooming&&this.fire(new Ce("zoom",e)),this._rotating&&this.fire(new Ce("rotate",e)),this._pitching&&this.fire(new Ce("pitch",e))}_afterEase(e,n){if(this._easeId&&n&&this._easeId===n)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";let i=this._zooming,r=this._rotating,o=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,i&&this.fire(new Ce("zoomend",e)),r&&this.fire(new Ce("rotateend",e)),o&&this.fire(new Ce("pitchend",e)),this.fire(new Ce("moveend",e))}flyTo(e,n){if(this._prefersReducedMotion(e)){let X=Nr(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(X,n)}this.stop(),e=$e({offset:[0,0],speed:1.2,curve:1.42,easing:vo},e);let i=this.transform,r=this.getZoom(),o=this.getBearing(),l=this.getPitch(),u=this.getPadding(),h="zoom"in e?We(+e.zoom,i.minZoom,i.maxZoom):r,p="bearing"in e?this._normalizeBearing(e.bearing,o):o,m="pitch"in e?+e.pitch:l,_="padding"in e?e.padding:i.padding,y=i.zoomScale(h-r),v=Q.convert(e.offset),b=i.centerPoint.add(v),w=i.pointLocation(b),C=pt.convert(e.center||w);this._normalizeCenter(C);let E=i.project(w),I=i.project(C).sub(E),D=e.curve,S=Math.max(i.width,i.height),M=S/y,A=I.mag();if("minZoom"in e){let X=We(Math.min(e.minZoom,r,h),i.minZoom,i.maxZoom),re=S/i.zoomScale(X-r);D=Math.sqrt(re/A*2)}let R=D*D;function F(X){let re=(M*M-S*S+(X?-1:1)*R*R*A*A)/(2*(X?M:S)*R*A);return Math.log(Math.sqrt(re*re+1)-re)}function k(X){return(Math.exp(X)-Math.exp(-X))/2}function L(X){return(Math.exp(X)+Math.exp(-X))/2}let z=F(0),B=function(X){return L(z)/L(z+D*X)},G=function(X){return S*((L(z)*(k(re=z+D*X)/L(re))-k(z))/R)/A;var re},N=(F(1)-z)/D;if(Math.abs(A)<1e-6||!isFinite(N)){if(Math.abs(S-M)<1e-6)return this.easeTo(e,n);let X=M<S?-1:1;N=Math.abs(Math.log(M/S))/D,G=function(){return 0},B=function(re){return Math.exp(X*D*re)}}e.duration="duration"in e?+e.duration:1e3*N/("screenSpeed"in e?+e.screenSpeed/D:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0);let W=o!==p,Y=m!==l,te=!i.isPaddingEqual(_),q=X=>re=>{let se=re*N,oe=1/B(se);X.zoom=re===1?h:r+X.scaleZoom(oe),W&&(X.bearing=ft(o,p,re)),Y&&(X.pitch=ft(l,m,re)),te&&(X.interpolatePadding(u,_,re),b=X.centerPoint.add(v));let ue=re===1?C:X.unproject(E.add(I.mult(G(se))).mult(oe));return X.setLocationAtPoint(X.renderWorldCopies?ue.wrap():ue,b),X._updateCameraOnTerrain(),e.preloadOnly||this._fireMoveEvents(n),X};if(e.preloadOnly){let X=this._emulate(q,e.duration,i);return this._preloadTiles(X),this}return this._zooming=!0,this._rotating=W,this._pitching=Y,this._padding=te,this._prepareEase(n,!1),this._ease(q(i),()=>this._afterEase(n),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(e,n){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){let i=this._onEaseEnd;this._onEaseEnd=void 0,i.call(this,n)}if(!e){let i=this.handlers;i&&i.stop(!1)}return this}_ease(e,n,i){i.animate===!1||i.duration===0?(e(1),n()):(this._easeStart=yt.now(),this._easeOptions=i,this._onEaseFrame=e,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){let e=Math.min((yt.now()-this._easeStart)/this._easeOptions.duration,1),n=this._onEaseFrame;n&&n(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(e,n){e=hs(e,-180,180);let i=Math.abs(e-n);return Math.abs(e-360-n)<i&&(e-=360),Math.abs(e+360-n)<i&&(e+=360),e}_normalizeCenter(e){let n=this.transform;if(n.maxBounds||n.projection.name!=="globe"&&!n.renderWorldCopies)return;let i=e.lng-n.center.lng;e.lng+=i>180?-360:i<-180?360:0}_prefersReducedMotion(e){return this._respectPrefersReducedMotion&&yt.prefersReducedMotion&&!(e&&e.essential)}_emulate(e,n,i){let r=Math.ceil(15*n/1e3),o=[],l=e(i.clone());for(let u=0;u<=r;u++){let h=l(u/r);o.push(h.clone())}return o}}class dA{constructor(e={}){this.options=e,Ri(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(e){let n=this.options&&this.options.compact;return this._map=e,this._container=Sn("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Sn("button","mapboxgl-ctrl-attrib-button",this._container),Sn("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Sn("div","mapboxgl-ctrl-attrib-inner",this._container),n&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),n===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(e,n){let i=this._map._getUIString(`AttributionControl.${n}`);e.removeAttribute("title"),e.firstElementChild&&e.firstElementChild.setAttribute("title",i)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let e=this._editLink;e||(e=this._editLink=this._container.querySelector(".mapbox-improve-map"));let n=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||O.ACCESS_TOKEN}];if(e){let i=n.reduce((r,o,l)=>(o.value&&(r+=`${o.key}=${o.value}${l<n.length-1?"&":""}`),r),"?");e.href=`${O.FEEDBACK_URL}/${i}#${rA(this._map,!0)}`,e.rel="noopener nofollow",this._setElementTitle(e,"MapFeedback")}}_updateData(e){!e||e.sourceDataType!=="metadata"&&e.sourceDataType!=="visibility"&&e.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let e=[];if(this._map.style.stylesheet){let r=this._map.style.stylesheet;this.styleOwner=r.owner,this.styleId=r.id}let n=this._map.style._mergedSourceCaches;for(let r in n){let o=n[r];if(o.used){let l=o.getSource();l.attribution&&e.indexOf(l.attribution)<0&&e.push(l.attribution)}}e.sort((r,o)=>r.length-o.length),e=e.filter((r,o)=>{for(let l=o+1;l<e.length;l++)if(e[l].indexOf(r)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=[...this.options.customAttribution,...e]:e.unshift(this.options.customAttribution));let i=e.join(" | ");i!==this._attribHTML&&(this._attribHTML=i,e.length?(this._innerContainer.innerHTML=i,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class hA{constructor(){Ri(["_updateLogo","_updateCompact"],this)}onAdd(e){this._map=e,this._container=Sn("div","mapboxgl-ctrl");let n=Sn("a","mapboxgl-ctrl-logo");return n.target="_blank",n.rel="noopener nofollow",n.href="https://www.mapbox.com/",n.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),n.setAttribute("rel","noopener nofollow"),this._container.appendChild(n),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(e){e&&e.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;let e=this._map.style._sourceCaches;if(Object.entries(e).length===0)return!0;for(let n in e){let i=e[n].getSource();if(i.hasOwnProperty("mapbox_logo")&&!i.mapbox_logo)return!1}return!0}_updateCompact(){let e=this._container.children;if(e.length){let n=e[0];this._map.getCanvasContainer().offsetWidth<250?n.classList.add("mapboxgl-compact"):n.classList.remove("mapboxgl-compact")}}}class fA{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){let n=++this._id;return this._queue.push({callback:e,id:n,cancelled:!1}),n}remove(e){let n=this._currentlyRunning,i=n?this._queue.concat(n):this._queue;for(let r of i)if(r.id===e)return void(r.cancelled=!0)}run(e=0){let n=this._currentlyRunning=this._queue;this._queue=[];for(let i of n)if(!i.cancelled&&(i.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function pA(t,e,n){if(t=new pt(t.lng,t.lat),e){let i=new pt(t.lng-360,t.lat),r=new pt(t.lng+360,t.lat),o=360*Math.ceil(Math.abs(t.lng-n.center.lng)/360),l=n.locationPoint(t).distSqr(e),u=e.x<0||e.y<0||e.x>n.width||e.y>n.height;n.locationPoint(i).distSqr(e)<l&&(u||Math.abs(i.lng-n.center.lng)<o)?t=i:n.locationPoint(r).distSqr(e)<l&&(u||Math.abs(r.lng-n.center.lng)<o)&&(t=r)}for(;Math.abs(t.lng-n.center.lng)>180;){let i=n.locationPoint(t);if(i.x>=0&&i.y>=0&&i.x<=n.width&&i.y<=n.height)break;t.lng>n.center.lng?t.lng-=360:t.lng+=360}return t}let Ux={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class $x extends yi{constructor(e,n){if(super(),(e instanceof x.HTMLElement||n)&&(e=$e({element:e},n)),Ri(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&e.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=e&&e.occludedOpacity||.2,e&&e.element)this._element=e.element,this._offset=Q.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=Sn("div");let o=41,l=27,u=Bs("svg",{display:"block",height:o*this._scale+"px",width:l*this._scale+"px",viewBox:`0 0 ${l} ${o}`},this._element),h=Bs("radialGradient",{id:"shadowGradient"},Bs("defs",{},u));Bs("stop",{offset:"10%","stop-opacity":.4},h),Bs("stop",{offset:"100%","stop-opacity":.05},h),Bs("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},u),Bs("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},u),Bs("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},u),Bs("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},u),this._offset=Q.convert(e&&e.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",o=>{o.preventDefault()}),this._element.addEventListener("mousedown",o=>{o.preventDefault()});let i=this._element.classList;for(let o in Ux)i.remove(`mapboxgl-marker-anchor-${o}`);i.add(`mapboxgl-marker-anchor-${this._anchor}`);let r=e&&e.className?e.className.trim().split(/\s+/):[];i.add(...r),this._popup=null}addTo(e){return e===this._map||(this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._updateMoving),e.on("moveend",this._update),e.on("remove",this._clearFadeTimer),e._addMarker(this),this.setDraggable(this._draggable),this._update(),e.on("click",this._onMapClick)),this}remove(){let e=this._map;return e&&(e.off("click",this._onMapClick),e.off("move",this._updateMoving),e.off("moveend",this._update),e.off("mousedown",this._addDragHandler),e.off("touchstart",this._addDragHandler),e.off("mouseup",this._onUp),e.off("touchend",this._onUp),e.off("mousemove",this._onMove),e.off("touchmove",this._onMove),e.off("remove",this._clearFadeTimer),e._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=pt.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){let r=Math.sqrt(Math.pow(13.5,2)/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[r,-1*(38.1-13.5+r)],"bottom-right":[-r,-1*(38.1-13.5+r)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=e,e._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(e){let n=e.code,i=e.charCode||e.keyCode;n!=="Space"&&n!=="Enter"&&i!==32&&i!==13||this.togglePopup()}_onMapClick(e){let n=e.originalEvent.target,i=this._element;this._popup&&(n===i||i.contains(n))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){let e=this._popup;return e?(e.isOpen()?(e.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(e.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){let e=this._map,n=this._pos;if(!e||!n)return!1;let i=e.unproject(n),r=e.getFreeCameraOptions();if(!r.position)return!1;let o=r.position.toLngLat();return o.distanceTo(i)<.9*o.distanceTo(this._lngLat)}_evaluateOpacity(){let e=this._map;if(!e)return;let n=this._pos;if(!n||n.x<0||n.x>e.transform.width||n.y<0||n.y>e.transform.height)return void this._clearFadeTimer();let i=e.unproject(n),r;e._showingGlobe()&&wp(e.transform,this._lngLat)?r=0:(r=1-e._queryFogOpacity(i),e.transform._terrainEnabled()&&e.getTerrain()&&this._behindTerrain()&&(r*=this._occludedOpacity)),this._element.style.opacity=`${r}`,this._element.style.pointerEvents=r>0?"auto":"none",this._popup&&this._popup._setOpacity(r),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){let e=this._pos;if(!e||!this._map)return;let n=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${e.x}px,${e.y}px)
            ${Ux[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${n.x}px,${n.y}px)
        `}_calculateXYTransform(){let e=this._pos,n=this._map,i=this.getPitchAlignment();if(!n||!e||i!=="map")return"";if(!n._showingGlobe()){let h=n.getPitch();return h?`rotateX(${h}deg)`:""}let r=ji(eM(n.transform,this._lngLat)),o=e.sub(QI(n.transform)),l=Math.abs(o.x)+Math.abs(o.y);if(l===0)return"";let u=r/l;return`rotateX(${-o.y*u}deg) rotateY(${o.x*u}deg)`}_calculateZTransform(){let e=this._pos,n=this._map;if(!n||!e)return"";let i=0,r=this.getRotationAlignment();if(r==="map")if(n._showingGlobe()){let o=n.project(new pt(this._lngLat.lng,this._lngLat.lat+.001)),l=n.project(new pt(this._lngLat.lng,this._lngLat.lat-.001)).sub(o);i=ji(Math.atan2(l.y,l.x))-90}else i=-n.getBearing();else if(r==="horizon"){let o=ds(4,6,n.getZoom()),l=QI(n.transform);l.y+=o*n.transform.height;let u=e.sub(l),h=ji(Math.atan2(u.y,u.x));i=(h>90?h-270:h+90)*(1-o)}return i+=this._rotation,i?`rotateZ(${i}deg)`:""}_update(e){x.cancelAnimationFrame(this._updateFrameId);let n=this._map;n&&(n.transform.renderWorldCopies&&(this._lngLat=pA(this._lngLat,this._pos,n.transform)),this._pos=n.project(this._lngLat),e===!0?this._updateFrameId=x.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),n._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(n._showingGlobe()||n.getTerrain()||n.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(e){return this._offset=Q.convert(e),this._update(),this}addClassName(e){return this._element.classList.add(e),this}removeClassName(e){return this._element.classList.remove(e),this}toggleClassName(e){return this._element.classList.toggle(e)}_onMove(e){let n=this._map;if(!n)return;let i=this._pointerdownPos,r=this._positionDelta;if(i&&r){if(!this._isDragging){let o=this._clickTolerance||n._clickTolerance;if(e.point.dist(i)<o)return;this._isDragging=!0}this._pos=e.point.sub(r),this._lngLat=n.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new Ce("dragstart"))),this.fire(new Ce("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;let e=this._map;e&&(e.off("mousemove",this._onMove),e.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new Ce("dragend")),this._state="inactive"}_addDragHandler(e){let n=this._map,i=this._pos;n&&i&&this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(i),this._pointerdownPos=e.point,this._state="pending",n.on("mousemove",this._onMove),n.on("touchmove",this._onMove),n.once("mouseup",this._onUp),n.once("touchend",this._onUp))}setDraggable(e){this._draggable=!!e;let n=this._map;return n&&(e?(n.on("mousedown",this._addDragHandler),n.on("touchstart",this._addDragHandler)):(n.off("mousedown",this._addDragHandler),n.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e||"auto",this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(e){return this._occludedOpacity=e||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}let bj={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},wj=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function mA(t=new Q(0,0),e="bottom"){if(typeof t=="number"){let n=Math.round(Math.sqrt(.5*Math.pow(t,2)));switch(e){case"top":return new Q(0,t);case"top-left":return new Q(n,n);case"top-right":return new Q(-n,n);case"bottom":return new Q(0,-t);case"bottom-left":return new Q(n,-n);case"bottom-right":return new Q(-n,-n);case"left":return new Q(t,0);case"right":return new Q(-t,0)}return new Q(0,0)}return t instanceof Q||Array.isArray(t)?Q.convert(t):Q.convert(t[e]||[0,0])}class Cj{constructor(e){this.jumpTo(e)}getValue(e){if(e<=this._startTime)return this._start;if(e>=this._endTime)return this._end;let n=vc((e-this._startTime)/(this._endTime-this._startTime));return this._start*(1-n)+this._end*n}isEasing(e){return e>=this._startTime&&e<=this._endTime}jumpTo(e){this._startTime=-1/0,this._endTime=-1/0,this._start=e,this._end=e}easeTo(e,n,i){this._start=this.getValue(n),this._end=e,this._startTime=n,this._endTime=n+i}}let Ej={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Tj={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1},Ij={showCompass:!0,showZoom:!0,visualizePitch:!1};class Mj{constructor(e,n,i=!1){this._clickTolerance=10,this.element=n,this.mouseRotate=new oA({clickTolerance:e.dragRotate._mouseRotate._clickTolerance}),this.map=e,i&&(this.mousePitch=new sA({clickTolerance:e.dragRotate._mousePitch._clickTolerance})),Ri(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),n.addEventListener("mousedown",this.mousedown),n.addEventListener("touchstart",this.touchstart,{passive:!1}),n.addEventListener("touchmove",this.touchmove),n.addEventListener("touchend",this.touchend),n.addEventListener("touchcancel",this.reset)}down(e,n){this.mouseRotate.mousedown(e,n),this.mousePitch&&this.mousePitch.mousedown(e,n),OC()}move(e,n){let i=this.map,r=this.mouseRotate.mousemoveWindow(e,n),o=r&&r.bearingDelta;if(o&&i.setBearing(i.getBearing()+o),this.mousePitch){let l=this.mousePitch.mousemoveWindow(e,n),u=l&&l.pitchDelta;u&&i.setPitch(i.getPitch()+u)}}off(){let e=this.element;e.removeEventListener("mousedown",this.mousedown),e.removeEventListener("touchstart",this.touchstart,{passive:!1}),e.removeEventListener("touchmove",this.touchmove),e.removeEventListener("touchend",this.touchend),e.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){FC(),x.removeEventListener("mousemove",this.mousemove),x.removeEventListener("mouseup",this.mouseup)}mousedown(e){this.down($e({},e,{ctrlKey:!0,preventDefault:()=>e.preventDefault()}),ld(this.element,e)),x.addEventListener("mousemove",this.mousemove),x.addEventListener("mouseup",this.mouseup)}mousemove(e){this.move(e,ld(this.element,e))}mouseup(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp()}touchstart(e){e.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Rf(this.element,e.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>e.preventDefault()},this._startPos))}touchmove(e){e.targetTouches.length!==1?this.reset():(this._lastPos=Rf(this.element,e.targetTouches)[0],this.move({preventDefault:()=>e.preventDefault()},this._lastPos))}touchend(e){e.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}let Dj={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Sj={maxWidth:100,unit:"metric"},Aj={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Vm={version:T,supported:AC,setRTLTextPlugin:function(t,e,n=!1){if(Ur===x0||Ur===b0||Ur===w0)throw new Error("setRTLTextPlugin cannot be called multiple times.");Ma=yt.resolveURL(t),Ur=x0,C0=e,E0(),n||nT()},getRTLTextPluginStatus:I0,Map:class extends xj{constructor(t){DC.mark(Sf.create);let e=t;if((t=$e({},Tj,t)).minZoom!=null&&t.maxZoom!=null&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(t.minPitch!=null&&t.maxPitch!=null&&t.minPitch>t.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(t.minPitch!=null&&t.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(t.maxPitch!=null&&t.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(t.antialias&&function(n){let i=n.navigator?n.navigator.userAgent:null;return!!function(r){if(ht==null){let o=r.navigator?r.navigator.userAgent:null;ht=!!r.safari||!(!o||!(/\b(iPad|iPhone|iPod)\b/.test(o)||o.match("Safari")&&!o.match("Chrome")))}return ht}(n)&&i&&(i.match("Version/15.4")||i.match("Version/15.5")||i.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))}(x)&&(t.antialias=!1,J("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new ix(t.minZoom,t.maxZoom,t.minPitch,t.maxPitch,t.renderWorldCopies),t),this._interactive=t.interactive,this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=t.preserveDrawingBuffer,this._antialias=t.antialias,this._trackResize=t.trackResize,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles,this._fadeDuration=t.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=t.crossSourceCollisions,this._collectResourceTiming=t.collectResourceTiming,this._language=this._parseLanguage(t.language),this._worldview=t.worldview,this._renderTaskQueue=new fA,this._domRenderTaskQueue=new fA,this._controls=[],this._markers=[],this._popups=[],this._mapId=xc(),this._locale=$e({},Ej,t.locale),this._clickTolerance=t.clickTolerance,this._cooperativeGestures=t.cooperativeGestures,this._performanceMetricsCollection=t.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Cj(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new it(t.transformRequest,t.accessToken,t.testMode),this._silenceAuthErrors=!!t.testMode,this._contextCreateOptions=t.contextCreateOptions?rt({},t.contextCreateOptions):{},typeof t.container=="string"){if(this._container=x.document.getElementById(t.container),!this._container)throw new Error(`Container '${t.container.toString()}' not found.`)}else{if(!(t.container instanceof x.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container}if(this._container.childNodes.length>0&&J("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),t.maxBounds&&this.setMaxBounds(t.maxBounds),Ri(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),x!==void 0&&(this._fullscreenchangeEvent="onfullscreenchange"in x.document?"fullscreenchange":"webkitfullscreenchange",x.addEventListener("online",this._onWindowOnline,!1),x.addEventListener("resize",this._onWindowResize,!1),x.addEventListener("orientationchange",this._onWindowResize,!1),x.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),x.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new vj(this,t),this._localFontFamily=t.localFontFamily,this._localIdeographFontFamily=t.localIdeographFontFamily,(t.style||!t.testMode)&&this.setStyle(t.style||O.DEFAULT_STYLE,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),t.projection&&this.setProjection(t.projection),t.hash&&(this._hash=new $5(typeof t.hash=="string"&&t.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){e.center==null&&e.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch});let n=t.bounds;n&&(this.resize(),this.fitBounds(n,$e({},t.fitBoundsOptions,{duration:0})))}this.resize(),t.attributionControl&&this.addControl(new dA({customAttribution:t.customAttribution})),this._logoControl=new hA,this.addControl(this._logoControl,t.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",n=>{this._update(n.dataType==="style"),this.fire(new Ce(`${n.dataType}data`,n))}),this.on("dataloading",n=>{this.fire(new Ce(`${n.dataType}dataloading`,n))})}_getMapId(){return this._mapId}addControl(t,e){if(e===void 0&&(e=t.getDefaultPosition?t.getDefaultPosition():"top-right"),!t||!t.onAdd)return this.fire(new mt(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));let n=t.onAdd(this);this._controls.push(t);let i=this._controlPositions[e];return e.indexOf("bottom")!==-1?i.insertBefore(n,i.firstChild):i.appendChild(n),this}removeControl(t){if(!t||!t.onRemove)return this.fire(new mt(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));let e=this._controls.indexOf(t);return e>-1&&this._controls.splice(e,1),t.onRemove(this),this}hasControl(t){return this._controls.indexOf(t)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(t){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));let e=!this._moving;return e&&this.fire(new Ce("movestart",t)).fire(new Ce("move",t)),this.fire(new Ce("resize",t)),e&&this.fire(new Ce("moveend",t)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(t){return this.transform.setMaxBounds(Hr.convert(t)),this._update()}setMinZoom(t){if((t=t??-2)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t?this.setZoom(t):this.fire(new Ce("zoomstart")).fire(new Ce("zoom")).fire(new Ce("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(t){if((t=t??22)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t?this.setZoom(t):this.fire(new Ce("zoomstart")).fire(new Ce("zoom")).fire(new Ce("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(t){if((t=t??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t?this.setPitch(t):this.fire(new Ce("pitchstart")).fire(new Ce("pitch")).fire(new Ce("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(t){if((t=t??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t?this.setPitch(t):this.fire(new Ce("pitchstart")).fire(new Ce("pitch")).fire(new Ce("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(t){return this.transform.renderWorldCopies=t,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(t){return t==="auto"?x.navigator.language:Array.isArray(t)?t.length===0?void 0:t.map(e=>e==="auto"?x.navigator.language:e):t}setLanguage(t){let e=this._parseLanguage(t);if(!this.style||e===this._language)return this;this._language=e,this.style.reloadSources();for(let n of this._controls)n._setLanguage&&n._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(t){return this.style&&t!==this._worldview?(this._worldview=t,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(t){return this._lazyInitEmptyStyle(),t?typeof t=="string"&&(t={name:t}):t=null,this._useExplicitProjection=!!t,this._prioritizeAndUpdateProjection(t,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;let t=this.transform,e=t.projection.name,n;e==="globe"&&t.zoom>=Fa?(t.setMercatorFromTransition(),n=!0):e==="mercator"&&t.zoom<Fa&&(t.setProjection({name:"globe"}),n=!0),n&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(t,e){return this._updateProjection(t||e||{name:"mercator"})}_updateProjection(t){let e;return e=t.name==="globe"&&this.transform.zoom>=Fa?this.transform.setMercatorFromTransition():this.transform.setProjection(t),this.style.applyProjectionUpdate(),e&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(t){return this.transform.locationPoint3D(pt.convert(t))}unproject(t){return this.transform.pointLocation3D(Q.convert(t))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(t,e,n){if(t==="mouseenter"||t==="mouseover"){let i=!1,r=l=>{let u=e.filter(p=>this.getLayer(p)),h=u.length?this.queryRenderedFeatures(l.point,{layers:u}):[];h.length?i||(i=!0,n.call(this,new ao(t,this,l.originalEvent,{features:h}))):i=!1},o=()=>{i=!1};return{layers:new Set(e),listener:n,delegates:{mousemove:r,mouseout:o}}}if(t==="mouseleave"||t==="mouseout"){let i=!1,r=l=>{let u=e.filter(h=>this.getLayer(h));(u.length?this.queryRenderedFeatures(l.point,{layers:u}):[]).length?i=!0:i&&(i=!1,n.call(this,new ao(t,this,l.originalEvent)))},o=l=>{i&&(i=!1,n.call(this,new ao(t,this,l.originalEvent)))};return{layers:new Set(e),listener:n,delegates:{mousemove:r,mouseout:o}}}{let i=r=>{let o=e.filter(u=>this.getLayer(u)),l=o.length?this.queryRenderedFeatures(r.point,{layers:o}):[];l.length&&(r.features=l,n.call(this,r),delete r.features)};return{layers:new Set(e),listener:n,delegates:{[t]:i}}}}on(t,e,n){if(n===void 0)return super.on(t,e);if(Array.isArray(e)||(e=[e]),e){for(let r of e)if(!this._isValidId(r))return this}let i=this._createDelegatedListener(t,e,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(i);for(let r in i.delegates)this.on(r,i.delegates[r]);return this}once(t,e,n){if(n===void 0)return super.once(t,e);if(Array.isArray(e)||(e=[e]),e){for(let r of e)if(!this._isValidId(r))return this}let i=this._createDelegatedListener(t,e,n);for(let r in i.delegates)this.once(r,i.delegates[r]);return this}off(t,e,n){if(n===void 0)return super.off(t,e);e=new Set(Array.isArray(e)?e:[e]);for(let o of e)if(!this._isValidId(o))return this;let i=(o,l)=>{if(o.size!==l.size)return!1;for(let u of o)if(!l.has(u))return!1;return!0},r=this._delegatedListeners?this._delegatedListeners[t]:void 0;return r&&(o=>{for(let l=0;l<o.length;l++){let u=o[l];if(u.listener===n&&i(u.layers,e)){for(let h in u.delegates)this.off(h,u.delegates[h]);return o.splice(l,1),this}}})(r),this}queryRenderedFeatures(t,e){if(!this.style)return[];if(e!==void 0||t===void 0||t instanceof Q||Array.isArray(t)||(e=t,t=void 0),t=t||[[0,0],[this.transform.width,this.transform.height]],(e=e||{}).layers&&Array.isArray(e.layers)){for(let n of e.layers)if(!this._isValidId(n))return[]}return this.style.queryRenderedFeatures(t,e,this.transform)}querySourceFeatures(t,e){return this._isValidId(t)?this.style.querySourceFeatures(t,e):[]}isPointOnSurface(t){let{name:e}=this.transform.projection;return e!=="globe"&&e!=="mercator"&&J(`${e} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(Q.convert(t))}setStyle(t,e){return(e=$e({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},e)).diff!==!1&&e.localIdeographFontFamily===this._localIdeographFontFamily&&e.localFontFamily===this._localFontFamily&&this.style&&t?(this._diffStyle(t,e),this):(this._localIdeographFontFamily=e.localIdeographFontFamily,this._localFontFamily=e.localFontFamily,this._updateStyle(t,e))}_getUIString(t){let e=this._locale[t];if(e==null)throw new Error(`Missing UI string '${t}'`);return e}_updateStyle(t,e){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),t&&(this.style=new es(this,e||{}),this.style.setEventedParent(this,{style:this.style}),typeof t=="string"?this.style.loadURL(t):this.style.loadJSON(t)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new es(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(t,e){if(typeof t=="string"){let n=this._requestManager.normalizeStyleURL(t),i=this._requestManager.transformRequest(n,fe.Style);Me(i,(r,o)=>{r?this.fire(new mt(r)):o&&this._updateDiff(o,e)})}else typeof t=="object"&&this._updateDiff(t,e)}_updateDiff(t,e){try{this.style.setState(t)&&this._update(!0)}catch(n){J(`Unable to perform style diff: ${n.message||n.error||n}.  Rebuilding the style from scratch.`),this._updateStyle(t,e)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(J("There is no style added to the map."),!1)}_isValidId(t){return t==null?(this.fire(new mt(new Error("IDs can't be empty."))),!1):!oT(t)||(this.fire(new mt(new Error(`IDs can't contain special symbols: "${t}".`))),!1)}addSource(t,e){return this._isValidId(t)?(this._lazyInitEmptyStyle(),this.style.addSource(t,e),this._update(!0)):this}isSourceLoaded(t){return!!this._isValidId(t)&&!!this.style&&this.style._isSourceCacheLoaded(t)}areTilesLoaded(){let t=this.style&&this.style._sourceCaches;for(let e in t){let n=t[e]._tiles;for(let i in n){let r=n[i];if(r.state!=="loaded"&&r.state!=="errored")return!1}}return!0}addSourceType(t,e,n){this._lazyInitEmptyStyle(),this.style.addSourceType(t,e,n)}removeSource(t){return this._isValidId(t)?(this.style.removeSource(t),this._updateTerrain(),this._update(!0)):this}getSource(t){return this._isValidId(t)?this.style.getOwnSource(t):null}addImage(t,e,{pixelRatio:n=1,sdf:i=!1,stretchX:r,stretchY:o,content:l}={}){if(this._lazyInitEmptyStyle(),e instanceof x.HTMLImageElement||x.ImageBitmap&&e instanceof x.ImageBitmap){let{width:u,height:h,data:p}=yt.getImageData(e);this.style.addImage(t,{data:new gi({width:u,height:h},p),pixelRatio:n,stretchX:r,stretchY:o,content:l,sdf:i,version:0})}else if(e.width===void 0||e.height===void 0)this.fire(new mt(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{let{width:u,height:h}=e,p=e;this.style.addImage(t,{data:new gi({width:u,height:h},new Uint8Array(p.data)),pixelRatio:n,stretchX:r,stretchY:o,content:l,sdf:i,version:0,userImage:p}),p.onAdd&&p.onAdd(this,t)}}updateImage(t,e){this._lazyInitEmptyStyle();let n=this.style.getImage(t);if(!n)return void this.fire(new mt(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));let i=e instanceof x.HTMLImageElement||x.ImageBitmap&&e instanceof x.ImageBitmap?yt.getImageData(e):e,{width:r,height:o}=i;r!==void 0&&o!==void 0?r===n.data.width&&o===n.data.height?(n.data.replace(i.data,!(e instanceof x.HTMLImageElement||x.ImageBitmap&&e instanceof x.ImageBitmap)),this.style.updateImage(t,n)):this.fire(new mt(new Error(`The width and height of the updated image (${r}, ${o})
                must be that same as the previous version of the image
                (${n.data.width}, ${n.data.height})`))):this.fire(new mt(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(t){return t?!!this.style&&!!this.style.getImage(t):(this.fire(new mt(new Error("Missing required image id"))),!1)}removeImage(t){this.style.removeImage(t)}loadImage(t,e){St(this._requestManager.transformRequest(t,fe.Image),(n,i)=>{e(n,i instanceof x.HTMLImageElement?yt.getImageData(i):i)})}listImages(){return this.style.listImages()}addModel(t,e){this._lazyInitEmptyStyle(),this.style.addModel(t,e)}hasModel(t){return t?this.style.hasModel(t):(this.fire(new mt(new Error("Missing required model id"))),!1)}removeModel(t){this.style.removeModel(t)}listModels(){return this.style.listModels()}addLayer(t,e){return this._isValidId(t.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(t,e),this._update(!0)):this}moveLayer(t,e){return this._isValidId(t)?(this.style.moveLayer(t,e),this._update(!0)):this}removeLayer(t){return this._isValidId(t)?(this.style.removeLayer(t),this._update(!0)):this}getLayer(t){return this._isValidId(t)?this.style.getOwnLayer(t):null}setLayerZoomRange(t,e,n){return this._isValidId(t)?(this.style.setLayerZoomRange(t,e,n),this._update(!0)):this}setFilter(t,e,n={}){return this._isValidId(t)?(this.style.setFilter(t,e,n),this._update(!0)):this}getFilter(t){return this._isValidId(t)?this.style.getFilter(t):null}setPaintProperty(t,e,n,i={}){return this._isValidId(t)?(this.style.setPaintProperty(t,e,n,i),this._update(!0)):this}getPaintProperty(t,e){return this._isValidId(t)?this.style.getPaintProperty(t,e):null}setLayoutProperty(t,e,n,i={}){return this._isValidId(t)?(this.style.setLayoutProperty(t,e,n,i),this._update(!0)):this}getLayoutProperty(t,e){return this._isValidId(t)?this.style.getLayoutProperty(t,e):null}getConfigProperty(t,e){return this.style.getConfigProperty(t,e)}setConfigProperty(t,e,n){return this.style.setConfigProperty(t,e,n),this._update(!0)}setLights(t){if(this._lazyInitEmptyStyle(),t&&t.length===1&&t[0].type==="flat"){let e=t[0];e.properties?this.style.setFlatLight(e.properties,e.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(t),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){let t=this.style.getLights()||[];return t.length===0&&t.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),t}setLight(t,e={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:t}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(t){return this._lazyInitEmptyStyle(),!t&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(t),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(t){return this._lazyInitEmptyStyle(),this.style.setFog(t),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setCamera(t){return this.style.setCamera(t),this._triggerCameraUpdate(t)}_triggerCameraUpdate(t){return this._update(this.transform.setOrthographicProjectionAtLowPitch(t["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(t){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(pt.convert(t),this.transform):0}setFeatureState(t,e){return this._isValidId(t.source)?(this.style.setFeatureState(t,e),this._update()):this}removeFeatureState(t,e){return this._isValidId(t.source)?(this.style.removeFeatureState(t,e),this._update()):this}getFeatureState(t){return this._isValidId(t.source)?this.style.getFeatureState(t):null}_updateContainerDimensions(){if(!this._container)return;let t=this._container.getBoundingClientRect().width||400,e=this._container.getBoundingClientRect().height||300,n,i,r,o=this._container;for(;o&&(!i||!r);){let l=x.getComputedStyle(o).transform;l&&l!=="none"&&(n=l.match(/matrix.*\((.+)\)/)[1].split(", "),n[0]&&n[0]!=="0"&&n[0]!=="1"&&(i=n[0]),n[3]&&n[3]!=="0"&&n[3]!=="1"&&(r=n[3])),o=o.parentElement}this._containerWidth=i?Math.abs(t/i):t,this._containerHeight=r?Math.abs(e/r):e}_detectMissingCSS(){x.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&J("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){let t=this._container;t.classList.add("mapboxgl-map"),(this._missingCSSCanary=Sn("div","mapboxgl-canary",t)).style.visibility="hidden",this._detectMissingCSS();let e=this._canvasContainer=Sn("div","mapboxgl-canvas-container",t);this._canvas=Sn("canvas","mapboxgl-canvas",e),this._interactive&&(e.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);let n=this._controlContainer=Sn("div","mapboxgl-control-container",t),i=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(r=>{i[r]=Sn("div",`mapboxgl-ctrl-${r}`,n)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(t,e){let n=yt.devicePixelRatio||1;this._canvas.width=n*Math.ceil(t),this._canvas.height=n*Math.ceil(e),this._canvas.style.width=`${t}px`,this._canvas.style.height=`${e}px`}_addMarker(t){this._markers.push(t)}_removeMarker(t){let e=this._markers.indexOf(t);e!==-1&&this._markers.splice(e,1)}_addPopup(t){this._popups.push(t)}_removePopup(t){let e=this._popups.indexOf(t);e!==-1&&this._popups.splice(e,1)}_setupPainter(){let t=$e({},AC.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),e=this._canvas.getContext("webgl2",t);e?(MC(e,!0),this.painter=new F5(e,this._contextCreateOptions,this.transform),this.on("data",n=>{n.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),Z.testSupport(e)):this.fire(new mt(new Error("Failed to initialize WebGL")))}_contextLost(t){t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new Ce("webglcontextlost",{originalEvent:t}))}_contextRestored(t){this._setupPainter(),this.resize(),this._update(),this.fire(new Ce("webglcontextrestored",{originalEvent:t}))}_onMapScroll(t){if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(t){return this.style?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(t){return this._update(),this._renderTaskQueue.add(t)}_cancelRenderFrame(t){this._renderTaskQueue.remove(t)}_requestDomTask(t){!this.loaded()||this.loaded()&&!this.isMoving()?t():this._domRenderTaskQueue.add(t)}_render(t){let e;this.fire(new Ce("renderstart"));let n=this.painter.context.extTimerQuery,i=yt.now(),r=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(e=r.createQuery(),r.beginQuery(n.TIME_ELAPSED_EXT,e)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],x.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],x.performance.now())),this._renderTaskQueue.run(t),this._domRenderTaskQueue.run(t),this._removed)return;this._updateProjectionTransition();let o=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;let h=this.transform.zoom,p=this.transform.pitch,m=yt.now(),_=new Hn(h,{now:m,fadeDuration:o,pitch:p,transition:this.style.transition});this.style.update(_)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let l=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),l=this._updateAverageElevation(i),this.style.updateSources(this.transform),this._forceMarkerAndPopupUpdate()):l=this._updateAverageElevation(i),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,o,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:o,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new Ce("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new Ce("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),e){let h=yt.now()-i;r.endQuery(n.TIME_ELAPSED_EXT),setTimeout(()=>{let p=r.getQueryParameter(e,r.QUERY_RESULT)/1e6;r.deleteQuery(e),this.fire(new Ce("gpu-timing-frame",{cpuTime:h,gpuTime:p})),x.performance.mark("frame-gpu",{startTime:i,detail:{gpuTime:p}})},50)}if(this.listens("gpu-timing-layer")){let h=this.painter.collectGpuTimers();setTimeout(()=>{let p=this.painter.queryGpuTimers(h);this.fire(new Ce("gpu-timing-layer",{layerTimes:p}))},50)}if(this.listens("gpu-timing-deferred-render")){let h=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{let p=this.painter.queryGpuTimeDeferredRender(h);this.fire(new Ce("gpu-timing-deferred-render",{gpuTime:p}))},50)}let u=this._sourcesDirty||this._styleDirty||this._placementDirty||l;if(u||this._repaint)this.triggerRepaint();else{let h=!this.isMoving()&&this.loaded();if(h&&(l=this._updateAverageElevation(i,!0)),l)this.triggerRepaint();else if(this._triggerFrame(!1),h&&(this.fire(new Ce("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){let p=this._calculateSpeedIndex();this.fire(new Ce("speedindexcompleted",{speedIndex:p})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||u||(this._fullyLoaded=!0,DC.mark(Sf.fullLoad),this._performanceMetricsCollection&&mL(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(t){for(let e of this._markers)t&&!this.getRenderWorldCopies()&&(e._lngLat=e._lngLat.wrap()),e._update();for(let e of this._popups)!t||this.getRenderWorldCopies()||e._trackPointer||(e._lngLat=e._lngLat.wrap()),e._update()}_updateAverageElevation(t,e=!1){let n=r=>(this.transform.averageElevation=r,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&n(0);let i=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(i||(e||t-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(t)){let r=this.transform.averageElevation,o=this.transform.sampleAverageElevation();this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(o)?o=0:this._averageElevationLastSampledAt=t;let l=Math.abs(r-o);if(l>1){if(this._isInitialLoad||i)return this._averageElevation.jumpTo(o),n(o);this._averageElevation.easeTo(o,t,300)}else if(l>1e-4)return this._averageElevation.jumpTo(o),n(o)}return!!this._averageElevation.isEasing(t)&&n(this._averageElevation.getValue(t))}_authenticate(){gL(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,t=>{if(t&&(t.message===wn||t.status===401)){let e=this.painter.context.gl;MC(e,!1),this._logoControl instanceof hA&&this._logoControl._updateLogo(),e&&e.clear(e.DEPTH_BUFFER_BIT|e.COLOR_BUFFER_BIT|e.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new mt(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),pL(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){let t=this._isDragging();this.painter.updateTerrain(this.style,t)}_calculateSpeedIndex(){let t=this.painter.canvasCopy(),e=this.painter.getCanvasCopiesAndTimestamps();e.timeStamps.push(performance.now());let n=this.painter.context.gl,i=n.createFramebuffer();function r(o){n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,o,0);let l=new Uint8Array(n.drawingBufferWidth*n.drawingBufferHeight*4);return n.readPixels(0,0,n.drawingBufferWidth,n.drawingBufferHeight,n.RGBA,n.UNSIGNED_BYTE,l),l}return n.bindFramebuffer(n.FRAMEBUFFER,i),this._canvasPixelComparison(r(t),e.canvasCopies.map(r),e.timeStamps)}_canvasPixelComparison(t,e,n){let i=n[1]-n[0],r=t.length/4;for(let o=0;o<e.length;o++){let l=e[o],u=0;for(let h=0;h<l.length;h+=4)l[h]===t[h]&&l[h+1]===t[h+1]&&l[h+2]===t[h+2]&&l[h+3]===t[h+3]&&(u+=1);i+=(n[o+2]-n[o+1])*(1-u/r)}return i}remove(){this._hash&&this._hash.remove();for(let e of this._controls)e.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),x!==void 0&&(x.removeEventListener("resize",this._onWindowResize,!1),x.removeEventListener("orientationchange",this._onWindowResize,!1),x.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),x.removeEventListener("online",this._onWindowOnline,!1),x.removeEventListener("visibilitychange",this._onVisibilityChange,!1));let t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Df.delete(this.painter.context.gl),this._removed=!0,this.fire(new Ce("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(t){this._renderNextFrame=this._renderNextFrame||t,this.style&&!this._frame&&(this._frame=yt.frame(e=>{let n=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,n&&this._render(e)}))}_preloadTiles(t){return vl(this.style?Object.values(this.style._sourceCaches):[],(e,n)=>e._preloadTiles(t,n),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(t){this._trackResize&&this.resize({originalEvent:t})._update()}_onVisibilityChange(){x.document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(t){this._showTerrainWireframe!==t&&(this._showTerrainWireframe=t,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(t){this._showLayers2DWireframe!==t&&(this._showLayers2DWireframe=t,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(t){this._showLayers3DWireframe!==t&&(this._showLayers3DWireframe=t,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(t){this._speedIndexTiming!==t&&(this._speedIndexTiming=t,this._update())}get showPadding(){return!!this._showPadding}set showPadding(t){this._showPadding!==t&&(this._showPadding=t,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())}get repaint(){return!!this._repaint}set repaint(t){this._repaint!==t&&(this._repaint=t,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(t){this._vertices=t,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(t){this._showTileAABBs!==t&&(this._showTileAABBs=t,t&&this._update())}_setCacheLimits(t,e){(function(n,i){cr=n,Mr=i})(t,e)}get version(){return T}},NavigationControl:class{constructor(t){this.options=$e({},Ij,t),this._container=Sn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(Ri(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",e=>{this._map&&this._map.zoomIn({},{originalEvent:e})}),Sn("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",e=>{this._map&&this._map.zoomOut({},{originalEvent:e})}),Sn("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(Ri(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",e=>{let n=this._map;n&&(this.options.visualizePitch?n.resetNorthPitch({},{originalEvent:e}):n.resetNorth({},{originalEvent:e}))}),this._compassIcon=Sn("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){let t=this._map;if(!t)return;let e=t.getZoom(),n=e===t.getMaxZoom(),i=e===t.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=i,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",i.toString())}_rotateCompassArrow(){let t=this._map;if(!t)return;let e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(t.transform.pitch*(Math.PI/180)),.5)}) rotateX(${t.transform.pitch}deg) rotateZ(${t.transform.angle*(180/Math.PI)}deg)`:`rotate(${t.transform.angle*(180/Math.PI)}deg)`;t._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=e)})}onAdd(t){return this._map=t,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),t.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&t.on("pitch",this._rotateCompassArrow),t.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Mj(t,this._compass,this.options.visualizePitch)),this._container}onRemove(){let t=this._map;t&&(this._container.remove(),this.options.showZoom&&t.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&t.off("pitch",this._rotateCompassArrow),t.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(t,e){let n=Sn("button",t,this._container);return n.type="button",n.addEventListener("click",e),n}_setButtonTitle(t,e){if(!this._map)return;let n=this._map._getUIString(`NavigationControl.${e}`);t.setAttribute("aria-label",n),t.firstElementChild&&t.firstElementChild.setAttribute("title",n)}},GeolocateControl:class extends yi{constructor(t){super(),this.options=$e({geolocation:x.navigator.geolocation},Dj,t),Ri(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=iA(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(t){return this._map=t,this._container=Sn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(t){let e=(n=!!this.options.geolocation)=>{this._supportsGeolocation=n,t(n)};this._supportsGeolocation!==void 0?t(this._supportsGeolocation):x.navigator.permissions!==void 0?x.navigator.permissions.query({name:"geolocation"}).then(n=>e(n.state!=="denied")).catch(()=>e()):e()}_isOutOfMapMaxBounds(t){let e=this._map.getMaxBounds(),n=t.coords;return!!e&&(n.longitude<e.getWest()||n.longitude>e.getEast()||n.latitude<e.getSouth()||n.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(t){if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new Ce("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(t),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(t),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new Ce("geolocate",t)),this._finish()}}_updateCamera(t){let e=new pt(t.coords.longitude,t.coords.latitude),n=t.coords.accuracy,i=$e({bearing:this._map.getBearing()},this.options.fitBoundsOptions);this._map.fitBounds(e.toBounds(n),i,{geolocateSource:!0})}_updateMarker(t){if(t){let e=new pt(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(e).addTo(this._map),this._userLocationDotMarker.setLngLat(e).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){let t=this._map.transform,e=Cn(1,t._center.lat)*t.worldSize,n=Math.ceil(2*this._accuracy*e);this._circleElement.style.width=`${n}px`,this._circleElement.style.height=`${n}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(t){if(this._map){if(this.options.trackUserLocation)if(t.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;let e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(t.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new Ce("error",t)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(t){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=Sn("button","mapboxgl-ctrl-geolocate",this._container),Sn("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",t===!1){J("Geolocation support is not available so the GeolocateControl will be disabled.");let e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}else{let e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Sn("div","mapboxgl-user-location"),this._dotElement.appendChild(Sn("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Sn("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new $x({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Sn("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new $x({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",e=>{e.geolocateSource||this._watchState!=="ACTIVE_LOCK"||e.originalEvent&&e.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new Ce("trackuserlocationend")))})}}_onDeviceOrientation(t){this._userLocationDotMarker&&(t.webkitCompassHeading?this._heading=t.webkitCompassHeading:t.absolute===!0&&(this._heading=-1*t.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return J("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new Ce("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new Ce("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new Ce("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let t;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(t={maximumAge:6e5,timeout:0},this._noTimeout=!0):(t=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,t),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){let t=()=>{x.addEventListener("ondeviceorientationabsolute"in x?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};x.DeviceMotionEvent!==void 0&&typeof x.DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(e=>{e==="granted"&&t()}).catch(console.error):t()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),x.removeEventListener("deviceorientation",this._onDeviceOrientation),x.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:dA,ScaleControl:class{constructor(t){this.options=$e({},Sj,t),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),Ri(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){let t=this.options.maxWidth||100,e=this._map,n=e._containerHeight/2,i=e._containerWidth/2-t/2,r=e.unproject([i,n]),o=e.unproject([i+t,n]),l=r.distanceTo(o);if(this.options.unit==="imperial"){let u=3.2808*l;u>5280?this._setScale(t,u/5280,"mile"):this._setScale(t,u,"foot")}else this.options.unit==="nautical"?this._setScale(t,l/1852,"nautical-mile"):l>=1e3?this._setScale(t,l/1e3,"kilometer"):this._setScale(t,l,"meter")}_setScale(t,e,n){this._map._requestDomTask(()=>{let i=function(o){let l=Math.pow(10,`${Math.floor(o)}`.length-1),u=o/l;return u=u>=10?10:u>=5?5:u>=3?3:u>=2?2:u>=1?1:function(h){let p=Math.pow(10,Math.ceil(-Math.log(h)/Math.LN10));return Math.round(h*p)/p}(u),l*u}(e),r=i/e;this._container.innerHTML=this._isNumberFormatSupported&&n!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:n}).format(i):`${i}&nbsp;${Aj[n]}`,this._container.style.width=t*r+"px"})}onAdd(t){return this._map=t,this._language=t.getLanguage(),this._container=Sn("div","mapboxgl-ctrl mapboxgl-ctrl-scale",t.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(t){this._language=t,this._update()}setUnit(t){this.options.unit=t,this._update()}},FullscreenControl:class{constructor(t){this._fullscreen=!1,t&&t.container&&(t.container instanceof x.HTMLElement?this._container=t.container:J("Full screen control 'container' must be a DOM element.")),Ri(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in x.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in x.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(t){return this._map=t,this._container||(this._container=this._map.getContainer()),this._controlContainer=Sn("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",J("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,x.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!x.document.fullscreenEnabled&&!x.document.webkitFullscreenEnabled)}_setupUI(){let t=this._fullscreenButton=Sn("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Sn("span","mapboxgl-ctrl-icon",t).setAttribute("aria-hidden","true"),t.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),x.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){let t=this._getTitle();this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",t)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(x.document.fullscreenElement||x.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?x.document.exitFullscreen?x.document.exitFullscreen():x.document.webkitCancelFullScreen&&x.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends yi{constructor(t){super(),this.options=$e(Object.create(bj),t),Ri(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(t&&t.className?t.className.trim().split(/\s+/):[])}addTo(t){return this._map&&this.remove(),this._map=t,this.options.closeOnClick&&t.on("preclick",this._onClose),this.options.closeOnMove&&t.on("move",this._onClose),t.on("remove",this.remove),this._update(),t._addPopup(this),this._focusFirstElement(),this._trackPointer?(t.on("mousemove",this._onMouseEvent),t.on("mouseup",this._onMouseEvent),t._canvasContainer.classList.add("mapboxgl-track-pointer")):t.on("move",this._update),this.fire(new Ce("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);let t=this._map;return t&&(t.off("move",this._update),t.off("move",this._onClose),t.off("preclick",this._onClose),t.off("click",this._onClose),t.off("remove",this.remove),t.off("mousemove",this._onMouseEvent),t.off("mouseup",this._onMouseEvent),t.off("drag",this._onMouseEvent),t._canvasContainer&&t._canvasContainer.classList.remove("mapboxgl-track-pointer"),t._removePopup(this),this._map=void 0),this.fire(new Ce("close")),this}getLngLat(){return this._lngLat}setLngLat(t){this._lngLat=pt.convert(t),this._pos=null,this._trackPointer=!1,this._update();let e=this._map;return e&&(e.on("move",this._update),e.off("mousemove",this._onMouseEvent),e._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();let t=this._map;return t&&(t.off("move",this._update),t.on("mousemove",this._onMouseEvent),t.on("drag",this._onMouseEvent),t._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(t){return this.setDOMContent(x.document.createTextNode(t))}setHTML(t){let e=x.document.createDocumentFragment(),n=x.document.createElement("body"),i;for(n.innerHTML=t;i=n.firstChild,i;)e.appendChild(i);return this.setDOMContent(e)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(t){return this.options.maxWidth=t,this._update(),this}setDOMContent(t){let e=this._content;if(e)for(;e.hasChildNodes();)e.firstChild&&e.removeChild(e.firstChild);else e=this._content=Sn("div","mapboxgl-popup-content",this._container||void 0);if(e.appendChild(t),this.options.closeButton){let n=this._closeButton=Sn("button","mapboxgl-popup-close-button",e);n.type="button",n.setAttribute("aria-label","Close popup"),n.setAttribute("aria-hidden","true"),n.innerHTML="&#215;",n.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(t){return this._classList.add(t),this._updateClassList(),this}removeClassName(t){return this._classList.delete(t),this._updateClassList(),this}setOffset(t){return this.options.offset=t,this._update(),this}toggleClassName(t){let e;return this._classList.delete(t)?e=!1:(this._classList.add(t),e=!0),this._updateClassList(),e}_onMouseEvent(t){this._update(t.point)}_getAnchor(t){if(this.options.anchor)return this.options.anchor;let e=this._map,n=this._container,i=this._pos;if(!e||!n||!i)return"bottom";let r=n.offsetWidth,o=n.offsetHeight,l=i.x<r/2,u=i.x>e.transform.width-r/2;if(i.y+t<o)return l?"top-left":u?"top-right":"top";if(i.y>e.transform.height-o){if(l)return"bottom-left";if(u)return"bottom-right"}return l?"left":u?"right":"bottom"}_updateClassList(){let t=this._container;if(!t)return;let e=[...this._classList];e.push("mapboxgl-popup"),this._anchor&&e.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&e.push("mapboxgl-popup-track-pointer"),t.className=e.join(" ")}_update(t){let e=this._map,n=this._content;if(!e||!this._lngLat&&!this._trackPointer||!n)return;let i=this._container;if(i||(i=this._container=Sn("div","mapboxgl-popup",e.getContainer()),this._tip=Sn("div","mapboxgl-popup-tip",i),i.appendChild(n)),this.options.maxWidth&&i.style.maxWidth!==this.options.maxWidth&&(i.style.maxWidth=this.options.maxWidth),e.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=pA(this._lngLat,this._pos,e.transform)),!this._trackPointer||t){let r=this._pos=this._trackPointer&&t?t:e.project(this._lngLat),o=mA(this.options.offset),l=this._anchor=this._getAnchor(o.y),u=mA(this.options.offset,l),h=r.add(u).round();e._requestDomTask(()=>{this._container&&l&&(this._container.style.transform=`${Ux[l]} translate(${h.x}px,${h.y}px)`)})}if(!this._marker&&e._showingGlobe()){let r=wp(e.transform,this._lngLat)?0:1;this._setOpacity(r)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;let t=this._container.querySelector(wj);t&&t.focus()}_onClose(){this.remove()}_setOpacity(t){this._container&&(this._container.style.opacity=`${t}`),this._content&&(this._content.style.pointerEvents=t?"auto":"none")}},Marker:$x,Style:es,LngLat:pt,LngLatBounds:Hr,Point:Q,MercatorCoordinate:Gt,FreeCameraOptions:ID,Evented:yi,config:O,prewarm:function(){ch().acquire(fx)},clearPrewarmedResources:function(){let t=lh;t&&(t.isPreloaded()&&t.numActive()===1?(t.release(fx),lh=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return O.ACCESS_TOKEN},set accessToken(t){O.ACCESS_TOKEN=t},get baseApiUrl(){return O.API_URL},set baseApiUrl(t){O.API_URL=t},get workerCount(){return du.workerCount},set workerCount(t){du.workerCount=t},get maxParallelImageRequests(){return O.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(t){O.MAX_PARALLEL_IMAGE_REQUESTS=t},clearStorage(t){(function(e){if(!Cc())return;let n=x.caches.delete(Nn);e&&n.catch(e).then(()=>e())})(t)},workerUrl:"",workerClass:null,get dracoUrl(){return jS()},set dracoUrl(t){(function(e){px=yt.resolveURL(e),mx||(mx=new gm(ch(),new yi)),mx.broadcast("setDracoUrl",px)})(t)},setNow:yt.setNow,restoreNow:yt.restoreNow};g.A=RS,g.D=Vp,g.E=le,g.F=Lv,g.K=Em,g.O=Jt,g.P=Q,g.T=KD,g.V=kp,g.a=Fp,g.b=DM,g.c=pm,g.d=class extends yi{constructor(t,e,n,i,r,o){super(),this.actor=t,this.layerIndex=e,this.availableImages=n,this.loadVectorData=r||BS,this.loading={},this.loaded={},this.deduped=new zS(t.scheduler),this.isSpriteLoaded=i,this.scheduler=t.scheduler,this.brightness=o}loadTile(t,e){let n=t.uid,i=t&&t.request,r=i&&i.collectResourceTiming,o=this.loading[n]=new Y4(t);o.abort=this.loadVectorData(t,(l,u)=>{let h=!this.loading[n];if(delete this.loading[n],h||l||!u)return o.status="done",h||(this.loaded[n]=o),e(l);let p=u.rawData,m={};u.expires&&(m.expires=u.expires),u.cacheControl&&(m.cacheControl=u.cacheControl),o.vectorTile=u.vectorTile||new Fv(new Bp(p));let _=()=>{o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,(y,v)=>{if(y||!v)return e(y);let b={};if(r){let w=SC(i);w.length>0&&(b.resourceTiming=JSON.parse(JSON.stringify(w)))}e(null,$e({rawTileData:p.slice(0)},v,m,b))})};this.isSpriteLoaded?_():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(_,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):_()}),this.loaded=this.loaded||{},this.loaded[n]=o})}reloadTile(t,e){let n=this.loaded,i=t.uid,r=this;if(n&&n[i]){let o=n[i];o.showCollisionBoxes=t.showCollisionBoxes,o.projection=t.projection,o.brightness=t.brightness,o.tileTransform=zl(t.tileID.canonical,t.projection),o.extraShadowCaster=t.extraShadowCaster;let l=(u,h)=>{let p=o.reloadCallback;p&&(delete o.reloadCallback,o.parse(o.vectorTile,r.layerIndex,this.availableImages,r.actor,p)),e(u,h)};o.status==="parsing"?o.reloadCallback=l:o.status==="done"&&(o.vectorTile?o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,l):l())}else e(null,void 0)}abortTile(t,e){let n=t.uid,i=this.loading[n];i&&(i.abort&&i.abort(),delete this.loading[n]),e()}removeTile(t,e){let n=this.loaded,i=t.uid;n&&n[i]&&delete n[i],e()}},g.e=Ea,g.f=SC,g.g=tt,g.h=Me,g.i=Oe,g.j=function(t,e){let n=bx(t);for(let i of n){for(let r of i.meshes)sV(r);i.lights&&(i.lightMeshIndex=i.meshes.length,i.meshes.push(aV(i.lights,e)))}return n},g.k=Hn,g.l=function(t){let e=0;if(new Uint32Array(t,0,1)[0]!==$S){let n=new Uint32Array(t,0,7),[,,i,r,o,l]=n;e=n.byteLength+r+o+l+o,(i!==t.byteLength||e>=t.byteLength)&&J("Invalid b3dm header information.")}return WS(t,e)},g.m=Xp,g.n=Eo,g.o=Ce,g.p=Pi,g.q=function(t){zr(),Dr&&Dr.then(e=>{e.keys().then(n=>{for(let i=0;i<n.length-t;i++)e.delete(n[i])})})},g.r=JS,g.s=Vm,g.t=zd,g.v=xl,g.w=x}),c(["./shared"],function(g){"use strict";function x(Te){if(typeof Te=="number"||typeof Te=="boolean"||typeof Te=="string"||Te==null)return JSON.stringify(Te);if(Array.isArray(Te)){let H="[";for(let J of Te)H+=`${x(J)},`;return`${H}]`}let V="{";for(let H of Object.keys(Te).sort())V+=`${H}:${x(Te[H])},`;return`${V}}`}function T(Te){let V="";for(let H of g.r)V+=`/${x(Te[H])}`;return V}class P{constructor(V){this.keyCache={},this._layers={},this._layerConfigs={},V&&this.replace(V)}replace(V,H){this._layerConfigs={},this._layers={},this.update(V,[],H)}update(V,H,J){this._options=J;for(let ve of V){this._layerConfigs[ve.id]=ve;let Ve=this._layers[ve.id]=g.c(ve,this._options);Ve.setScope(this.scope),Ve.compileFilter(),this.keyCache[ve.id]&&delete this.keyCache[ve.id]}for(let ve of H)delete this.keyCache[ve],delete this._layerConfigs[ve],delete this._layers[ve];this.familiesBySource={};let _e=function(ve,Ve){let Ke={};for(let nt=0;nt<ve.length;nt++){let ht=Ve&&Ve[ve[nt].id]||T(ve[nt]);Ve&&(Ve[ve[nt].id]=ht);let _t=Ke[ht];_t||(_t=Ke[ht]=[]),_t.push(ve[nt])}let xe=[];for(let nt in Ke)xe.push(Ke[nt]);return xe}(g.v(this._layerConfigs),this.keyCache);for(let ve of _e){let Ve=ve.map(An=>this._layers[An.id]),Ke=Ve[0];if(Ke.visibility==="none")continue;let xe=Ke.source||"",nt=this.familiesBySource[xe];nt||(nt=this.familiesBySource[xe]={});let ht=Ke.sourceLayer||"_geojsonTileLayer",_t=nt[ht];_t||(_t=nt[ht]=[]),_t.push(Ve)}}}class O{loadTile(V,H){let{uid:J,encoding:_e,rawImageData:ve,padding:Ve}=V,Ke=g.w.ImageBitmap&&ve instanceof g.w.ImageBitmap?this.getImageData(ve,Ve):ve;H(null,new g.D(J,Ke,_e,Ve<1))}getImageData(V,H){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(V.width,V.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=V.width,this.offscreenCanvas.height=V.height,this.offscreenCanvasContext.drawImage(V,0,0,V.width,V.height);let J=this.offscreenCanvasContext.getImageData(-H,-H,V.width+2*H,V.height+2*H);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),J}}function Z(Te,V){if(Te.length!==0){ee(Te[0],V);for(var H=1;H<Te.length;H++)ee(Te[H],!V)}}function ee(Te,V){for(var H=0,J=0,_e=0,ve=Te.length,Ve=ve-1;_e<ve;Ve=_e++){var Ke=(Te[_e][0]-Te[Ve][0])*(Te[Ve][1]+Te[_e][1]),xe=H+Ke;J+=Math.abs(H)>=Math.abs(Ke)?H-xe+Ke:Ke-xe+H,H=xe}H+J>=0!=!!V&&Te.reverse()}var ce=g.g(function Te(V,H){var J,_e=V&&V.type;if(_e==="FeatureCollection")for(J=0;J<V.features.length;J++)Te(V.features[J],H);else if(_e==="GeometryCollection")for(J=0;J<V.geometries.length;J++)Te(V.geometries[J],H);else if(_e==="Feature")Te(V.geometry,H);else if(_e==="Polygon")Z(V.coordinates,H);else if(_e==="MultiPolygon")for(J=0;J<V.coordinates.length;J++)Z(V.coordinates[J],H);return V});let Ee=g.V.prototype.toGeoJSON;var Ze={exports:{}},Vt=g.p,dt=g.a.VectorTileFeature,tt=Ln;function Ln(Te,V){this.options=V||{},this.features=Te,this.length=Te.length}function ri(Te,V){this.id=typeof Te.id=="number"?Te.id:void 0,this.type=Te.type,this.rawGeometry=Te.type===1?[Te.geometry]:Te.geometry,this.properties=Te.tags,this.extent=V||4096}Ln.prototype.feature=function(Te){return new ri(this.features[Te],this.options.extent)},ri.prototype.loadGeometry=function(){var Te=this.rawGeometry;this.geometry=[];for(var V=0;V<Te.length;V++){for(var H=Te[V],J=[],_e=0;_e<H.length;_e++)J.push(new Vt(H[_e][0],H[_e][1]));this.geometry.push(J)}return this.geometry},ri.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Te=this.geometry,V=1/0,H=-1/0,J=1/0,_e=-1/0,ve=0;ve<Te.length;ve++)for(var Ve=Te[ve],Ke=0;Ke<Ve.length;Ke++){var xe=Ve[Ke];V=Math.min(V,xe.x),H=Math.max(H,xe.x),J=Math.min(J,xe.y),_e=Math.max(_e,xe.y)}return[V,J,H,_e]},ri.prototype.toGeoJSON=dt.prototype.toGeoJSON;var bn=g.b,Pi=tt;function Si(Te){var V=new bn;return function(H,J){for(var _e in H.layers)J.writeMessage(3,Q,H.layers[_e])}(Te,V),V.finish()}function Q(Te,V){var H;V.writeVarintField(15,Te.version||1),V.writeStringField(1,Te.name||""),V.writeVarintField(5,Te.extent||4096);var J={keys:[],values:[],keycache:{},valuecache:{}};for(H=0;H<Te.length;H++)J.feature=Te.feature(H),V.writeMessage(2,Wt,J);var _e=J.keys;for(H=0;H<_e.length;H++)V.writeStringField(3,_e[H]);var ve=J.values;for(H=0;H<ve.length;H++)V.writeMessage(4,ly,ve[H])}function Wt(Te,V){var H=Te.feature;H.id!==void 0&&V.writeVarintField(1,H.id),V.writeMessage(2,sd,Te),V.writeVarintField(3,H.type),V.writeMessage(4,ji,H)}function sd(Te,V){var H=Te.feature,J=Te.keys,_e=Te.values,ve=Te.keycache,Ve=Te.valuecache;for(var Ke in H.properties){var xe=H.properties[Ke],nt=ve[Ke];if(xe!==null){nt===void 0&&(J.push(Ke),ve[Ke]=nt=J.length-1),V.writeVarint(nt);var ht=typeof xe;ht!=="string"&&ht!=="boolean"&&ht!=="number"&&(xe=JSON.stringify(xe));var _t=ht+":"+xe,An=Ve[_t];An===void 0&&(_e.push(xe),Ve[_t]=An=_e.length-1),V.writeVarint(An)}}}function gl(Te,V){return(V<<3)+(7&Te)}function Tt(Te){return Te<<1^Te>>31}function ji(Te,V){for(var H=Te.loadGeometry(),J=Te.type,_e=0,ve=0,Ve=H.length,Ke=0;Ke<Ve;Ke++){var xe=H[Ke],nt=1;J===1&&(nt=xe.length),V.writeVarint(gl(1,nt));for(var ht=J===3?xe.length-1:xe.length,_t=0;_t<ht;_t++){_t===1&&J!==1&&V.writeVarint(gl(2,ht-1));var An=xe[_t].x-_e,ei=xe[_t].y-ve;V.writeVarint(Tt(An)),V.writeVarint(Tt(ei)),_e+=An,ve+=ei}J===3&&V.writeVarint(gl(7,1))}}function ly(Te,V){var H=typeof Te;H==="string"?V.writeStringField(1,Te):H==="boolean"?V.writeBooleanField(7,Te):H==="number"&&(Te%1!=0?V.writeDoubleField(3,Te):Te<0?V.writeSVarintField(6,Te):V.writeVarintField(5,Te))}Ze.exports=Si,Ze.exports.fromVectorTileJs=Si,Ze.exports.fromGeojsonVt=function(Te,V){V=V||{};var H={};for(var J in Te)H[J]=new Pi(Te[J].features,V),H[J].name=J,H[J].version=V.version,H[J].extent=V.extent;return Si({layers:H})},Ze.exports.GeoJSONWrapper=Pi;var vc=g.g(Ze.exports);let cy={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Te=>Te},_l=Math.fround||(yl=new Float32Array(1),Te=>(yl[0]=+Te,yl[0]));var yl;let vo=3,We=5,ds=6;class hs{constructor(V){this.options=Object.assign(Object.create(cy),V),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(V){let{log:H,minZoom:J,maxZoom:_e}=this.options;H&&console.time("total time");let ve=`prepare ${V.length} points`;H&&console.time(ve),this.points=V;let Ve=[];for(let xe=0;xe<V.length;xe++){let nt=V[xe];if(!nt.geometry)continue;let[ht,_t]=nt.geometry.coordinates,An=_l($e(ht)),ei=_l(Nr(_t));Ve.push(An,ei,1/0,xe,-1,1),this.options.reduce&&Ve.push(0)}let Ke=this.trees[_e+1]=this._createTree(Ve);H&&console.timeEnd(ve);for(let xe=_e;xe>=J;xe--){let nt=+Date.now();Ke=this.trees[xe]=this._createTree(this._cluster(Ke,xe)),H&&console.log("z%d: %d clusters in %dms",xe,Ke.numItems,+Date.now()-nt)}return H&&console.timeEnd("total time"),this}getClusters(V,H){let J=((V[0]+180)%360+360)%360-180,_e=Math.max(-90,Math.min(90,V[1])),ve=V[2]===180?180:((V[2]+180)%360+360)%360-180,Ve=Math.max(-90,Math.min(90,V[3]));if(V[2]-V[0]>=360)J=-180,ve=180;else if(J>ve){let _t=this.getClusters([J,_e,180,Ve],H),An=this.getClusters([-180,_e,ve,Ve],H);return _t.concat(An)}let Ke=this.trees[this._limitZoom(H)],xe=Ke.range($e(J),Nr(Ve),$e(ve),Nr(_e)),nt=Ke.data,ht=[];for(let _t of xe){let An=this.stride*_t;ht.push(nt[An+We]>1?vl(nt,An,this.clusterProps):this.points[nt[An+vo]])}return ht}getChildren(V){let H=this._getOriginId(V),J=this._getOriginZoom(V),_e="No cluster with the specified id.",ve=this.trees[J];if(!ve)throw new Error(_e);let Ve=ve.data;if(H*this.stride>=Ve.length)throw new Error(_e);let Ke=this.options.radius/(this.options.extent*Math.pow(2,J-1)),xe=ve.within(Ve[H*this.stride],Ve[H*this.stride+1],Ke),nt=[];for(let ht of xe){let _t=ht*this.stride;Ve[_t+4]===V&&nt.push(Ve[_t+We]>1?vl(Ve,_t,this.clusterProps):this.points[Ve[_t+vo]])}if(nt.length===0)throw new Error(_e);return nt}getLeaves(V,H,J){let _e=[];return this._appendLeaves(_e,V,H=H||10,J=J||0,0),_e}getTile(V,H,J){let _e=this.trees[this._limitZoom(V)],ve=Math.pow(2,V),{extent:Ve,radius:Ke}=this.options,xe=Ke/Ve,nt=(J-xe)/ve,ht=(J+1+xe)/ve,_t={features:[]};return this._addTileFeatures(_e.range((H-xe)/ve,nt,(H+1+xe)/ve,ht),_e.data,H,J,ve,_t),H===0&&this._addTileFeatures(_e.range(1-xe/ve,nt,1,ht),_e.data,ve,J,ve,_t),H===ve-1&&this._addTileFeatures(_e.range(0,nt,xe/ve,ht),_e.data,-1,J,ve,_t),_t.features.length?_t:null}getClusterExpansionZoom(V){let H=this._getOriginZoom(V)-1;for(;H<=this.options.maxZoom;){let J=this.getChildren(V);if(H++,J.length!==1)break;V=J[0].properties.cluster_id}return H}_appendLeaves(V,H,J,_e,ve){let Ve=this.getChildren(H);for(let Ke of Ve){let xe=Ke.properties;if(xe&&xe.cluster?ve+xe.point_count<=_e?ve+=xe.point_count:ve=this._appendLeaves(V,xe.cluster_id,J,_e,ve):ve<_e?ve++:V.push(Ke),V.length===J)break}return ve}_createTree(V){let H=new g.K(V.length/this.stride|0,this.options.nodeSize,Float32Array);for(let J=0;J<V.length;J+=this.stride)H.add(V[J],V[J+1]);return H.finish(),H.data=V,H}_addTileFeatures(V,H,J,_e,ve,Ve){for(let Ke of V){let xe=Ke*this.stride,nt=H[xe+We]>1,ht,_t,An;if(nt)ht=xl(H,xe,this.clusterProps),_t=H[xe],An=H[xe+1];else{let ti=this.points[H[xe+vo]];ht=ti.properties;let[di,Nn]=ti.geometry.coordinates;_t=$e(di),An=Nr(Nn)}let ei={type:1,geometry:[[Math.round(this.options.extent*(_t*ve-J)),Math.round(this.options.extent*(An*ve-_e))]],tags:ht},Ui;Ui=nt||this.options.generateId?H[xe+vo]:this.points[H[xe+vo]].id,Ui!==void 0&&(ei.id=Ui),Ve.features.push(ei)}}_limitZoom(V){return Math.max(this.options.minZoom,Math.min(Math.floor(+V),this.options.maxZoom+1))}_cluster(V,H){let{radius:J,extent:_e,reduce:ve,minPoints:Ve}=this.options,Ke=J/(_e*Math.pow(2,H)),xe=V.data,nt=[],ht=this.stride;for(let _t=0;_t<xe.length;_t+=ht){if(xe[_t+2]<=H)continue;xe[_t+2]=H;let An=xe[_t],ei=xe[_t+1],Ui=V.within(xe[_t],xe[_t+1],Ke),ti=xe[_t+We],di=ti;for(let Nn of Ui){let cr=Nn*ht;xe[cr+2]>H&&(di+=xe[cr+We])}if(di>ti&&di>=Ve){let Nn,cr=An*ti,Mr=ei*ti,Dr=-1,Go=((_t/ht|0)<<5)+(H+1)+this.points.length;for(let Cc of Ui){let zr=Cc*ht;if(xe[zr+2]<=H)continue;xe[zr+2]=H;let zs=xe[zr+We];cr+=xe[zr]*zs,Mr+=xe[zr+1]*zs,xe[zr+4]=Go,ve&&(Nn||(Nn=this._map(xe,_t,!0),Dr=this.clusterProps.length,this.clusterProps.push(Nn)),ve(Nn,this._map(xe,zr)))}xe[_t+4]=Go,nt.push(cr/di,Mr/di,1/0,Go,-1,di),ve&&nt.push(Dr)}else{for(let Nn=0;Nn<ht;Nn++)nt.push(xe[_t+Nn]);if(di>1)for(let Nn of Ui){let cr=Nn*ht;if(!(xe[cr+2]<=H)){xe[cr+2]=H;for(let Mr=0;Mr<ht;Mr++)nt.push(xe[cr+Mr])}}}}return nt}_getOriginId(V){return V-this.points.length>>5}_getOriginZoom(V){return(V-this.points.length)%32}_map(V,H,J){if(V[H+We]>1){let Ve=this.clusterProps[V[H+ds]];return J?Object.assign({},Ve):Ve}let _e=this.points[V[H+vo]].properties,ve=this.options.map(_e);return J&&ve===_e?Object.assign({},ve):ve}}function vl(Te,V,H){return{type:"Feature",id:Te[V+vo],properties:xl(Te,V,H),geometry:{type:"Point",coordinates:[(J=Te[V],360*(J-.5)),uy(Te[V+1])]}};var J}function xl(Te,V,H){let J=Te[V+We],_e=J>=1e4?`${Math.round(J/1e3)}k`:J>=1e3?Math.round(J/100)/10+"k":J,ve=Te[V+ds],Ve=ve===-1?{}:Object.assign({},H[ve]);return Object.assign(Ve,{cluster:!0,cluster_id:Te[V+vo],point_count:J,point_count_abbreviated:_e})}function $e(Te){return Te/360+.5}function Nr(Te){let V=Math.sin(Te*Math.PI/180),H=.5-.25*Math.log((1+V)/(1-V))/Math.PI;return H<0?0:H>1?1:H}function uy(Te){let V=(180-360*Te)*Math.PI/180;return 360*Math.atan(Math.exp(V))/Math.PI-90}var xc={exports:{}};xc.exports=function(){function Te(fe,me,we,Ie){for(var Me,Oe=Ie,Le=we-me>>1,Se=we-me,He=fe[me],Fe=fe[me+1],St=fe[we],wn=fe[we+1],it=me+3;it<we;it+=3){var gn=V(fe[it],fe[it+1],He,Fe,St,wn);if(gn>Oe)Me=it,Oe=gn;else if(gn===Oe){var ni=Math.abs(it-Le);ni<Se&&(Me=it,Se=ni)}}Oe>Ie&&(Me-me>3&&Te(fe,me,Me,Ie),fe[Me+2]=Oe,we-Me>3&&Te(fe,Me,we,Ie))}function V(fe,me,we,Ie,Me,Oe){var Le=Me-we,Se=Oe-Ie;if(Le!==0||Se!==0){var He=((fe-we)*Le+(me-Ie)*Se)/(Le*Le+Se*Se);He>1?(we=Me,Ie=Oe):He>0&&(we+=Le*He,Ie+=Se*He)}return(Le=fe-we)*Le+(Se=me-Ie)*Se}function H(fe,me,we,Ie){var Me={id:fe===void 0?null:fe,type:me,geometry:we,tags:Ie,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Oe){var Le=Oe.geometry,Se=Oe.type;if(Se==="Point"||Se==="MultiPoint"||Se==="LineString")J(Oe,Le);else if(Se==="Polygon"||Se==="MultiLineString")for(var He=0;He<Le.length;He++)J(Oe,Le[He]);else if(Se==="MultiPolygon")for(He=0;He<Le.length;He++)for(var Fe=0;Fe<Le[He].length;Fe++)J(Oe,Le[He][Fe])}(Me),Me}function J(fe,me){for(var we=0;we<me.length;we+=3)fe.minX=Math.min(fe.minX,me[we]),fe.minY=Math.min(fe.minY,me[we+1]),fe.maxX=Math.max(fe.maxX,me[we]),fe.maxY=Math.max(fe.maxY,me[we+1])}function _e(fe,me,we,Ie){if(me.geometry){var Me=me.geometry.coordinates,Oe=me.geometry.type,Le=Math.pow(we.tolerance/((1<<we.maxZoom)*we.extent),2),Se=[],He=me.id;if(we.promoteId?He=me.properties[we.promoteId]:we.generateId&&(He=Ie||0),Oe==="Point")ve(Me,Se);else if(Oe==="MultiPoint")for(var Fe=0;Fe<Me.length;Fe++)ve(Me[Fe],Se);else if(Oe==="LineString")Ve(Me,Se,Le,!1);else if(Oe==="MultiLineString"){if(we.lineMetrics){for(Fe=0;Fe<Me.length;Fe++)Ve(Me[Fe],Se=[],Le,!1),fe.push(H(He,"LineString",Se,me.properties));return}Ke(Me,Se,Le,!1)}else if(Oe==="Polygon")Ke(Me,Se,Le,!0);else{if(Oe!=="MultiPolygon"){if(Oe==="GeometryCollection"){for(Fe=0;Fe<me.geometry.geometries.length;Fe++)_e(fe,{id:He,geometry:me.geometry.geometries[Fe],properties:me.properties},we,Ie);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Fe=0;Fe<Me.length;Fe++){var St=[];Ke(Me[Fe],St,Le,!0),Se.push(St)}}fe.push(H(He,Oe,Se,me.properties))}}function ve(fe,me){me.push(xe(fe[0])),me.push(nt(fe[1])),me.push(0)}function Ve(fe,me,we,Ie){for(var Me,Oe,Le=0,Se=0;Se<fe.length;Se++){var He=xe(fe[Se][0]),Fe=nt(fe[Se][1]);me.push(He),me.push(Fe),me.push(0),Se>0&&(Le+=Ie?(Me*Fe-He*Oe)/2:Math.sqrt(Math.pow(He-Me,2)+Math.pow(Fe-Oe,2))),Me=He,Oe=Fe}var St=me.length-3;me[2]=1,Te(me,0,St,we),me[St+2]=1,me.size=Math.abs(Le),me.start=0,me.end=me.size}function Ke(fe,me,we,Ie){for(var Me=0;Me<fe.length;Me++){var Oe=[];Ve(fe[Me],Oe,we,Ie),me.push(Oe)}}function xe(fe){return fe/360+.5}function nt(fe){var me=Math.sin(fe*Math.PI/180),we=.5-.25*Math.log((1+me)/(1-me))/Math.PI;return we<0?0:we>1?1:we}function ht(fe,me,we,Ie,Me,Oe,Le,Se){if(Ie/=me,Oe>=(we/=me)&&Le<Ie)return fe;if(Le<we||Oe>=Ie)return null;for(var He=[],Fe=0;Fe<fe.length;Fe++){var St=fe[Fe],wn=St.geometry,it=St.type,gn=Me===0?St.minX:St.minY,ni=Me===0?St.maxX:St.maxY;if(gn>=we&&ni<Ie)He.push(St);else if(!(ni<we||gn>=Ie)){var hi=[];if(it==="Point"||it==="MultiPoint")_t(wn,hi,we,Ie,Me);else if(it==="LineString")An(wn,hi,we,Ie,Me,!1,Se.lineMetrics);else if(it==="MultiLineString")Ui(wn,hi,we,Ie,Me,!1);else if(it==="Polygon")Ui(wn,hi,we,Ie,Me,!0);else if(it==="MultiPolygon")for(var Ei=0;Ei<wn.length;Ei++){var ur=[];Ui(wn[Ei],ur,we,Ie,Me,!0),ur.length&&hi.push(ur)}if(hi.length){if(Se.lineMetrics&&it==="LineString"){for(Ei=0;Ei<hi.length;Ei++)He.push(H(St.id,it,hi[Ei],St.tags));continue}it!=="LineString"&&it!=="MultiLineString"||(hi.length===1?(it="LineString",hi=hi[0]):it="MultiLineString"),it!=="Point"&&it!=="MultiPoint"||(it=hi.length===3?"Point":"MultiPoint"),He.push(H(St.id,it,hi,St.tags))}}}return He.length?He:null}function _t(fe,me,we,Ie,Me){for(var Oe=0;Oe<fe.length;Oe+=3){var Le=fe[Oe+Me];Le>=we&&Le<=Ie&&(me.push(fe[Oe]),me.push(fe[Oe+1]),me.push(fe[Oe+2]))}}function An(fe,me,we,Ie,Me,Oe,Le){for(var Se,He,Fe=ei(fe),St=Me===0?di:Nn,wn=fe.start,it=0;it<fe.length-3;it+=3){var gn=fe[it],ni=fe[it+1],hi=fe[it+2],Ei=fe[it+3],ur=fe[it+4],xo=Me===0?gn:ni,Oi=Me===0?Ei:ur,Sr=!1;Le&&(Se=Math.sqrt(Math.pow(gn-Ei,2)+Math.pow(ni-ur,2))),xo<we?Oi>we&&(He=St(Fe,gn,ni,Ei,ur,we),Le&&(Fe.start=wn+Se*He)):xo>Ie?Oi<Ie&&(He=St(Fe,gn,ni,Ei,ur,Ie),Le&&(Fe.start=wn+Se*He)):ti(Fe,gn,ni,hi),Oi<we&&xo>=we&&(He=St(Fe,gn,ni,Ei,ur,we),Sr=!0),Oi>Ie&&xo<=Ie&&(He=St(Fe,gn,ni,Ei,ur,Ie),Sr=!0),!Oe&&Sr&&(Le&&(Fe.end=wn+Se*He),me.push(Fe),Fe=ei(fe)),Le&&(wn+=Se)}var dr=fe.length-3;gn=fe[dr],ni=fe[dr+1],hi=fe[dr+2],(xo=Me===0?gn:ni)>=we&&xo<=Ie&&ti(Fe,gn,ni,hi),dr=Fe.length-3,Oe&&dr>=3&&(Fe[dr]!==Fe[0]||Fe[dr+1]!==Fe[1])&&ti(Fe,Fe[0],Fe[1],Fe[2]),Fe.length&&me.push(Fe)}function ei(fe){var me=[];return me.size=fe.size,me.start=fe.start,me.end=fe.end,me}function Ui(fe,me,we,Ie,Me,Oe){for(var Le=0;Le<fe.length;Le++)An(fe[Le],me,we,Ie,Me,Oe,!1)}function ti(fe,me,we,Ie){fe.push(me),fe.push(we),fe.push(Ie)}function di(fe,me,we,Ie,Me,Oe){var Le=(Oe-me)/(Ie-me);return fe.push(Oe),fe.push(we+(Me-we)*Le),fe.push(1),Le}function Nn(fe,me,we,Ie,Me,Oe){var Le=(Oe-we)/(Me-we);return fe.push(me+(Ie-me)*Le),fe.push(Oe),fe.push(1),Le}function cr(fe,me){for(var we=[],Ie=0;Ie<fe.length;Ie++){var Me,Oe=fe[Ie],Le=Oe.type;if(Le==="Point"||Le==="MultiPoint"||Le==="LineString")Me=Mr(Oe.geometry,me);else if(Le==="MultiLineString"||Le==="Polygon"){Me=[];for(var Se=0;Se<Oe.geometry.length;Se++)Me.push(Mr(Oe.geometry[Se],me))}else if(Le==="MultiPolygon")for(Me=[],Se=0;Se<Oe.geometry.length;Se++){for(var He=[],Fe=0;Fe<Oe.geometry[Se].length;Fe++)He.push(Mr(Oe.geometry[Se][Fe],me));Me.push(He)}we.push(H(Oe.id,Le,Me,Oe.tags))}return we}function Mr(fe,me){var we=[];we.size=fe.size,fe.start!==void 0&&(we.start=fe.start,we.end=fe.end);for(var Ie=0;Ie<fe.length;Ie+=3)we.push(fe[Ie]+me,fe[Ie+1],fe[Ie+2]);return we}function Dr(fe,me){if(fe.transformed)return fe;var we,Ie,Me,Oe=1<<fe.z,Le=fe.x,Se=fe.y;for(we=0;we<fe.features.length;we++){var He=fe.features[we],Fe=He.geometry,St=He.type;if(He.geometry=[],St===1)for(Ie=0;Ie<Fe.length;Ie+=2)He.geometry.push(Go(Fe[Ie],Fe[Ie+1],me,Oe,Le,Se));else for(Ie=0;Ie<Fe.length;Ie++){var wn=[];for(Me=0;Me<Fe[Ie].length;Me+=2)wn.push(Go(Fe[Ie][Me],Fe[Ie][Me+1],me,Oe,Le,Se));He.geometry.push(wn)}}return fe.transformed=!0,fe}function Go(fe,me,we,Ie,Me,Oe){return[Math.round(we*(fe*Ie-Me)),Math.round(we*(me*Ie-Oe))]}function Cc(fe,me,we,Ie,Me){for(var Oe=me===Me.maxZoom?0:Me.tolerance/((1<<me)*Me.extent),Le={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:we,y:Ie,z:me,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},Se=0;Se<fe.length;Se++){Le.numFeatures++,zr(Le,fe[Se],Oe,Me);var He=fe[Se].minX,Fe=fe[Se].minY,St=fe[Se].maxX,wn=fe[Se].maxY;He<Le.minX&&(Le.minX=He),Fe<Le.minY&&(Le.minY=Fe),St>Le.maxX&&(Le.maxX=St),wn>Le.maxY&&(Le.maxY=wn)}return Le}function zr(fe,me,we,Ie){var Me=me.geometry,Oe=me.type,Le=[];if(Oe==="Point"||Oe==="MultiPoint")for(var Se=0;Se<Me.length;Se+=3)Le.push(Me[Se]),Le.push(Me[Se+1]),fe.numPoints++,fe.numSimplified++;else if(Oe==="LineString")zs(Le,Me,fe,we,!1,!1);else if(Oe==="MultiLineString"||Oe==="Polygon")for(Se=0;Se<Me.length;Se++)zs(Le,Me[Se],fe,we,Oe==="Polygon",Se===0);else if(Oe==="MultiPolygon")for(var He=0;He<Me.length;He++){var Fe=Me[He];for(Se=0;Se<Fe.length;Se++)zs(Le,Fe[Se],fe,we,!0,Se===0)}if(Le.length){var St=me.tags||null;if(Oe==="LineString"&&Ie.lineMetrics){for(var wn in St={},me.tags)St[wn]=me.tags[wn];St.mapbox_clip_start=Me.start/Me.size,St.mapbox_clip_end=Me.end/Me.size}var it={geometry:Le,type:Oe==="Polygon"||Oe==="MultiPolygon"?3:Oe==="LineString"||Oe==="MultiLineString"?2:1,tags:St};me.id!==null&&(it.id=me.id),fe.features.push(it)}}function zs(fe,me,we,Ie,Me,Oe){var Le=Ie*Ie;if(Ie>0&&me.size<(Me?Le:Ie))we.numPoints+=me.length/3;else{for(var Se=[],He=0;He<me.length;He+=3)(Ie===0||me[He+2]>Le)&&(we.numSimplified++,Se.push(me[He]),Se.push(me[He+1])),we.numPoints++;Me&&function(Fe,St){for(var wn=0,it=0,gn=Fe.length,ni=gn-2;it<gn;ni=it,it+=2)wn+=(Fe[it]-Fe[ni])*(Fe[it+1]+Fe[ni+1]);if(wn>0===St)for(it=0,gn=Fe.length;it<gn/2;it+=2){var hi=Fe[it],Ei=Fe[it+1];Fe[it]=Fe[gn-2-it],Fe[it+1]=Fe[gn-1-it],Fe[gn-2-it]=hi,Fe[gn-1-it]=Ei}}(Se,Oe),fe.push(Se)}}function ba(fe,me){var we=(me=this.options=function(Me,Oe){for(var Le in Oe)Me[Le]=Oe[Le];return Me}(Object.create(this.options),me)).debug;if(we&&console.time("preprocess data"),me.maxZoom<0||me.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(me.promoteId&&me.generateId)throw new Error("promoteId and generateId cannot be used together.");var Ie=function(Me,Oe){var Le=[];if(Me.type==="FeatureCollection")for(var Se=0;Se<Me.features.length;Se++)_e(Le,Me.features[Se],Oe,Se);else _e(Le,Me.type==="Feature"?Me:{geometry:Me},Oe);return Le}(fe,me);this.tiles={},this.tileCoords=[],we&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",me.indexMaxZoom,me.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(Ie=function(Me,Oe){var Le=Oe.buffer/Oe.extent,Se=Me,He=ht(Me,1,-1-Le,Le,0,-1,2,Oe),Fe=ht(Me,1,1-Le,2+Le,0,-1,2,Oe);return(He||Fe)&&(Se=ht(Me,1,-Le,1+Le,0,-1,2,Oe)||[],He&&(Se=cr(He,1).concat(Se)),Fe&&(Se=Se.concat(cr(Fe,-1)))),Se}(Ie,me)).length&&this.splitTile(Ie,0,0,0),we&&(Ie.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ec(fe,me,we){return 32*((1<<fe)*we+me)+fe}return ba.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ba.prototype.splitTile=function(fe,me,we,Ie,Me,Oe,Le){for(var Se=[fe,me,we,Ie],He=this.options,Fe=He.debug;Se.length;){Ie=Se.pop(),we=Se.pop(),me=Se.pop(),fe=Se.pop();var St=1<<me,wn=Ec(me,we,Ie),it=this.tiles[wn];if(!it&&(Fe>1&&console.time("creation"),it=this.tiles[wn]=Cc(fe,me,we,Ie,He),this.tileCoords.push({z:me,x:we,y:Ie}),Fe)){Fe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",me,we,Ie,it.numFeatures,it.numPoints,it.numSimplified),console.timeEnd("creation"));var gn="z"+me;this.stats[gn]=(this.stats[gn]||0)+1,this.total++}if(it.source=fe,Me){if(me===He.maxZoom||me===Me)continue;var ni=1<<Me-me;if(we!==Math.floor(Oe/ni)||Ie!==Math.floor(Le/ni))continue}else if(me===He.indexMaxZoom||it.numPoints<=He.indexMaxPoints)continue;if(it.source=null,fe.length!==0){Fe>1&&console.time("clipping");var hi,Ei,ur,xo,Oi,Sr,dr=.5*He.buffer/He.extent,Tc=.5-dr,wa=.5+dr,Ic=1+dr;hi=Ei=ur=xo=null,Oi=ht(fe,St,we-dr,we+wa,0,it.minX,it.maxX,He),Sr=ht(fe,St,we+Tc,we+Ic,0,it.minX,it.maxX,He),fe=null,Oi&&(hi=ht(Oi,St,Ie-dr,Ie+wa,1,it.minY,it.maxY,He),Ei=ht(Oi,St,Ie+Tc,Ie+Ic,1,it.minY,it.maxY,He),Oi=null),Sr&&(ur=ht(Sr,St,Ie-dr,Ie+wa,1,it.minY,it.maxY,He),xo=ht(Sr,St,Ie+Tc,Ie+Ic,1,it.minY,it.maxY,He),Sr=null),Fe>1&&console.timeEnd("clipping"),Se.push(hi||[],me+1,2*we,2*Ie),Se.push(Ei||[],me+1,2*we,2*Ie+1),Se.push(ur||[],me+1,2*we+1,2*Ie),Se.push(xo||[],me+1,2*we+1,2*Ie+1)}}},ba.prototype.getTile=function(fe,me,we){var Ie=this.options,Me=Ie.extent,Oe=Ie.debug;if(fe<0||fe>24)return null;var Le=1<<fe,Se=Ec(fe,me=(me%Le+Le)%Le,we);if(this.tiles[Se])return Dr(this.tiles[Se],Me);Oe>1&&console.log("drilling down to z%d-%d-%d",fe,me,we);for(var He,Fe=fe,St=me,wn=we;!He&&Fe>0;)Fe--,St=Math.floor(St/2),wn=Math.floor(wn/2),He=this.tiles[Ec(Fe,St,wn)];return He&&He.source?(Oe>1&&console.log("found parent tile z%d-%d-%d",Fe,St,wn),Oe>1&&console.time("drilling down"),this.splitTile(He.source,Fe,St,wn,fe,me,we),Oe>1&&console.timeEnd("drilling down"),this.tiles[Se]?Dr(this.tiles[Se],Me):null):null},function(fe,me){return new ba(fe,me)}}();var Tf=g.g(xc.exports);function If(Te,V){let H=Te.tileID.canonical;if(!this._geoJSONIndex)return V(null,null);let J=this._geoJSONIndex.getTile(H.z,H.x,H.y);if(!J)return V(null,null);let _e=new class{constructor(Ve){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=g.E,this.length=Ve.length,this._features=Ve}feature(Ve){return new class{constructor(Ke){this._feature=Ke,this.extent=g.E,this.type=Ke.type,this.properties=Ke.tags,"id"in Ke&&!isNaN(Ke.id)&&(this.id=parseInt(Ke.id,10))}loadGeometry(){if(this._feature.type===1){let Ke=[];for(let xe of this._feature.geometry)Ke.push([new g.P(xe[0],xe[1])]);return Ke}{let Ke=[];for(let xe of this._feature.geometry){let nt=[];for(let ht of xe)nt.push(new g.P(ht[0],ht[1]));Ke.push(nt)}return Ke}}toGeoJSON(Ke,xe,nt){return Ee.call(this,Ke,xe,nt)}}(this._features[Ve])}}(J.features),ve=vc(_e);ve.byteOffset===0&&ve.byteLength===ve.buffer.byteLength||(ve=new Uint8Array(ve)),V(null,{vectorTile:_e,rawData:ve.buffer})}class Mf extends g.d{constructor(V,H,J,_e,ve,Ve){super(V,H,J,_e,If,Ve),ve&&(this.loadGeoJSON=ve)}loadData(V,H){let J=V&&V.request,_e=J&&J.collectResourceTiming;this.loadGeoJSON(V,(ve,Ve)=>{if(ve||!Ve)return H(ve);if(typeof Ve!="object")return H(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`));{ce(Ve,!0);try{if(V.filter){let xe=g.e(V.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(xe.result==="error")throw new Error(xe.value.map(ht=>`${ht.key}: ${ht.message}`).join(", "));Ve={type:"FeatureCollection",features:Ve.features.filter(ht=>xe.value.evaluate({zoom:0},ht))}}this._geoJSONIndex=V.cluster?new hs(function({superclusterOptions:xe,clusterProperties:nt}){if(!nt||!xe)return xe;let ht={},_t={},An={accumulated:null,zoom:0},ei={properties:null},Ui=Object.keys(nt);for(let ti of Ui){let[di,Nn]=nt[ti],cr=g.e(Nn),Mr=g.e(typeof di=="string"?[di,["accumulated"],["get",ti]]:di);ht[ti]=cr.value,_t[ti]=Mr.value}return xe.map=ti=>{ei.properties=ti;let di={};for(let Nn of Ui)di[Nn]=ht[Nn].evaluate(An,ei);return di},xe.reduce=(ti,di)=>{ei.properties=di;for(let Nn of Ui)An.accumulated=ti[Nn],ti[Nn]=_t[Nn].evaluate(An,ei)},xe}(V)).load(Ve.features):Tf(Ve,V.geojsonVtOptions)}catch(xe){return H(xe)}this.loaded={};let Ke={};if(_e){let xe=g.f(J);xe&&(Ke.resourceTiming={},Ke.resourceTiming[V.source]=JSON.parse(JSON.stringify(xe)))}H(null,Ke)}})}reloadTile(V,H){let J=this.loaded;return J&&J[V.uid]?super.reloadTile(V,H):this.loadTile(V,H)}loadGeoJSON(V,H){if(V.request)g.h(V.request,H);else{if(typeof V.data!="string")return H(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`));try{return H(null,JSON.parse(V.data))}catch{return H(new Error(`Input data given to '${V.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(V,H){try{H(null,this._geoJSONIndex.getClusterExpansionZoom(V.clusterId))}catch(J){H(J)}}getClusterChildren(V,H){try{H(null,this._geoJSONIndex.getChildren(V.clusterId))}catch(J){H(J)}}getClusterLeaves(V,H){try{H(null,this._geoJSONIndex.getLeaves(V.clusterId,V.limit,V.offset))}catch(J){H(J)}}}class Ri{constructor(V,H){this.tileID=new g.O(V.tileID.overscaledZ,V.tileID.wrap,V.tileID.canonical.z,V.tileID.canonical.x,V.tileID.canonical.y),this.tileZoom=V.tileZoom,this.uid=V.uid,this.zoom=V.zoom,this.canonical=V.tileID.canonical,this.pixelRatio=V.pixelRatio,this.tileSize=V.tileSize,this.source=V.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=V.projection,this.brightness=H}parse(V,H,J,_e){this.status="parsing";let ve=new g.O(J.tileID.overscaledZ,J.tileID.wrap,J.tileID.canonical.z,J.tileID.canonical.x,J.tileID.canonical.y),Ve={},Ke=H.familiesBySource[J.source],xe=new g.F(ve,J.promoteId);return xe.bucketLayerIDs=[],g.l(V).then(nt=>{if(!nt)return _e(new Error("Could not parse tile"));let ht=g.j(nt,1/g.t(J.tileID.canonical)),_t=nt.json.extensionsUsed&&nt.json.extensionsUsed.includes("MAPBOX_mesh_features"),An=new g.k(this.zoom,{brightness:this.brightness});for(let ei in Ke)for(let Ui of Ke[ei]){let ti=Ui[0],di=nt.json.extensionsUsed;ti.recalculate(An,[]);let Nn=new g.T(ht,ve,di&&di.includes("MAPBOX_mesh_features"),this.brightness);_t||(Nn.needsUpload=!0),Ve[ti.fqid]=Nn,Nn.evaluate(ti)}this.status="done",_e(null,{buckets:Ve,featureIndex:xe})}).catch(nt=>_e(new Error(nt.message)))}}class bc{constructor(V,H,J,_e,ve,Ve){this.actor=V,this.layerIndex=H,this.brightness=Ve,this.loading={},this.loaded={}}loadTile(V,H){let J=V.uid,_e=this.loading[J]=new Ri(V,this.brightness);g.i(V.request,(ve,Ve)=>{let Ke=!this.loading[J];return delete this.loading[J],Ke||ve?(_e.status="done",Ke||(this.loaded[J]=_e),H(ve)):Ve&&Ve.byteLength!==0?void _e.parse(Ve,this.layerIndex,V,(xe,nt)=>{_e.status="done",this.loaded=this.loaded||{},this.loaded[J]=_e,xe||!nt?H(xe):H(null,nt)}):(_e.status="done",this.loaded[J]=_e,H())})}reloadTile(V,H){let J=this.loaded,_e=V.uid;if(J&&J[_e]){let ve=J[_e];ve.projection=V.projection,ve.brightness=V.brightness;let Ve=(Ke,xe)=>{ve.reloadCallback&&(delete ve.reloadCallback,this.loadTile(V,H)),H(Ke,xe)};ve.status==="parsing"?ve.reloadCallback=Ve:ve.status==="done"&&this.loadTile(V,H)}}abortTile(V,H){let J=V.uid;this.loading[J]&&delete this.loading[J],H()}removeTile(V,H){let J=this.loaded,_e=V.uid;J&&J[_e]&&delete J[_e],H()}}class wc{constructor(V){this.self=V,this.actor=new g.A(V,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=g.m({name:"mercator"}),this.workerSourceTypes={vector:g.d,geojson:Mf,"batched-model":bc},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(H,J)=>{if(this.workerSourceTypes[H])throw new Error(`Worker source with name "${H}" already registered.`);this.workerSourceTypes[H]=J},this.self.registerRTLTextPlugin=H=>{if(g.n.isParsed())throw new Error("RTL text plugin already registered.");g.n.applyArabicShaping=H.applyArabicShaping,g.n.processBidirectionalText=H.processBidirectionalText,g.n.processStyledBidirectionalText=H.processStyledBidirectionalText}}clearCaches(V,H,J){delete this.layerIndexes[V],delete this.availableImages[V],delete this.workerSources[V],delete this.demWorkerSources[V],J()}checkIfReady(V,H,J){J()}setReferrer(V,H){this.referrer=H}spriteLoaded(V,{scope:H,isLoaded:J}){if(this.isSpriteLoaded[V]||(this.isSpriteLoaded[V]={}),this.isSpriteLoaded[V][H]=J,this.workerSources[V]&&this.workerSources[V][H])for(let _e in this.workerSources[V][H]){let ve=this.workerSources[V][H][_e];for(let Ve in ve)ve[Ve]instanceof g.d&&(ve[Ve].isSpriteLoaded=J,ve[Ve].fire(new g.o("isSpriteLoaded")))}}setImages(V,{scope:H,images:J},_e){if(this.availableImages[V]||(this.availableImages[V]={}),this.availableImages[V][H]=J,this.workerSources[V]&&this.workerSources[V][H]){for(let ve in this.workerSources[V][H]){let Ve=this.workerSources[V][H][ve];for(let Ke in Ve)Ve[Ke].availableImages=J}_e()}else _e()}setProjection(V,H){this.projections[V]=g.m(H)}setBrightness(V,H,J){this.brightness=H,J()}setLayers(V,H,J){this.getLayerIndex(V,H.scope).replace(H.layers,H.options),J()}updateLayers(V,H,J){this.getLayerIndex(V,H.scope).update(H.layers,H.removedIds,H.options),J()}loadTile(V,H,J){H.projection=this.projections[V]||this.defaultProjection,this.getWorkerSource(V,H.type,H.source,H.scope).loadTile(H,J)}loadDEMTile(V,H,J){this.getDEMWorkerSource(V,H.source,H.scope).loadTile(H,J)}reloadTile(V,H,J){H.projection=this.projections[V]||this.defaultProjection,this.getWorkerSource(V,H.type,H.source,H.scope).reloadTile(H,J)}abortTile(V,H,J){this.getWorkerSource(V,H.type,H.source,H.scope).abortTile(H,J)}removeTile(V,H,J){this.getWorkerSource(V,H.type,H.source,H.scope).removeTile(H,J)}removeSource(V,H,J){if(!(this.workerSources[V]&&this.workerSources[V][H.scope]&&this.workerSources[V][H.scope][H.type]&&this.workerSources[V][H.scope][H.type][H.source]))return;let _e=this.workerSources[V][H.scope][H.type][H.source];delete this.workerSources[V][H.scope][H.type][H.source],_e.removeSource!==void 0?_e.removeSource(H,J):J()}loadWorkerSource(V,H,J){try{this.self.importScripts(H.url),J()}catch(_e){J(_e.toString())}}syncRTLPluginState(V,H,J){try{g.n.setState(H);let _e=g.n.getPluginURL();if(g.n.isLoaded()&&!g.n.isParsed()&&_e!=null){this.self.importScripts(_e);let ve=g.n.isParsed();J(ve?void 0:new Error(`RTL Text Plugin failed to import scripts from ${_e}`),ve)}}catch(_e){J(_e.toString())}}setDracoUrl(V,H){this.dracoUrl=H}getAvailableImages(V,H){this.availableImages[V]||(this.availableImages[V]={});let J=this.availableImages[V][H];return J||(J=[]),J}getLayerIndex(V,H){this.layerIndexes[V]||(this.layerIndexes[V]={});let J=this.layerIndexes[V][H];return J||(J=this.layerIndexes[V][H]=new P,J.scope=H),J}getWorkerSource(V,H,J,_e){if(this.workerSources[V]||(this.workerSources[V]={}),this.workerSources[V][_e]||(this.workerSources[V][_e]={}),this.workerSources[V][_e][H]||(this.workerSources[V][_e][H]={}),this.isSpriteLoaded[V]||(this.isSpriteLoaded[V]={}),!this.workerSources[V][_e][H][J]){let ve={send:(Ve,Ke,xe,nt,ht,_t)=>{this.actor.send(Ve,Ke,xe,V,ht,_t)},scheduler:this.actor.scheduler};this.workerSources[V][_e][H][J]=new this.workerSourceTypes[H](ve,this.getLayerIndex(V,_e),this.getAvailableImages(V,_e),this.isSpriteLoaded[V][_e],void 0,this.brightness)}return this.workerSources[V][_e][H][J]}getDEMWorkerSource(V,H,J){return this.demWorkerSources[V]||(this.demWorkerSources[V]={}),this.demWorkerSources[V][J]||(this.demWorkerSources[V][J]={}),this.demWorkerSources[V][J][H]||(this.demWorkerSources[V][J][H]=new O),this.demWorkerSources[V][J][H]}enforceCacheSizeLimit(V,H){g.q(H)}getWorkerPerformanceMetrics(V,H,J){J(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new wc(self)),wc}),c(["./shared"],function(g){"use strict";return g.s});var f=d;return f})});var MA=null;var Qx=1,DA=Symbol("SIGNAL");function fr(s){let a=MA;return MA=s,a}var SA={version:0,lastCleanEpoch:0,dirty:!1,producerNode:void 0,producerLastReadVersion:void 0,producerIndexOfThis:void 0,nextProducerIndex:0,liveConsumerNode:void 0,liveConsumerIndexOfThis:void 0,consumerAllowSignalWrites:!1,consumerIsAlwaysLive:!1,producerMustRecompute:()=>!1,producerRecomputeValue:()=>{},consumerMarkedDirty:()=>{},consumerOnSignalRead:()=>{}};function jj(s){if(!(n1(s)&&!s.dirty)&&!(!s.dirty&&s.lastCleanEpoch===Qx)){if(!s.producerMustRecompute(s)&&!e1(s)){s.dirty=!1,s.lastCleanEpoch=Qx;return}s.producerRecomputeValue(s),s.dirty=!1,s.lastCleanEpoch=Qx}}function AA(s){return s&&(s.nextProducerIndex=0),fr(s)}function PA(s,a){if(fr(a),!(!s||s.producerNode===void 0||s.producerIndexOfThis===void 0||s.producerLastReadVersion===void 0)){if(n1(s))for(let d=s.nextProducerIndex;d<s.producerNode.length;d++)t1(s.producerNode[d],s.producerIndexOfThis[d]);for(;s.producerNode.length>s.nextProducerIndex;)s.producerNode.pop(),s.producerLastReadVersion.pop(),s.producerIndexOfThis.pop()}}function e1(s){$m(s);for(let a=0;a<s.producerNode.length;a++){let d=s.producerNode[a],c=s.producerLastReadVersion[a];if(c!==d.version||(jj(d),c!==d.version))return!0}return!1}function RA(s){if($m(s),n1(s))for(let a=0;a<s.producerNode.length;a++)t1(s.producerNode[a],s.producerIndexOfThis[a]);s.producerNode.length=s.producerLastReadVersion.length=s.producerIndexOfThis.length=0,s.liveConsumerNode&&(s.liveConsumerNode.length=s.liveConsumerIndexOfThis.length=0)}function t1(s,a){if(Uj(s),$m(s),s.liveConsumerNode.length===1)for(let c=0;c<s.producerNode.length;c++)t1(s.producerNode[c],s.producerIndexOfThis[c]);let d=s.liveConsumerNode.length-1;if(s.liveConsumerNode[a]=s.liveConsumerNode[d],s.liveConsumerIndexOfThis[a]=s.liveConsumerIndexOfThis[d],s.liveConsumerNode.length--,s.liveConsumerIndexOfThis.length--,a<s.liveConsumerNode.length){let c=s.liveConsumerIndexOfThis[a],f=s.liveConsumerNode[a];$m(f),f.producerIndexOfThis[c]=a}}function n1(s){return s.consumerIsAlwaysLive||(s?.liveConsumerNode?.length??0)>0}function $m(s){s.producerNode??=[],s.producerIndexOfThis??=[],s.producerLastReadVersion??=[]}function Uj(s){s.liveConsumerNode??=[],s.liveConsumerIndexOfThis??=[]}function $j(){throw new Error}var Gj=$j;function OA(s){Gj=s}function sn(s){return typeof s=="function"}function _u(s){let d=s(c=>{Error.call(c),c.stack=new Error().stack});return d.prototype=Object.create(Error.prototype),d.prototype.constructor=d,d}var Gm=_u(s=>function(d){s(this),this.message=d?`${d.length} errors occurred during unsubscription:
${d.map((c,f)=>`${f+1}) ${c.toString()}`).join(`
  `)}`:"",this.name="UnsubscriptionError",this.errors=d});function mh(s,a){if(s){let d=s.indexOf(a);0<=d&&s.splice(d,1)}}var Yi=class s{constructor(a){this.initialTeardown=a,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let a;if(!this.closed){this.closed=!0;let{_parentage:d}=this;if(d)if(this._parentage=null,Array.isArray(d))for(let g of d)g.remove(this);else d.remove(this);let{initialTeardown:c}=this;if(sn(c))try{c()}catch(g){a=g instanceof Gm?g.errors:[g]}let{_finalizers:f}=this;if(f){this._finalizers=null;for(let g of f)try{FA(g)}catch(x){a=a??[],x instanceof Gm?a=[...a,...x.errors]:a.push(x)}}if(a)throw new Gm(a)}}add(a){var d;if(a&&a!==this)if(this.closed)FA(a);else{if(a instanceof s){if(a.closed||a._hasParent(this))return;a._addParent(this)}(this._finalizers=(d=this._finalizers)!==null&&d!==void 0?d:[]).push(a)}}_hasParent(a){let{_parentage:d}=this;return d===a||Array.isArray(d)&&d.includes(a)}_addParent(a){let{_parentage:d}=this;this._parentage=Array.isArray(d)?(d.push(a),d):d?[d,a]:a}_removeParent(a){let{_parentage:d}=this;d===a?this._parentage=null:Array.isArray(d)&&mh(d,a)}remove(a){let{_finalizers:d}=this;d&&mh(d,a),a instanceof s&&a._removeParent(this)}};Yi.EMPTY=(()=>{let s=new Yi;return s.closed=!0,s})();var i1=Yi.EMPTY;function Hm(s){return s instanceof Yi||s&&"closed"in s&&sn(s.remove)&&sn(s.add)&&sn(s.unsubscribe)}function FA(s){sn(s)?s():s.unsubscribe()}var ts={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var yu={setTimeout(s,a,...d){let{delegate:c}=yu;return c?.setTimeout?c.setTimeout(s,a,...d):setTimeout(s,a,...d)},clearTimeout(s){let{delegate:a}=yu;return(a?.clearTimeout||clearTimeout)(s)},delegate:void 0};function qm(s){yu.setTimeout(()=>{let{onUnhandledError:a}=ts;if(a)a(s);else throw s})}function gh(){}var kA=r1("C",void 0,void 0);function LA(s){return r1("E",void 0,s)}function NA(s){return r1("N",s,void 0)}function r1(s,a,d){return{kind:s,value:a,error:d}}var Wl=null;function vu(s){if(ts.useDeprecatedSynchronousErrorHandling){let a=!Wl;if(a&&(Wl={errorThrown:!1,error:null}),s(),a){let{errorThrown:d,error:c}=Wl;if(Wl=null,d)throw c}}else s()}function zA(s){ts.useDeprecatedSynchronousErrorHandling&&Wl&&(Wl.errorThrown=!0,Wl.error=s)}var Zl=class extends Yi{constructor(a){super(),this.isStopped=!1,a?(this.destination=a,Hm(a)&&a.add(this)):this.destination=Wj}static create(a,d,c){return new xu(a,d,c)}next(a){this.isStopped?s1(NA(a),this):this._next(a)}error(a){this.isStopped?s1(LA(a),this):(this.isStopped=!0,this._error(a))}complete(){this.isStopped?s1(kA,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(a){this.destination.next(a)}_error(a){try{this.destination.error(a)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}},Hj=Function.prototype.bind;function o1(s,a){return Hj.call(s,a)}var a1=class{constructor(a){this.partialObserver=a}next(a){let{partialObserver:d}=this;if(d.next)try{d.next(a)}catch(c){Wm(c)}}error(a){let{partialObserver:d}=this;if(d.error)try{d.error(a)}catch(c){Wm(c)}else Wm(a)}complete(){let{partialObserver:a}=this;if(a.complete)try{a.complete()}catch(d){Wm(d)}}},xu=class extends Zl{constructor(a,d,c){super();let f;if(sn(a)||!a)f={next:a??void 0,error:d??void 0,complete:c??void 0};else{let g;this&&ts.useDeprecatedNextContext?(g=Object.create(a),g.unsubscribe=()=>this.unsubscribe(),f={next:a.next&&o1(a.next,g),error:a.error&&o1(a.error,g),complete:a.complete&&o1(a.complete,g)}):f=a}this.destination=new a1(f)}};function Wm(s){ts.useDeprecatedSynchronousErrorHandling?zA(s):qm(s)}function qj(s){throw s}function s1(s,a){let{onStoppedNotification:d}=ts;d&&yu.setTimeout(()=>d(s,a))}var Wj={closed:!0,next:gh,error:qj,complete:gh};var bu=typeof Symbol=="function"&&Symbol.observable||"@@observable";function lo(s){return s}function l1(...s){return c1(s)}function c1(s){return s.length===0?lo:s.length===1?s[0]:function(d){return s.reduce((c,f)=>f(c),d)}}var kn=(()=>{class s{constructor(d){d&&(this._subscribe=d)}lift(d){let c=new s;return c.source=this,c.operator=d,c}subscribe(d,c,f){let g=Xj(d)?d:new xu(d,c,f);return vu(()=>{let{operator:x,source:T}=this;g.add(x?x.call(g,T):T?this._subscribe(g):this._trySubscribe(g))}),g}_trySubscribe(d){try{return this._subscribe(d)}catch(c){d.error(c)}}forEach(d,c){return c=BA(c),new c((f,g)=>{let x=new xu({next:T=>{try{d(T)}catch(P){g(P),x.unsubscribe()}},error:g,complete:f});this.subscribe(x)})}_subscribe(d){var c;return(c=this.source)===null||c===void 0?void 0:c.subscribe(d)}[bu](){return this}pipe(...d){return c1(d)(this)}toPromise(d){return d=BA(d),new d((c,f)=>{let g;this.subscribe(x=>g=x,x=>f(x),()=>c(g))})}}return s.create=a=>new s(a),s})();function BA(s){var a;return(a=s??ts.Promise)!==null&&a!==void 0?a:Promise}function Zj(s){return s&&sn(s.next)&&sn(s.error)&&sn(s.complete)}function Xj(s){return s&&s instanceof Zl||Zj(s)&&Hm(s)}function u1(s){return sn(s?.lift)}function Pn(s){return a=>{if(u1(a))return a.lift(function(d){try{return s(d,this)}catch(c){this.error(c)}});throw new TypeError("Unable to lift unknown Observable type")}}function Mn(s,a,d,c,f){return new d1(s,a,d,c,f)}var d1=class extends Zl{constructor(a,d,c,f,g,x){super(a),this.onFinalize=g,this.shouldUnsubscribe=x,this._next=d?function(T){try{d(T)}catch(P){a.error(P)}}:super._next,this._error=f?function(T){try{f(T)}catch(P){a.error(P)}finally{this.unsubscribe()}}:super._error,this._complete=c?function(){try{c()}catch(T){a.error(T)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var a;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){let{closed:d}=this;super.unsubscribe(),!d&&((a=this.onFinalize)===null||a===void 0||a.call(this))}}};function wu(){return Pn((s,a)=>{let d=null;s._refCount++;let c=Mn(a,void 0,void 0,void 0,()=>{if(!s||s._refCount<=0||0<--s._refCount){d=null;return}let f=s._connection,g=d;d=null,f&&(!g||f===g)&&f.unsubscribe(),a.unsubscribe()});s.subscribe(c),c.closed||(d=s.connect())})}var Cu=class extends kn{constructor(a,d){super(),this.source=a,this.subjectFactory=d,this._subject=null,this._refCount=0,this._connection=null,u1(a)&&(this.lift=a.lift)}_subscribe(a){return this.getSubject().subscribe(a)}getSubject(){let a=this._subject;return(!a||a.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;let{_connection:a}=this;this._subject=this._connection=null,a?.unsubscribe()}connect(){let a=this._connection;if(!a){a=this._connection=new Yi;let d=this.getSubject();a.add(this.source.subscribe(Mn(d,void 0,()=>{this._teardown(),d.complete()},c=>{this._teardown(),d.error(c)},()=>this._teardown()))),a.closed&&(this._connection=null,a=Yi.EMPTY)}return a}refCount(){return wu()(this)}};var VA=_u(s=>function(){s(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var co=(()=>{class s extends kn{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(d){let c=new Zm(this,this);return c.operator=d,c}_throwIfClosed(){if(this.closed)throw new VA}next(d){vu(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(let c of this.currentObservers)c.next(d)}})}error(d){vu(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=d;let{observers:c}=this;for(;c.length;)c.shift().error(d)}})}complete(){vu(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;let{observers:d}=this;for(;d.length;)d.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var d;return((d=this.observers)===null||d===void 0?void 0:d.length)>0}_trySubscribe(d){return this._throwIfClosed(),super._trySubscribe(d)}_subscribe(d){return this._throwIfClosed(),this._checkFinalizedStatuses(d),this._innerSubscribe(d)}_innerSubscribe(d){let{hasError:c,isStopped:f,observers:g}=this;return c||f?i1:(this.currentObservers=null,g.push(d),new Yi(()=>{this.currentObservers=null,mh(g,d)}))}_checkFinalizedStatuses(d){let{hasError:c,thrownError:f,isStopped:g}=this;c?d.error(f):g&&d.complete()}asObservable(){let d=new kn;return d.source=this,d}}return s.create=(a,d)=>new Zm(a,d),s})(),Zm=class extends co{constructor(a,d){super(),this.destination=a,this.source=d}next(a){var d,c;(c=(d=this.destination)===null||d===void 0?void 0:d.next)===null||c===void 0||c.call(d,a)}error(a){var d,c;(c=(d=this.destination)===null||d===void 0?void 0:d.error)===null||c===void 0||c.call(d,a)}complete(){var a,d;(d=(a=this.destination)===null||a===void 0?void 0:a.complete)===null||d===void 0||d.call(a)}_subscribe(a){var d,c;return(c=(d=this.source)===null||d===void 0?void 0:d.subscribe(a))!==null&&c!==void 0?c:i1}};var pr=class extends co{constructor(a){super(),this._value=a}get value(){return this.getValue()}_subscribe(a){let d=super._subscribe(a);return!d.closed&&a.next(this._value),d}getValue(){let{hasError:a,thrownError:d,_value:c}=this;if(a)throw d;return this._throwIfClosed(),c}next(a){super.next(this._value=a)}};var Po=new kn(s=>s.complete());function jA(s){return s&&sn(s.schedule)}function UA(s){return s[s.length-1]}function Xm(s){return sn(UA(s))?s.pop():void 0}function Ya(s){return jA(UA(s))?s.pop():void 0}function GA(s,a,d,c){function f(g){return g instanceof d?g:new d(function(x){x(g)})}return new(d||(d=Promise))(function(g,x){function T(Z){try{O(c.next(Z))}catch(ee){x(ee)}}function P(Z){try{O(c.throw(Z))}catch(ee){x(ee)}}function O(Z){Z.done?g(Z.value):f(Z.value).then(T,P)}O((c=c.apply(s,a||[])).next())})}function $A(s){var a=typeof Symbol=="function"&&Symbol.iterator,d=a&&s[a],c=0;if(d)return d.call(s);if(s&&typeof s.length=="number")return{next:function(){return s&&c>=s.length&&(s=void 0),{value:s&&s[c++],done:!s}}};throw new TypeError(a?"Object is not iterable.":"Symbol.iterator is not defined.")}function Xl(s){return this instanceof Xl?(this.v=s,this):new Xl(s)}function HA(s,a,d){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var c=d.apply(s,a||[]),f,g=[];return f={},x("next"),x("throw"),x("return"),f[Symbol.asyncIterator]=function(){return this},f;function x(ce){c[ce]&&(f[ce]=function(Ee){return new Promise(function(Ze,Vt){g.push([ce,Ee,Ze,Vt])>1||T(ce,Ee)})})}function T(ce,Ee){try{P(c[ce](Ee))}catch(Ze){ee(g[0][3],Ze)}}function P(ce){ce.value instanceof Xl?Promise.resolve(ce.value.v).then(O,Z):ee(g[0][2],ce)}function O(ce){T("next",ce)}function Z(ce){T("throw",ce)}function ee(ce,Ee){ce(Ee),g.shift(),g.length&&T(g[0][0],g[0][1])}}function qA(s){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var a=s[Symbol.asyncIterator],d;return a?a.call(s):(s=typeof $A=="function"?$A(s):s[Symbol.iterator](),d={},c("next"),c("throw"),c("return"),d[Symbol.asyncIterator]=function(){return this},d);function c(g){d[g]=s[g]&&function(x){return new Promise(function(T,P){x=s[g](x),f(T,P,x.done,x.value)})}}function f(g,x,T,P){Promise.resolve(P).then(function(O){g({value:O,done:T})},x)}}var Ym=s=>s&&typeof s.length=="number"&&typeof s!="function";function Km(s){return sn(s?.then)}function Jm(s){return sn(s[bu])}function Qm(s){return Symbol.asyncIterator&&sn(s?.[Symbol.asyncIterator])}function eg(s){return new TypeError(`You provided ${s!==null&&typeof s=="object"?"an invalid object":`'${s}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}function Yj(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var tg=Yj();function ng(s){return sn(s?.[tg])}function ig(s){return HA(this,arguments,function*(){let d=s.getReader();try{for(;;){let{value:c,done:f}=yield Xl(d.read());if(f)return yield Xl(void 0);yield yield Xl(c)}}finally{d.releaseLock()}})}function rg(s){return sn(s?.getReader)}function Hi(s){if(s instanceof kn)return s;if(s!=null){if(Jm(s))return Kj(s);if(Ym(s))return Jj(s);if(Km(s))return Qj(s);if(Qm(s))return WA(s);if(ng(s))return eU(s);if(rg(s))return tU(s)}throw eg(s)}function Kj(s){return new kn(a=>{let d=s[bu]();if(sn(d.subscribe))return d.subscribe(a);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Jj(s){return new kn(a=>{for(let d=0;d<s.length&&!a.closed;d++)a.next(s[d]);a.complete()})}function Qj(s){return new kn(a=>{s.then(d=>{a.closed||(a.next(d),a.complete())},d=>a.error(d)).then(null,qm)})}function eU(s){return new kn(a=>{for(let d of s)if(a.next(d),a.closed)return;a.complete()})}function WA(s){return new kn(a=>{nU(s,a).catch(d=>a.error(d))})}function tU(s){return WA(ig(s))}function nU(s,a){var d,c,f,g;return GA(this,void 0,void 0,function*(){try{for(d=qA(s);c=yield d.next(),!c.done;){let x=c.value;if(a.next(x),a.closed)return}}catch(x){f={error:x}}finally{try{c&&!c.done&&(g=d.return)&&(yield g.call(d))}finally{if(f)throw f.error}}a.complete()})}function Kr(s,a,d,c=0,f=!1){let g=a.schedule(function(){d(),f?s.add(this.schedule(null,c)):this.unsubscribe()},c);if(s.add(g),!f)return g}function og(s,a=0){return Pn((d,c)=>{d.subscribe(Mn(c,f=>Kr(c,s,()=>c.next(f),a),()=>Kr(c,s,()=>c.complete(),a),f=>Kr(c,s,()=>c.error(f),a)))})}function sg(s,a=0){return Pn((d,c)=>{c.add(s.schedule(()=>d.subscribe(c),a))})}function ZA(s,a){return Hi(s).pipe(sg(a),og(a))}function XA(s,a){return Hi(s).pipe(sg(a),og(a))}function YA(s,a){return new kn(d=>{let c=0;return a.schedule(function(){c===s.length?d.complete():(d.next(s[c++]),d.closed||this.schedule())})})}function KA(s,a){return new kn(d=>{let c;return Kr(d,a,()=>{c=s[tg](),Kr(d,a,()=>{let f,g;try{({value:f,done:g}=c.next())}catch(x){d.error(x);return}g?d.complete():d.next(f)},0,!0)}),()=>sn(c?.return)&&c.return()})}function ag(s,a){if(!s)throw new Error("Iterable cannot be null");return new kn(d=>{Kr(d,a,()=>{let c=s[Symbol.asyncIterator]();Kr(d,a,()=>{c.next().then(f=>{f.done?d.complete():d.next(f.value)})},0,!0)})})}function JA(s,a){return ag(ig(s),a)}function QA(s,a){if(s!=null){if(Jm(s))return ZA(s,a);if(Ym(s))return YA(s,a);if(Km(s))return XA(s,a);if(Qm(s))return ag(s,a);if(ng(s))return KA(s,a);if(rg(s))return JA(s,a)}throw eg(s)}function Di(s,a){return a?QA(s,a):Hi(s)}function Yt(...s){let a=Ya(s);return Di(s,a)}function Eu(s,a){let d=sn(s)?s:()=>s,c=f=>f.error(d());return new kn(a?f=>a.schedule(c,0,f):c)}function h1(s){return!!s&&(s instanceof kn||sn(s.lift)&&sn(s.subscribe))}var ra=_u(s=>function(){s(this),this.name="EmptyError",this.message="no elements in sequence"});function ot(s,a){return Pn((d,c)=>{let f=0;d.subscribe(Mn(c,g=>{c.next(s.call(a,g,f++))}))})}var{isArray:iU}=Array;function rU(s,a){return iU(a)?s(...a):s(a)}function lg(s){return ot(a=>rU(s,a))}var{isArray:oU}=Array,{getPrototypeOf:sU,prototype:aU,keys:lU}=Object;function cg(s){if(s.length===1){let a=s[0];if(oU(a))return{args:a,keys:null};if(cU(a)){let d=lU(a);return{args:d.map(c=>a[c]),keys:d}}}return{args:s,keys:null}}function cU(s){return s&&typeof s=="object"&&sU(s)===aU}function ug(s,a){return s.reduce((d,c,f)=>(d[c]=a[f],d),{})}function _h(...s){let a=Ya(s),d=Xm(s),{args:c,keys:f}=cg(s);if(c.length===0)return Di([],a);let g=new kn(uU(c,a,f?x=>ug(f,x):lo));return d?g.pipe(lg(d)):g}function uU(s,a,d=lo){return c=>{eP(a,()=>{let{length:f}=s,g=new Array(f),x=f,T=f;for(let P=0;P<f;P++)eP(a,()=>{let O=Di(s[P],a),Z=!1;O.subscribe(Mn(c,ee=>{g[P]=ee,Z||(Z=!0,T--),T||c.next(d(g.slice()))},()=>{--x||c.complete()}))},c)},c)}}function eP(s,a,d){s?Kr(d,s,a):a()}function tP(s,a,d,c,f,g,x,T){let P=[],O=0,Z=0,ee=!1,ce=()=>{ee&&!P.length&&!O&&a.complete()},Ee=Vt=>O<c?Ze(Vt):P.push(Vt),Ze=Vt=>{g&&a.next(Vt),O++;let dt=!1;Hi(d(Vt,Z++)).subscribe(Mn(a,tt=>{f?.(tt),g?Ee(tt):a.next(tt)},()=>{dt=!0},void 0,()=>{if(dt)try{for(O--;P.length&&O<c;){let tt=P.shift();x?Kr(a,x,()=>Ze(tt)):Ze(tt)}ce()}catch(tt){a.error(tt)}}))};return s.subscribe(Mn(a,Ee,()=>{ee=!0,ce()})),()=>{T?.()}}function Ki(s,a,d=1/0){return sn(a)?Ki((c,f)=>ot((g,x)=>a(c,g,f,x))(Hi(s(c,f))),d):(typeof a=="number"&&(d=a),Pn((c,f)=>tP(c,f,s,d)))}function f1(s=1/0){return Ki(lo,s)}function nP(){return f1(1)}function Tu(...s){return nP()(Di(s,Ya(s)))}function dg(s){return new kn(a=>{Hi(s()).subscribe(a)})}function p1(...s){let a=Xm(s),{args:d,keys:c}=cg(s),f=new kn(g=>{let{length:x}=d;if(!x){g.complete();return}let T=new Array(x),P=x,O=x;for(let Z=0;Z<x;Z++){let ee=!1;Hi(d[Z]).subscribe(Mn(g,ce=>{ee||(ee=!0,O--),T[Z]=ce},()=>P--,void 0,()=>{(!P||!ee)&&(O||g.next(c?ug(c,T):T),g.complete())}))}});return a?f.pipe(lg(a)):f}function uo(s,a){return Pn((d,c)=>{let f=0;d.subscribe(Mn(c,g=>s.call(a,g,f++)&&c.next(g)))})}function Ka(s){return Pn((a,d)=>{let c=null,f=!1,g;c=a.subscribe(Mn(d,void 0,void 0,x=>{g=Hi(s(x,Ka(s)(a))),c?(c.unsubscribe(),c=null,g.subscribe(d)):f=!0})),f&&(c.unsubscribe(),c=null,g.subscribe(d))})}function iP(s,a,d,c,f){return(g,x)=>{let T=d,P=a,O=0;g.subscribe(Mn(x,Z=>{let ee=O++;P=T?s(P,Z,ee):(T=!0,Z),c&&x.next(P)},f&&(()=>{T&&x.next(P),x.complete()})))}}function Ja(s,a){return sn(a)?Ki(s,a,1):Ki(s,1)}function Qa(s){return Pn((a,d)=>{let c=!1;a.subscribe(Mn(d,f=>{c=!0,d.next(f)},()=>{c||d.next(s),d.complete()}))})}function oa(s){return s<=0?()=>Po:Pn((a,d)=>{let c=0;a.subscribe(Mn(d,f=>{++c<=s&&(d.next(f),s<=c&&d.complete())}))})}function m1(s){return ot(()=>s)}function hg(s=dU){return Pn((a,d)=>{let c=!1;a.subscribe(Mn(d,f=>{c=!0,d.next(f)},()=>c?d.complete():d.error(s())))})}function dU(){return new ra}function el(s){return Pn((a,d)=>{try{a.subscribe(d)}finally{d.add(s)}})}function Ds(s,a){let d=arguments.length>=2;return c=>c.pipe(s?uo((f,g)=>s(f,g,c)):lo,oa(1),d?Qa(a):hg(()=>new ra))}function Iu(s){return s<=0?()=>Po:Pn((a,d)=>{let c=[];a.subscribe(Mn(d,f=>{c.push(f),s<c.length&&c.shift()},()=>{for(let f of c)d.next(f);d.complete()},void 0,()=>{c=null}))})}function g1(s,a){let d=arguments.length>=2;return c=>c.pipe(s?uo((f,g)=>s(f,g,c)):lo,Iu(1),d?Qa(a):hg(()=>new ra))}function _1(s,a){return Pn(iP(s,a,arguments.length>=2,!0))}function y1(...s){let a=Ya(s);return Pn((d,c)=>{(a?Tu(s,d,a):Tu(s,d)).subscribe(c)})}function Jr(s,a){return Pn((d,c)=>{let f=null,g=0,x=!1,T=()=>x&&!f&&c.complete();d.subscribe(Mn(c,P=>{f?.unsubscribe();let O=0,Z=g++;Hi(s(P,Z)).subscribe(f=Mn(c,ee=>c.next(a?a(P,ee,Z,O++):ee),()=>{f=null,T()}))},()=>{x=!0,T()}))})}function v1(s){return Pn((a,d)=>{Hi(s).subscribe(Mn(d,()=>d.complete(),gh)),!d.closed&&a.subscribe(d)})}function Ji(s,a,d){let c=sn(s)||a||d?{next:s,error:a,complete:d}:s;return c?Pn((f,g)=>{var x;(x=c.subscribe)===null||x===void 0||x.call(c);let T=!0;f.subscribe(Mn(g,P=>{var O;(O=c.next)===null||O===void 0||O.call(c,P),g.next(P)},()=>{var P;T=!1,(P=c.complete)===null||P===void 0||P.call(c),g.complete()},P=>{var O;T=!1,(O=c.error)===null||O===void 0||O.call(c,P),g.error(P)},()=>{var P,O;T&&((P=c.unsubscribe)===null||P===void 0||P.call(c)),(O=c.finalize)===null||O===void 0||O.call(c)}))}):lo}var BP="https://g.co/ng/security#xss",$t=class extends Error{constructor(a,d){super(Vg(a,d)),this.code=a}};function Vg(s,a){return`${`NG0${Math.abs(s)}`}${a?": "+a:""}`}function ci(s){for(let a in s)if(s[a]===ci)return a;throw Error("Could not find renamed property on target object.")}function hU(s,a){for(let d in a)a.hasOwnProperty(d)&&!s.hasOwnProperty(d)&&(s[d]=a[d])}function Fr(s){if(typeof s=="string")return s;if(Array.isArray(s))return"["+s.map(Fr).join(", ")+"]";if(s==null)return""+s;if(s.overriddenName)return`${s.overriddenName}`;if(s.name)return`${s.name}`;let a=s.toString();if(a==null)return""+a;let d=a.indexOf(`
`);return d===-1?a:a.substring(0,d)}function rP(s,a){return s==null||s===""?a===null?"":a:a==null||a===""?s:s+" "+a}var fU=ci({__forward_ref__:ci});function no(s){return s.__forward_ref__=no,s.toString=function(){return Fr(this())},s}function Or(s){return VP(s)?s():s}function VP(s){return typeof s=="function"&&s.hasOwnProperty(fU)&&s.__forward_ref__===no}function jP(s){return s&&!!s.\u0275providers}var pU=ci({\u0275cmp:ci}),mU=ci({\u0275dir:ci}),gU=ci({\u0275pipe:ci}),_U=ci({\u0275mod:ci}),xg=ci({\u0275fac:ci}),yh=ci({__NG_ELEMENT_ID__:ci}),oP=ci({__NG_ENV_ID__:ci});function Pu(s){return typeof s=="string"?s:s==null?"":String(s)}function yU(s){return typeof s=="function"?s.name||s.toString():typeof s=="object"&&s!=null&&typeof s.type=="function"?s.type.name||s.type.toString():Pu(s)}function vU(s,a){let d=a?`. Dependency path: ${a.join(" > ")} > ${s}`:"";throw new $t(-200,`Circular dependency in DI detected for ${s}${d}`)}function wb(s,a){throw new $t(-201,!1)}function xU(s,a){s==null&&bU(a,s,null,"!=")}function bU(s,a,d,c){throw new Error(`ASSERTION ERROR: ${s}`+(c==null?"":` [Expected=> ${d} ${c} ${a} <=Actual]`))}function gt(s){return{token:s.token,providedIn:s.providedIn||null,factory:s.factory,value:void 0}}function os(s){return{providers:s.providers||[],imports:s.imports||[]}}function jg(s){return sP(s,$P)||sP(s,GP)}function UP(s){return jg(s)!==null}function sP(s,a){return s.hasOwnProperty(a)?s[a]:null}function wU(s){let a=s&&(s[$P]||s[GP]);return a||null}function aP(s){return s&&(s.hasOwnProperty(lP)||s.hasOwnProperty(CU))?s[lP]:null}var $P=ci({\u0275prov:ci}),lP=ci({\u0275inj:ci}),GP=ci({ngInjectableDef:ci}),CU=ci({ngInjectorDef:ci}),Tn=function(s){return s[s.Default=0]="Default",s[s.Host=1]="Host",s[s.Self=2]="Self",s[s.SkipSelf=4]="SkipSelf",s[s.Optional=8]="Optional",s}(Tn||{}),N1;function EU(){return N1}function Qr(s){let a=N1;return N1=s,a}function HP(s,a,d){let c=jg(s);if(c&&c.providedIn=="root")return c.value===void 0?c.value=c.factory():c.value;if(d&Tn.Optional)return null;if(a!==void 0)return a;wb(s,"Injector")}var sa=globalThis;var zt=class{constructor(a,d){this._desc=a,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,typeof d=="number"?this.__NG_ELEMENT_ID__=d:d!==void 0&&(this.\u0275prov=gt({token:this,providedIn:d.providedIn||"root",factory:d.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}};var TU={},bh=TU,IU="__NG_DI_FLAG__",bg="ngTempTokenPath",MU="ngTokenPath",DU=/\n/gm,SU="\u0275",cP="__source",vh;function tl(s){let a=vh;return vh=s,a}function AU(s,a=Tn.Default){if(vh===void 0)throw new $t(-203,!1);return vh===null?HP(s,void 0,a):vh.get(s,a&Tn.Optional?null:void 0,a)}function vt(s,a=Tn.Default){return(EU()||AU)(Or(s),a)}function ut(s,a=Tn.Default){return vt(s,Ug(a))}function Ug(s){return typeof s>"u"||typeof s=="number"?s:0|(s.optional&&8)|(s.host&&1)|(s.self&&2)|(s.skipSelf&&4)}function z1(s){let a=[];for(let d=0;d<s.length;d++){let c=Or(s[d]);if(Array.isArray(c)){if(c.length===0)throw new $t(900,!1);let f,g=Tn.Default;for(let x=0;x<c.length;x++){let T=c[x],P=PU(T);typeof P=="number"?P===-1?f=T.token:g|=P:f=T}a.push(vt(f,g))}else a.push(vt(c))}return a}function PU(s){return s[IU]}function RU(s,a,d,c){let f=s[bg];throw a[cP]&&f.unshift(a[cP]),s.message=OU(`
`+s.message,f,d,c),s[MU]=f,s[bg]=null,s}function OU(s,a,d,c=null){s=s&&s.charAt(0)===`
`&&s.charAt(1)==SU?s.slice(2):s;let f=Fr(a);if(Array.isArray(a))f=a.map(Fr).join(" -> ");else if(typeof a=="object"){let g=[];for(let x in a)if(a.hasOwnProperty(x)){let T=a[x];g.push(x+":"+(typeof T=="string"?JSON.stringify(T):Fr(T)))}f=`{${g.join(", ")}}`}return`${d}${c?"("+c+")":""}[${f}]: ${s.replace(DU,`
  `)}`}function $g(s){return{toString:s}.toString()}var qP=function(s){return s[s.OnPush=0]="OnPush",s[s.Default=1]="Default",s}(qP||{}),Ps=function(s){return s[s.Emulated=0]="Emulated",s[s.None=2]="None",s[s.ShadowDom=3]="ShadowDom",s}(Ps||{}),Ru={},Ro=[],Cr=function(s){return s[s.None=0]="None",s[s.SignalBased=1]="SignalBased",s[s.HasDecoratorInputTransform=2]="HasDecoratorInputTransform",s}(Cr||{});function WP(s,a,d){let c=s.length;for(;;){let f=s.indexOf(a,d);if(f===-1)return f;if(f===0||s.charCodeAt(f-1)<=32){let g=a.length;if(f+g===c||s.charCodeAt(f+g)<=32)return f}d=f+1}}function B1(s,a,d){let c=0;for(;c<d.length;){let f=d[c];if(typeof f=="number"){if(f!==0)break;c++;let g=d[c++],x=d[c++],T=d[c++];s.setAttribute(a,x,T,g)}else{let g=f,x=d[++c];kU(g)?s.setProperty(a,g,x):s.setAttribute(a,g,x),c++}}return c}function FU(s){return s===3||s===4||s===6}function kU(s){return s.charCodeAt(0)===64}function wh(s,a){if(!(a===null||a.length===0))if(s===null||s.length===0)s=a.slice();else{let d=-1;for(let c=0;c<a.length;c++){let f=a[c];typeof f=="number"?d=f:d===0||(d===-1||d===2?uP(s,d,f,null,a[++c]):uP(s,d,f,null,null))}}return s}function uP(s,a,d,c,f){let g=0,x=s.length;if(a===-1)x=-1;else for(;g<s.length;){let T=s[g++];if(typeof T=="number"){if(T===a){x=-1;break}else if(T>a){x=g-1;break}}}for(;g<s.length;){let T=s[g];if(typeof T=="number")break;if(T===d){if(c===null){f!==null&&(s[g+1]=f);return}else if(c===s[g+1]){s[g+2]=f;return}}g++,c!==null&&g++,f!==null&&g++}x!==-1&&(s.splice(x,0,a),g=x+1),s.splice(g++,0,d),c!==null&&s.splice(g++,0,c),f!==null&&s.splice(g++,0,f)}var ZP="ng-template";function LU(s,a,d){let c=0,f=!0;for(;c<s.length;){let g=s[c++];if(typeof g=="string"&&f){let x=s[c++];if(d&&g==="class"&&WP(x.toLowerCase(),a,0)!==-1)return!0}else if(g===1){for(;c<s.length&&typeof(g=s[c++])=="string";)if(g.toLowerCase()===a)return!0;return!1}else typeof g=="number"&&(f=!1)}return!1}function XP(s){return s.type===4&&s.value!==ZP}function NU(s,a,d){let c=s.type===4&&!d?ZP:s.value;return a===c}function zU(s,a,d){let c=4,f=s.attrs||[],g=jU(f),x=!1;for(let T=0;T<a.length;T++){let P=a[T];if(typeof P=="number"){if(!x&&!ns(c)&&!ns(P))return!1;if(x&&ns(P))continue;x=!1,c=P|c&1;continue}if(!x)if(c&4){if(c=2|c&1,P!==""&&!NU(s,P,d)||P===""&&a.length===1){if(ns(c))return!1;x=!0}}else{let O=c&8?P:a[++T];if(c&8&&s.attrs!==null){if(!LU(s.attrs,O,d)){if(ns(c))return!1;x=!0}continue}let Z=c&8?"class":P,ee=BU(Z,f,XP(s),d);if(ee===-1){if(ns(c))return!1;x=!0;continue}if(O!==""){let ce;ee>g?ce="":ce=f[ee+1].toLowerCase();let Ee=c&8?ce:null;if(Ee&&WP(Ee,O,0)!==-1||c&2&&O!==ce){if(ns(c))return!1;x=!0}}}}return ns(c)||x}function ns(s){return(s&1)===0}function BU(s,a,d,c){if(a===null)return-1;let f=0;if(c||!d){let g=!1;for(;f<a.length;){let x=a[f];if(x===s)return f;if(x===3||x===6)g=!0;else if(x===1||x===2){let T=a[++f];for(;typeof T=="string";)T=a[++f];continue}else{if(x===4)break;if(x===0){f+=4;continue}}f+=g?1:2}return-1}else return UU(a,s)}function VU(s,a,d=!1){for(let c=0;c<a.length;c++)if(zU(s,a[c],d))return!0;return!1}function jU(s){for(let a=0;a<s.length;a++){let d=s[a];if(FU(d))return a}return s.length}function UU(s,a){let d=s.indexOf(4);if(d>-1)for(d++;d<s.length;){let c=s[d];if(typeof c=="number")return-1;if(c===a)return d;d++}return-1}function dP(s,a){return s?":not("+a.trim()+")":a}function $U(s){let a=s[0],d=1,c=2,f="",g=!1;for(;d<s.length;){let x=s[d];if(typeof x=="string")if(c&2){let T=s[++d];f+="["+x+(T.length>0?'="'+T+'"':"")+"]"}else c&8?f+="."+x:c&4&&(f+=" "+x);else f!==""&&!ns(x)&&(a+=dP(g,f),f=""),c=x,g=g||!ns(c);d++}return f!==""&&(a+=dP(g,f)),a}function GU(s){return s.map($U).join(",")}function HU(s){let a=[],d=[],c=1,f=2;for(;c<s.length;){let g=s[c];if(typeof g=="string")f===2?g!==""&&a.push(g,s[++c]):f===8&&d.push(g);else{if(!ns(f))break;f=g}c++}return{attrs:a,classes:d}}function tn(s){return $g(()=>{let a=tR(s),d=Qn(rt({},a),{decls:s.decls,vars:s.vars,template:s.template,consts:s.consts||null,ngContentSelectors:s.ngContentSelectors,onPush:s.changeDetection===qP.OnPush,directiveDefs:null,pipeDefs:null,dependencies:a.standalone&&s.dependencies||null,getStandaloneInjector:null,signals:s.signals??!1,data:s.data||{},encapsulation:s.encapsulation||Ps.Emulated,styles:s.styles||Ro,_:null,schemas:s.schemas||null,tView:null,id:""});nR(d);let c=s.dependencies;return d.directiveDefs=fP(c,!1),d.pipeDefs=fP(c,!0),d.id=ZU(d),d})}function qU(s){return nl(s)||KP(s)}function WU(s){return s!==null}function ss(s){return $g(()=>({type:s.type,bootstrap:s.bootstrap||Ro,declarations:s.declarations||Ro,imports:s.imports||Ro,exports:s.exports||Ro,transitiveCompileScopes:null,schemas:s.schemas||null,id:s.id||null}))}function hP(s,a){if(s==null)return Ru;let d={};for(let c in s)if(s.hasOwnProperty(c)){let f=s[c],g,x,T=Cr.None;Array.isArray(f)?(T=f[0],g=f[1],x=f[2]??g):(g=f,x=f),a?(d[g]=T!==Cr.None?[c,T]:c,a[g]=x):d[g]=c}return d}function _i(s){return $g(()=>{let a=tR(s);return nR(a),a})}function YP(s){return{type:s.type,name:s.name,factory:null,pure:s.pure!==!1,standalone:s.standalone===!0,onDestroy:s.type.prototype.ngOnDestroy||null}}function nl(s){return s[pU]||null}function KP(s){return s[mU]||null}function JP(s){return s[gU]||null}function QP(s){let a=nl(s)||KP(s)||JP(s);return a!==null?a.standalone:!1}function eR(s,a){let d=s[_U]||null;if(!d&&a===!0)throw new Error(`Type ${Fr(s)} does not have '\u0275mod' property.`);return d}function tR(s){let a={};return{type:s.type,providersResolver:null,factory:null,hostBindings:s.hostBindings||null,hostVars:s.hostVars||0,hostAttrs:s.hostAttrs||null,contentQueries:s.contentQueries||null,declaredInputs:a,inputTransforms:null,inputConfig:s.inputs||Ru,exportAs:s.exportAs||null,standalone:s.standalone===!0,signals:s.signals===!0,selectors:s.selectors||Ro,viewQuery:s.viewQuery||null,features:s.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:hP(s.inputs,a),outputs:hP(s.outputs),debugInfo:null}}function nR(s){s.features?.forEach(a=>a(s))}function fP(s,a){if(!s)return null;let d=a?JP:qU;return()=>(typeof s=="function"?s():s).map(c=>d(c)).filter(WU)}function ZU(s){let a=0,d=[s.selectors,s.ngContentSelectors,s.hostVars,s.hostAttrs,s.consts,s.vars,s.decls,s.encapsulation,s.standalone,s.signals,s.exportAs,JSON.stringify(s.inputs),JSON.stringify(s.outputs),Object.getOwnPropertyNames(s.type.prototype),!!s.contentQueries,!!s.viewQuery].join("|");for(let f of d)a=Math.imul(31,a)+f.charCodeAt(0)<<0;return a+=2147483648,"c"+a}var da=0,mn=1,en=2,Er=3,is=4,as=5,Ch=6,Eh=7,wr=8,Ou=9,aa=10,nr=11,Th=12,pP=13,Bu=14,rs=15,Gg=16,Mu=17,Ih=18,Hg=19,iR=20,xh=21,x1=22,Ql=23,eo=25,rR=1;var ec=7,wg=8,Cg=9,kr=10,Cb=function(s){return s[s.None=0]="None",s[s.HasTransplantedViews=2]="HasTransplantedViews",s}(Cb||{});function Kl(s){return Array.isArray(s)&&typeof s[rR]=="object"}function ha(s){return Array.isArray(s)&&s[rR]===!0}function oR(s){return(s.flags&4)!==0}function qg(s){return s.componentOffset>-1}function Eb(s){return(s.flags&1)===1}function il(s){return!!s.template}function XU(s){return(s[en]&512)!==0}function tc(s,a){let d=s.hasOwnProperty(xg);return d?s[xg]:null}var V1=class{constructor(a,d,c){this.previousValue=a,this.currentValue=d,this.firstChange=c}isFirstChange(){return this.firstChange}};function sR(s,a,d,c){a!==null?a.applyValueToInputSignal(a,c):s[d]=c}function ol(){return aR}function aR(s){return s.type.prototype.ngOnChanges&&(s.setInput=KU),YU}ol.ngInherit=!0;function YU(){let s=cR(this),a=s?.current;if(a){let d=s.previous;if(d===Ru)s.previous=a;else for(let c in a)d[c]=a[c];s.current=null,this.ngOnChanges(a)}}function KU(s,a,d,c,f){let g=this.declaredInputs[c],x=cR(s)||JU(s,{previous:Ru,current:null}),T=x.current||(x.current={}),P=x.previous,O=P[g];T[g]=new V1(O&&O.currentValue,d,P===Ru),sR(s,a,f,d)}var lR="__ngSimpleChanges__";function cR(s){return s[lR]||null}function JU(s,a){return s[lR]=a}var mP=null;var Ss=function(s,a,d){mP?.(s,a,d)},uR="svg",QU="math",e6=!1;function t6(){return e6}function Rs(s){for(;Array.isArray(s);)s=s[da];return s}function dR(s,a){return Rs(a[s])}function Oo(s,a){return Rs(a[s.index])}function Tb(s,a){return s.data[a]}function hR(s,a){return s[a]}function sl(s,a){let d=a[s];return Kl(d)?d:d[da]}function Ib(s){return(s[en]&128)===128}function n6(s){return ha(s[Er])}function Eg(s,a){return a==null?null:s[a]}function fR(s){s[Mu]=0}function i6(s){s[en]&1024||(s[en]|=1024,Ib(s)&&Mh(s))}function r6(s,a){for(;s>0;)a=a[Bu],s--;return a}function pR(s){return s[en]&9216||s[Ql]?.dirty}function j1(s){pR(s)?Mh(s):s[en]&64&&(t6()?(s[en]|=1024,Mh(s)):s[aa].changeDetectionScheduler?.notify())}function Mh(s){s[aa].changeDetectionScheduler?.notify();let a=Dh(s);for(;a!==null&&!(a[en]&8192||(a[en]|=8192,!Ib(a)));)a=Dh(a)}function o6(s,a){if((s[en]&256)===256)throw new $t(911,!1);s[xh]===null&&(s[xh]=[]),s[xh].push(a)}function Dh(s){let a=s[Er];return ha(a)?a[Er]:a}var hn={lFrame:CR(null),bindingsEnabled:!0,skipHydrationRootTNode:null};function s6(){return hn.lFrame.elementDepthCount}function a6(){hn.lFrame.elementDepthCount++}function l6(){hn.lFrame.elementDepthCount--}function mR(){return hn.bindingsEnabled}function c6(){return hn.skipHydrationRootTNode!==null}function u6(s){return hn.skipHydrationRootTNode===s}function d6(){hn.skipHydrationRootTNode=null}function Xn(){return hn.lFrame.lView}function ho(){return hn.lFrame.tView}function xt(s){return hn.lFrame.contextLView=s,s[wr]}function bt(s){return hn.lFrame.contextLView=null,s}function Fo(){let s=gR();for(;s!==null&&s.type===64;)s=s.parent;return s}function gR(){return hn.lFrame.currentTNode}function h6(){let s=hn.lFrame,a=s.currentTNode;return s.isParent?a:a.parent}function Lh(s,a){let d=hn.lFrame;d.currentTNode=s,d.isParent=a}function _R(){return hn.lFrame.isParent}function f6(){hn.lFrame.isParent=!1}function p6(){return hn.lFrame.contextLView}function yR(){let s=hn.lFrame,a=s.bindingRootIndex;return a===-1&&(a=s.bindingRootIndex=s.tView.bindingStartIndex),a}function m6(){return hn.lFrame.bindingIndex}function g6(s){return hn.lFrame.bindingIndex=s}function Nh(){return hn.lFrame.bindingIndex++}function vR(s){let a=hn.lFrame,d=a.bindingIndex;return a.bindingIndex=a.bindingIndex+s,d}function _6(){return hn.lFrame.inI18n}function y6(s,a){let d=hn.lFrame;d.bindingIndex=d.bindingRootIndex=s,U1(a)}function v6(){return hn.lFrame.currentDirectiveIndex}function U1(s){hn.lFrame.currentDirectiveIndex=s}function x6(s){let a=hn.lFrame.currentDirectiveIndex;return a===-1?null:s[a]}function xR(s){hn.lFrame.currentQueryIndex=s}function b6(s){let a=s[mn];return a.type===2?a.declTNode:a.type===1?s[as]:null}function bR(s,a,d){if(d&Tn.SkipSelf){let f=a,g=s;for(;f=f.parent,f===null&&!(d&Tn.Host);)if(f=b6(g),f===null||(g=g[Bu],f.type&10))break;if(f===null)return!1;a=f,s=g}let c=hn.lFrame=wR();return c.currentTNode=a,c.lView=s,!0}function Mb(s){let a=wR(),d=s[mn];hn.lFrame=a,a.currentTNode=d.firstChild,a.lView=s,a.tView=d,a.contextLView=s,a.bindingIndex=d.bindingStartIndex,a.inI18n=!1}function wR(){let s=hn.lFrame,a=s===null?null:s.child;return a===null?CR(s):a}function CR(s){let a={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:s,child:null,inI18n:!1};return s!==null&&(s.child=a),a}function ER(){let s=hn.lFrame;return hn.lFrame=s.parent,s.currentTNode=null,s.lView=null,s}var TR=ER;function Db(){let s=ER();s.isParent=!0,s.tView=null,s.selectedIndex=-1,s.contextLView=null,s.elementDepthCount=0,s.currentDirectiveIndex=-1,s.currentNamespace=null,s.bindingRootIndex=-1,s.bindingIndex=-1,s.currentQueryIndex=0}function w6(s){return(hn.lFrame.contextLView=r6(s,hn.lFrame.contextLView))[wr]}function al(){return hn.lFrame.selectedIndex}function nc(s){hn.lFrame.selectedIndex=s}function Sb(){let s=hn.lFrame;return Tb(s.tView,s.selectedIndex)}function Ab(){hn.lFrame.currentNamespace=uR}function Pb(){C6()}function C6(){hn.lFrame.currentNamespace=null}function E6(){return hn.lFrame.currentNamespace}var IR=!0;function Rb(){return IR}function Ob(s){IR=s}function T6(s,a,d){let{ngOnChanges:c,ngOnInit:f,ngDoCheck:g}=a.type.prototype;if(c){let x=aR(a);(d.preOrderHooks??=[]).push(s,x),(d.preOrderCheckHooks??=[]).push(s,x)}f&&(d.preOrderHooks??=[]).push(0-s,f),g&&((d.preOrderHooks??=[]).push(s,g),(d.preOrderCheckHooks??=[]).push(s,g))}function Fb(s,a){for(let d=a.directiveStart,c=a.directiveEnd;d<c;d++){let g=s.data[d].type.prototype,{ngAfterContentInit:x,ngAfterContentChecked:T,ngAfterViewInit:P,ngAfterViewChecked:O,ngOnDestroy:Z}=g;x&&(s.contentHooks??=[]).push(-d,x),T&&((s.contentHooks??=[]).push(d,T),(s.contentCheckHooks??=[]).push(d,T)),P&&(s.viewHooks??=[]).push(-d,P),O&&((s.viewHooks??=[]).push(d,O),(s.viewCheckHooks??=[]).push(d,O)),Z!=null&&(s.destroyHooks??=[]).push(d,Z)}}function mg(s,a,d){MR(s,a,3,d)}function gg(s,a,d,c){(s[en]&3)===d&&MR(s,a,d,c)}function b1(s,a){let d=s[en];(d&3)===a&&(d&=16383,d+=1,s[en]=d)}function MR(s,a,d,c){let f=c!==void 0?s[Mu]&65535:0,g=c??-1,x=a.length-1,T=0;for(let P=f;P<x;P++)if(typeof a[P+1]=="number"){if(T=a[P],c!=null&&T>=c)break}else a[P]<0&&(s[Mu]+=65536),(T<g||g==-1)&&(I6(s,d,a,P),s[Mu]=(s[Mu]&4294901760)+P+2),P++}function gP(s,a){Ss(4,s,a);let d=fr(null);try{a.call(s)}finally{fr(d),Ss(5,s,a)}}function I6(s,a,d,c){let f=d[c]<0,g=d[c+1],x=f?-d[c]:d[c],T=s[x];f?s[en]>>14<s[Mu]>>16&&(s[en]&3)===a&&(s[en]+=16384,gP(T,g)):gP(T,g)}var Au=-1,ic=class{constructor(a,d,c){this.factory=a,this.resolving=!1,this.canSeeViewProviders=d,this.injectImpl=c}};function M6(s){return s instanceof ic}function D6(s){return(s.flags&8)!==0}function S6(s){return(s.flags&16)!==0}function DR(s){return s!==Au}function Tg(s){return s&32767}function A6(s){return s>>16}function Ig(s,a){let d=A6(s),c=a;for(;d>0;)c=c[Bu],d--;return c}var $1=!0;function Mg(s){let a=$1;return $1=s,a}var P6=256,SR=P6-1,AR=5,R6=0,As={};function O6(s,a,d){let c;typeof d=="string"?c=d.charCodeAt(0)||0:d.hasOwnProperty(yh)&&(c=d[yh]),c==null&&(c=d[yh]=R6++);let f=c&SR,g=1<<f;a.data[s+(f>>AR)]|=g}function Dg(s,a){let d=PR(s,a);if(d!==-1)return d;let c=a[mn];c.firstCreatePass&&(s.injectorIndex=a.length,w1(c.data,s),w1(a,null),w1(c.blueprint,null));let f=kb(s,a),g=s.injectorIndex;if(DR(f)){let x=Tg(f),T=Ig(f,a),P=T[mn].data;for(let O=0;O<8;O++)a[g+O]=T[x+O]|P[x+O]}return a[g+8]=f,g}function w1(s,a){s.push(0,0,0,0,0,0,0,0,a)}function PR(s,a){return s.injectorIndex===-1||s.parent&&s.parent.injectorIndex===s.injectorIndex||a[s.injectorIndex+8]===null?-1:s.injectorIndex}function kb(s,a){if(s.parent&&s.parent.injectorIndex!==-1)return s.parent.injectorIndex;let d=0,c=null,f=a;for(;f!==null;){if(c=LR(f),c===null)return Au;if(d++,f=f[Bu],c.injectorIndex!==-1)return c.injectorIndex|d<<16}return Au}function G1(s,a,d){O6(s,a,d)}function RR(s,a,d){if(d&Tn.Optional||s!==void 0)return s;wb(a,"NodeInjector")}function OR(s,a,d,c){if(d&Tn.Optional&&c===void 0&&(c=null),!(d&(Tn.Self|Tn.Host))){let f=s[Ou],g=Qr(void 0);try{return f?f.get(a,c,d&Tn.Optional):HP(a,c,d&Tn.Optional)}finally{Qr(g)}}return RR(c,a,d)}function FR(s,a,d,c=Tn.Default,f){if(s!==null){if(a[en]&2048&&!(c&Tn.Self)){let x=z6(s,a,d,c,As);if(x!==As)return x}let g=kR(s,a,d,c,As);if(g!==As)return g}return OR(a,d,c,f)}function kR(s,a,d,c,f){let g=L6(d);if(typeof g=="function"){if(!bR(a,s,c))return c&Tn.Host?RR(f,d,c):OR(a,d,c,f);try{let x;if(x=g(c),x==null&&!(c&Tn.Optional))wb(d);else return x}finally{TR()}}else if(typeof g=="number"){let x=null,T=PR(s,a),P=Au,O=c&Tn.Host?a[rs][as]:null;for((T===-1||c&Tn.SkipSelf)&&(P=T===-1?kb(s,a):a[T+8],P===Au||!yP(c,!1)?T=-1:(x=a[mn],T=Tg(P),a=Ig(P,a)));T!==-1;){let Z=a[mn];if(_P(g,T,Z.data)){let ee=F6(T,a,d,x,c,O);if(ee!==As)return ee}P=a[T+8],P!==Au&&yP(c,a[mn].data[T+8]===O)&&_P(g,T,a)?(x=Z,T=Tg(P),a=Ig(P,a)):T=-1}}return f}function F6(s,a,d,c,f,g){let x=a[mn],T=x.data[s+8],P=c==null?qg(T)&&$1:c!=x&&(T.type&3)!==0,O=f&Tn.Host&&g===T,Z=k6(T,x,d,P,O);return Z!==null?Fu(a,x,Z,T):As}function k6(s,a,d,c,f){let g=s.providerIndexes,x=a.data,T=g&1048575,P=s.directiveStart,O=s.directiveEnd,Z=g>>20,ee=c?T:T+Z,ce=f?T+Z:O;for(let Ee=ee;Ee<ce;Ee++){let Ze=x[Ee];if(Ee<P&&d===Ze||Ee>=P&&Ze.type===d)return Ee}if(f){let Ee=x[P];if(Ee&&il(Ee)&&Ee.type===d)return P}return null}function Fu(s,a,d,c){let f=s[d],g=a.data;if(M6(f)){let x=f;x.resolving&&vU(yU(g[d]));let T=Mg(x.canSeeViewProviders);x.resolving=!0;let P,O=x.injectImpl?Qr(x.injectImpl):null,Z=bR(s,c,Tn.Default);try{f=s[d]=x.factory(void 0,g,s,c),a.firstCreatePass&&d>=c.directiveStart&&T6(d,g[d],a)}finally{O!==null&&Qr(O),Mg(T),x.resolving=!1,TR()}}return f}function L6(s){if(typeof s=="string")return s.charCodeAt(0)||0;let a=s.hasOwnProperty(yh)?s[yh]:void 0;return typeof a=="number"?a>=0?a&SR:N6:a}function _P(s,a,d){let c=1<<s;return!!(d[a+(s>>AR)]&c)}function yP(s,a){return!(s&Tn.Self)&&!(s&Tn.Host&&a)}var Jl=class{constructor(a,d){this._tNode=a,this._lView=d}get(a,d,c){return FR(this._tNode,this._lView,a,Ug(c),d)}};function N6(){return new Jl(Fo(),Xn())}function fo(s){return $g(()=>{let a=s.prototype.constructor,d=a[xg]||H1(a),c=Object.prototype,f=Object.getPrototypeOf(s.prototype).constructor;for(;f&&f!==c;){let g=f[xg]||H1(f);if(g&&g!==d)return g;f=Object.getPrototypeOf(f)}return g=>new g})}function H1(s){return VP(s)?()=>{let a=H1(Or(s));return a&&a()}:tc(s)}function z6(s,a,d,c,f){let g=s,x=a;for(;g!==null&&x!==null&&x[en]&2048&&!(x[en]&512);){let T=kR(g,x,d,c|Tn.Self,As);if(T!==As)return T;let P=g.parent;if(!P){let O=x[iR];if(O){let Z=O.get(d,As,c);if(Z!==As)return Z}P=LR(x),x=x[Bu]}g=P}return f}function LR(s){let a=s[mn],d=a.type;return d===2?a.declTNode:d===1?s[as]:null}function B6(s){return typeof s=="function"}function Lb(s,a){s.forEach(d=>Array.isArray(d)?Lb(d,a):a(d))}function NR(s,a,d){a>=s.length?s.push(d):s.splice(a,0,d)}function Sg(s,a){return a>=s.length-1?s.pop():s.splice(a,1)[0]}function V6(s,a,d,c){let f=s.length;if(f==a)s.push(d,c);else if(f===1)s.push(c,s[0]),s[0]=d;else{for(f--,s.push(s[f-1],s[f]);f>a;){let g=f-2;s[f]=s[g],f--}s[a]=d,s[a+1]=c}}function j6(s,a,d){let c=zh(s,a);return c>=0?s[c|1]=d:(c=~c,V6(s,c,a,d)),c}function C1(s,a){let d=zh(s,a);if(d>=0)return s[d|1]}function zh(s,a){return U6(s,a,1)}function U6(s,a,d){let c=0,f=s.length>>d;for(;f!==c;){let g=c+(f-c>>1),x=s[g<<d];if(a===x)return g<<d;x>a?f=g:c=g+1}return~(f<<d)}var ku=new zt("ENVIRONMENT_INITIALIZER"),zR=new zt("INJECTOR",-1),BR=new zt("INJECTOR_DEF_TYPES"),Ag=class{get(a,d=bh){if(d===bh){let c=new Error(`NullInjectorError: No provider for ${Fr(a)}!`);throw c.name="NullInjectorError",c}return d}};function Vu(s){return{\u0275providers:s}}function $6(...s){return{\u0275providers:VR(!0,s),\u0275fromNgModule:!0}}function VR(s,...a){let d=[],c=new Set,f,g=x=>{d.push(x)};return Lb(a,x=>{let T=x;q1(T,g,[],c)&&(f||=[],f.push(T))}),f!==void 0&&jR(f,g),d}function jR(s,a){for(let d=0;d<s.length;d++){let{ngModule:c,providers:f}=s[d];Nb(f,g=>{a(g,c)})}}function q1(s,a,d,c){if(s=Or(s),!s)return!1;let f=null,g=aP(s),x=!g&&nl(s);if(!g&&!x){let P=s.ngModule;if(g=aP(P),g)f=P;else return!1}else{if(x&&!x.standalone)return!1;f=s}let T=c.has(f);if(x){if(T)return!1;if(c.add(f),x.dependencies){let P=typeof x.dependencies=="function"?x.dependencies():x.dependencies;for(let O of P)q1(O,a,d,c)}}else if(g){if(g.imports!=null&&!T){c.add(f);let O;try{Lb(g.imports,Z=>{q1(Z,a,d,c)&&(O||=[],O.push(Z))})}finally{}O!==void 0&&jR(O,a)}if(!T){let O=tc(f)||(()=>new f);a({provide:f,useFactory:O,deps:Ro},f),a({provide:BR,useValue:f,multi:!0},f),a({provide:ku,useValue:()=>vt(f),multi:!0},f)}let P=g.providers;if(P!=null&&!T){let O=s;Nb(P,Z=>{a(Z,O)})}}else return!1;return f!==s&&s.providers!==void 0}function Nb(s,a){for(let d of s)jP(d)&&(d=d.\u0275providers),Array.isArray(d)?Nb(d,a):a(d)}var G6=ci({provide:String,useValue:ci});function UR(s){return s!==null&&typeof s=="object"&&G6 in s}function H6(s){return!!(s&&s.useExisting)}function q6(s){return!!(s&&s.useFactory)}function Lu(s){return typeof s=="function"}function W6(s){return!!s.useClass}var Wg=new zt("Set Injector scope."),_g={},Z6={},E1;function zb(){return E1===void 0&&(E1=new Ag),E1}var to=class{},Sh=class extends to{get destroyed(){return this._destroyed}constructor(a,d,c,f){super(),this.parent=d,this.source=c,this.scopes=f,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Z1(a,x=>this.processProvider(x)),this.records.set(zR,Du(void 0,this)),f.has("environment")&&this.records.set(to,Du(void 0,this));let g=this.records.get(Wg);g!=null&&typeof g.value=="string"&&this.scopes.add(g.value),this.injectorDefTypes=new Set(this.get(BR,Ro,Tn.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(let d of this._ngOnDestroyHooks)d.ngOnDestroy();let a=this._onDestroyHooks;this._onDestroyHooks=[];for(let d of a)d()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear()}}onDestroy(a){return this.assertNotDestroyed(),this._onDestroyHooks.push(a),()=>this.removeOnDestroy(a)}runInContext(a){this.assertNotDestroyed();let d=tl(this),c=Qr(void 0),f;try{return a()}finally{tl(d),Qr(c)}}get(a,d=bh,c=Tn.Default){if(this.assertNotDestroyed(),a.hasOwnProperty(oP))return a[oP](this);c=Ug(c);let f,g=tl(this),x=Qr(void 0);try{if(!(c&Tn.SkipSelf)){let P=this.records.get(a);if(P===void 0){let O=Q6(a)&&jg(a);O&&this.injectableDefInScope(O)?P=Du(W1(a),_g):P=null,this.records.set(a,P)}if(P!=null)return this.hydrate(a,P)}let T=c&Tn.Self?zb():this.parent;return d=c&Tn.Optional&&d===bh?null:d,T.get(a,d)}catch(T){if(T.name==="NullInjectorError"){if((T[bg]=T[bg]||[]).unshift(Fr(a)),g)throw T;return RU(T,a,"R3InjectorError",this.source)}else throw T}finally{Qr(x),tl(g)}}resolveInjectorInitializers(){let a=tl(this),d=Qr(void 0),c;try{let f=this.get(ku,Ro,Tn.Self);for(let g of f)g()}finally{tl(a),Qr(d)}}toString(){let a=[],d=this.records;for(let c of d.keys())a.push(Fr(c));return`R3Injector[${a.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new $t(205,!1)}processProvider(a){a=Or(a);let d=Lu(a)?a:Or(a&&a.provide),c=Y6(a);if(!Lu(a)&&a.multi===!0){let f=this.records.get(d);f||(f=Du(void 0,_g,!0),f.factory=()=>z1(f.multi),this.records.set(d,f)),d=a,f.multi.push(a)}this.records.set(d,c)}hydrate(a,d){return d.value===_g&&(d.value=Z6,d.value=d.factory()),typeof d.value=="object"&&d.value&&J6(d.value)&&this._ngOnDestroyHooks.add(d.value),d.value}injectableDefInScope(a){if(!a.providedIn)return!1;let d=Or(a.providedIn);return typeof d=="string"?d==="any"||this.scopes.has(d):this.injectorDefTypes.has(d)}removeOnDestroy(a){let d=this._onDestroyHooks.indexOf(a);d!==-1&&this._onDestroyHooks.splice(d,1)}};function W1(s){let a=jg(s),d=a!==null?a.factory:tc(s);if(d!==null)return d;if(s instanceof zt)throw new $t(204,!1);if(s instanceof Function)return X6(s);throw new $t(204,!1)}function X6(s){if(s.length>0)throw new $t(204,!1);let d=wU(s);return d!==null?()=>d.factory(s):()=>new s}function Y6(s){if(UR(s))return Du(void 0,s.useValue);{let a=$R(s);return Du(a,_g)}}function $R(s,a,d){let c;if(Lu(s)){let f=Or(s);return tc(f)||W1(f)}else if(UR(s))c=()=>Or(s.useValue);else if(q6(s))c=()=>s.useFactory(...z1(s.deps||[]));else if(H6(s))c=()=>vt(Or(s.useExisting));else{let f=Or(s&&(s.useClass||s.provide));if(K6(s))c=()=>new f(...z1(s.deps));else return tc(f)||W1(f)}return c}function Du(s,a,d=!1){return{factory:s,value:a,multi:d?[]:void 0}}function K6(s){return!!s.deps}function J6(s){return s!==null&&typeof s=="object"&&typeof s.ngOnDestroy=="function"}function Q6(s){return typeof s=="function"||typeof s=="object"&&s instanceof zt}function Z1(s,a){for(let d of s)Array.isArray(d)?Z1(d,a):d&&jP(d)?Z1(d.\u0275providers,a):a(d)}function fa(s,a){s instanceof Sh&&s.assertNotDestroyed();let d,c=tl(s),f=Qr(void 0);try{return a()}finally{tl(c),Qr(f)}}function vP(s,a=null,d=null,c){let f=GR(s,a,d,c);return f.resolveInjectorInitializers(),f}function GR(s,a=null,d=null,c,f=new Set){let g=[d||Ro,$6(s)];return c=c||(typeof s=="object"?void 0:Fr(s)),new Sh(g,a||zb(),c||null,f)}var ac=(()=>{let a=class a{static create(c,f){if(Array.isArray(c))return vP({name:""},f,c,"");{let g=c.name??"";return vP({name:g},c.parent,c.providers,g)}}};a.THROW_IF_NOT_FOUND=bh,a.NULL=new Ag,a.\u0275prov=gt({token:a,providedIn:"any",factory:()=>vt(zR)}),a.__NG_ELEMENT_ID__=-1;let s=a;return s})();var X1;function HR(s){X1=s}function e$(){if(X1!==void 0)return X1;if(typeof document<"u")return document;throw new $t(210,!1)}var Bb=new zt("AppId",{providedIn:"root",factory:()=>t$}),t$="ng",Vb=new zt("Platform Initializer"),Os=new zt("Platform ID",{providedIn:"platform",factory:()=>"unknown"});var jb=new zt("CSP nonce",{providedIn:"root",factory:()=>e$().body?.querySelector("[ngCspNonce]")?.getAttribute("ngCspNonce")||null});function qR(s){return s instanceof Function?s():s}function WR(s){return(s.flags&128)===128}var la=function(s){return s[s.Important=1]="Important",s[s.DashCase=2]="DashCase",s}(la||{});var ZR=new Map,n$=0;function i$(){return n$++}function r$(s){ZR.set(s[Hg],s)}function o$(s){ZR.delete(s[Hg])}var xP="__ngContext__";function rc(s,a){Kl(a)?(s[xP]=a[Hg],r$(a)):s[xP]=a}var s$;function Ub(s,a){return s$(s,a)}function Su(s,a,d,c,f){if(c!=null){let g,x=!1;ha(c)?g=c:Kl(c)&&(x=!0,c=c[da]);let T=Rs(c);s===0&&d!==null?f==null?JR(a,d,T):Pg(a,d,T,f||null,!0):s===1&&d!==null?Pg(a,d,T,f||null,!0):s===2?C$(a,T,x):s===3&&a.destroyNode(T),g!=null&&T$(a,s,g,d,f)}}function a$(s,a){return s.createText(a)}function l$(s,a,d){s.setValue(a,d)}function XR(s,a,d){return s.createElement(a,d)}function c$(s,a){YR(s,a),a[da]=null,a[as]=null}function u$(s,a,d,c,f,g){c[da]=f,c[as]=a,Xg(s,c,d,1,f,g)}function YR(s,a){Xg(s,a,a[nr],2,null,null)}function d$(s){let a=s[Th];if(!a)return T1(s[mn],s);for(;a;){let d=null;if(Kl(a))d=a[Th];else{let c=a[kr];c&&(d=c)}if(!d){for(;a&&!a[is]&&a!==s;)Kl(a)&&T1(a[mn],a),a=a[Er];a===null&&(a=s),Kl(a)&&T1(a[mn],a),d=a&&a[is]}a=d}}function h$(s,a,d,c){let f=kr+c,g=d.length;c>0&&(d[f-1][is]=a),c<g-kr?(a[is]=d[f],NR(d,kr+c,a)):(d.push(a),a[is]=null),a[Er]=d;let x=a[Gg];x!==null&&d!==x&&f$(x,a);let T=a[Ih];T!==null&&T.insertView(s),j1(a),a[en]|=128}function f$(s,a){let d=s[Cg],f=a[Er][Er][rs];a[rs]!==f&&(s[en]|=Cb.HasTransplantedViews),d===null?s[Cg]=[a]:d.push(a)}function KR(s,a){let d=s[Cg],c=d.indexOf(a);d.splice(c,1)}function Ah(s,a){if(s.length<=kr)return;let d=kr+a,c=s[d];if(c){let f=c[Gg];f!==null&&f!==s&&KR(f,c),a>0&&(s[d-1][is]=c[is]);let g=Sg(s,kr+a);c$(c[mn],c);let x=g[Ih];x!==null&&x.detachView(g[mn]),c[Er]=null,c[is]=null,c[en]&=-129}return c}function Zg(s,a){if(!(a[en]&256)){let d=a[nr];d.destroyNode&&Xg(s,a,d,3,null,null),d$(a)}}function T1(s,a){if(!(a[en]&256)){a[en]&=-129,a[en]|=256,a[Ql]&&RA(a[Ql]),m$(s,a),p$(s,a),a[mn].type===1&&a[nr].destroy();let d=a[Gg];if(d!==null&&ha(a[Er])){d!==a[Er]&&KR(d,a);let c=a[Ih];c!==null&&c.detachView(s)}o$(a)}}function p$(s,a){let d=s.cleanup,c=a[Eh];if(d!==null)for(let g=0;g<d.length-1;g+=2)if(typeof d[g]=="string"){let x=d[g+3];x>=0?c[x]():c[-x].unsubscribe(),g+=2}else{let x=c[d[g+1]];d[g].call(x)}c!==null&&(a[Eh]=null);let f=a[xh];if(f!==null){a[xh]=null;for(let g=0;g<f.length;g++){let x=f[g];x()}}}function m$(s,a){let d;if(s!=null&&(d=s.destroyHooks)!=null)for(let c=0;c<d.length;c+=2){let f=a[d[c]];if(!(f instanceof ic)){let g=d[c+1];if(Array.isArray(g))for(let x=0;x<g.length;x+=2){let T=f[g[x]],P=g[x+1];Ss(4,T,P);try{P.call(T)}finally{Ss(5,T,P)}}else{Ss(4,f,g);try{g.call(f)}finally{Ss(5,f,g)}}}}}function g$(s,a,d){return _$(s,a.parent,d)}function _$(s,a,d){let c=a;for(;c!==null&&c.type&40;)a=c,c=a.parent;if(c===null)return d[da];{let{componentOffset:f}=c;if(f>-1){let{encapsulation:g}=s.data[c.directiveStart+f];if(g===Ps.None||g===Ps.Emulated)return null}return Oo(c,d)}}function Pg(s,a,d,c,f){s.insertBefore(a,d,c,f)}function JR(s,a,d){s.appendChild(a,d)}function bP(s,a,d,c,f){c!==null?Pg(s,a,d,c,f):JR(s,a,d)}function y$(s,a,d,c){s.removeChild(a,d,c)}function $b(s,a){return s.parentNode(a)}function v$(s,a){return s.nextSibling(a)}function x$(s,a,d){return w$(s,a,d)}function b$(s,a,d){return s.type&40?Oo(s,d):null}var w$=b$,wP;function Gb(s,a,d,c){let f=g$(s,c,a),g=a[nr],x=c.parent||a[as],T=x$(x,c,a);if(f!=null)if(Array.isArray(d))for(let P=0;P<d.length;P++)bP(g,f,d[P],T,!1);else bP(g,f,d,T,!1);wP!==void 0&&wP(g,c,a,d,f)}function yg(s,a){if(a!==null){let d=a.type;if(d&3)return Oo(a,s);if(d&4)return Y1(-1,s[a.index]);if(d&8){let c=a.child;if(c!==null)return yg(s,c);{let f=s[a.index];return ha(f)?Y1(-1,f):Rs(f)}}else{if(d&32)return Ub(a,s)()||Rs(s[a.index]);{let c=QR(s,a);if(c!==null){if(Array.isArray(c))return c[0];let f=Dh(s[rs]);return yg(f,c)}else return yg(s,a.next)}}}return null}function QR(s,a){if(a!==null){let c=s[rs][as],f=a.projection;return c.projection[f]}return null}function Y1(s,a){let d=kr+s+1;if(d<a.length){let c=a[d],f=c[mn].firstChild;if(f!==null)return yg(c,f)}return a[ec]}function C$(s,a,d){let c=$b(s,a);c&&y$(s,c,a,d)}function Hb(s,a,d,c,f,g,x){for(;d!=null;){let T=c[d.index],P=d.type;if(x&&a===0&&(T&&rc(Rs(T),c),d.flags|=2),(d.flags&32)!==32)if(P&8)Hb(s,a,d.child,c,f,g,!1),Su(a,s,f,T,g);else if(P&32){let O=Ub(d,c),Z;for(;Z=O();)Su(a,s,f,Z,g);Su(a,s,f,T,g)}else P&16?E$(s,a,c,d,f,g):Su(a,s,f,T,g);d=x?d.projectionNext:d.next}}function Xg(s,a,d,c,f,g){Hb(d,c,s.firstChild,a,f,g,!1)}function E$(s,a,d,c,f,g){let x=d[rs],P=x[as].projection[c.projection];if(Array.isArray(P))for(let O=0;O<P.length;O++){let Z=P[O];Su(a,s,f,Z,g)}else{let O=P,Z=x[Er];WR(c)&&(O.flags|=128),Hb(s,a,O,Z,f,g,!0)}}function T$(s,a,d,c,f){let g=d[ec],x=Rs(d);g!==x&&Su(a,s,c,g,f);for(let T=kr;T<d.length;T++){let P=d[T];Xg(P[mn],P,s,a,c,g)}}function I$(s,a,d,c,f){if(a)f?s.addClass(d,c):s.removeClass(d,c);else{let g=c.indexOf("-")===-1?void 0:la.DashCase;f==null?s.removeStyle(d,c,g):(typeof f=="string"&&f.endsWith("!important")&&(f=f.slice(0,-10),g|=la.Important),s.setStyle(d,c,f,g))}}function M$(s,a,d){s.setAttribute(a,"style",d)}function eO(s,a,d){d===""?s.removeAttribute(a,"class"):s.setAttribute(a,"class",d)}function tO(s,a,d){let{mergedAttrs:c,classes:f,styles:g}=d;c!==null&&B1(s,a,c),f!==null&&eO(s,a,f),g!==null&&M$(s,a,g)}var Rg=class{constructor(a){this.changingThisBreaksApplicationSecurity=a}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${BP})`}};function Yg(s){return s instanceof Rg?s.changingThisBreaksApplicationSecurity:s}function nO(s,a){let d=D$(s);if(d!=null&&d!==a){if(d==="ResourceURL"&&a==="URL")return!0;throw new Error(`Required a safe ${a}, got a ${d} (see ${BP})`)}return d===a}function D$(s){return s instanceof Rg&&s.getTypeName()||null}var S$=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;function iO(s){return s=String(s),s.match(S$)?s:"unsafe:"+s}var qb=function(s){return s[s.NONE=0]="NONE",s[s.HTML=1]="HTML",s[s.STYLE=2]="STYLE",s[s.SCRIPT=3]="SCRIPT",s[s.URL=4]="URL",s[s.RESOURCE_URL=5]="RESOURCE_URL",s}(qb||{});function ir(s){let a=A$();return a?a.sanitize(qb.URL,s)||"":nO(s,"URL")?Yg(s):iO(Pu(s))}function A$(){let s=Xn();return s&&s[aa].sanitizer}var K1=class{};var P$="h",R$="b";var O$=()=>null;function Wb(s,a,d=!1){return O$(s,a,d)}var J1=class{},Og=class{};function F$(s){let a=Error(`No component factory found for ${Fr(s)}.`);return a[k$]=s,a}var k$="ngComponent";var Q1=class{resolveComponentFactory(a){throw F$(a)}},Kg=(()=>{let a=class a{};a.NULL=new Q1;let s=a;return s})();function L$(){return Jg(Fo(),Xn())}function Jg(s,a){return new Fs(Oo(s,a))}var Fs=(()=>{let a=class a{constructor(c){this.nativeElement=c}};a.__NG_ELEMENT_ID__=L$;let s=a;return s})();var Ph=class{},ls=(()=>{let a=class a{constructor(){this.destroyNode=null}};a.__NG_ELEMENT_ID__=()=>N$();let s=a;return s})();function N$(){let s=Xn(),a=Fo(),d=sl(a.index,s);return(Kl(d)?d:s)[nr]}var z$=(()=>{let a=class a{};a.\u0275prov=gt({token:a,providedIn:"root",factory:()=>null});let s=a;return s})(),I1={};function Fg(s,a,d,c,f=!1){for(;d!==null;){let g=a[d.index];g!==null&&c.push(Rs(g)),ha(g)&&B$(g,c);let x=d.type;if(x&8)Fg(s,a,d.child,c);else if(x&32){let T=Ub(d,a),P;for(;P=T();)c.push(P)}else if(x&16){let T=QR(a,d);if(Array.isArray(T))c.push(...T);else{let P=Dh(a[rs]);Fg(P[mn],P,T,c,!0)}}d=f?d.projectionNext:d.next}return c}function B$(s,a){for(let d=kr;d<s.length;d++){let c=s[d],f=c[mn].firstChild;f!==null&&Fg(c[mn],c,f,a)}s[ec]!==s[da]&&a.push(s[ec])}var rO=[];function V$(s){return s[Ql]??j$(s)}function j$(s){let a=rO.pop()??Object.create($$);return a.lView=s,a}function U$(s){s.lView[Ql]!==s&&(s.lView=null,rO.push(s))}var $$=Qn(rt({},SA),{consumerIsAlwaysLive:!0,consumerMarkedDirty:s=>{Mh(s.lView)},consumerOnSignalRead(){this.lView[Ql]=this}});function oO(s){return aO(s[Th])}function sO(s){return aO(s[is])}function aO(s){for(;s!==null&&!ha(s);)s=s[is];return s}var G$="ngOriginalError";function M1(s){return s[G$]}var ca=class{constructor(){this._console=console}handleError(a){let d=this._findOriginalError(a);this._console.error("ERROR",a),d&&this._console.error("ORIGINAL ERROR",d)}_findOriginalError(a){let d=a&&M1(a);for(;d&&M1(d);)d=M1(d);return d||null}},lO=new zt("",{providedIn:"root",factory:()=>ut(ca).handleError.bind(void 0)});var cO=!1,H$=new zt("",{providedIn:"root",factory:()=>cO});var ks={};function he(s=1){uO(ho(),Xn(),al()+s,!1)}function uO(s,a,d,c){if(!c)if((a[en]&3)===3){let g=s.preOrderCheckHooks;g!==null&&mg(a,g,d)}else{let g=s.preOrderHooks;g!==null&&gg(a,g,0,d)}nc(d)}function qe(s,a=Tn.Default){let d=Xn();if(d===null)return vt(s,a);let c=Fo();return FR(c,d,Or(s),a)}function dO(s,a,d,c,f,g){let x=fr(null);try{let T=null;f&Cr.SignalBased&&(T=a[c][DA]),T!==null&&T.transformFn!==void 0&&(g=T.transformFn(g)),f&Cr.HasDecoratorInputTransform&&(g=s.inputTransforms[c].call(a,g)),s.setInput!==null?s.setInput(a,T,g,d,c):sR(a,T,c,g)}finally{fr(x)}}function q$(s,a){let d=s.hostBindingOpCodes;if(d!==null)try{for(let c=0;c<d.length;c++){let f=d[c];if(f<0)nc(~f);else{let g=f,x=d[++c],T=d[++c];y6(x,g);let P=a[g];T(2,P)}}}finally{nc(-1)}}function Qg(s,a,d,c,f,g,x,T,P,O,Z){let ee=a.blueprint.slice();return ee[da]=f,ee[en]=c|4|128|8|64,(O!==null||s&&s[en]&2048)&&(ee[en]|=2048),fR(ee),ee[Er]=ee[Bu]=s,ee[wr]=d,ee[aa]=x||s&&s[aa],ee[nr]=T||s&&s[nr],ee[Ou]=P||s&&s[Ou]||null,ee[as]=g,ee[Hg]=i$(),ee[Ch]=Z,ee[iR]=O,ee[rs]=a.type==2?s[rs]:ee,ee}function e_(s,a,d,c,f){let g=s.data[a];if(g===null)g=W$(s,a,d,c,f),_6()&&(g.flags|=32);else if(g.type&64){g.type=d,g.value=c,g.attrs=f;let x=h6();g.injectorIndex=x===null?-1:x.injectorIndex}return Lh(g,!0),g}function W$(s,a,d,c,f){let g=gR(),x=_R(),T=x?g:g&&g.parent,P=s.data[a]=J$(s,T,d,a,c,f);return s.firstChild===null&&(s.firstChild=P),g!==null&&(x?g.child==null&&P.parent!==null&&(g.child=P):g.next===null&&(g.next=P,P.prev=g)),P}function hO(s,a,d,c){if(d===0)return-1;let f=a.length;for(let g=0;g<d;g++)a.push(c),s.blueprint.push(c),s.data.push(null);return f}function fO(s,a,d,c,f){let g=al(),x=c&2;try{nc(-1),x&&a.length>eo&&uO(s,a,eo,!1),Ss(x?2:0,f),d(c,f)}finally{nc(g),Ss(x?3:1,f)}}function pO(s,a,d){if(oR(a)){let c=fr(null);try{let f=a.directiveStart,g=a.directiveEnd;for(let x=f;x<g;x++){let T=s.data[x];T.contentQueries&&T.contentQueries(1,d[x],x)}}finally{fr(c)}}}function mO(s,a,d){mR()&&(r8(s,a,d,Oo(d,a)),(d.flags&64)===64&&bO(s,a,d))}function gO(s,a,d=Oo){let c=a.localNames;if(c!==null){let f=a.index+1;for(let g=0;g<c.length;g+=2){let x=c[g+1],T=x===-1?d(a,s):s[x];s[f++]=T}}}function _O(s){let a=s.tView;return a===null||a.incompleteFirstPass?s.tView=Zb(1,null,s.template,s.decls,s.vars,s.directiveDefs,s.pipeDefs,s.viewQuery,s.schemas,s.consts,s.id):a}function Zb(s,a,d,c,f,g,x,T,P,O,Z){let ee=eo+c,ce=ee+f,Ee=Z$(ee,ce),Ze=typeof O=="function"?O():O;return Ee[mn]={type:s,blueprint:Ee,template:d,queries:null,viewQuery:T,declTNode:a,data:Ee.slice().fill(null,ee),bindingStartIndex:ee,expandoStartIndex:ce,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:typeof g=="function"?g():g,pipeRegistry:typeof x=="function"?x():x,firstChild:null,schemas:P,consts:Ze,incompleteFirstPass:!1,ssrId:Z}}function Z$(s,a){let d=[];for(let c=0;c<a;c++)d.push(c<s?null:ks);return d}function X$(s,a,d,c){let g=c.get(H$,cO)||d===Ps.ShadowDom,x=s.selectRootElement(a,g);return Y$(x),x}function Y$(s){K$(s)}var K$=()=>null;function J$(s,a,d,c,f,g){let x=a?a.injectorIndex:-1,T=0;return c6()&&(T|=128),{type:d,index:c,insertBeforeIndex:null,injectorIndex:x,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:T,providerIndexes:0,value:f,attrs:g,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:a,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}function CP(s,a,d,c,f){for(let g in a){if(!a.hasOwnProperty(g))continue;let x=a[g];if(x===void 0)continue;c??={};let T,P=Cr.None;Array.isArray(x)?(T=x[0],P=x[1]):T=x;let O=g;if(f!==null){if(!f.hasOwnProperty(g))continue;O=f[g]}s===0?EP(c,d,O,T,P):EP(c,d,O,T)}return c}function EP(s,a,d,c,f){let g;s.hasOwnProperty(d)?(g=s[d]).push(a,c):g=s[d]=[a,c],f!==void 0&&g.push(f)}function Q$(s,a,d){let c=a.directiveStart,f=a.directiveEnd,g=s.data,x=a.attrs,T=[],P=null,O=null;for(let Z=c;Z<f;Z++){let ee=g[Z],ce=d?d.get(ee):null,Ee=ce?ce.inputs:null,Ze=ce?ce.outputs:null;P=CP(0,ee.inputs,Z,P,Ee),O=CP(1,ee.outputs,Z,O,Ze);let Vt=P!==null&&x!==null&&!XP(a)?m8(P,Z,x):null;T.push(Vt)}P!==null&&(P.hasOwnProperty("class")&&(a.flags|=8),P.hasOwnProperty("style")&&(a.flags|=16)),a.initialInputs=T,a.inputs=P,a.outputs=O}function e8(s){return s==="class"?"className":s==="for"?"htmlFor":s==="formaction"?"formAction":s==="innerHtml"?"innerHTML":s==="readonly"?"readOnly":s==="tabindex"?"tabIndex":s}function yO(s,a,d,c,f,g,x,T){let P=Oo(a,d),O=a.inputs,Z;!T&&O!=null&&(Z=O[c])?(Xb(s,d,Z,c,f),qg(a)&&t8(d,a.index)):a.type&3?(c=e8(c),f=x!=null?x(f,a.value||"",c):f,g.setProperty(P,c,f)):a.type&12}function t8(s,a){let d=sl(a,s);d[en]&16||(d[en]|=64)}function vO(s,a,d,c){if(mR()){let f=c===null?null:{"":-1},g=s8(s,d),x,T;g===null?x=T=null:[x,T]=g,x!==null&&xO(s,a,d,x,f,T),f&&a8(d,c,f)}d.mergedAttrs=wh(d.mergedAttrs,d.attrs)}function xO(s,a,d,c,f,g){for(let O=0;O<c.length;O++)G1(Dg(d,a),s,c[O].type);c8(d,s.data.length,c.length);for(let O=0;O<c.length;O++){let Z=c[O];Z.providersResolver&&Z.providersResolver(Z)}let x=!1,T=!1,P=hO(s,a,c.length,null);for(let O=0;O<c.length;O++){let Z=c[O];d.mergedAttrs=wh(d.mergedAttrs,Z.hostAttrs),u8(s,d,a,P,Z),l8(P,Z,f),Z.contentQueries!==null&&(d.flags|=4),(Z.hostBindings!==null||Z.hostAttrs!==null||Z.hostVars!==0)&&(d.flags|=64);let ee=Z.type.prototype;!x&&(ee.ngOnChanges||ee.ngOnInit||ee.ngDoCheck)&&((s.preOrderHooks??=[]).push(d.index),x=!0),!T&&(ee.ngOnChanges||ee.ngDoCheck)&&((s.preOrderCheckHooks??=[]).push(d.index),T=!0),P++}Q$(s,d,g)}function n8(s,a,d,c,f){let g=f.hostBindings;if(g){let x=s.hostBindingOpCodes;x===null&&(x=s.hostBindingOpCodes=[]);let T=~a.index;i8(x)!=T&&x.push(T),x.push(d,c,g)}}function i8(s){let a=s.length;for(;a>0;){let d=s[--a];if(typeof d=="number"&&d<0)return d}return 0}function r8(s,a,d,c){let f=d.directiveStart,g=d.directiveEnd;qg(d)&&d8(a,d,s.data[f+d.componentOffset]),s.firstCreatePass||Dg(d,a),rc(c,a);let x=d.initialInputs;for(let T=f;T<g;T++){let P=s.data[T],O=Fu(a,s,T,d);if(rc(O,a),x!==null&&p8(a,T-f,O,P,d,x),il(P)){let Z=sl(d.index,a);Z[wr]=Fu(a,s,T,d)}}}function bO(s,a,d){let c=d.directiveStart,f=d.directiveEnd,g=d.index,x=v6();try{nc(g);for(let T=c;T<f;T++){let P=s.data[T],O=a[T];U1(T),(P.hostBindings!==null||P.hostVars!==0||P.hostAttrs!==null)&&o8(P,O)}}finally{nc(-1),U1(x)}}function o8(s,a){s.hostBindings!==null&&s.hostBindings(1,a)}function s8(s,a){let d=s.directiveRegistry,c=null,f=null;if(d)for(let g=0;g<d.length;g++){let x=d[g];if(VU(a,x.selectors,!1))if(c||(c=[]),il(x))if(x.findHostDirectiveDefs!==null){let T=[];f=f||new Map,x.findHostDirectiveDefs(x,T,f),c.unshift(...T,x);let P=T.length;eb(s,a,P)}else c.unshift(x),eb(s,a,0);else f=f||new Map,x.findHostDirectiveDefs?.(x,c,f),c.push(x)}return c===null?null:[c,f]}function eb(s,a,d){a.componentOffset=d,(s.components??=[]).push(a.index)}function a8(s,a,d){if(a){let c=s.localNames=[];for(let f=0;f<a.length;f+=2){let g=d[a[f+1]];if(g==null)throw new $t(-301,!1);c.push(a[f],g)}}}function l8(s,a,d){if(d){if(a.exportAs)for(let c=0;c<a.exportAs.length;c++)d[a.exportAs[c]]=s;il(a)&&(d[""]=s)}}function c8(s,a,d){s.flags|=1,s.directiveStart=a,s.directiveEnd=a+d,s.providerIndexes=a}function u8(s,a,d,c,f){s.data[c]=f;let g=f.factory||(f.factory=tc(f.type,!0)),x=new ic(g,il(f),qe);s.blueprint[c]=x,d[c]=x,n8(s,a,c,hO(s,d,f.hostVars,ks),f)}function d8(s,a,d){let c=Oo(a,s),f=_O(d),g=s[aa].rendererFactory,x=16;d.signals?x=4096:d.onPush&&(x=64);let T=t_(s,Qg(s,f,null,x,c,a,null,g.createRenderer(c,d),null,null,null));s[a.index]=T}function h8(s,a,d,c,f,g){let x=Oo(s,a);f8(a[nr],x,g,s.value,d,c,f)}function f8(s,a,d,c,f,g,x){if(g==null)s.removeAttribute(a,f,d);else{let T=x==null?Pu(g):x(g,c||"",f);s.setAttribute(a,f,T,d)}}function p8(s,a,d,c,f,g){let x=g[a];if(x!==null)for(let T=0;T<x.length;){let P=x[T++],O=x[T++],Z=x[T++],ee=x[T++];dO(c,d,P,O,Z,ee)}}function m8(s,a,d){let c=null,f=0;for(;f<d.length;){let g=d[f];if(g===0){f+=4;continue}else if(g===5){f+=2;continue}if(typeof g=="number")break;if(s.hasOwnProperty(g)){c===null&&(c=[]);let x=s[g];for(let T=0;T<x.length;T+=3)if(x[T]===a){c.push(g,x[T+1],x[T+2],d[f+1]);break}}f+=2}return c}function wO(s,a,d,c){return[s,!0,0,a,null,c,null,d,null,null]}function CO(s,a){let d=s.contentQueries;if(d!==null){let c=fr(null);try{for(let f=0;f<d.length;f+=2){let g=d[f],x=d[f+1];if(x!==-1){let T=s.data[x];xR(g),T.contentQueries(2,a[x],x)}}}finally{fr(c)}}}function t_(s,a){return s[Th]?s[pP][is]=a:s[Th]=a,s[pP]=a,a}function tb(s,a,d){xR(0);let c=fr(null);try{a(s,d)}finally{fr(c)}}function g8(s){return s[Eh]||(s[Eh]=[])}function _8(s){return s.cleanup||(s.cleanup=[])}function EO(s,a){let d=s[Ou],c=d?d.get(ca,null):null;c&&c.handleError(a)}function Xb(s,a,d,c,f){for(let g=0;g<d.length;){let x=d[g++],T=d[g++],P=d[g++],O=a[x],Z=s.data[x];dO(Z,O,c,T,P,f)}}function TO(s,a,d){let c=dR(a,s);l$(s[nr],c,d)}var y8=100;function v8(s,a=!0){let d=s[aa],c=d.rendererFactory,f=!1;f||c.begin?.();try{x8(s)}catch(g){throw a&&EO(s,g),g}finally{f||(c.end?.(),d.inlineEffectRunner?.flush())}}function x8(s){nb(s,0);let a=0;for(;pR(s);){if(a===y8)throw new $t(103,!1);a++,nb(s,1)}}function b8(s,a,d,c){let f=a[en];if((f&256)===256)return;let g=!1;!g&&a[aa].inlineEffectRunner?.flush(),Mb(a);let x=null,T=null;!g&&w8(s)&&(T=V$(a),x=AA(T));try{fR(a),g6(s.bindingStartIndex),d!==null&&fO(s,a,d,2,c);let P=(f&3)===3;if(!g)if(P){let ee=s.preOrderCheckHooks;ee!==null&&mg(a,ee,null)}else{let ee=s.preOrderHooks;ee!==null&&gg(a,ee,0,null),b1(a,0)}if(C8(a),IO(a,0),s.contentQueries!==null&&CO(s,a),!g)if(P){let ee=s.contentCheckHooks;ee!==null&&mg(a,ee)}else{let ee=s.contentHooks;ee!==null&&gg(a,ee,1),b1(a,1)}q$(s,a);let O=s.components;O!==null&&DO(a,O,0);let Z=s.viewQuery;if(Z!==null&&tb(2,Z,c),!g)if(P){let ee=s.viewCheckHooks;ee!==null&&mg(a,ee)}else{let ee=s.viewHooks;ee!==null&&gg(a,ee,2),b1(a,2)}if(s.firstUpdatePass===!0&&(s.firstUpdatePass=!1),a[x1]){for(let ee of a[x1])ee();a[x1]=null}g||(a[en]&=-73)}catch(P){throw Mh(a),P}finally{T!==null&&(PA(T,x),U$(T)),Db()}}function w8(s){return s.type!==2}function IO(s,a){for(let d=oO(s);d!==null;d=sO(d))for(let c=kr;c<d.length;c++){let f=d[c];MO(f,a)}}function C8(s){for(let a=oO(s);a!==null;a=sO(a)){if(!(a[en]&Cb.HasTransplantedViews))continue;let d=a[Cg];for(let c=0;c<d.length;c++){let f=d[c],g=f[Er];i6(f)}}}function E8(s,a,d){let c=sl(a,s);MO(c,d)}function MO(s,a){Ib(s)&&nb(s,a)}function nb(s,a){let c=s[mn],f=s[en],g=s[Ql],x=!!(a===0&&f&16);if(x||=!!(f&64&&a===0),x||=!!(f&1024),x||=!!(g?.dirty&&e1(g)),g&&(g.dirty=!1),s[en]&=-9217,x)b8(c,s,c.template,s[wr]);else if(f&8192){IO(s,1);let T=c.components;T!==null&&DO(s,T,1)}}function DO(s,a,d){for(let c=0;c<a.length;c++)E8(s,a[c],d)}function Yb(s){for(s[aa].changeDetectionScheduler?.notify();s;){s[en]|=64;let a=Dh(s);if(XU(s)&&!a)return s;s=a}return null}var oc=class{get rootNodes(){let a=this._lView,d=a[mn];return Fg(d,a,d.firstChild,[])}constructor(a,d,c=!0){this._lView=a,this._cdRefInjectingView=d,this.notifyErrorHandler=c,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[wr]}set context(a){this._lView[wr]=a}get destroyed(){return(this._lView[en]&256)===256}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){let a=this._lView[Er];if(ha(a)){let d=a[wg],c=d?d.indexOf(this):-1;c>-1&&(Ah(a,c),Sg(d,c))}this._attachedToViewContainer=!1}Zg(this._lView[mn],this._lView)}onDestroy(a){o6(this._lView,a)}markForCheck(){Yb(this._cdRefInjectingView||this._lView)}detach(){this._lView[en]&=-129}reattach(){j1(this._lView),this._lView[en]|=128}detectChanges(){this._lView[en]|=1024,v8(this._lView,this.notifyErrorHandler)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new $t(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,YR(this._lView[mn],this._lView)}attachToAppRef(a){if(this._attachedToViewContainer)throw new $t(902,!1);this._appRef=a,j1(this._lView)}},Bh=(()=>{let a=class a{};a.__NG_ELEMENT_ID__=T8;let s=a;return s})();function T8(s){return I8(Fo(),Xn(),(s&16)===16)}function I8(s,a,d){if(qg(s)&&!d){let c=sl(s.index,a);return new oc(c,c)}else if(s.type&47){let c=a[rs];return new oc(c,a)}return null}var TP=new Set;function Vh(s){TP.has(s)||(TP.add(s),performance?.mark?.("mark_feature_usage",{detail:{feature:s}}))}var ib=class extends co{constructor(a=!1){super(),this.__isAsync=a}emit(a){super.next(a)}subscribe(a,d,c){let f=a,g=d||(()=>null),x=c;if(a&&typeof a=="object"){let P=a;f=P.next?.bind(P),g=P.error?.bind(P),x=P.complete?.bind(P)}this.__isAsync&&(g=D1(g),f&&(f=D1(f)),x&&(x=D1(x)));let T=super.subscribe({next:f,error:g,complete:x});return a instanceof Yi&&a.add(T),T}};function D1(s){return a=>{setTimeout(s,void 0,a)}}var br=ib;function IP(...s){}function M8(){let s=typeof sa.requestAnimationFrame=="function",a=sa[s?"requestAnimationFrame":"setTimeout"],d=sa[s?"cancelAnimationFrame":"clearTimeout"];if(typeof Zone<"u"&&a&&d){let c=a[Zone.__symbol__("OriginalDelegate")];c&&(a=c);let f=d[Zone.__symbol__("OriginalDelegate")];f&&(d=f)}return{nativeRequestAnimationFrame:a,nativeCancelAnimationFrame:d}}var Bi=class s{constructor({enableLongStackTrace:a=!1,shouldCoalesceEventChangeDetection:d=!1,shouldCoalesceRunChangeDetection:c=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new br(!1),this.onMicrotaskEmpty=new br(!1),this.onStable=new br(!1),this.onError=new br(!1),typeof Zone>"u")throw new $t(908,!1);Zone.assertZonePatched();let f=this;f._nesting=0,f._outer=f._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(f._inner=f._inner.fork(new Zone.TaskTrackingZoneSpec)),a&&Zone.longStackTraceZoneSpec&&(f._inner=f._inner.fork(Zone.longStackTraceZoneSpec)),f.shouldCoalesceEventChangeDetection=!c&&d,f.shouldCoalesceRunChangeDetection=c,f.lastRequestAnimationFrameId=-1,f.nativeRequestAnimationFrame=M8().nativeRequestAnimationFrame,A8(f)}static isInAngularZone(){return typeof Zone<"u"&&Zone.current.get("isAngularZone")===!0}static assertInAngularZone(){if(!s.isInAngularZone())throw new $t(909,!1)}static assertNotInAngularZone(){if(s.isInAngularZone())throw new $t(909,!1)}run(a,d,c){return this._inner.run(a,d,c)}runTask(a,d,c,f){let g=this._inner,x=g.scheduleEventTask("NgZoneEvent: "+f,a,D8,IP,IP);try{return g.runTask(x,d,c)}finally{g.cancelTask(x)}}runGuarded(a,d,c){return this._inner.runGuarded(a,d,c)}runOutsideAngular(a){return this._outer.run(a)}},D8={};function Kb(s){if(s._nesting==0&&!s.hasPendingMicrotasks&&!s.isStable)try{s._nesting++,s.onMicrotaskEmpty.emit(null)}finally{if(s._nesting--,!s.hasPendingMicrotasks)try{s.runOutsideAngular(()=>s.onStable.emit(null))}finally{s.isStable=!0}}}function S8(s){s.isCheckStableRunning||s.lastRequestAnimationFrameId!==-1||(s.lastRequestAnimationFrameId=s.nativeRequestAnimationFrame.call(sa,()=>{s.fakeTopEventTask||(s.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{s.lastRequestAnimationFrameId=-1,rb(s),s.isCheckStableRunning=!0,Kb(s),s.isCheckStableRunning=!1},void 0,()=>{},()=>{})),s.fakeTopEventTask.invoke()}),rb(s))}function A8(s){let a=()=>{S8(s)};s._inner=s._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(d,c,f,g,x,T)=>{if(P8(T))return d.invokeTask(f,g,x,T);try{return MP(s),d.invokeTask(f,g,x,T)}finally{(s.shouldCoalesceEventChangeDetection&&g.type==="eventTask"||s.shouldCoalesceRunChangeDetection)&&a(),DP(s)}},onInvoke:(d,c,f,g,x,T,P)=>{try{return MP(s),d.invoke(f,g,x,T,P)}finally{s.shouldCoalesceRunChangeDetection&&a(),DP(s)}},onHasTask:(d,c,f,g)=>{d.hasTask(f,g),c===f&&(g.change=="microTask"?(s._hasPendingMicrotasks=g.microTask,rb(s),Kb(s)):g.change=="macroTask"&&(s.hasPendingMacrotasks=g.macroTask))},onHandleError:(d,c,f,g)=>(d.handleError(f,g),s.runOutsideAngular(()=>s.onError.emit(g)),!1)})}function rb(s){s._hasPendingMicrotasks||(s.shouldCoalesceEventChangeDetection||s.shouldCoalesceRunChangeDetection)&&s.lastRequestAnimationFrameId!==-1?s.hasPendingMicrotasks=!0:s.hasPendingMicrotasks=!1}function MP(s){s._nesting++,s.isStable&&(s.isStable=!1,s.onUnstable.emit(null))}function DP(s){s._nesting--,Kb(s)}function P8(s){return!Array.isArray(s)||s.length!==1?!1:s[0].data?.__ignore_ng_zone__===!0}var SO=(()=>{let a=class a{constructor(){this.handler=null,this.internalCallbacks=[]}execute(){let c=[...this.internalCallbacks];this.internalCallbacks.length=0;for(let g of c)g();return!!this.handler?.execute()||c.length>0}ngOnDestroy(){this.handler?.destroy(),this.handler=null,this.internalCallbacks.length=0}};a.\u0275prov=gt({token:a,providedIn:"root",factory:()=>new a});let s=a;return s})();function R8(s,a){let d=sl(a,s),c=d[mn];O8(c,d);let f=d[da];f!==null&&d[Ch]===null&&(d[Ch]=Wb(f,d[Ou])),Jb(c,d,d[wr])}function O8(s,a){for(let d=a.length;d<s.blueprint.length;d++)a.push(s.blueprint[d])}function Jb(s,a,d){Mb(a);try{let c=s.viewQuery;c!==null&&tb(1,c,d);let f=s.template;f!==null&&fO(s,a,f,1,d),s.firstCreatePass&&(s.firstCreatePass=!1),s.staticContentQueries&&CO(s,a),s.staticViewQueries&&tb(2,s.viewQuery,d);let g=s.components;g!==null&&F8(a,g)}catch(c){throw s.firstCreatePass&&(s.incompleteFirstPass=!0,s.firstCreatePass=!1),c}finally{a[en]&=-5,Db()}}function F8(s,a){for(let d=0;d<a.length;d++)R8(s,a[d])}function ob(s,a,d){let c=d?s.styles:null,f=d?s.classes:null,g=0;if(a!==null)for(let x=0;x<a.length;x++){let T=a[x];if(typeof T=="number")g=T;else if(g==1)f=rP(f,T);else if(g==2){let P=T,O=a[++x];c=rP(c,P+": "+O+";")}}d?s.styles=c:s.stylesWithoutHost=c,d?s.classes=f:s.classesWithoutHost=f}var kg=class extends Kg{constructor(a){super(),this.ngModule=a}resolveComponentFactory(a){let d=nl(a);return new Nu(d,this.ngModule)}};function SP(s){let a=[];for(let d in s){if(!s.hasOwnProperty(d))continue;let c=s[d];c!==void 0&&a.push({propName:Array.isArray(c)?c[0]:c,templateName:d})}return a}function k8(s){let a=s.toLowerCase();return a==="svg"?uR:a==="math"?QU:null}var sb=class{constructor(a,d){this.injector=a,this.parentInjector=d}get(a,d,c){c=Ug(c);let f=this.injector.get(a,I1,c);return f!==I1||d===I1?f:this.parentInjector.get(a,d,c)}},Nu=class extends Og{get inputs(){let a=this.componentDef,d=a.inputTransforms,c=SP(a.inputs);if(d!==null)for(let f of c)d.hasOwnProperty(f.propName)&&(f.transform=d[f.propName]);return c}get outputs(){return SP(this.componentDef.outputs)}constructor(a,d){super(),this.componentDef=a,this.ngModule=d,this.componentType=a.type,this.selector=GU(a.selectors),this.ngContentSelectors=a.ngContentSelectors?a.ngContentSelectors:[],this.isBoundToModule=!!d}create(a,d,c,f){f=f||this.ngModule;let g=f instanceof to?f:f?.injector;g&&this.componentDef.getStandaloneInjector!==null&&(g=this.componentDef.getStandaloneInjector(g)||g);let x=g?new sb(a,g):a,T=x.get(Ph,null);if(T===null)throw new $t(407,!1);let P=x.get(z$,null),O=x.get(SO,null),Z=x.get(K1,null),ee={rendererFactory:T,sanitizer:P,inlineEffectRunner:null,afterRenderEventManager:O,changeDetectionScheduler:Z},ce=T.createRenderer(null,this.componentDef),Ee=this.componentDef.selectors[0][0]||"div",Ze=c?X$(ce,c,this.componentDef.encapsulation,x):XR(ce,Ee,k8(Ee)),Vt=512;this.componentDef.signals?Vt|=4096:this.componentDef.onPush||(Vt|=16);let dt=null;Ze!==null&&(dt=Wb(Ze,x,!0));let tt=Zb(0,null,null,1,0,null,null,null,null,null,null),Ln=Qg(null,tt,null,Vt,null,null,ee,ce,x,null,dt);Mb(Ln);let ri,bn;try{let Pi=this.componentDef,Si,Q=null;Pi.findHostDirectiveDefs?(Si=[],Q=new Map,Pi.findHostDirectiveDefs(Pi,Si,Q),Si.push(Pi)):Si=[Pi];let Wt=L8(Ln,Ze),sd=N8(Wt,Ze,Pi,Si,Ln,ee,ce);bn=Tb(tt,eo),Ze&&V8(ce,Pi,Ze,c),d!==void 0&&j8(bn,this.ngContentSelectors,d),ri=B8(sd,Pi,Si,Q,Ln,[U8]),Jb(tt,Ln,null)}finally{Db()}return new ab(this.componentType,ri,Jg(bn,Ln),Ln,bn)}},ab=class extends J1{constructor(a,d,c,f,g){super(),this.location=c,this._rootLView=f,this._tNode=g,this.previousInputValues=null,this.instance=d,this.hostView=this.changeDetectorRef=new oc(f,void 0,!1),this.componentType=a}setInput(a,d){let c=this._tNode.inputs,f;if(c!==null&&(f=c[a])){if(this.previousInputValues??=new Map,this.previousInputValues.has(a)&&Object.is(this.previousInputValues.get(a),d))return;let g=this._rootLView;Xb(g[mn],g,f,a,d),this.previousInputValues.set(a,d);let x=sl(this._tNode.index,g);Yb(x)}}get injector(){return new Jl(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(a){this.hostView.onDestroy(a)}};function L8(s,a){let d=s[mn],c=eo;return s[c]=a,e_(d,c,2,"#host",null)}function N8(s,a,d,c,f,g,x){let T=f[mn];z8(c,s,a,x);let P=null;a!==null&&(P=Wb(a,f[Ou]));let O=g.rendererFactory.createRenderer(a,d),Z=16;d.signals?Z=4096:d.onPush&&(Z=64);let ee=Qg(f,_O(d),null,Z,f[s.index],s,g,O,null,null,P);return T.firstCreatePass&&eb(T,s,c.length-1),t_(f,ee),f[s.index]=ee}function z8(s,a,d,c){for(let f of s)a.mergedAttrs=wh(a.mergedAttrs,f.hostAttrs);a.mergedAttrs!==null&&(ob(a,a.mergedAttrs,!0),d!==null&&tO(c,d,a))}function B8(s,a,d,c,f,g){let x=Fo(),T=f[mn],P=Oo(x,f);xO(T,f,x,d,null,c);for(let Z=0;Z<d.length;Z++){let ee=x.directiveStart+Z,ce=Fu(f,T,ee,x);rc(ce,f)}bO(T,f,x),P&&rc(P,f);let O=Fu(f,T,x.directiveStart+x.componentOffset,x);if(s[wr]=f[wr]=O,g!==null)for(let Z of g)Z(O,a);return pO(T,x,s),O}function V8(s,a,d,c){if(c)B1(s,d,["ng-version","17.1.1"]);else{let{attrs:f,classes:g}=HU(a.selectors[0]);f&&B1(s,d,f),g&&g.length>0&&eO(s,d,g.join(" "))}}function j8(s,a,d){let c=s.projection=[];for(let f=0;f<a.length;f++){let g=d[f];c.push(g!=null?Array.from(g):null)}}function U8(){let s=Fo();Fb(Xn()[mn],s)}function $8(s){return Object.getPrototypeOf(s.prototype).constructor}function Tr(s){let a=$8(s.type),d=!0,c=[s];for(;a;){let f;if(il(s))f=a.\u0275cmp||a.\u0275dir;else{if(a.\u0275cmp)throw new $t(903,!1);f=a.\u0275dir}if(f){if(d){c.push(f);let x=s;x.inputs=fg(s.inputs),x.inputTransforms=fg(s.inputTransforms),x.declaredInputs=fg(s.declaredInputs),x.outputs=fg(s.outputs);let T=f.hostBindings;T&&Z8(s,T);let P=f.viewQuery,O=f.contentQueries;if(P&&q8(s,P),O&&W8(s,O),G8(s,f),hU(s.outputs,f.outputs),il(f)&&f.data.animation){let Z=s.data;Z.animation=(Z.animation||[]).concat(f.data.animation)}}let g=f.features;if(g)for(let x=0;x<g.length;x++){let T=g[x];T&&T.ngInherit&&T(s),T===Tr&&(d=!1)}}a=Object.getPrototypeOf(a)}H8(c)}function G8(s,a){for(let d in a.inputs){if(!a.inputs.hasOwnProperty(d)||s.inputs.hasOwnProperty(d))continue;let c=a.inputs[d];if(c!==void 0&&(s.inputs[d]=c,s.declaredInputs[d]=a.declaredInputs[d],a.inputTransforms!==null)){let f=Array.isArray(c)?c[0]:c;if(!a.inputTransforms.hasOwnProperty(f))continue;s.inputTransforms??={},s.inputTransforms[f]=a.inputTransforms[f]}}}function H8(s){let a=0,d=null;for(let c=s.length-1;c>=0;c--){let f=s[c];f.hostVars=a+=f.hostVars,f.hostAttrs=wh(f.hostAttrs,d=wh(d,f.hostAttrs))}}function fg(s){return s===Ru?{}:s===Ro?[]:s}function q8(s,a){let d=s.viewQuery;d?s.viewQuery=(c,f)=>{a(c,f),d(c,f)}:s.viewQuery=a}function W8(s,a){let d=s.contentQueries;d?s.contentQueries=(c,f,g)=>{a(c,f,g),d(c,f,g)}:s.contentQueries=a}function Z8(s,a){let d=s.hostBindings;d?s.hostBindings=(c,f)=>{a(c,f),d(c,f)}:s.hostBindings=a}var vte=new RegExp(`^(\\d+)*(${R$}|${P$})*(.*)`);var X8=()=>null;function Rh(s,a){return X8(s,a)}function n_(s,a,d,c){let f=a.tView,x=s[en]&4096?4096:16,T=Qg(s,f,d,x,null,a,null,null,null,c?.injector??null,c?.dehydratedView??null),P=s[a.index];T[Gg]=P;let O=s[Ih];return O!==null&&(T[Ih]=O.createEmbeddedView(f)),Jb(f,T,d),T}function AO(s,a){let d=kr+a;if(d<s.length)return s[d]}function Oh(s,a){return!a||a.firstChild===null||WR(s)}function i_(s,a,d,c=!0){let f=a[mn];if(h$(f,a,s,d),c){let x=Y1(d,s),T=a[nr],P=$b(T,s[ec]);P!==null&&u$(f,s[as],T,a,P,x)}let g=a[Ch];g!==null&&g.firstChild!==null&&(g.firstChild=null)}function PO(s,a){let d=Ah(s,a);return d!==void 0&&Zg(d[mn],d),d}var jh=(()=>{let a=class a{};a.__NG_ELEMENT_ID__=Y8;let s=a;return s})();function Y8(){let s=Fo();return J8(s,Xn())}var K8=jh,RO=class extends K8{constructor(a,d,c){super(),this._lContainer=a,this._hostTNode=d,this._hostLView=c}get element(){return Jg(this._hostTNode,this._hostLView)}get injector(){return new Jl(this._hostTNode,this._hostLView)}get parentInjector(){let a=kb(this._hostTNode,this._hostLView);if(DR(a)){let d=Ig(a,this._hostLView),c=Tg(a),f=d[mn].data[c+8];return new Jl(f,d)}else return new Jl(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(a){let d=AP(this._lContainer);return d!==null&&d[a]||null}get length(){return this._lContainer.length-kr}createEmbeddedView(a,d,c){let f,g;typeof c=="number"?f=c:c!=null&&(f=c.index,g=c.injector);let x=Rh(this._lContainer,a.ssrId),T=a.createEmbeddedViewImpl(d||{},g,x);return this.insertImpl(T,f,Oh(this._hostTNode,x)),T}createComponent(a,d,c,f,g){let x=a&&!B6(a),T;if(x)T=d;else{let Ze=d||{};T=Ze.index,c=Ze.injector,f=Ze.projectableNodes,g=Ze.environmentInjector||Ze.ngModuleRef}let P=x?a:new Nu(nl(a)),O=c||this.parentInjector;if(!g&&P.ngModule==null){let Vt=(x?O:this.parentInjector).get(to,null);Vt&&(g=Vt)}let Z=nl(P.componentType??{}),ee=Rh(this._lContainer,Z?.id??null),ce=ee?.firstChild??null,Ee=P.create(O,f,ce,g);return this.insertImpl(Ee.hostView,T,Oh(this._hostTNode,ee)),Ee}insert(a,d){return this.insertImpl(a,d,!0)}insertImpl(a,d,c){let f=a._lView;if(n6(f)){let T=this.indexOf(a);if(T!==-1)this.detach(T);else{let P=f[Er],O=new RO(P,P[as],P[Er]);O.detach(O.indexOf(a))}}let g=this._adjustIndex(d),x=this._lContainer;return i_(x,f,g,c),a.attachToViewContainerRef(),NR(S1(x),g,a),a}move(a,d){return this.insert(a,d)}indexOf(a){let d=AP(this._lContainer);return d!==null?d.indexOf(a):-1}remove(a){let d=this._adjustIndex(a,-1),c=Ah(this._lContainer,d);c&&(Sg(S1(this._lContainer),d),Zg(c[mn],c))}detach(a){let d=this._adjustIndex(a,-1),c=Ah(this._lContainer,d);return c&&Sg(S1(this._lContainer),d)!=null?new oc(c):null}_adjustIndex(a,d=0){return a??this.length+d}};function AP(s){return s[wg]}function S1(s){return s[wg]||(s[wg]=[])}function J8(s,a){let d,c=a[s.index];return ha(c)?d=c:(d=wO(c,a,null,s),a[s.index]=d,t_(a,d)),eG(d,a,s,c),new RO(d,s,a)}function Q8(s,a){let d=s[nr],c=d.createComment(""),f=Oo(a,s),g=$b(d,f);return Pg(d,g,c,v$(d,f),!1),c}var eG=iG,tG=()=>!1;function nG(s,a,d){return tG(s,a,d)}function iG(s,a,d,c){if(s[ec])return;let f;d.type&8?f=Rs(c):f=Q8(a,d),s[ec]=f}function OO(s,a,d){return s[a]=d}function ua(s,a,d){let c=s[a];return Object.is(c,d)?!1:(s[a]=d,!0)}function FO(s,a,d,c){let f=ua(s,a,d);return ua(s,a+1,c)||f}function rG(s,a,d,c,f,g,x,T,P){let O=a.consts,Z=e_(a,s,4,x||null,Eg(O,T));vO(a,d,Z,Eg(O,P)),Fb(a,Z);let ee=Z.tView=Zb(2,Z,c,f,g,a.directiveRegistry,a.pipeRegistry,null,a.schemas,O,null);return a.queries!==null&&(a.queries.template(a,Z),ee.queries=a.queries.embeddedTView(Z)),Z}function Je(s,a,d,c,f,g,x,T){let P=Xn(),O=ho(),Z=s+eo,ee=O.firstCreatePass?rG(Z,O,P,a,d,c,f,g,x):O.data[Z];Lh(ee,!1);let ce=oG(O,P,ee,s);Rb()&&Gb(O,P,ce,ee),rc(ce,P);let Ee=wO(ce,P,ce,ee);return P[Z]=Ee,t_(P,Ee),nG(Ee,ee,P),Eb(ee)&&mO(O,P,ee),x!=null&&gO(P,ee,T),Je}var oG=sG;function sG(s,a,d,c){return Ob(!0),a[nr].createComment("")}function ll(s,a,d,c){let f=Xn(),g=Nh();if(ua(f,g,a)){let x=ho(),T=Sb();h8(T,f,s,a,d,c)}return ll}function kO(s,a,d,c){return ua(s,Nh(),d)?a+Pu(d)+c:ks}function aG(s,a,d,c,f,g){let x=m6(),T=FO(s,x,d,f);return vR(2),T?a+Pu(d)+c+Pu(f)+g:ks}function pg(s,a){return s<<17|a<<2}function sc(s){return s>>17&32767}function lG(s){return(s&2)==2}function cG(s,a){return s&131071|a<<17}function lb(s){return s|2}function zu(s){return(s&131068)>>2}function A1(s,a){return s&-131069|a<<2}function uG(s){return(s&1)===1}function cb(s){return s|1}function dG(s,a,d,c,f,g){let x=g?a.classBindings:a.styleBindings,T=sc(x),P=zu(x);s[c]=d;let O=!1,Z;if(Array.isArray(d)){let ee=d;Z=ee[1],(Z===null||zh(ee,Z)>0)&&(O=!0)}else Z=d;if(f)if(P!==0){let ce=sc(s[T+1]);s[c+1]=pg(ce,T),ce!==0&&(s[ce+1]=A1(s[ce+1],c)),s[T+1]=cG(s[T+1],c)}else s[c+1]=pg(T,0),T!==0&&(s[T+1]=A1(s[T+1],c)),T=c;else s[c+1]=pg(P,0),T===0?T=c:s[P+1]=A1(s[P+1],c),P=c;O&&(s[c+1]=lb(s[c+1])),PP(s,Z,c,!0),PP(s,Z,c,!1),hG(a,Z,s,c,g),x=pg(T,P),g?a.classBindings=x:a.styleBindings=x}function hG(s,a,d,c,f){let g=f?s.residualClasses:s.residualStyles;g!=null&&typeof a=="string"&&zh(g,a)>=0&&(d[c+1]=cb(d[c+1]))}function PP(s,a,d,c){let f=s[d+1],g=a===null,x=c?sc(f):zu(f),T=!1;for(;x!==0&&(T===!1||g);){let P=s[x],O=s[x+1];fG(P,a)&&(T=!0,s[x+1]=c?cb(O):lb(O)),x=c?sc(O):zu(O)}T&&(s[d+1]=c?lb(f):cb(f))}function fG(s,a){return s===null||a==null||(Array.isArray(s)?s[1]:s)===a?!0:Array.isArray(s)&&typeof a=="string"?zh(s,a)>=0:!1}function ke(s,a,d){let c=Xn(),f=Nh();if(ua(c,f,a)){let g=ho(),x=Sb();yO(g,x,c,s,a,c[nr],d,!1)}return ke}function RP(s,a,d,c,f){let g=a.inputs,x=f?"class":"style";Xb(s,d,g[x],x,c)}function r_(s,a){return pG(s,a,null,!0),r_}function pG(s,a,d,c){let f=Xn(),g=ho(),x=vR(2);if(g.firstUpdatePass&&gG(g,s,x,c),a!==ks&&ua(f,x,a)){let T=g.data[al()];bG(g,T,f,f[nr],s,f[x+1]=wG(a,d),c,x)}}function mG(s,a){return a>=s.expandoStartIndex}function gG(s,a,d,c){let f=s.data;if(f[d+1]===null){let g=f[al()],x=mG(s,d);CG(g,c)&&a===null&&!x&&(a=!1),a=_G(f,g,a,c),dG(f,g,a,d,x,c)}}function _G(s,a,d,c){let f=x6(s),g=c?a.residualClasses:a.residualStyles;if(f===null)(c?a.classBindings:a.styleBindings)===0&&(d=P1(null,s,a,d,c),d=Fh(d,a.attrs,c),g=null);else{let x=a.directiveStylingLast;if(x===-1||s[x]!==f)if(d=P1(f,s,a,d,c),g===null){let P=yG(s,a,c);P!==void 0&&Array.isArray(P)&&(P=P1(null,s,a,P[1],c),P=Fh(P,a.attrs,c),vG(s,a,c,P))}else g=xG(s,a,c)}return g!==void 0&&(c?a.residualClasses=g:a.residualStyles=g),d}function yG(s,a,d){let c=d?a.classBindings:a.styleBindings;if(zu(c)!==0)return s[sc(c)]}function vG(s,a,d,c){let f=d?a.classBindings:a.styleBindings;s[sc(f)]=c}function xG(s,a,d){let c,f=a.directiveEnd;for(let g=1+a.directiveStylingLast;g<f;g++){let x=s[g].hostAttrs;c=Fh(c,x,d)}return Fh(c,a.attrs,d)}function P1(s,a,d,c,f){let g=null,x=d.directiveEnd,T=d.directiveStylingLast;for(T===-1?T=d.directiveStart:T++;T<x&&(g=a[T],c=Fh(c,g.hostAttrs,f),g!==s);)T++;return s!==null&&(d.directiveStylingLast=T),c}function Fh(s,a,d){let c=d?1:2,f=-1;if(a!==null)for(let g=0;g<a.length;g++){let x=a[g];typeof x=="number"?f=x:f===c&&(Array.isArray(s)||(s=s===void 0?[]:["",s]),j6(s,x,d?!0:a[++g]))}return s===void 0?null:s}function bG(s,a,d,c,f,g,x,T){if(!(a.type&3))return;let P=s.data,O=P[T+1],Z=uG(O)?OP(P,a,d,f,zu(O),x):void 0;if(!Lg(Z)){Lg(g)||lG(O)&&(g=OP(P,null,d,f,T,x));let ee=dR(al(),d);I$(c,x,ee,f,g)}}function OP(s,a,d,c,f,g){let x=a===null,T;for(;f>0;){let P=s[f],O=Array.isArray(P),Z=O?P[1]:P,ee=Z===null,ce=d[f+1];ce===ks&&(ce=ee?Ro:void 0);let Ee=ee?C1(ce,c):Z===c?ce:void 0;if(O&&!Lg(Ee)&&(Ee=C1(P,c)),Lg(Ee)&&(T=Ee,x))return T;let Ze=s[f+1];f=x?sc(Ze):zu(Ze)}if(a!==null){let P=g?a.residualClasses:a.residualStyles;P!=null&&(T=C1(P,c))}return T}function Lg(s){return s!==void 0}function wG(s,a){return s==null||s===""||(typeof a=="string"?s=s+a:typeof s=="object"&&(s=Fr(Yg(s)))),s}function CG(s,a){return(s.flags&(a?8:16))!==0}var ub=class{destroy(a){}updateValue(a,d){}swap(a,d){let c=Math.min(a,d),f=Math.max(a,d),g=this.detach(f);if(f-c>1){let x=this.detach(c);this.attach(c,g),this.attach(f,x)}else this.attach(c,g)}move(a,d){this.attach(d,this.detach(a))}};function R1(s,a,d,c,f){return s===d&&Object.is(a,c)?1:Object.is(f(s,a),f(d,c))?-1:0}function EG(s,a,d){let c,f,g=0,x=s.length-1;if(Array.isArray(a)){let T=a.length-1;for(;g<=x&&g<=T;){let P=s.at(g),O=a[g],Z=R1(g,P,g,O,d);if(Z!==0){Z<0&&s.updateValue(g,O),g++;continue}let ee=s.at(x),ce=a[T],Ee=R1(x,ee,T,ce,d);if(Ee!==0){Ee<0&&s.updateValue(x,ce),x--,T--;continue}let Ze=d(g,P),Vt=d(x,ee),dt=d(g,O);if(Object.is(dt,Vt)){let tt=d(T,ce);Object.is(tt,Ze)?(s.swap(g,x),s.updateValue(x,ce),T--,x--):s.move(x,g),s.updateValue(g,O),g++;continue}if(c??=new Ng,f??=kP(s,g,x,d),db(s,c,g,dt))s.updateValue(g,O),g++,x++;else if(f.has(dt))c.set(Ze,s.detach(g)),x--;else{let tt=s.create(g,a[g]);s.attach(g,tt),g++,x++}}for(;g<=T;)FP(s,c,d,g,a[g]),g++}else if(a!=null){let T=a[Symbol.iterator](),P=T.next();for(;!P.done&&g<=x;){let O=s.at(g),Z=P.value,ee=R1(g,O,g,Z,d);if(ee!==0)ee<0&&s.updateValue(g,Z),g++,P=T.next();else{c??=new Ng,f??=kP(s,g,x,d);let ce=d(g,Z);if(db(s,c,g,ce))s.updateValue(g,Z),g++,x++,P=T.next();else if(!f.has(ce))s.attach(g,s.create(g,Z)),g++,x++,P=T.next();else{let Ee=d(g,O);c.set(Ee,s.detach(g)),x--}}}for(;!P.done;)FP(s,c,d,s.length,P.value),P=T.next()}for(;g<=x;)s.destroy(s.detach(x--));c?.forEach(T=>{s.destroy(T)})}function db(s,a,d,c){return a!==void 0&&a.has(c)?(s.attach(d,a.get(c)),a.delete(c),!0):!1}function FP(s,a,d,c,f){if(db(s,a,c,d(c,f)))s.updateValue(c,f);else{let g=s.create(c,f);s.attach(c,g)}}function kP(s,a,d,c){let f=new Set;for(let g=a;g<=d;g++)f.add(c(g,s.at(g)));return f}var Ng=class{constructor(){this.kvMap=new Map,this._vMap=void 0}has(a){return this.kvMap.has(a)}delete(a){if(!this.has(a))return!1;let d=this.kvMap.get(a);return this._vMap!==void 0&&this._vMap.has(d)?(this.kvMap.set(a,this._vMap.get(d)),this._vMap.delete(d)):this.kvMap.delete(a),!0}get(a){return this.kvMap.get(a)}set(a,d){if(this.kvMap.has(a)){let c=this.kvMap.get(a);this._vMap===void 0&&(this._vMap=new Map);let f=this._vMap;for(;f.has(c);)c=f.get(c);f.set(c,d)}else this.kvMap.set(a,d)}forEach(a){for(let[d,c]of this.kvMap)if(a(c,d),this._vMap!==void 0){let f=this._vMap;for(;f.has(c);)c=f.get(c),a(c,d)}}};function Pt(s,a,d){Vh("NgControlFlow");let c=Xn(),f=Nh(),g=mb(c,eo+s),x=0;if(ua(c,f,a)){let T=fr(null);try{if(PO(g,x),a!==-1){let P=gb(c[mn],eo+a),O=Rh(g,P.tView.ssrId),Z=n_(c,P,d,{dehydratedView:O});i_(g,Z,x,Oh(P,O))}}finally{fr(T)}}else{let T=AO(g,x);T!==void 0&&(T[wr]=d)}}var hb=class{constructor(a,d,c){this.lContainer=a,this.$implicit=d,this.$index=c}get $count(){return this.lContainer.length-kr}};function o_(s){return s}var fb=class{constructor(a,d,c){this.hasEmptyBlock=a,this.trackByFn=d,this.liveCollection=c}};function po(s,a,d,c,f,g,x,T,P,O,Z,ee,ce){Vh("NgControlFlow");let Ee=P!==void 0,Ze=Xn(),Vt=T?x.bind(Ze[rs][wr]):x,dt=new fb(Ee,Vt);Ze[eo+s]=dt,Je(s+1,a,d,c,f,g),Ee&&Je(s+2,P,O,Z,ee,ce)}var pb=class extends ub{constructor(a,d,c){super(),this.lContainer=a,this.hostLView=d,this.templateTNode=c,this.needsIndexUpdate=!1}get length(){return this.lContainer.length-kr}at(a){return this.getLView(a)[wr].$implicit}attach(a,d){let c=d[Ch];this.needsIndexUpdate||=a!==this.length,i_(this.lContainer,d,a,Oh(this.templateTNode,c))}detach(a){return this.needsIndexUpdate||=a!==this.length-1,TG(this.lContainer,a)}create(a,d){let c=Rh(this.lContainer,this.templateTNode.tView.ssrId);return n_(this.hostLView,this.templateTNode,new hb(this.lContainer,d,a),{dehydratedView:c})}destroy(a){Zg(a[mn],a)}updateValue(a,d){this.getLView(a)[wr].$implicit=d}reset(){this.needsIndexUpdate=!1}updateIndexes(){if(this.needsIndexUpdate)for(let a=0;a<this.length;a++)this.getLView(a)[wr].$index=a}getLView(a){return IG(this.lContainer,a)}};function mo(s){let a=fr(null),d=al();try{let c=Xn(),f=c[mn],g=c[d];if(g.liveCollection===void 0){let T=d+1,P=mb(c,T),O=gb(f,T);g.liveCollection=new pb(P,c,O)}else g.liveCollection.reset();let x=g.liveCollection;if(EG(x,s,g.trackByFn),x.updateIndexes(),g.hasEmptyBlock){let T=Nh(),P=x.length===0;if(ua(c,T,P)){let O=d+2,Z=mb(c,O);if(P){let ee=gb(f,O),ce=Rh(Z,ee.tView.ssrId),Ee=n_(c,ee,void 0,{dehydratedView:ce});i_(Z,Ee,0,Oh(ee,ce))}else PO(Z,0)}}}finally{fr(a)}}function mb(s,a){return s[a]}function TG(s,a){return Ah(s,a)}function IG(s,a){return AO(s,a)}function gb(s,a){return Tb(s,a)}function MG(s,a,d,c,f,g){let x=a.consts,T=Eg(x,f),P=e_(a,s,2,c,T);return vO(a,d,P,Eg(x,g)),P.attrs!==null&&ob(P,P.attrs,!1),P.mergedAttrs!==null&&ob(P,P.mergedAttrs,!0),a.queries!==null&&a.queries.elementStart(a,P),P}function U(s,a,d,c){let f=Xn(),g=ho(),x=eo+s,T=f[nr],P=g.firstCreatePass?MG(x,g,f,a,d,c):g.data[x],O=DG(g,f,P,T,a,s);f[x]=O;let Z=Eb(P);return Lh(P,!0),tO(T,O,P),(P.flags&32)!==32&&Rb()&&Gb(g,f,O,P),s6()===0&&rc(O,f),a6(),Z&&(mO(g,f,P),pO(g,P,f)),c!==null&&gO(f,P),U}function j(){let s=Fo();_R()?f6():(s=s.parent,Lh(s,!1));let a=s;u6(a)&&d6(),l6();let d=ho();return d.firstCreatePass&&(Fb(d,s),oR(s)&&d.queries.elementEnd(s)),a.classesWithoutHost!=null&&D6(a)&&RP(d,a,Xn(),a.classesWithoutHost,!0),a.stylesWithoutHost!=null&&S6(a)&&RP(d,a,Xn(),a.stylesWithoutHost,!1),j}function De(s,a,d,c){return U(s,a,d,c),j(),De}var DG=(s,a,d,c,f,g)=>(Ob(!0),XR(c,f,E6()));function Dn(){return Xn()}var Yl=void 0;function SG(s){let a=s,d=Math.floor(Math.abs(s)),c=s.toString().replace(/^[^.]*\.?/,"").length;return d===1&&c===0?1:5}var AG=["en",[["a","p"],["AM","PM"],Yl],[["AM","PM"],Yl,Yl],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Yl,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Yl,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Yl,"{1} 'at' {0}",Yl],[".",",",";","%","+","-","E","\xD7","\u2030","\u221E","NaN",":"],["#,##0.###","#,##0%","\xA4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",SG],O1={};function ko(s){let a=PG(s),d=LP(a);if(d)return d;let c=a.split("-")[0];if(d=LP(c),d)return d;if(c==="en")return AG;throw new $t(701,!1)}function LP(s){return s in O1||(O1[s]=sa.ng&&sa.ng.common&&sa.ng.common.locales&&sa.ng.common.locales[s]),O1[s]}var Vi=function(s){return s[s.LocaleId=0]="LocaleId",s[s.DayPeriodsFormat=1]="DayPeriodsFormat",s[s.DayPeriodsStandalone=2]="DayPeriodsStandalone",s[s.DaysFormat=3]="DaysFormat",s[s.DaysStandalone=4]="DaysStandalone",s[s.MonthsFormat=5]="MonthsFormat",s[s.MonthsStandalone=6]="MonthsStandalone",s[s.Eras=7]="Eras",s[s.FirstDayOfWeek=8]="FirstDayOfWeek",s[s.WeekendRange=9]="WeekendRange",s[s.DateFormat=10]="DateFormat",s[s.TimeFormat=11]="TimeFormat",s[s.DateTimeFormat=12]="DateTimeFormat",s[s.NumberSymbols=13]="NumberSymbols",s[s.NumberFormats=14]="NumberFormats",s[s.CurrencyCode=15]="CurrencyCode",s[s.CurrencySymbol=16]="CurrencySymbol",s[s.CurrencyName=17]="CurrencyName",s[s.Currencies=18]="Currencies",s[s.Directionality=19]="Directionality",s[s.PluralCase=20]="PluralCase",s[s.ExtraData=21]="ExtraData",s}(Vi||{});function PG(s){return s.toLowerCase().replace(/_/g,"-")}var zg="en-US";var RG=zg;function OG(s){xU(s,"Expected localeId to be defined"),typeof s=="string"&&(RG=s.toLowerCase().replace(/_/g,"-"))}function lc(s){return!!s&&typeof s.then=="function"}function LO(s){return!!s&&typeof s.subscribe=="function"}function je(s,a,d,c){let f=Xn(),g=ho(),x=Fo();return kG(g,f,f[nr],x,s,a,c),je}function FG(s,a,d,c){let f=s.cleanup;if(f!=null)for(let g=0;g<f.length-1;g+=2){let x=f[g];if(x===d&&f[g+1]===c){let T=a[Eh],P=f[g+2];return T.length>P?T[P]:null}typeof x=="string"&&(g+=2)}return null}function kG(s,a,d,c,f,g,x){let T=Eb(c),O=s.firstCreatePass&&_8(s),Z=a[wr],ee=g8(a),ce=!0;if(c.type&3||x){let Vt=Oo(c,a),dt=x?x(Vt):Vt,tt=ee.length,Ln=x?bn=>x(Rs(bn[c.index])):c.index,ri=null;if(!x&&T&&(ri=FG(s,a,f,c.index)),ri!==null){let bn=ri.__ngLastListenerFn__||ri;bn.__ngNextListenerFn__=g,ri.__ngLastListenerFn__=g,ce=!1}else{g=zP(c,a,Z,g,!1);let bn=d.listen(dt,f,g);ee.push(g,bn),O&&O.push(f,Ln,tt,tt+1)}}else g=zP(c,a,Z,g,!1);let Ee=c.outputs,Ze;if(ce&&Ee!==null&&(Ze=Ee[f])){let Vt=Ze.length;if(Vt)for(let dt=0;dt<Vt;dt+=2){let tt=Ze[dt],Ln=Ze[dt+1],Pi=a[tt][Ln].subscribe(g),Si=ee.length;ee.push(g,Pi),O&&O.push(f,c.index,Si,-(Si+1))}}}function NP(s,a,d,c){try{return Ss(6,a,d),d(c)!==!1}catch(f){return EO(s,f),!1}finally{Ss(7,a,d)}}function zP(s,a,d,c,f){return function g(x){if(x===Function)return c;let T=s.componentOffset>-1?sl(s.index,a):a;Yb(T);let P=NP(a,d,c,x),O=g.__ngNextListenerFn__;for(;O;)P=NP(a,d,O,x)&&P,O=O.__ngNextListenerFn__;return f&&P===!1&&x.preventDefault(),P}}function Re(s=1){return w6(s)}function cc(s,a,d){return NO(s,"",a,"",d),cc}function NO(s,a,d,c,f){let g=Xn(),x=kO(g,a,d,c);if(x!==ks){let T=ho(),P=Sb();yO(T,P,g,s,x,g[nr],f,!1)}return NO}var Qb=(()=>{let a=class a{};a.__NG_ELEMENT_ID__=zG;let s=a;return s})(),LG=Qb,NG=class extends LG{constructor(a,d,c){super(),this._declarationLView=a,this._declarationTContainer=d,this.elementRef=c}get ssrId(){return this._declarationTContainer.tView?.ssrId||null}createEmbeddedView(a,d){return this.createEmbeddedViewImpl(a,d)}createEmbeddedViewImpl(a,d,c){let f=n_(this._declarationLView,this._declarationTContainer,a,{injector:d,dehydratedView:c});return new oc(f)}};function zG(){return BG(Fo(),Xn())}function BG(s,a){return s.type&4?new NG(a,s,Jg(s,a)):null}function VG(s,a,d,c){d>=s.data.length&&(s.data[d]=null,s.blueprint[d]=null),a[d]=c}function s_(s){let a=p6();return hR(a,eo+s)}function K(s,a=""){let d=Xn(),c=ho(),f=s+eo,g=c.firstCreatePass?e_(c,f,1,a,null):c.data[f],x=jG(c,d,g,a,s);d[f]=x,Rb()&&Gb(c,d,x,g),Lh(g,!1)}var jG=(s,a,d,c,f)=>(Ob(!0),a$(a[nr],c));function Yn(s){return mr("",s,""),Yn}function mr(s,a,d){let c=Xn(),f=kO(c,s,a,d);return f!==ks&&TO(c,al(),f),mr}function Uh(s,a,d,c,f){let g=Xn(),x=aG(g,s,a,d,c,f);return x!==ks&&TO(g,al(),x),Uh}function UG(s,a,d){let c=ho();if(c.firstCreatePass){let f=il(s);_b(d,c.data,c.blueprint,f,!0),_b(a,c.data,c.blueprint,f,!1)}}function _b(s,a,d,c,f){if(s=Or(s),Array.isArray(s))for(let g=0;g<s.length;g++)_b(s[g],a,d,c,f);else{let g=ho(),x=Xn(),T=Fo(),P=Lu(s)?s:Or(s.provide),O=$R(s),Z=T.providerIndexes&1048575,ee=T.directiveStart,ce=T.providerIndexes>>20;if(Lu(s)||!s.multi){let Ee=new ic(O,f,qe),Ze=k1(P,a,f?Z:Z+ce,ee);Ze===-1?(G1(Dg(T,x),g,P),F1(g,s,a.length),a.push(P),T.directiveStart++,T.directiveEnd++,f&&(T.providerIndexes+=1048576),d.push(Ee),x.push(Ee)):(d[Ze]=Ee,x[Ze]=Ee)}else{let Ee=k1(P,a,Z+ce,ee),Ze=k1(P,a,Z,Z+ce),Vt=Ee>=0&&d[Ee],dt=Ze>=0&&d[Ze];if(f&&!dt||!f&&!Vt){G1(Dg(T,x),g,P);let tt=HG(f?GG:$G,d.length,f,c,O);!f&&dt&&(d[Ze].providerFactory=tt),F1(g,s,a.length,0),a.push(P),T.directiveStart++,T.directiveEnd++,f&&(T.providerIndexes+=1048576),d.push(tt),x.push(tt)}else{let tt=zO(d[f?Ze:Ee],O,!f&&c);F1(g,s,Ee>-1?Ee:Ze,tt)}!f&&c&&dt&&d[Ze].componentProviders++}}}function F1(s,a,d,c){let f=Lu(a),g=W6(a);if(f||g){let P=(g?Or(a.useClass):a).prototype.ngOnDestroy;if(P){let O=s.destroyHooks||(s.destroyHooks=[]);if(!f&&a.multi){let Z=O.indexOf(d);Z===-1?O.push(d,[c,P]):O[Z+1].push(c,P)}else O.push(d,P)}}}function zO(s,a,d){return d&&s.componentProviders++,s.multi.push(a)-1}function k1(s,a,d,c){for(let f=d;f<c;f++)if(a[f]===s)return f;return-1}function $G(s,a,d,c){return yb(this.multi,[])}function GG(s,a,d,c){let f=this.multi,g;if(this.providerFactory){let x=this.providerFactory.componentProviders,T=Fu(d,d[mn],this.providerFactory.index,c);g=T.slice(0,x),yb(f,g);for(let P=x;P<T.length;P++)g.push(T[P])}else g=[],yb(f,g);return g}function yb(s,a){for(let d=0;d<s.length;d++){let c=s[d];a.push(c())}return a}function HG(s,a,d,c,f){let g=new ic(s,d,qe);return g.multi=[],g.index=a,g.componentProviders=0,zO(g,f,c&&!d),g}function cn(s,a=[]){return d=>{d.providersResolver=(c,f)=>UG(c,f?f(s):s,a)}}var rl=class{},kh=class{};var vb=class extends rl{constructor(a,d,c){super(),this._parent=d,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new kg(this);let f=eR(a);this._bootstrapComponents=qR(f.bootstrap),this._r3Injector=GR(a,d,[{provide:rl,useValue:this},{provide:Kg,useValue:this.componentFactoryResolver},...c],Fr(a),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(a)}get injector(){return this._r3Injector}destroy(){let a=this._r3Injector;!a.destroyed&&a.destroy(),this.destroyCbs.forEach(d=>d()),this.destroyCbs=null}onDestroy(a){this.destroyCbs.push(a)}},xb=class extends kh{constructor(a){super(),this.moduleType=a}create(a){return new vb(this.moduleType,a,[])}};var Bg=class extends rl{constructor(a){super(),this.componentFactoryResolver=new kg(this),this.instance=null;let d=new Sh([...a.providers,{provide:rl,useValue:this},{provide:Kg,useValue:this.componentFactoryResolver}],a.parent||zb(),a.debugName,new Set(["environment"]));this.injector=d,a.runEnvironmentInitializers&&d.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(a){this.injector.onDestroy(a)}};function ew(s,a,d=null){return new Bg({providers:s,parent:a,debugName:d,runEnvironmentInitializers:!0}).injector}var qG=(()=>{let a=class a{constructor(c){this._injector=c,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(c){if(!c.standalone)return null;if(!this.cachedInjectors.has(c)){let f=VR(!1,c.type),g=f.length>0?ew([f],this._injector,`Standalone[${c.type.name}]`):null;this.cachedInjectors.set(c,g)}return this.cachedInjectors.get(c)}ngOnDestroy(){try{for(let c of this.cachedInjectors.values())c!==null&&c.destroy()}finally{this.cachedInjectors.clear()}}};a.\u0275prov=gt({token:a,providedIn:"environment",factory:()=>new a(vt(to))});let s=a;return s})();function nn(s){Vh("NgStandalone"),s.getStandaloneInjector=a=>a.get(qG).getOrCreateStandaloneInjector(s)}function Un(s,a,d,c){return WG(Xn(),yR(),s,a,d,c)}function BO(s,a){let d=s[a];return d===ks?void 0:d}function WG(s,a,d,c,f,g){let x=a+d;return ua(s,x,f)?OO(s,x+1,g?c.call(g,f):c(f)):BO(s,x+1)}function ZG(s,a,d,c,f,g,x){let T=a+d;return FO(s,T,f,g)?OO(s,T+2,x?c.call(x,f,g):c(f,g)):BO(s,T+2)}function Lo(s,a){let d=ho(),c,f=s+eo;d.firstCreatePass?(c=XG(a,d.pipeRegistry),d.data[f]=c,c.onDestroy&&(d.destroyHooks??=[]).push(f,c.onDestroy)):c=d.data[f];let g=c.factory||(c.factory=tc(c.type,!0)),x,T=Qr(qe);try{let P=Mg(!1),O=g();return Mg(P),VG(d,Xn(),f,O),O}finally{Qr(T)}}function XG(s,a){if(a)for(let d=a.length-1;d>=0;d--){let c=a[d];if(s===c.name)return c}}function No(s,a,d,c){let f=s+eo,g=Xn(),x=hR(g,f);return YG(g,f)?ZG(g,yR(),a,x.transform,d,c,x):x.transform(d,c)}function YG(s,a){return s[mn].data[a].pure}var a_=(()=>{let a=class a{log(c){console.log(c)}warn(c){console.warn(c)}};a.\u0275fac=function(f){return new(f||a)},a.\u0275prov=gt({token:a,factory:a.\u0275fac,providedIn:"platform"});let s=a;return s})(),bb=class{constructor(a,d){this.ngModuleFactory=a,this.componentFactories=d}},tw=(()=>{let a=class a{compileModuleSync(c){return new xb(c)}compileModuleAsync(c){return Promise.resolve(this.compileModuleSync(c))}compileModuleAndAllComponentsSync(c){let f=this.compileModuleSync(c),g=eR(c),x=qR(g.declarations).reduce((T,P)=>{let O=nl(P);return O&&T.push(new Nu(O)),T},[]);return new bb(f,x)}compileModuleAndAllComponentsAsync(c){return Promise.resolve(this.compileModuleAndAllComponentsSync(c))}clearCache(){}clearCacheFor(c){}getModuleId(c){}};a.\u0275fac=function(f){return new(f||a)},a.\u0275prov=gt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();var uc=(()=>{let a=class a{constructor(){this.taskId=0,this.pendingTasks=new Set,this.hasPendingTasks=new pr(!1)}get _hasPendingTasks(){return this.hasPendingTasks.value}add(){this._hasPendingTasks||this.hasPendingTasks.next(!0);let c=this.taskId++;return this.pendingTasks.add(c),c}remove(c){this.pendingTasks.delete(c),this.pendingTasks.size===0&&this._hasPendingTasks&&this.hasPendingTasks.next(!1)}ngOnDestroy(){this.pendingTasks.clear(),this._hasPendingTasks&&this.hasPendingTasks.next(!1)}};a.\u0275fac=function(f){return new(f||a)},a.\u0275prov=gt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();var VO=new zt("");var jO=new zt("Application Initializer"),UO=(()=>{let a=class a{constructor(){this.initialized=!1,this.done=!1,this.donePromise=new Promise((c,f)=>{this.resolve=c,this.reject=f}),this.appInits=ut(jO,{optional:!0})??[]}runInitializers(){if(this.initialized)return;let c=[];for(let g of this.appInits){let x=g();if(lc(x))c.push(x);else if(LO(x)){let T=new Promise((P,O)=>{x.subscribe({complete:P,error:O})});c.push(T)}}let f=()=>{this.done=!0,this.resolve()};Promise.all(c).then(()=>{f()}).catch(g=>{this.reject(g)}),c.length===0&&f(),this.initialized=!0}};a.\u0275fac=function(f){return new(f||a)},a.\u0275prov=gt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})(),l_=new zt("appBootstrapListener");function KG(){OA(()=>{throw new $t(600,!1)})}function JG(s){return s.isBoundToModule}function QG(s,a,d){try{let c=d();return lc(c)?c.catch(f=>{throw a.runOutsideAngular(()=>s.handleError(f)),f}):c}catch(c){throw a.runOutsideAngular(()=>s.handleError(c)),c}}var ju=(()=>{let a=class a{constructor(){this._bootstrapListeners=[],this._runningTick=!1,this._destroyed=!1,this._destroyListeners=[],this._views=[],this.internalErrorHandler=ut(lO),this.afterRenderEffectManager=ut(SO),this.componentTypes=[],this.components=[],this.isStable=ut(uc).hasPendingTasks.pipe(ot(c=>!c)),this._injector=ut(to)}get destroyed(){return this._destroyed}get injector(){return this._injector}bootstrap(c,f){let g=c instanceof Og;if(!this._injector.get(UO).done){let Ee=!g&&QP(c),Ze=!1;throw new $t(405,Ze)}let T;g?T=c:T=this._injector.get(Kg).resolveComponentFactory(c),this.componentTypes.push(T.componentType);let P=JG(T)?void 0:this._injector.get(rl),O=f||T.selector,Z=T.create(ac.NULL,[],O,P),ee=Z.location.nativeElement,ce=Z.injector.get(VO,null);return ce?.registerApplication(ee),Z.onDestroy(()=>{this.detachView(Z.hostView),L1(this.components,Z),ce?.unregisterApplication(ee)}),this._loadComponent(Z),Z}tick(){if(this._runningTick)throw new $t(101,!1);try{this._runningTick=!0;for(let c of this._views)c.detectChanges()}catch(c){this.internalErrorHandler(c)}finally{try{let c=this.afterRenderEffectManager.execute()}catch(c){this.internalErrorHandler(c)}this._runningTick=!1}}attachView(c){let f=c;this._views.push(f),f.attachToAppRef(this)}detachView(c){let f=c;L1(this._views,f),f.detachFromAppRef()}_loadComponent(c){this.attachView(c.hostView),this.tick(),this.components.push(c);let f=this._injector.get(l_,[]);[...this._bootstrapListeners,...f].forEach(g=>g(c))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(c=>c()),this._views.slice().forEach(c=>c.destroy())}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(c){return this._destroyListeners.push(c),()=>L1(this._destroyListeners,c)}destroy(){if(this._destroyed)throw new $t(406,!1);let c=this._injector;c.destroy&&!c.destroyed&&c.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}};a.\u0275fac=function(f){return new(f||a)},a.\u0275prov=gt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();function L1(s,a){let d=s.indexOf(a);d>-1&&s.splice(d,1)}var eH=(()=>{let a=class a{constructor(){this.zone=ut(Bi),this.applicationRef=ut(ju)}initialize(){this._onMicrotaskEmptySubscription||(this._onMicrotaskEmptySubscription=this.zone.onMicrotaskEmpty.subscribe({next:()=>{this.zone.run(()=>{this.applicationRef.tick()})}}))}ngOnDestroy(){this._onMicrotaskEmptySubscription?.unsubscribe()}};a.\u0275fac=function(f){return new(f||a)},a.\u0275prov=gt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();function tH(s){return[{provide:Bi,useFactory:s},{provide:ku,multi:!0,useFactory:()=>{let a=ut(eH,{optional:!0});return()=>a.initialize()}},{provide:ku,multi:!0,useFactory:()=>{let a=ut(oH);return()=>{a.initialize()}}},{provide:lO,useFactory:nH}]}function nH(){let s=ut(Bi),a=ut(ca);return d=>s.runOutsideAngular(()=>a.handleError(d))}function iH(s){let a=tH(()=>new Bi(rH(s)));return Vu([[],a])}function rH(s){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:s?.eventCoalescing??!1,shouldCoalesceRunChangeDetection:s?.runCoalescing??!1}}var oH=(()=>{let a=class a{constructor(){this.subscription=new Yi,this.initialized=!1,this.zone=ut(Bi),this.pendingTasks=ut(uc)}initialize(){if(this.initialized)return;this.initialized=!0;let c=null;!this.zone.isStable&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(c=this.pendingTasks.add()),this.zone.runOutsideAngular(()=>{this.subscription.add(this.zone.onStable.subscribe(()=>{Bi.assertNotInAngularZone(),queueMicrotask(()=>{c!==null&&!this.zone.hasPendingMacrotasks&&!this.zone.hasPendingMicrotasks&&(this.pendingTasks.remove(c),c=null)})}))}),this.subscription.add(this.zone.onUnstable.subscribe(()=>{Bi.assertInAngularZone(),c??=this.pendingTasks.add()}))}ngOnDestroy(){this.subscription.unsubscribe()}};a.\u0275fac=function(f){return new(f||a)},a.\u0275prov=gt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();function sH(){return typeof $localize<"u"&&$localize.locale||zg}var c_=new zt("LocaleId",{providedIn:"root",factory:()=>ut(c_,Tn.Optional|Tn.SkipSelf)||sH()});var $O=new zt("PlatformDestroyListeners");var vg=null;function aH(s=[],a){return ac.create({name:a,providers:[{provide:Wg,useValue:"platform"},{provide:$O,useValue:new Set([()=>vg=null])},...s]})}function lH(s=[]){if(vg)return vg;let a=aH(s);return vg=a,KG(),cH(a),a}function cH(s){s.get(Vb,null)?.forEach(d=>d())}function GO(s){try{let{rootComponent:a,appProviders:d,platformProviders:c}=s,f=lH(c),g=[iH(),...d||[]],T=new Bg({providers:g,parent:f,debugName:"",runEnvironmentInitializers:!1}).injector,P=T.get(Bi);return P.run(()=>{T.resolveInjectorInitializers();let O=T.get(ca,null),Z;P.runOutsideAngular(()=>{Z=P.onError.subscribe({next:Ee=>{O.handleError(Ee)}})});let ee=()=>T.destroy(),ce=f.get($O);return ce.add(ee),T.onDestroy(()=>{Z.unsubscribe(),ce.delete(ee)}),QG(O,P,()=>{let Ee=T.get(UO);return Ee.runInitializers(),Ee.donePromise.then(()=>{let Ze=T.get(c_,zg);OG(Ze||zg);let Vt=T.get(ju);return a!==void 0&&Vt.bootstrap(a),Vt})})})}catch(a){return Promise.reject(a)}}function u_(s){return typeof s=="boolean"?s:s!=null&&s!=="false"}function HO(s){let a=nl(s);if(!a)return null;let d=new Nu(a);return{get selector(){return d.selector},get type(){return d.componentType},get inputs(){return d.inputs},get outputs(){return d.outputs},get ngContentSelectors(){return d.ngContentSelectors},get isStandalone(){return a.standalone},get isSignal(){return a.signals}}}var sw=null;function _a(){return sw}function KO(s){sw||(sw=s)}var y_=class{},gr=new zt("DocumentToken"),JO=(()=>{let a=class a{historyGo(c){throw new Error("Not implemented")}};a.\u0275fac=function(f){return new(f||a)},a.\u0275prov=gt({token:a,factory:()=>ut(hH),providedIn:"platform"});let s=a;return s})();var hH=(()=>{let a=class a extends JO{constructor(){super(),this._doc=ut(gr),this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return _a().getBaseHref(this._doc)}onPopState(c){let f=_a().getGlobalEventTarget(this._doc,"window");return f.addEventListener("popstate",c,!1),()=>f.removeEventListener("popstate",c)}onHashChange(c){let f=_a().getGlobalEventTarget(this._doc,"window");return f.addEventListener("hashchange",c,!1),()=>f.removeEventListener("hashchange",c)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(c){this._location.pathname=c}pushState(c,f,g){this._history.pushState(c,f,g)}replaceState(c,f,g){this._history.replaceState(c,f,g)}forward(){this._history.forward()}back(){this._history.back()}historyGo(c=0){this._history.go(c)}getState(){return this._history.state}};a.\u0275fac=function(f){return new(f||a)},a.\u0275prov=gt({token:a,factory:()=>new a,providedIn:"platform"});let s=a;return s})();function QO(s,a){if(s.length==0)return a;if(a.length==0)return s;let d=0;return s.endsWith("/")&&d++,a.startsWith("/")&&d++,d==2?s+a.substring(1):d==1?s+a:s+"/"+a}function qO(s){let a=s.match(/#|\?|$/),d=a&&a.index||s.length,c=d-(s[d-1]==="/"?1:0);return s.slice(0,c)+s.slice(d)}function dc(s){return s&&s[0]!=="?"?"?"+s:s}var x_=(()=>{let a=class a{historyGo(c){throw new Error("Not implemented")}};a.\u0275fac=function(f){return new(f||a)},a.\u0275prov=gt({token:a,factory:()=>ut(eF),providedIn:"root"});let s=a;return s})(),fH=new zt("appBaseHref"),eF=(()=>{let a=class a extends x_{constructor(c,f){super(),this._platformLocation=c,this._removeListenerFns=[],this._baseHref=f??this._platformLocation.getBaseHrefFromDOM()??ut(gr).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(c){this._removeListenerFns.push(this._platformLocation.onPopState(c),this._platformLocation.onHashChange(c))}getBaseHref(){return this._baseHref}prepareExternalUrl(c){return QO(this._baseHref,c)}path(c=!1){let f=this._platformLocation.pathname+dc(this._platformLocation.search),g=this._platformLocation.hash;return g&&c?`${f}${g}`:f}pushState(c,f,g,x){let T=this.prepareExternalUrl(g+dc(x));this._platformLocation.pushState(c,f,T)}replaceState(c,f,g,x){let T=this.prepareExternalUrl(g+dc(x));this._platformLocation.replaceState(c,f,T)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(c=0){this._platformLocation.historyGo?.(c)}};a.\u0275fac=function(f){return new(f||a)(vt(JO),vt(fH,8))},a.\u0275prov=gt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();var _r=(()=>{let a=class a{constructor(c){this._subject=new br,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=c;let f=this._locationStrategy.getBaseHref();this._basePath=gH(qO(WO(f))),this._locationStrategy.onPopState(g=>{this._subject.emit({url:this.path(!0),pop:!0,state:g.state,type:g.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(c=!1){return this.normalize(this._locationStrategy.path(c))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(c,f=""){return this.path()==this.normalize(c+dc(f))}normalize(c){return a.stripTrailingSlash(mH(this._basePath,WO(c)))}prepareExternalUrl(c){return c&&c[0]!=="/"&&(c="/"+c),this._locationStrategy.prepareExternalUrl(c)}go(c,f="",g=null){this._locationStrategy.pushState(g,"",c,f),this._notifyUrlChangeListeners(this.prepareExternalUrl(c+dc(f)),g)}replaceState(c,f="",g=null){this._locationStrategy.replaceState(g,"",c,f),this._notifyUrlChangeListeners(this.prepareExternalUrl(c+dc(f)),g)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(c=0){this._locationStrategy.historyGo?.(c)}onUrlChange(c){return this._urlChangeListeners.push(c),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(f=>{this._notifyUrlChangeListeners(f.url,f.state)})),()=>{let f=this._urlChangeListeners.indexOf(c);this._urlChangeListeners.splice(f,1),this._urlChangeListeners.length===0&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(c="",f){this._urlChangeListeners.forEach(g=>g(c,f))}subscribe(c,f,g){return this._subject.subscribe({next:c,error:f,complete:g})}};a.normalizeQueryParams=dc,a.joinWithSlash=QO,a.stripTrailingSlash=qO,a.\u0275fac=function(f){return new(f||a)(vt(x_))},a.\u0275prov=gt({token:a,factory:()=>pH(),providedIn:"root"});let s=a;return s})();function pH(){return new _r(vt(x_))}function mH(s,a){if(!s||!a.startsWith(s))return a;let d=a.substring(s.length);return d===""||["/",";","?","#"].includes(d[0])?d:a}function WO(s){return s.replace(/\/index.html$/,"")}function gH(s){if(new RegExp("^(https?:)?//").test(s)){let[,d]=s.split(/\/\/[^\/]+/);return d}return s}var Lr=function(s){return s[s.Format=0]="Format",s[s.Standalone=1]="Standalone",s}(Lr||{}),ui=function(s){return s[s.Narrow=0]="Narrow",s[s.Abbreviated=1]="Abbreviated",s[s.Wide=2]="Wide",s[s.Short=3]="Short",s}(ui||{}),go=function(s){return s[s.Short=0]="Short",s[s.Medium=1]="Medium",s[s.Long=2]="Long",s[s.Full=3]="Full",s}(go||{}),ma=function(s){return s[s.Decimal=0]="Decimal",s[s.Group=1]="Group",s[s.List=2]="List",s[s.PercentSign=3]="PercentSign",s[s.PlusSign=4]="PlusSign",s[s.MinusSign=5]="MinusSign",s[s.Exponential=6]="Exponential",s[s.SuperscriptingExponent=7]="SuperscriptingExponent",s[s.PerMille=8]="PerMille",s[s.Infinity=9]="Infinity",s[s.NaN=10]="NaN",s[s.TimeSeparator=11]="TimeSeparator",s[s.CurrencyDecimal=12]="CurrencyDecimal",s[s.CurrencyGroup=13]="CurrencyGroup",s}(ma||{});function _H(s){return ko(s)[Vi.LocaleId]}function yH(s,a,d){let c=ko(s),f=[c[Vi.DayPeriodsFormat],c[Vi.DayPeriodsStandalone]],g=zo(f,a);return zo(g,d)}function vH(s,a,d){let c=ko(s),f=[c[Vi.DaysFormat],c[Vi.DaysStandalone]],g=zo(f,a);return zo(g,d)}function xH(s,a,d){let c=ko(s),f=[c[Vi.MonthsFormat],c[Vi.MonthsStandalone]],g=zo(f,a);return zo(g,d)}function bH(s,a){let c=ko(s)[Vi.Eras];return zo(c,a)}function d_(s,a){let d=ko(s);return zo(d[Vi.DateFormat],a)}function h_(s,a){let d=ko(s);return zo(d[Vi.TimeFormat],a)}function f_(s,a){let c=ko(s)[Vi.DateTimeFormat];return zo(c,a)}function b_(s,a){let d=ko(s),c=d[Vi.NumberSymbols][a];if(typeof c>"u"){if(a===ma.CurrencyDecimal)return d[Vi.NumberSymbols][ma.Decimal];if(a===ma.CurrencyGroup)return d[Vi.NumberSymbols][ma.Group]}return c}function tF(s){if(!s[Vi.ExtraData])throw new Error(`Missing extra locale data for the locale "${s[Vi.LocaleId]}". Use "registerLocaleData" to load new data. See the "I18n guide" on angular.io to know more.`)}function wH(s){let a=ko(s);return tF(a),(a[Vi.ExtraData][2]||[]).map(c=>typeof c=="string"?nw(c):[nw(c[0]),nw(c[1])])}function CH(s,a,d){let c=ko(s);tF(c);let f=[c[Vi.ExtraData][0],c[Vi.ExtraData][1]],g=zo(f,a)||[];return zo(g,d)||[]}function zo(s,a){for(let d=a;d>-1;d--)if(typeof s[d]<"u")return s[d];throw new Error("Locale data API: locale data undefined")}function nw(s){let[a,d]=s.split(":");return{hours:+a,minutes:+d}}var EH=/^(\d{4,})-?(\d\d)-?(\d\d)(?:T(\d\d)(?::?(\d\d)(?::?(\d\d)(?:\.(\d+))?)?)?(Z|([+-])(\d\d):?(\d\d))?)?$/,$h={},TH=/((?:[^BEGHLMOSWYZabcdhmswyz']+)|(?:'(?:[^']|'')*')|(?:G{1,5}|y{1,4}|Y{1,4}|M{1,5}|L{1,5}|w{1,2}|W{1}|d{1,2}|E{1,6}|c{1,6}|a{1,5}|b{1,5}|B{1,5}|h{1,2}|H{1,2}|m{1,2}|s{1,2}|S{1,3}|z{1,4}|Z{1,5}|O{1,4}))([\s\S]*)/,ga=function(s){return s[s.Short=0]="Short",s[s.ShortGMT=1]="ShortGMT",s[s.Long=2]="Long",s[s.Extended=3]="Extended",s}(ga||{}),Gn=function(s){return s[s.FullYear=0]="FullYear",s[s.Month=1]="Month",s[s.Date=2]="Date",s[s.Hours=3]="Hours",s[s.Minutes=4]="Minutes",s[s.Seconds=5]="Seconds",s[s.FractionalSeconds=6]="FractionalSeconds",s[s.Day=7]="Day",s}(Gn||{}),$n=function(s){return s[s.DayPeriods=0]="DayPeriods",s[s.Days=1]="Days",s[s.Months=2]="Months",s[s.Eras=3]="Eras",s}($n||{});function IH(s,a,d,c){let f=kH(s);a=pa(d,a)||a;let x=[],T;for(;a;)if(T=TH.exec(a),T){x=x.concat(T.slice(1));let Z=x.pop();if(!Z)break;a=Z}else{x.push(a);break}let P=f.getTimezoneOffset();c&&(P=iF(c,P),f=FH(f,c,!0));let O="";return x.forEach(Z=>{let ee=RH(Z);O+=ee?ee(f,d,P):Z==="''"?"'":Z.replace(/(^'|'$)/g,"").replace(/''/g,"'")}),O}function v_(s,a,d){let c=new Date(0);return c.setFullYear(s,a,d),c.setHours(0,0,0),c}function pa(s,a){let d=_H(s);if($h[d]=$h[d]||{},$h[d][a])return $h[d][a];let c="";switch(a){case"shortDate":c=d_(s,go.Short);break;case"mediumDate":c=d_(s,go.Medium);break;case"longDate":c=d_(s,go.Long);break;case"fullDate":c=d_(s,go.Full);break;case"shortTime":c=h_(s,go.Short);break;case"mediumTime":c=h_(s,go.Medium);break;case"longTime":c=h_(s,go.Long);break;case"fullTime":c=h_(s,go.Full);break;case"short":let f=pa(s,"shortTime"),g=pa(s,"shortDate");c=p_(f_(s,go.Short),[f,g]);break;case"medium":let x=pa(s,"mediumTime"),T=pa(s,"mediumDate");c=p_(f_(s,go.Medium),[x,T]);break;case"long":let P=pa(s,"longTime"),O=pa(s,"longDate");c=p_(f_(s,go.Long),[P,O]);break;case"full":let Z=pa(s,"fullTime"),ee=pa(s,"fullDate");c=p_(f_(s,go.Full),[Z,ee]);break}return c&&($h[d][a]=c),c}function p_(s,a){return a&&(s=s.replace(/\{([^}]+)}/g,function(d,c){return a!=null&&c in a?a[c]:d})),s}function cs(s,a,d="-",c,f){let g="";(s<0||f&&s<=0)&&(f?s=-s+1:(s=-s,g=d));let x=String(s);for(;x.length<a;)x="0"+x;return c&&(x=x.slice(x.length-a)),g+x}function MH(s,a){return cs(s,3).substring(0,a)}function qi(s,a,d=0,c=!1,f=!1){return function(g,x){let T=DH(s,g);if((d>0||T>-d)&&(T+=d),s===Gn.Hours)T===0&&d===-12&&(T=12);else if(s===Gn.FractionalSeconds)return MH(T,a);let P=b_(x,ma.MinusSign);return cs(T,a,P,c,f)}}function DH(s,a){switch(s){case Gn.FullYear:return a.getFullYear();case Gn.Month:return a.getMonth();case Gn.Date:return a.getDate();case Gn.Hours:return a.getHours();case Gn.Minutes:return a.getMinutes();case Gn.Seconds:return a.getSeconds();case Gn.FractionalSeconds:return a.getMilliseconds();case Gn.Day:return a.getDay();default:throw new Error(`Unknown DateType value "${s}".`)}}function pi(s,a,d=Lr.Format,c=!1){return function(f,g){return SH(f,g,s,a,d,c)}}function SH(s,a,d,c,f,g){switch(d){case $n.Months:return xH(a,f,c)[s.getMonth()];case $n.Days:return vH(a,f,c)[s.getDay()];case $n.DayPeriods:let x=s.getHours(),T=s.getMinutes();if(g){let O=wH(a),Z=CH(a,f,c),ee=O.findIndex(ce=>{if(Array.isArray(ce)){let[Ee,Ze]=ce,Vt=x>=Ee.hours&&T>=Ee.minutes,dt=x<Ze.hours||x===Ze.hours&&T<Ze.minutes;if(Ee.hours<Ze.hours){if(Vt&&dt)return!0}else if(Vt||dt)return!0}else if(ce.hours===x&&ce.minutes===T)return!0;return!1});if(ee!==-1)return Z[ee]}return yH(a,f,c)[x<12?0:1];case $n.Eras:return bH(a,c)[s.getFullYear()<=0?0:1];default:let P=d;throw new Error(`unexpected translation type ${P}`)}}function m_(s){return function(a,d,c){let f=-1*c,g=b_(d,ma.MinusSign),x=f>0?Math.floor(f/60):Math.ceil(f/60);switch(s){case ga.Short:return(f>=0?"+":"")+cs(x,2,g)+cs(Math.abs(f%60),2,g);case ga.ShortGMT:return"GMT"+(f>=0?"+":"")+cs(x,1,g);case ga.Long:return"GMT"+(f>=0?"+":"")+cs(x,2,g)+":"+cs(Math.abs(f%60),2,g);case ga.Extended:return c===0?"Z":(f>=0?"+":"")+cs(x,2,g)+":"+cs(Math.abs(f%60),2,g);default:throw new Error(`Unknown zone width "${s}"`)}}}var AH=0,__=4;function PH(s){let a=v_(s,AH,1).getDay();return v_(s,0,1+(a<=__?__:__+7)-a)}function nF(s){return v_(s.getFullYear(),s.getMonth(),s.getDate()+(__-s.getDay()))}function iw(s,a=!1){return function(d,c){let f;if(a){let g=new Date(d.getFullYear(),d.getMonth(),1).getDay()-1,x=d.getDate();f=1+Math.floor((x+g)/7)}else{let g=nF(d),x=PH(g.getFullYear()),T=g.getTime()-x.getTime();f=1+Math.round(T/6048e5)}return cs(f,s,b_(c,ma.MinusSign))}}function g_(s,a=!1){return function(d,c){let g=nF(d).getFullYear();return cs(g,s,b_(c,ma.MinusSign),a)}}var rw={};function RH(s){if(rw[s])return rw[s];let a;switch(s){case"G":case"GG":case"GGG":a=pi($n.Eras,ui.Abbreviated);break;case"GGGG":a=pi($n.Eras,ui.Wide);break;case"GGGGG":a=pi($n.Eras,ui.Narrow);break;case"y":a=qi(Gn.FullYear,1,0,!1,!0);break;case"yy":a=qi(Gn.FullYear,2,0,!0,!0);break;case"yyy":a=qi(Gn.FullYear,3,0,!1,!0);break;case"yyyy":a=qi(Gn.FullYear,4,0,!1,!0);break;case"Y":a=g_(1);break;case"YY":a=g_(2,!0);break;case"YYY":a=g_(3);break;case"YYYY":a=g_(4);break;case"M":case"L":a=qi(Gn.Month,1,1);break;case"MM":case"LL":a=qi(Gn.Month,2,1);break;case"MMM":a=pi($n.Months,ui.Abbreviated);break;case"MMMM":a=pi($n.Months,ui.Wide);break;case"MMMMM":a=pi($n.Months,ui.Narrow);break;case"LLL":a=pi($n.Months,ui.Abbreviated,Lr.Standalone);break;case"LLLL":a=pi($n.Months,ui.Wide,Lr.Standalone);break;case"LLLLL":a=pi($n.Months,ui.Narrow,Lr.Standalone);break;case"w":a=iw(1);break;case"ww":a=iw(2);break;case"W":a=iw(1,!0);break;case"d":a=qi(Gn.Date,1);break;case"dd":a=qi(Gn.Date,2);break;case"c":case"cc":a=qi(Gn.Day,1);break;case"ccc":a=pi($n.Days,ui.Abbreviated,Lr.Standalone);break;case"cccc":a=pi($n.Days,ui.Wide,Lr.Standalone);break;case"ccccc":a=pi($n.Days,ui.Narrow,Lr.Standalone);break;case"cccccc":a=pi($n.Days,ui.Short,Lr.Standalone);break;case"E":case"EE":case"EEE":a=pi($n.Days,ui.Abbreviated);break;case"EEEE":a=pi($n.Days,ui.Wide);break;case"EEEEE":a=pi($n.Days,ui.Narrow);break;case"EEEEEE":a=pi($n.Days,ui.Short);break;case"a":case"aa":case"aaa":a=pi($n.DayPeriods,ui.Abbreviated);break;case"aaaa":a=pi($n.DayPeriods,ui.Wide);break;case"aaaaa":a=pi($n.DayPeriods,ui.Narrow);break;case"b":case"bb":case"bbb":a=pi($n.DayPeriods,ui.Abbreviated,Lr.Standalone,!0);break;case"bbbb":a=pi($n.DayPeriods,ui.Wide,Lr.Standalone,!0);break;case"bbbbb":a=pi($n.DayPeriods,ui.Narrow,Lr.Standalone,!0);break;case"B":case"BB":case"BBB":a=pi($n.DayPeriods,ui.Abbreviated,Lr.Format,!0);break;case"BBBB":a=pi($n.DayPeriods,ui.Wide,Lr.Format,!0);break;case"BBBBB":a=pi($n.DayPeriods,ui.Narrow,Lr.Format,!0);break;case"h":a=qi(Gn.Hours,1,-12);break;case"hh":a=qi(Gn.Hours,2,-12);break;case"H":a=qi(Gn.Hours,1);break;case"HH":a=qi(Gn.Hours,2);break;case"m":a=qi(Gn.Minutes,1);break;case"mm":a=qi(Gn.Minutes,2);break;case"s":a=qi(Gn.Seconds,1);break;case"ss":a=qi(Gn.Seconds,2);break;case"S":a=qi(Gn.FractionalSeconds,1);break;case"SS":a=qi(Gn.FractionalSeconds,2);break;case"SSS":a=qi(Gn.FractionalSeconds,3);break;case"Z":case"ZZ":case"ZZZ":a=m_(ga.Short);break;case"ZZZZZ":a=m_(ga.Extended);break;case"O":case"OO":case"OOO":case"z":case"zz":case"zzz":a=m_(ga.ShortGMT);break;case"OOOO":case"ZZZZ":case"zzzz":a=m_(ga.Long);break;default:return null}return rw[s]=a,a}function iF(s,a){s=s.replace(/:/g,"");let d=Date.parse("Jan 01, 1970 00:00:00 "+s)/6e4;return isNaN(d)?a:d}function OH(s,a){return s=new Date(s.getTime()),s.setMinutes(s.getMinutes()+a),s}function FH(s,a,d){let c=d?-1:1,f=s.getTimezoneOffset(),g=iF(a,f);return OH(s,c*(g-f))}function kH(s){if(ZO(s))return s;if(typeof s=="number"&&!isNaN(s))return new Date(s);if(typeof s=="string"){if(s=s.trim(),/^(\d{4}(-\d{1,2}(-\d{1,2})?)?)$/.test(s)){let[f,g=1,x=1]=s.split("-").map(T=>+T);return v_(f,g-1,x)}let d=parseFloat(s);if(!isNaN(s-d))return new Date(d);let c;if(c=s.match(EH))return LH(c)}let a=new Date(s);if(!ZO(a))throw new Error(`Unable to convert "${s}" into a date`);return a}function LH(s){let a=new Date(0),d=0,c=0,f=s[8]?a.setUTCFullYear:a.setFullYear,g=s[8]?a.setUTCHours:a.setHours;s[9]&&(d=Number(s[9]+s[10]),c=Number(s[9]+s[11])),f.call(a,Number(s[1]),Number(s[2])-1,Number(s[3]));let x=Number(s[4]||0)-d,T=Number(s[5]||0)-c,P=Number(s[6]||0),O=Math.floor(parseFloat("0."+(s[7]||0))*1e3);return g.call(a,x,T,P,O),a}function ZO(s){return s instanceof Date&&!isNaN(s.valueOf())}function w_(s,a){a=encodeURIComponent(a);for(let d of s.split(";")){let c=d.indexOf("="),[f,g]=c==-1?[d,""]:[d.slice(0,c),d.slice(c+1)];if(f.trim()===a)return decodeURIComponent(g)}return null}var ow=/\s+/,XO=[],cl=(()=>{let a=class a{constructor(c,f){this._ngEl=c,this._renderer=f,this.initialClasses=XO,this.stateMap=new Map}set klass(c){this.initialClasses=c!=null?c.trim().split(ow):XO}set ngClass(c){this.rawClass=typeof c=="string"?c.trim().split(ow):c}ngDoCheck(){for(let f of this.initialClasses)this._updateState(f,!0);let c=this.rawClass;if(Array.isArray(c)||c instanceof Set)for(let f of c)this._updateState(f,!0);else if(c!=null)for(let f of Object.keys(c))this._updateState(f,!!c[f]);this._applyStateDiff()}_updateState(c,f){let g=this.stateMap.get(c);g!==void 0?(g.enabled!==f&&(g.changed=!0,g.enabled=f),g.touched=!0):this.stateMap.set(c,{enabled:f,changed:!0,touched:!0})}_applyStateDiff(){for(let c of this.stateMap){let f=c[0],g=c[1];g.changed?(this._toggleClass(f,g.enabled),g.changed=!1):g.touched||(g.enabled&&this._toggleClass(f,!1),this.stateMap.delete(f)),g.touched=!1}}_toggleClass(c,f){c=c.trim(),c.length>0&&c.split(ow).forEach(g=>{f?this._renderer.addClass(this._ngEl.nativeElement,g):this._renderer.removeClass(this._ngEl.nativeElement,g)})}};a.\u0275fac=function(f){return new(f||a)(qe(Fs),qe(ls))},a.\u0275dir=_i({type:a,selectors:[["","ngClass",""]],inputs:{klass:[Cr.None,"class","klass"],ngClass:"ngClass"},standalone:!0});let s=a;return s})();var ul=(()=>{let a=class a{constructor(c,f){this._viewContainer=c,this._context=new aw,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=f}set ngIf(c){this._context.$implicit=this._context.ngIf=c,this._updateView()}set ngIfThen(c){YO("ngIfThen",c),this._thenTemplateRef=c,this._thenViewRef=null,this._updateView()}set ngIfElse(c){YO("ngIfElse",c),this._elseTemplateRef=c,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(c,f){return!0}};a.\u0275fac=function(f){return new(f||a)(qe(jh),qe(Qb))},a.\u0275dir=_i({type:a,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0});let s=a;return s})(),aw=class{constructor(){this.$implicit=null,this.ngIf=null}};function YO(s,a){if(!!!(!a||a.createEmbeddedView))throw new Error(`${s} must be a TemplateRef, but received '${Fr(a)}'.`)}function NH(s,a){return new $t(2100,!1)}var zH="mediumDate",BH=new zt("DATE_PIPE_DEFAULT_TIMEZONE"),VH=new zt("DATE_PIPE_DEFAULT_OPTIONS"),ya=(()=>{let a=class a{constructor(c,f,g){this.locale=c,this.defaultTimezone=f,this.defaultOptions=g}transform(c,f,g,x){if(c==null||c===""||c!==c)return null;try{let T=f??this.defaultOptions?.dateFormat??zH,P=g??this.defaultOptions?.timezone??this.defaultTimezone??void 0;return IH(c,T,x||this.locale,P)}catch(T){throw NH(a,T.message)}}};a.\u0275fac=function(f){return new(f||a)(qe(c_,16),qe(BH,24),qe(VH,24))},a.\u0275pipe=YP({name:"date",type:a,pure:!0,standalone:!0});let s=a;return s})();var cw=(()=>{let a=class a{};a.\u0275fac=function(f){return new(f||a)},a.\u0275mod=ss({type:a}),a.\u0275inj=os({});let s=a;return s})(),uw="browser",jH="server";function rF(s){return s===uw}function dw(s){return s===jH}var Uu=class{};var qh=class{},E_=class{},hc=class s{constructor(a){this.normalizedNames=new Map,this.lazyUpdate=null,a?typeof a=="string"?this.lazyInit=()=>{this.headers=new Map,a.split(`
`).forEach(d=>{let c=d.indexOf(":");if(c>0){let f=d.slice(0,c),g=f.toLowerCase(),x=d.slice(c+1).trim();this.maybeSetNormalizedName(f,g),this.headers.has(g)?this.headers.get(g).push(x):this.headers.set(g,[x])}})}:typeof Headers<"u"&&a instanceof Headers?(this.headers=new Map,a.forEach((d,c)=>{this.setHeaderEntries(c,d)})):this.lazyInit=()=>{this.headers=new Map,Object.entries(a).forEach(([d,c])=>{this.setHeaderEntries(d,c)})}:this.headers=new Map}has(a){return this.init(),this.headers.has(a.toLowerCase())}get(a){this.init();let d=this.headers.get(a.toLowerCase());return d&&d.length>0?d[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(a){return this.init(),this.headers.get(a.toLowerCase())||null}append(a,d){return this.clone({name:a,value:d,op:"a"})}set(a,d){return this.clone({name:a,value:d,op:"s"})}delete(a,d){return this.clone({name:a,value:d,op:"d"})}maybeSetNormalizedName(a,d){this.normalizedNames.has(d)||this.normalizedNames.set(d,a)}init(){this.lazyInit&&(this.lazyInit instanceof s?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(a=>this.applyUpdate(a)),this.lazyUpdate=null))}copyFrom(a){a.init(),Array.from(a.headers.keys()).forEach(d=>{this.headers.set(d,a.headers.get(d)),this.normalizedNames.set(d,a.normalizedNames.get(d))})}clone(a){let d=new s;return d.lazyInit=this.lazyInit&&this.lazyInit instanceof s?this.lazyInit:this,d.lazyUpdate=(this.lazyUpdate||[]).concat([a]),d}applyUpdate(a){let d=a.name.toLowerCase();switch(a.op){case"a":case"s":let c=a.value;if(typeof c=="string"&&(c=[c]),c.length===0)return;this.maybeSetNormalizedName(a.name,d);let f=(a.op==="a"?this.headers.get(d):void 0)||[];f.push(...c),this.headers.set(d,f);break;case"d":let g=a.value;if(!g)this.headers.delete(d),this.normalizedNames.delete(d);else{let x=this.headers.get(d);if(!x)return;x=x.filter(T=>g.indexOf(T)===-1),x.length===0?(this.headers.delete(d),this.normalizedNames.delete(d)):this.headers.set(d,x)}break}}setHeaderEntries(a,d){let c=(Array.isArray(d)?d:[d]).map(g=>g.toString()),f=a.toLowerCase();this.headers.set(f,c),this.maybeSetNormalizedName(a,f)}forEach(a){this.init(),Array.from(this.normalizedNames.keys()).forEach(d=>a(this.normalizedNames.get(d),this.headers.get(d)))}};var fw=class{encodeKey(a){return oF(a)}encodeValue(a){return oF(a)}decodeKey(a){return decodeURIComponent(a)}decodeValue(a){return decodeURIComponent(a)}};function GH(s,a){let d=new Map;return s.length>0&&s.replace(/^\?/,"").split("&").forEach(f=>{let g=f.indexOf("="),[x,T]=g==-1?[a.decodeKey(f),""]:[a.decodeKey(f.slice(0,g)),a.decodeValue(f.slice(g+1))],P=d.get(x)||[];P.push(T),d.set(x,P)}),d}var HH=/%(\d[a-f0-9])/gi,qH={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function oF(s){return encodeURIComponent(s).replace(HH,(a,d)=>qH[d]??a)}function C_(s){return`${s}`}var rr=class s{constructor(a={}){if(this.updates=null,this.cloneFrom=null,this.encoder=a.encoder||new fw,a.fromString){if(a.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=GH(a.fromString,this.encoder)}else a.fromObject?(this.map=new Map,Object.keys(a.fromObject).forEach(d=>{let c=a.fromObject[d],f=Array.isArray(c)?c.map(C_):[C_(c)];this.map.set(d,f)})):this.map=null}has(a){return this.init(),this.map.has(a)}get(a){this.init();let d=this.map.get(a);return d?d[0]:null}getAll(a){return this.init(),this.map.get(a)||null}keys(){return this.init(),Array.from(this.map.keys())}append(a,d){return this.clone({param:a,value:d,op:"a"})}appendAll(a){let d=[];return Object.keys(a).forEach(c=>{let f=a[c];Array.isArray(f)?f.forEach(g=>{d.push({param:c,value:g,op:"a"})}):d.push({param:c,value:f,op:"a"})}),this.clone(d)}set(a,d){return this.clone({param:a,value:d,op:"s"})}delete(a,d){return this.clone({param:a,value:d,op:"d"})}toString(){return this.init(),this.keys().map(a=>{let d=this.encoder.encodeKey(a);return this.map.get(a).map(c=>d+"="+this.encoder.encodeValue(c)).join("&")}).filter(a=>a!=="").join("&")}clone(a){let d=new s({encoder:this.encoder});return d.cloneFrom=this.cloneFrom||this,d.updates=(this.updates||[]).concat(a),d}init(){this.map===null&&(this.map=new Map),this.cloneFrom!==null&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(a=>this.map.set(a,this.cloneFrom.map.get(a))),this.updates.forEach(a=>{switch(a.op){case"a":case"s":let d=(a.op==="a"?this.map.get(a.param):void 0)||[];d.push(C_(a.value)),this.map.set(a.param,d);break;case"d":if(a.value!==void 0){let c=this.map.get(a.param)||[],f=c.indexOf(C_(a.value));f!==-1&&c.splice(f,1),c.length>0?this.map.set(a.param,c):this.map.delete(a.param)}else{this.map.delete(a.param);break}}}),this.cloneFrom=this.updates=null)}};var pw=class{constructor(){this.map=new Map}set(a,d){return this.map.set(a,d),this}get(a){return this.map.has(a)||this.map.set(a,a.defaultValue()),this.map.get(a)}delete(a){return this.map.delete(a),this}has(a){return this.map.has(a)}keys(){return this.map.keys()}};function WH(s){switch(s){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}function sF(s){return typeof ArrayBuffer<"u"&&s instanceof ArrayBuffer}function aF(s){return typeof Blob<"u"&&s instanceof Blob}function lF(s){return typeof FormData<"u"&&s instanceof FormData}function ZH(s){return typeof URLSearchParams<"u"&&s instanceof URLSearchParams}var Hh=class s{constructor(a,d,c,f){this.url=d,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=a.toUpperCase();let g;if(WH(this.method)||f?(this.body=c!==void 0?c:null,g=f):g=c,g&&(this.reportProgress=!!g.reportProgress,this.withCredentials=!!g.withCredentials,g.responseType&&(this.responseType=g.responseType),g.headers&&(this.headers=g.headers),g.context&&(this.context=g.context),g.params&&(this.params=g.params),this.transferCache=g.transferCache),this.headers||(this.headers=new hc),this.context||(this.context=new pw),!this.params)this.params=new rr,this.urlWithParams=d;else{let x=this.params.toString();if(x.length===0)this.urlWithParams=d;else{let T=d.indexOf("?"),P=T===-1?"?":T<d.length-1?"&":"";this.urlWithParams=d+P+x}}}serializeBody(){return this.body===null?null:sF(this.body)||aF(this.body)||lF(this.body)||ZH(this.body)||typeof this.body=="string"?this.body:this.body instanceof rr?this.body.toString():typeof this.body=="object"||typeof this.body=="boolean"||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return this.body===null||lF(this.body)?null:aF(this.body)?this.body.type||null:sF(this.body)?null:typeof this.body=="string"?"text/plain":this.body instanceof rr?"application/x-www-form-urlencoded;charset=UTF-8":typeof this.body=="object"||typeof this.body=="number"||typeof this.body=="boolean"?"application/json":null}clone(a={}){let d=a.method||this.method,c=a.url||this.url,f=a.responseType||this.responseType,g=a.body!==void 0?a.body:this.body,x=a.withCredentials!==void 0?a.withCredentials:this.withCredentials,T=a.reportProgress!==void 0?a.reportProgress:this.reportProgress,P=a.headers||this.headers,O=a.params||this.params,Z=a.context??this.context;return a.setHeaders!==void 0&&(P=Object.keys(a.setHeaders).reduce((ee,ce)=>ee.set(ce,a.setHeaders[ce]),P)),a.setParams&&(O=Object.keys(a.setParams).reduce((ee,ce)=>ee.set(ce,a.setParams[ce]),O)),new s(d,c,g,{params:O,headers:P,context:Z,reportProgress:T,responseType:f,withCredentials:x})}},$u=function(s){return s[s.Sent=0]="Sent",s[s.UploadProgress=1]="UploadProgress",s[s.ResponseHeader=2]="ResponseHeader",s[s.DownloadProgress=3]="DownloadProgress",s[s.Response=4]="Response",s[s.User=5]="User",s}($u||{}),Wh=class{constructor(a,d=M_.Ok,c="OK"){this.headers=a.headers||new hc,this.status=a.status!==void 0?a.status:d,this.statusText=a.statusText||c,this.url=a.url||null,this.ok=this.status>=200&&this.status<300}},mw=class s extends Wh{constructor(a={}){super(a),this.type=$u.ResponseHeader}clone(a={}){return new s({headers:a.headers||this.headers,status:a.status!==void 0?a.status:this.status,statusText:a.statusText||this.statusText,url:a.url||this.url||void 0})}},T_=class s extends Wh{constructor(a={}){super(a),this.type=$u.Response,this.body=a.body!==void 0?a.body:null}clone(a={}){return new s({body:a.body!==void 0?a.body:this.body,headers:a.headers||this.headers,status:a.status!==void 0?a.status:this.status,statusText:a.statusText||this.statusText,url:a.url||this.url||void 0})}},I_=class extends Wh{constructor(a){super(a,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.status>=200&&this.status<300?this.message=`Http failure during parsing for ${a.url||"(unknown url)"}`:this.message=`Http failure response for ${a.url||"(unknown url)"}: ${a.status} ${a.statusText}`,this.error=a.error||null}},M_=function(s){return s[s.Continue=100]="Continue",s[s.SwitchingProtocols=101]="SwitchingProtocols",s[s.Processing=102]="Processing",s[s.EarlyHints=103]="EarlyHints",s[s.Ok=200]="Ok",s[s.Created=201]="Created",s[s.Accepted=202]="Accepted",s[s.NonAuthoritativeInformation=203]="NonAuthoritativeInformation",s[s.NoContent=204]="NoContent",s[s.ResetContent=205]="ResetContent",s[s.PartialContent=206]="PartialContent",s[s.MultiStatus=207]="MultiStatus",s[s.AlreadyReported=208]="AlreadyReported",s[s.ImUsed=226]="ImUsed",s[s.MultipleChoices=300]="MultipleChoices",s[s.MovedPermanently=301]="MovedPermanently",s[s.Found=302]="Found",s[s.SeeOther=303]="SeeOther",s[s.NotModified=304]="NotModified",s[s.UseProxy=305]="UseProxy",s[s.Unused=306]="Unused",s[s.TemporaryRedirect=307]="TemporaryRedirect",s[s.PermanentRedirect=308]="PermanentRedirect",s[s.BadRequest=400]="BadRequest",s[s.Unauthorized=401]="Unauthorized",s[s.PaymentRequired=402]="PaymentRequired",s[s.Forbidden=403]="Forbidden",s[s.NotFound=404]="NotFound",s[s.MethodNotAllowed=405]="MethodNotAllowed",s[s.NotAcceptable=406]="NotAcceptable",s[s.ProxyAuthenticationRequired=407]="ProxyAuthenticationRequired",s[s.RequestTimeout=408]="RequestTimeout",s[s.Conflict=409]="Conflict",s[s.Gone=410]="Gone",s[s.LengthRequired=411]="LengthRequired",s[s.PreconditionFailed=412]="PreconditionFailed",s[s.PayloadTooLarge=413]="PayloadTooLarge",s[s.UriTooLong=414]="UriTooLong",s[s.UnsupportedMediaType=415]="UnsupportedMediaType",s[s.RangeNotSatisfiable=416]="RangeNotSatisfiable",s[s.ExpectationFailed=417]="ExpectationFailed",s[s.ImATeapot=418]="ImATeapot",s[s.MisdirectedRequest=421]="MisdirectedRequest",s[s.UnprocessableEntity=422]="UnprocessableEntity",s[s.Locked=423]="Locked",s[s.FailedDependency=424]="FailedDependency",s[s.TooEarly=425]="TooEarly",s[s.UpgradeRequired=426]="UpgradeRequired",s[s.PreconditionRequired=428]="PreconditionRequired",s[s.TooManyRequests=429]="TooManyRequests",s[s.RequestHeaderFieldsTooLarge=431]="RequestHeaderFieldsTooLarge",s[s.UnavailableForLegalReasons=451]="UnavailableForLegalReasons",s[s.InternalServerError=500]="InternalServerError",s[s.NotImplemented=501]="NotImplemented",s[s.BadGateway=502]="BadGateway",s[s.ServiceUnavailable=503]="ServiceUnavailable",s[s.GatewayTimeout=504]="GatewayTimeout",s[s.HttpVersionNotSupported=505]="HttpVersionNotSupported",s[s.VariantAlsoNegotiates=506]="VariantAlsoNegotiates",s[s.InsufficientStorage=507]="InsufficientStorage",s[s.LoopDetected=508]="LoopDetected",s[s.NotExtended=510]="NotExtended",s[s.NetworkAuthenticationRequired=511]="NetworkAuthenticationRequired",s}(M_||{});function hw(s,a){return{body:a,headers:s.headers,context:s.context,observe:s.observe,params:s.params,reportProgress:s.reportProgress,responseType:s.responseType,withCredentials:s.withCredentials,transferCache:s.transferCache}}var _o=(()=>{let a=class a{constructor(c){this.handler=c}request(c,f,g={}){let x;if(c instanceof Hh)x=c;else{let O;g.headers instanceof hc?O=g.headers:O=new hc(g.headers);let Z;g.params&&(g.params instanceof rr?Z=g.params:Z=new rr({fromObject:g.params})),x=new Hh(c,f,g.body!==void 0?g.body:null,{headers:O,context:g.context,params:Z,reportProgress:g.reportProgress,responseType:g.responseType||"json",withCredentials:g.withCredentials,transferCache:g.transferCache})}let T=Yt(x).pipe(Ja(O=>this.handler.handle(O)));if(c instanceof Hh||g.observe==="events")return T;let P=T.pipe(uo(O=>O instanceof T_));switch(g.observe||"body"){case"body":switch(x.responseType){case"arraybuffer":return P.pipe(ot(O=>{if(O.body!==null&&!(O.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return O.body}));case"blob":return P.pipe(ot(O=>{if(O.body!==null&&!(O.body instanceof Blob))throw new Error("Response is not a Blob.");return O.body}));case"text":return P.pipe(ot(O=>{if(O.body!==null&&typeof O.body!="string")throw new Error("Response is not a string.");return O.body}));case"json":default:return P.pipe(ot(O=>O.body))}case"response":return P;default:throw new Error(`Unreachable: unhandled observe type ${g.observe}}`)}}delete(c,f={}){return this.request("DELETE",c,f)}get(c,f={}){return this.request("GET",c,f)}head(c,f={}){return this.request("HEAD",c,f)}jsonp(c,f){return this.request("JSONP",c,{params:new rr().append(f,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(c,f={}){return this.request("OPTIONS",c,f)}patch(c,f,g={}){return this.request("PATCH",c,hw(g,f))}post(c,f,g={}){return this.request("POST",c,hw(g,f))}put(c,f,g={}){return this.request("PUT",c,hw(g,f))}};a.\u0275fac=function(f){return new(f||a)(vt(qh))},a.\u0275prov=gt({token:a,factory:a.\u0275fac});let s=a;return s})();function hF(s,a){return a(s)}function XH(s,a){return(d,c)=>a.intercept(d,{handle:f=>s(f,c)})}function YH(s,a,d){return(c,f)=>fa(d,()=>a(c,g=>s(g,f)))}var KH=new zt(""),gw=new zt(""),JH=new zt(""),QH=new zt("");function eq(){let s=null;return(a,d)=>{s===null&&(s=(ut(KH,{optional:!0})??[]).reduceRight(XH,hF));let c=ut(uc),f=c.add();return s(a,d).pipe(el(()=>c.remove(f)))}}var cF=(()=>{let a=class a extends qh{constructor(c,f){super(),this.backend=c,this.injector=f,this.chain=null,this.pendingTasks=ut(uc);let g=ut(QH,{optional:!0});this.backend=g??c}handle(c){if(this.chain===null){let g=Array.from(new Set([...this.injector.get(gw),...this.injector.get(JH,[])]));this.chain=g.reduceRight((x,T)=>YH(x,T,this.injector),hF)}let f=this.pendingTasks.add();return this.chain(c,g=>this.backend.handle(g)).pipe(el(()=>this.pendingTasks.remove(f)))}};a.\u0275fac=function(f){return new(f||a)(vt(E_),vt(to))},a.\u0275prov=gt({token:a,factory:a.\u0275fac});let s=a;return s})();var tq=/^\)\]\}',?\n/;function nq(s){return"responseURL"in s&&s.responseURL?s.responseURL:/^X-Request-URL:/m.test(s.getAllResponseHeaders())?s.getResponseHeader("X-Request-URL"):null}var uF=(()=>{let a=class a{constructor(c){this.xhrFactory=c}handle(c){if(c.method==="JSONP")throw new $t(-2800,!1);let f=this.xhrFactory;return(f.\u0275loadImpl?Di(f.\u0275loadImpl()):Yt(null)).pipe(Jr(()=>new kn(x=>{let T=f.build();if(T.open(c.method,c.urlWithParams),c.withCredentials&&(T.withCredentials=!0),c.headers.forEach((dt,tt)=>T.setRequestHeader(dt,tt.join(","))),c.headers.has("Accept")||T.setRequestHeader("Accept","application/json, text/plain, */*"),!c.headers.has("Content-Type")){let dt=c.detectContentTypeHeader();dt!==null&&T.setRequestHeader("Content-Type",dt)}if(c.responseType){let dt=c.responseType.toLowerCase();T.responseType=dt!=="json"?dt:"text"}let P=c.serializeBody(),O=null,Z=()=>{if(O!==null)return O;let dt=T.statusText||"OK",tt=new hc(T.getAllResponseHeaders()),Ln=nq(T)||c.url;return O=new mw({headers:tt,status:T.status,statusText:dt,url:Ln}),O},ee=()=>{let{headers:dt,status:tt,statusText:Ln,url:ri}=Z(),bn=null;tt!==M_.NoContent&&(bn=typeof T.response>"u"?T.responseText:T.response),tt===0&&(tt=bn?M_.Ok:0);let Pi=tt>=200&&tt<300;if(c.responseType==="json"&&typeof bn=="string"){let Si=bn;bn=bn.replace(tq,"");try{bn=bn!==""?JSON.parse(bn):null}catch(Q){bn=Si,Pi&&(Pi=!1,bn={error:Q,text:bn})}}Pi?(x.next(new T_({body:bn,headers:dt,status:tt,statusText:Ln,url:ri||void 0})),x.complete()):x.error(new I_({error:bn,headers:dt,status:tt,statusText:Ln,url:ri||void 0}))},ce=dt=>{let{url:tt}=Z(),Ln=new I_({error:dt,status:T.status||0,statusText:T.statusText||"Unknown Error",url:tt||void 0});x.error(Ln)},Ee=!1,Ze=dt=>{Ee||(x.next(Z()),Ee=!0);let tt={type:$u.DownloadProgress,loaded:dt.loaded};dt.lengthComputable&&(tt.total=dt.total),c.responseType==="text"&&T.responseText&&(tt.partialText=T.responseText),x.next(tt)},Vt=dt=>{let tt={type:$u.UploadProgress,loaded:dt.loaded};dt.lengthComputable&&(tt.total=dt.total),x.next(tt)};return T.addEventListener("load",ee),T.addEventListener("error",ce),T.addEventListener("timeout",ce),T.addEventListener("abort",ce),c.reportProgress&&(T.addEventListener("progress",Ze),P!==null&&T.upload&&T.upload.addEventListener("progress",Vt)),T.send(P),x.next({type:$u.Sent}),()=>{T.removeEventListener("error",ce),T.removeEventListener("abort",ce),T.removeEventListener("load",ee),T.removeEventListener("timeout",ce),c.reportProgress&&(T.removeEventListener("progress",Ze),P!==null&&T.upload&&T.upload.removeEventListener("progress",Vt)),T.readyState!==T.DONE&&T.abort()}})))}};a.\u0275fac=function(f){return new(f||a)(vt(Uu))},a.\u0275prov=gt({token:a,factory:a.\u0275fac});let s=a;return s})(),fF=new zt("XSRF_ENABLED"),iq="XSRF-TOKEN",rq=new zt("XSRF_COOKIE_NAME",{providedIn:"root",factory:()=>iq}),oq="X-XSRF-TOKEN",sq=new zt("XSRF_HEADER_NAME",{providedIn:"root",factory:()=>oq}),D_=class{},aq=(()=>{let a=class a{constructor(c,f,g){this.doc=c,this.platform=f,this.cookieName=g,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if(this.platform==="server")return null;let c=this.doc.cookie||"";return c!==this.lastCookieString&&(this.parseCount++,this.lastToken=w_(c,this.cookieName),this.lastCookieString=c),this.lastToken}};a.\u0275fac=function(f){return new(f||a)(vt(gr),vt(Os),vt(rq))},a.\u0275prov=gt({token:a,factory:a.\u0275fac});let s=a;return s})();function lq(s,a){let d=s.url.toLowerCase();if(!ut(fF)||s.method==="GET"||s.method==="HEAD"||d.startsWith("http://")||d.startsWith("https://"))return a(s);let c=ut(D_).getToken(),f=ut(sq);return c!=null&&!s.headers.has(f)&&(s=s.clone({headers:s.headers.set(f,c)})),a(s)}var pF=function(s){return s[s.Interceptors=0]="Interceptors",s[s.LegacyInterceptors=1]="LegacyInterceptors",s[s.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",s[s.NoXsrfProtection=3]="NoXsrfProtection",s[s.JsonpSupport=4]="JsonpSupport",s[s.RequestsMadeViaParent=5]="RequestsMadeViaParent",s[s.Fetch=6]="Fetch",s}(pF||{});function cq(s,a){return{\u0275kind:s,\u0275providers:a}}function uq(...s){let a=[_o,uF,cF,{provide:qh,useExisting:cF},{provide:E_,useExisting:uF},{provide:gw,useValue:lq,multi:!0},{provide:fF,useValue:!0},{provide:D_,useClass:aq}];for(let d of s)a.push(...d.\u0275providers);return Vu(a)}var dF=new zt("LEGACY_INTERCEPTOR_FN");function dq(){return cq(pF.LegacyInterceptors,[{provide:dF,useFactory:eq},{provide:gw,useExisting:dF,multi:!0}])}var S_=(()=>{let a=class a{};a.\u0275fac=function(f){return new(f||a)},a.\u0275mod=ss({type:a}),a.\u0275inj=os({providers:[uq(dq())]});let s=a;return s})();var vw=class extends y_{constructor(){super(...arguments),this.supportsDOMEvents=!0}},xw=class s extends vw{static makeCurrent(){KO(new s)}onAndCancel(a,d,c){return a.addEventListener(d,c),()=>{a.removeEventListener(d,c)}}dispatchEvent(a,d){a.dispatchEvent(d)}remove(a){a.parentNode&&a.parentNode.removeChild(a)}createElement(a,d){return d=d||this.getDefaultDocument(),d.createElement(a)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(a){return a.nodeType===Node.ELEMENT_NODE}isShadowRoot(a){return a instanceof DocumentFragment}getGlobalEventTarget(a,d){return d==="window"?window:d==="document"?a:d==="body"?a.body:null}getBaseHref(a){let d=fq();return d==null?null:pq(d)}resetBaseElement(){Zh=null}getUserAgent(){return window.navigator.userAgent}getCookie(a){return w_(document.cookie,a)}},Zh=null;function fq(){return Zh=Zh||document.querySelector("base"),Zh?Zh.getAttribute("href"):null}function pq(s){return new URL(s,document.baseURI).pathname}var mq=(()=>{let a=class a{build(){return new XMLHttpRequest}};a.\u0275fac=function(f){return new(f||a)},a.\u0275prov=gt({token:a,factory:a.\u0275fac});let s=a;return s})(),bw=new zt("EventManagerPlugins"),yF=(()=>{let a=class a{constructor(c,f){this._zone=f,this._eventNameToPlugin=new Map,c.forEach(g=>{g.manager=this}),this._plugins=c.slice().reverse()}addEventListener(c,f,g){return this._findPluginFor(f).addEventListener(c,f,g)}getZone(){return this._zone}_findPluginFor(c){let f=this._eventNameToPlugin.get(c);if(f)return f;if(f=this._plugins.find(x=>x.supports(c)),!f)throw new $t(5101,!1);return this._eventNameToPlugin.set(c,f),f}};a.\u0275fac=function(f){return new(f||a)(vt(bw),vt(Bi))},a.\u0275prov=gt({token:a,factory:a.\u0275fac});let s=a;return s})(),A_=class{constructor(a){this._doc=a}},_w="ng-app-id",vF=(()=>{let a=class a{constructor(c,f,g,x={}){this.doc=c,this.appId=f,this.nonce=g,this.platformId=x,this.styleRef=new Map,this.hostNodes=new Set,this.styleNodesInDOM=this.collectServerRenderedStyles(),this.platformIsServer=dw(x),this.resetHostNodes()}addStyles(c){for(let f of c)this.changeUsageCount(f,1)===1&&this.onStyleAdded(f)}removeStyles(c){for(let f of c)this.changeUsageCount(f,-1)<=0&&this.onStyleRemoved(f)}ngOnDestroy(){let c=this.styleNodesInDOM;c&&(c.forEach(f=>f.remove()),c.clear());for(let f of this.getAllStyles())this.onStyleRemoved(f);this.resetHostNodes()}addHost(c){this.hostNodes.add(c);for(let f of this.getAllStyles())this.addStyleToHost(c,f)}removeHost(c){this.hostNodes.delete(c)}getAllStyles(){return this.styleRef.keys()}onStyleAdded(c){for(let f of this.hostNodes)this.addStyleToHost(f,c)}onStyleRemoved(c){let f=this.styleRef;f.get(c)?.elements?.forEach(g=>g.remove()),f.delete(c)}collectServerRenderedStyles(){let c=this.doc.head?.querySelectorAll(`style[${_w}="${this.appId}"]`);if(c?.length){let f=new Map;return c.forEach(g=>{g.textContent!=null&&f.set(g.textContent,g)}),f}return null}changeUsageCount(c,f){let g=this.styleRef;if(g.has(c)){let x=g.get(c);return x.usage+=f,x.usage}return g.set(c,{usage:f,elements:[]}),f}getStyleElement(c,f){let g=this.styleNodesInDOM,x=g?.get(f);if(x?.parentNode===c)return g.delete(f),x.removeAttribute(_w),x;{let T=this.doc.createElement("style");return this.nonce&&T.setAttribute("nonce",this.nonce),T.textContent=f,this.platformIsServer&&T.setAttribute(_w,this.appId),c.appendChild(T),T}}addStyleToHost(c,f){let g=this.getStyleElement(c,f),x=this.styleRef,T=x.get(f)?.elements;T?T.push(g):x.set(f,{elements:[g],usage:1})}resetHostNodes(){let c=this.hostNodes;c.clear(),c.add(this.doc.head)}};a.\u0275fac=function(f){return new(f||a)(vt(gr),vt(Bb),vt(jb,8),vt(Os))},a.\u0275prov=gt({token:a,factory:a.\u0275fac});let s=a;return s})(),yw={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Cw=/%COMP%/g,xF="%COMP%",gq=`_nghost-${xF}`,_q=`_ngcontent-${xF}`,yq=!0,vq=new zt("RemoveStylesOnCompDestroy",{providedIn:"root",factory:()=>yq});function xq(s){return _q.replace(Cw,s)}function bq(s){return gq.replace(Cw,s)}function bF(s,a){return a.map(d=>d.replace(Cw,s))}var mF=(()=>{let a=class a{constructor(c,f,g,x,T,P,O,Z=null){this.eventManager=c,this.sharedStylesHost=f,this.appId=g,this.removeStylesOnCompDestroy=x,this.doc=T,this.platformId=P,this.ngZone=O,this.nonce=Z,this.rendererByCompId=new Map,this.platformIsServer=dw(P),this.defaultRenderer=new Xh(c,T,O,this.platformIsServer)}createRenderer(c,f){if(!c||!f)return this.defaultRenderer;this.platformIsServer&&f.encapsulation===Ps.ShadowDom&&(f=Qn(rt({},f),{encapsulation:Ps.Emulated}));let g=this.getOrCreateRenderer(c,f);return g instanceof P_?g.applyToHost(c):g instanceof Yh&&g.applyStyles(),g}getOrCreateRenderer(c,f){let g=this.rendererByCompId,x=g.get(f.id);if(!x){let T=this.doc,P=this.ngZone,O=this.eventManager,Z=this.sharedStylesHost,ee=this.removeStylesOnCompDestroy,ce=this.platformIsServer;switch(f.encapsulation){case Ps.Emulated:x=new P_(O,Z,f,this.appId,ee,T,P,ce);break;case Ps.ShadowDom:return new ww(O,Z,c,f,T,P,this.nonce,ce);default:x=new Yh(O,Z,f,ee,T,P,ce);break}g.set(f.id,x)}return x}ngOnDestroy(){this.rendererByCompId.clear()}};a.\u0275fac=function(f){return new(f||a)(vt(yF),vt(vF),vt(Bb),vt(vq),vt(gr),vt(Os),vt(Bi),vt(jb))},a.\u0275prov=gt({token:a,factory:a.\u0275fac});let s=a;return s})(),Xh=class{constructor(a,d,c,f){this.eventManager=a,this.doc=d,this.ngZone=c,this.platformIsServer=f,this.data=Object.create(null),this.throwOnSyntheticProps=!0,this.destroyNode=null}destroy(){}createElement(a,d){return d?this.doc.createElementNS(yw[d]||d,a):this.doc.createElement(a)}createComment(a){return this.doc.createComment(a)}createText(a){return this.doc.createTextNode(a)}appendChild(a,d){(gF(a)?a.content:a).appendChild(d)}insertBefore(a,d,c){a&&(gF(a)?a.content:a).insertBefore(d,c)}removeChild(a,d){a&&a.removeChild(d)}selectRootElement(a,d){let c=typeof a=="string"?this.doc.querySelector(a):a;if(!c)throw new $t(-5104,!1);return d||(c.textContent=""),c}parentNode(a){return a.parentNode}nextSibling(a){return a.nextSibling}setAttribute(a,d,c,f){if(f){d=f+":"+d;let g=yw[f];g?a.setAttributeNS(g,d,c):a.setAttribute(d,c)}else a.setAttribute(d,c)}removeAttribute(a,d,c){if(c){let f=yw[c];f?a.removeAttributeNS(f,d):a.removeAttribute(`${c}:${d}`)}else a.removeAttribute(d)}addClass(a,d){a.classList.add(d)}removeClass(a,d){a.classList.remove(d)}setStyle(a,d,c,f){f&(la.DashCase|la.Important)?a.style.setProperty(d,c,f&la.Important?"important":""):a.style[d]=c}removeStyle(a,d,c){c&la.DashCase?a.style.removeProperty(d):a.style[d]=""}setProperty(a,d,c){a!=null&&(a[d]=c)}setValue(a,d){a.nodeValue=d}listen(a,d,c){if(typeof a=="string"&&(a=_a().getGlobalEventTarget(this.doc,a),!a))throw new Error(`Unsupported event target ${a} for event ${d}`);return this.eventManager.addEventListener(a,d,this.decoratePreventDefault(c))}decoratePreventDefault(a){return d=>{if(d==="__ngUnwrap__")return a;(this.platformIsServer?this.ngZone.runGuarded(()=>a(d)):a(d))===!1&&d.preventDefault()}}};function gF(s){return s.tagName==="TEMPLATE"&&s.content!==void 0}var ww=class extends Xh{constructor(a,d,c,f,g,x,T,P){super(a,g,x,P),this.sharedStylesHost=d,this.hostEl=c,this.shadowRoot=c.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);let O=bF(f.id,f.styles);for(let Z of O){let ee=document.createElement("style");T&&ee.setAttribute("nonce",T),ee.textContent=Z,this.shadowRoot.appendChild(ee)}}nodeOrShadowRoot(a){return a===this.hostEl?this.shadowRoot:a}appendChild(a,d){return super.appendChild(this.nodeOrShadowRoot(a),d)}insertBefore(a,d,c){return super.insertBefore(this.nodeOrShadowRoot(a),d,c)}removeChild(a,d){return super.removeChild(this.nodeOrShadowRoot(a),d)}parentNode(a){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(a)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}},Yh=class extends Xh{constructor(a,d,c,f,g,x,T,P){super(a,g,x,T),this.sharedStylesHost=d,this.removeStylesOnCompDestroy=f,this.styles=P?bF(P,c.styles):c.styles}applyStyles(){this.sharedStylesHost.addStyles(this.styles)}destroy(){this.removeStylesOnCompDestroy&&this.sharedStylesHost.removeStyles(this.styles)}},P_=class extends Yh{constructor(a,d,c,f,g,x,T,P){let O=f+"-"+c.id;super(a,d,c,g,x,T,P,O),this.contentAttr=xq(O),this.hostAttr=bq(O)}applyToHost(a){this.applyStyles(),this.setAttribute(a,this.hostAttr,"")}createElement(a,d){let c=super.createElement(a,d);return super.setAttribute(c,this.contentAttr,""),c}},wq=(()=>{let a=class a extends A_{constructor(c){super(c)}supports(c){return!0}addEventListener(c,f,g){return c.addEventListener(f,g,!1),()=>this.removeEventListener(c,f,g)}removeEventListener(c,f,g){return c.removeEventListener(f,g)}};a.\u0275fac=function(f){return new(f||a)(vt(gr))},a.\u0275prov=gt({token:a,factory:a.\u0275fac});let s=a;return s})(),_F=["alt","control","meta","shift"],Cq={"\b":"Backspace","	":"Tab","\x7F":"Delete","\x1B":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},Eq={alt:s=>s.altKey,control:s=>s.ctrlKey,meta:s=>s.metaKey,shift:s=>s.shiftKey},Tq=(()=>{let a=class a extends A_{constructor(c){super(c)}supports(c){return a.parseEventName(c)!=null}addEventListener(c,f,g){let x=a.parseEventName(f),T=a.eventCallback(x.fullKey,g,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>_a().onAndCancel(c,x.domEventName,T))}static parseEventName(c){let f=c.toLowerCase().split("."),g=f.shift();if(f.length===0||!(g==="keydown"||g==="keyup"))return null;let x=a._normalizeKey(f.pop()),T="",P=f.indexOf("code");if(P>-1&&(f.splice(P,1),T="code."),_F.forEach(Z=>{let ee=f.indexOf(Z);ee>-1&&(f.splice(ee,1),T+=Z+".")}),T+=x,f.length!=0||x.length===0)return null;let O={};return O.domEventName=g,O.fullKey=T,O}static matchEventFullKeyCode(c,f){let g=Cq[c.key]||c.key,x="";return f.indexOf("code.")>-1&&(g=c.code,x="code."),g==null||!g?!1:(g=g.toLowerCase(),g===" "?g="space":g==="."&&(g="dot"),_F.forEach(T=>{if(T!==g){let P=Eq[T];P(c)&&(x+=T+".")}}),x+=g,x===f)}static eventCallback(c,f,g){return x=>{a.matchEventFullKeyCode(x,c)&&g.runGuarded(()=>f(x))}}static _normalizeKey(c){return c==="esc"?"escape":c}};a.\u0275fac=function(f){return new(f||a)(vt(gr))},a.\u0275prov=gt({token:a,factory:a.\u0275fac});let s=a;return s})();function wF(s,a){return GO(rt({rootComponent:s},Iq(a)))}function Iq(s){return{appProviders:[...Pq,...s?.providers??[]],platformProviders:Aq}}function Mq(){xw.makeCurrent()}function Dq(){return new ca}function Sq(){return HR(document),document}var Aq=[{provide:Os,useValue:uw},{provide:Vb,useValue:Mq,multi:!0},{provide:gr,useFactory:Sq,deps:[]}];var Pq=[{provide:Wg,useValue:"root"},{provide:ca,useFactory:Dq,deps:[]},{provide:bw,useClass:wq,multi:!0,deps:[gr,Bi,Os]},{provide:bw,useClass:Tq,multi:!0,deps:[gr]},mF,vF,yF,{provide:Ph,useExisting:mF},{provide:Uu,useClass:mq,deps:[]},[]];function Rq(){return new Ew(vt(gr))}var Ew=(()=>{let a=class a{constructor(c){this._doc=c}getTitle(){return this._doc.title}setTitle(c){this._doc.title=c||""}};a.\u0275fac=function(f){return new(f||a)(vt(gr))},a.\u0275prov=gt({token:a,factory:function(f){let g=null;return f?g=new f:g=Rq(),g},providedIn:"root"});let s=a;return s})();var fn="primary",hf=Symbol("RouteTitle"),Sw=class{constructor(a){this.params=a||{}}has(a){return Object.prototype.hasOwnProperty.call(this.params,a)}get(a){if(this.has(a)){let d=this.params[a];return Array.isArray(d)?d[0]:d}return null}getAll(a){if(this.has(a)){let d=this.params[a];return Array.isArray(d)?d:[d]}return[]}get keys(){return Object.keys(this.params)}};function Xu(s){return new Sw(s)}function Fq(s,a,d){let c=d.path.split("/");if(c.length>s.length||d.pathMatch==="full"&&(a.hasChildren()||c.length<s.length))return null;let f={};for(let g=0;g<c.length;g++){let x=c[g],T=s[g];if(x.startsWith(":"))f[x.substring(1)]=T;else if(x!==T.path)return null}return{consumed:s.slice(0,c.length),posParams:f}}function kq(s,a){if(s.length!==a.length)return!1;for(let d=0;d<s.length;++d)if(!Ls(s[d],a[d]))return!1;return!0}function Ls(s,a){let d=s?Aw(s):void 0,c=a?Aw(a):void 0;if(!d||!c||d.length!=c.length)return!1;let f;for(let g=0;g<d.length;g++)if(f=d[g],!SF(s[f],a[f]))return!1;return!0}function Aw(s){return[...Object.keys(s),...Object.getOwnPropertySymbols(s)]}function SF(s,a){if(Array.isArray(s)&&Array.isArray(a)){if(s.length!==a.length)return!1;let d=[...s].sort(),c=[...a].sort();return d.every((f,g)=>c[g]===f)}else return s===a}function AF(s){return s.length>0?s[s.length-1]:null}function fl(s){return h1(s)?s:lc(s)?Di(Promise.resolve(s)):Yt(s)}var Lq={exact:RF,subset:OF},PF={exact:Nq,subset:zq,ignored:()=>!0};function CF(s,a,d){return Lq[d.paths](s.root,a.root,d.matrixParams)&&PF[d.queryParams](s.queryParams,a.queryParams)&&!(d.fragment==="exact"&&s.fragment!==a.fragment)}function Nq(s,a){return Ls(s,a)}function RF(s,a,d){if(!pc(s.segments,a.segments)||!F_(s.segments,a.segments,d)||s.numberOfChildren!==a.numberOfChildren)return!1;for(let c in a.children)if(!s.children[c]||!RF(s.children[c],a.children[c],d))return!1;return!0}function zq(s,a){return Object.keys(a).length<=Object.keys(s).length&&Object.keys(a).every(d=>SF(s[d],a[d]))}function OF(s,a,d){return FF(s,a,a.segments,d)}function FF(s,a,d,c){if(s.segments.length>d.length){let f=s.segments.slice(0,d.length);return!(!pc(f,d)||a.hasChildren()||!F_(f,d,c))}else if(s.segments.length===d.length){if(!pc(s.segments,d)||!F_(s.segments,d,c))return!1;for(let f in a.children)if(!s.children[f]||!OF(s.children[f],a.children[f],c))return!1;return!0}else{let f=d.slice(0,s.segments.length),g=d.slice(s.segments.length);return!pc(s.segments,f)||!F_(s.segments,f,c)||!s.children[fn]?!1:FF(s.children[fn],a,g,c)}}function F_(s,a,d){return a.every((c,f)=>PF[d](s[f].parameters,c.parameters))}var dl=class{constructor(a=new Kn([],{}),d={},c=null){this.root=a,this.queryParams=d,this.fragment=c}get queryParamMap(){return this._queryParamMap??=Xu(this.queryParams),this._queryParamMap}toString(){return jq.serialize(this)}},Kn=class{constructor(a,d){this.segments=a,this.children=d,this.parent=null,Object.values(d).forEach(c=>c.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return k_(this)}},fc=class{constructor(a,d){this.path=a,this.parameters=d}get parameterMap(){return this._parameterMap??=Xu(this.parameters),this._parameterMap}toString(){return LF(this)}};function Bq(s,a){return pc(s,a)&&s.every((d,c)=>Ls(d.parameters,a[c].parameters))}function pc(s,a){return s.length!==a.length?!1:s.every((d,c)=>d.path===a[c].path)}function Vq(s,a){let d=[];return Object.entries(s.children).forEach(([c,f])=>{c===fn&&(d=d.concat(a(f,c)))}),Object.entries(s.children).forEach(([c,f])=>{c!==fn&&(d=d.concat(a(f,c)))}),d}var nC=(()=>{let a=class a{};a.\u0275fac=function(f){return new(f||a)},a.\u0275prov=gt({token:a,factory:()=>new N_,providedIn:"root"});let s=a;return s})(),N_=class{parse(a){let d=new Rw(a);return new dl(d.parseRootSegment(),d.parseQueryParams(),d.parseFragment())}serialize(a){let d=`/${Kh(a.root,!0)}`,c=Gq(a.queryParams),f=typeof a.fragment=="string"?`#${Uq(a.fragment)}`:"";return`${d}${c}${f}`}},jq=new N_;function k_(s){return s.segments.map(a=>LF(a)).join("/")}function Kh(s,a){if(!s.hasChildren())return k_(s);if(a){let d=s.children[fn]?Kh(s.children[fn],!1):"",c=[];return Object.entries(s.children).forEach(([f,g])=>{f!==fn&&c.push(`${f}:${Kh(g,!1)}`)}),c.length>0?`${d}(${c.join("//")})`:d}else{let d=Vq(s,(c,f)=>f===fn?[Kh(s.children[fn],!1)]:[`${f}:${Kh(c,!1)}`]);return Object.keys(s.children).length===1&&s.children[fn]!=null?`${k_(s)}/${d[0]}`:`${k_(s)}/(${d.join("//")})`}}function kF(s){return encodeURIComponent(s).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function R_(s){return kF(s).replace(/%3B/gi,";")}function Uq(s){return encodeURI(s)}function Pw(s){return kF(s).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function L_(s){return decodeURIComponent(s)}function EF(s){return L_(s.replace(/\+/g,"%20"))}function LF(s){return`${Pw(s.path)}${$q(s.parameters)}`}function $q(s){return Object.entries(s).map(([a,d])=>`;${Pw(a)}=${Pw(d)}`).join("")}function Gq(s){let a=Object.entries(s).map(([d,c])=>Array.isArray(c)?c.map(f=>`${R_(d)}=${R_(f)}`).join("&"):`${R_(d)}=${R_(c)}`).filter(d=>d);return a.length?`?${a.join("&")}`:""}var Hq=/^[^\/()?;#]+/;function Tw(s){let a=s.match(Hq);return a?a[0]:""}var qq=/^[^\/()?;=#]+/;function Wq(s){let a=s.match(qq);return a?a[0]:""}var Zq=/^[^=?&#]+/;function Xq(s){let a=s.match(Zq);return a?a[0]:""}var Yq=/^[^&#]+/;function Kq(s){let a=s.match(Yq);return a?a[0]:""}var Rw=class{constructor(a){this.url=a,this.remaining=a}parseRootSegment(){return this.consumeOptional("/"),this.remaining===""||this.peekStartsWith("?")||this.peekStartsWith("#")?new Kn([],{}):new Kn([],this.parseChildren())}parseQueryParams(){let a={};if(this.consumeOptional("?"))do this.parseQueryParam(a);while(this.consumeOptional("&"));return a}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(this.remaining==="")return{};this.consumeOptional("/");let a=[];for(this.peekStartsWith("(")||a.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),a.push(this.parseSegment());let d={};this.peekStartsWith("/(")&&(this.capture("/"),d=this.parseParens(!0));let c={};return this.peekStartsWith("(")&&(c=this.parseParens(!1)),(a.length>0||Object.keys(d).length>0)&&(c[fn]=new Kn(a,d)),c}parseSegment(){let a=Tw(this.remaining);if(a===""&&this.peekStartsWith(";"))throw new $t(4009,!1);return this.capture(a),new fc(L_(a),this.parseMatrixParams())}parseMatrixParams(){let a={};for(;this.consumeOptional(";");)this.parseParam(a);return a}parseParam(a){let d=Wq(this.remaining);if(!d)return;this.capture(d);let c="";if(this.consumeOptional("=")){let f=Tw(this.remaining);f&&(c=f,this.capture(c))}a[L_(d)]=L_(c)}parseQueryParam(a){let d=Xq(this.remaining);if(!d)return;this.capture(d);let c="";if(this.consumeOptional("=")){let x=Kq(this.remaining);x&&(c=x,this.capture(c))}let f=EF(d),g=EF(c);if(a.hasOwnProperty(f)){let x=a[f];Array.isArray(x)||(x=[x],a[f]=x),x.push(g)}else a[f]=g}parseParens(a){let d={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){let c=Tw(this.remaining),f=this.remaining[c.length];if(f!=="/"&&f!==")"&&f!==";")throw new $t(4010,!1);let g;c.indexOf(":")>-1?(g=c.slice(0,c.indexOf(":")),this.capture(g),this.capture(":")):a&&(g=fn);let x=this.parseChildren();d[g]=Object.keys(x).length===1?x[fn]:new Kn([],x),this.consumeOptional("//")}return d}peekStartsWith(a){return this.remaining.startsWith(a)}consumeOptional(a){return this.peekStartsWith(a)?(this.remaining=this.remaining.substring(a.length),!0):!1}capture(a){if(!this.consumeOptional(a))throw new $t(4011,!1)}};function NF(s){return s.segments.length>0?new Kn([],{[fn]:s}):s}function zF(s){let a={};for(let[c,f]of Object.entries(s.children)){let g=zF(f);if(c===fn&&g.segments.length===0&&g.hasChildren())for(let[x,T]of Object.entries(g.children))a[x]=T;else(g.segments.length>0||g.hasChildren())&&(a[c]=g)}let d=new Kn(s.segments,a);return Jq(d)}function Jq(s){if(s.numberOfChildren===1&&s.children[fn]){let a=s.children[fn];return new Kn(s.segments.concat(a.segments),a.children)}return s}function Yu(s){return s instanceof dl}function Qq(s,a,d=null,c=null){let f=BF(s);return VF(f,a,d,c)}function BF(s){let a;function d(g){let x={};for(let P of g.children){let O=d(P);x[P.outlet]=O}let T=new Kn(g.url,x);return g===s&&(a=T),T}let c=d(s.root),f=NF(c);return a??f}function VF(s,a,d,c){let f=s;for(;f.parent;)f=f.parent;if(a.length===0)return Iw(f,f,f,d,c);let g=e7(a);if(g.toRoot())return Iw(f,f,new Kn([],{}),d,c);let x=t7(g,f,s),T=x.processChildren?ef(x.segmentGroup,x.index,g.commands):UF(x.segmentGroup,x.index,g.commands);return Iw(f,x.segmentGroup,T,d,c)}function z_(s){return typeof s=="object"&&s!=null&&!s.outlets&&!s.segmentPath}function rf(s){return typeof s=="object"&&s!=null&&s.outlets}function Iw(s,a,d,c,f){let g={};c&&Object.entries(c).forEach(([P,O])=>{g[P]=Array.isArray(O)?O.map(Z=>`${Z}`):`${O}`});let x;s===a?x=d:x=jF(s,a,d);let T=NF(zF(x));return new dl(T,g,f)}function jF(s,a,d){let c={};return Object.entries(s.children).forEach(([f,g])=>{g===a?c[f]=d:c[f]=jF(g,a,d)}),new Kn(s.segments,c)}var B_=class{constructor(a,d,c){if(this.isAbsolute=a,this.numberOfDoubleDots=d,this.commands=c,a&&c.length>0&&z_(c[0]))throw new $t(4003,!1);let f=c.find(rf);if(f&&f!==AF(c))throw new $t(4004,!1)}toRoot(){return this.isAbsolute&&this.commands.length===1&&this.commands[0]=="/"}};function e7(s){if(typeof s[0]=="string"&&s.length===1&&s[0]==="/")return new B_(!0,0,s);let a=0,d=!1,c=s.reduce((f,g,x)=>{if(typeof g=="object"&&g!=null){if(g.outlets){let T={};return Object.entries(g.outlets).forEach(([P,O])=>{T[P]=typeof O=="string"?O.split("/"):O}),[...f,{outlets:T}]}if(g.segmentPath)return[...f,g.segmentPath]}return typeof g!="string"?[...f,g]:x===0?(g.split("/").forEach((T,P)=>{P==0&&T==="."||(P==0&&T===""?d=!0:T===".."?a++:T!=""&&f.push(T))}),f):[...f,g]},[]);return new B_(d,a,c)}var Wu=class{constructor(a,d,c){this.segmentGroup=a,this.processChildren=d,this.index=c}};function t7(s,a,d){if(s.isAbsolute)return new Wu(a,!0,0);if(!d)return new Wu(a,!1,NaN);if(d.parent===null)return new Wu(d,!0,0);let c=z_(s.commands[0])?0:1,f=d.segments.length-1+c;return n7(d,f,s.numberOfDoubleDots)}function n7(s,a,d){let c=s,f=a,g=d;for(;g>f;){if(g-=f,c=c.parent,!c)throw new $t(4005,!1);f=c.segments.length}return new Wu(c,!1,f-g)}function i7(s){return rf(s[0])?s[0].outlets:{[fn]:s}}function UF(s,a,d){if(s??=new Kn([],{}),s.segments.length===0&&s.hasChildren())return ef(s,a,d);let c=r7(s,a,d),f=d.slice(c.commandIndex);if(c.match&&c.pathIndex<s.segments.length){let g=new Kn(s.segments.slice(0,c.pathIndex),{});return g.children[fn]=new Kn(s.segments.slice(c.pathIndex),s.children),ef(g,0,f)}else return c.match&&f.length===0?new Kn(s.segments,{}):c.match&&!s.hasChildren()?Ow(s,a,d):c.match?ef(s,0,f):Ow(s,a,d)}function ef(s,a,d){if(d.length===0)return new Kn(s.segments,{});{let c=i7(d),f={};if(Object.keys(c).some(g=>g!==fn)&&s.children[fn]&&s.numberOfChildren===1&&s.children[fn].segments.length===0){let g=ef(s.children[fn],a,d);return new Kn(s.segments,g.children)}return Object.entries(c).forEach(([g,x])=>{typeof x=="string"&&(x=[x]),x!==null&&(f[g]=UF(s.children[g],a,x))}),Object.entries(s.children).forEach(([g,x])=>{c[g]===void 0&&(f[g]=x)}),new Kn(s.segments,f)}}function r7(s,a,d){let c=0,f=a,g={match:!1,pathIndex:0,commandIndex:0};for(;f<s.segments.length;){if(c>=d.length)return g;let x=s.segments[f],T=d[c];if(rf(T))break;let P=`${T}`,O=c<d.length-1?d[c+1]:null;if(f>0&&P===void 0)break;if(P&&O&&typeof O=="object"&&O.outlets===void 0){if(!IF(P,O,x))return g;c+=2}else{if(!IF(P,{},x))return g;c++}f++}return{match:!0,pathIndex:f,commandIndex:c}}function Ow(s,a,d){let c=s.segments.slice(0,a),f=0;for(;f<d.length;){let g=d[f];if(rf(g)){let P=o7(g.outlets);return new Kn(c,P)}if(f===0&&z_(d[0])){let P=s.segments[a];c.push(new fc(P.path,TF(d[0]))),f++;continue}let x=rf(g)?g.outlets[fn]:`${g}`,T=f<d.length-1?d[f+1]:null;x&&T&&z_(T)?(c.push(new fc(x,TF(T))),f+=2):(c.push(new fc(x,{})),f++)}return new Kn(c,{})}function o7(s){let a={};return Object.entries(s).forEach(([d,c])=>{typeof c=="string"&&(c=[c]),c!==null&&(a[d]=Ow(new Kn([],{}),0,c))}),a}function TF(s){let a={};return Object.entries(s).forEach(([d,c])=>a[d]=`${c}`),a}function IF(s,a,d){return s==d.path&&Ls(a,d.parameters)}var tf="imperative",yr=function(s){return s[s.NavigationStart=0]="NavigationStart",s[s.NavigationEnd=1]="NavigationEnd",s[s.NavigationCancel=2]="NavigationCancel",s[s.NavigationError=3]="NavigationError",s[s.RoutesRecognized=4]="RoutesRecognized",s[s.ResolveStart=5]="ResolveStart",s[s.ResolveEnd=6]="ResolveEnd",s[s.GuardsCheckStart=7]="GuardsCheckStart",s[s.GuardsCheckEnd=8]="GuardsCheckEnd",s[s.RouteConfigLoadStart=9]="RouteConfigLoadStart",s[s.RouteConfigLoadEnd=10]="RouteConfigLoadEnd",s[s.ChildActivationStart=11]="ChildActivationStart",s[s.ChildActivationEnd=12]="ChildActivationEnd",s[s.ActivationStart=13]="ActivationStart",s[s.ActivationEnd=14]="ActivationEnd",s[s.Scroll=15]="Scroll",s[s.NavigationSkipped=16]="NavigationSkipped",s}(yr||{}),Vo=class{constructor(a,d){this.id=a,this.url=d}},of=class extends Vo{constructor(a,d,c="imperative",f=null){super(a,d),this.type=yr.NavigationStart,this.navigationTrigger=c,this.restoredState=f}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}},mc=class extends Vo{constructor(a,d,c){super(a,d),this.urlAfterRedirects=c,this.type=yr.NavigationEnd}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}},Bo=function(s){return s[s.Redirect=0]="Redirect",s[s.SupersededByNewNavigation=1]="SupersededByNewNavigation",s[s.NoDataFromResolver=2]="NoDataFromResolver",s[s.GuardRejected=3]="GuardRejected",s}(Bo||{}),Fw=function(s){return s[s.IgnoredSameUrlNavigation=0]="IgnoredSameUrlNavigation",s[s.IgnoredByUrlHandlingStrategy=1]="IgnoredByUrlHandlingStrategy",s}(Fw||{}),hl=class extends Vo{constructor(a,d,c,f){super(a,d),this.reason=c,this.code=f,this.type=yr.NavigationCancel}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}},gc=class extends Vo{constructor(a,d,c,f){super(a,d),this.reason=c,this.code=f,this.type=yr.NavigationSkipped}},sf=class extends Vo{constructor(a,d,c,f){super(a,d),this.error=c,this.target=f,this.type=yr.NavigationError}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}},V_=class extends Vo{constructor(a,d,c,f){super(a,d),this.urlAfterRedirects=c,this.state=f,this.type=yr.RoutesRecognized}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},kw=class extends Vo{constructor(a,d,c,f){super(a,d),this.urlAfterRedirects=c,this.state=f,this.type=yr.GuardsCheckStart}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Lw=class extends Vo{constructor(a,d,c,f,g){super(a,d),this.urlAfterRedirects=c,this.state=f,this.shouldActivate=g,this.type=yr.GuardsCheckEnd}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}},Nw=class extends Vo{constructor(a,d,c,f){super(a,d),this.urlAfterRedirects=c,this.state=f,this.type=yr.ResolveStart}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},zw=class extends Vo{constructor(a,d,c,f){super(a,d),this.urlAfterRedirects=c,this.state=f,this.type=yr.ResolveEnd}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}},Bw=class{constructor(a){this.route=a,this.type=yr.RouteConfigLoadStart}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}},Vw=class{constructor(a){this.route=a,this.type=yr.RouteConfigLoadEnd}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}},jw=class{constructor(a){this.snapshot=a,this.type=yr.ChildActivationStart}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Uw=class{constructor(a){this.snapshot=a,this.type=yr.ChildActivationEnd}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},$w=class{constructor(a){this.snapshot=a,this.type=yr.ActivationStart}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}},Gw=class{constructor(a){this.snapshot=a,this.type=yr.ActivationEnd}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}};var af=class{},lf=class{constructor(a){this.url=a}};var Hw=class{constructor(){this.outlet=null,this.route=null,this.injector=null,this.children=new q_,this.attachRef=null}},q_=(()=>{let a=class a{constructor(){this.contexts=new Map}onChildOutletCreated(c,f){let g=this.getOrCreateContext(c);g.outlet=f,this.contexts.set(c,g)}onChildOutletDestroyed(c){let f=this.getContext(c);f&&(f.outlet=null,f.attachRef=null)}onOutletDeactivated(){let c=this.contexts;return this.contexts=new Map,c}onOutletReAttached(c){this.contexts=c}getOrCreateContext(c){let f=this.getContext(c);return f||(f=new Hw,this.contexts.set(c,f)),f}getContext(c){return this.contexts.get(c)||null}};a.\u0275fac=function(f){return new(f||a)},a.\u0275prov=gt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})(),j_=class{constructor(a){this._root=a}get root(){return this._root.value}parent(a){let d=this.pathFromRoot(a);return d.length>1?d[d.length-2]:null}children(a){let d=qw(a,this._root);return d?d.children.map(c=>c.value):[]}firstChild(a){let d=qw(a,this._root);return d&&d.children.length>0?d.children[0].value:null}siblings(a){let d=Ww(a,this._root);return d.length<2?[]:d[d.length-2].children.map(f=>f.value).filter(f=>f!==a)}pathFromRoot(a){return Ww(a,this._root).map(d=>d.value)}};function qw(s,a){if(s===a.value)return a;for(let d of a.children){let c=qw(s,d);if(c)return c}return null}function Ww(s,a){if(s===a.value)return[a];for(let d of a.children){let c=Ww(s,d);if(c.length)return c.unshift(a),c}return[]}var yo=class{constructor(a,d){this.value=a,this.children=d}toString(){return`TreeNode(${this.value})`}};function qu(s){let a={};return s&&s.children.forEach(d=>a[d.value.outlet]=d),a}var U_=class extends j_{constructor(a,d){super(a),this.snapshot=d,rC(this,a)}toString(){return this.snapshot.toString()}};function $F(s){let a=s7(s),d=new pr([new fc("",{})]),c=new pr({}),f=new pr({}),g=new pr({}),x=new pr(""),T=new Ku(d,c,g,x,f,fn,s,a.root);return T.snapshot=a.root,new U_(new yo(T,[]),a)}function s7(s){let a={},d={},c={},f="",g=new cf([],a,c,f,d,fn,s,null,{});return new $_("",new yo(g,[]))}var Ku=class{constructor(a,d,c,f,g,x,T,P){this.urlSubject=a,this.paramsSubject=d,this.queryParamsSubject=c,this.fragmentSubject=f,this.dataSubject=g,this.outlet=x,this.component=T,this._futureSnapshot=P,this.title=this.dataSubject?.pipe(ot(O=>O[hf]))??Yt(void 0),this.url=a,this.params=d,this.queryParams=c,this.fragment=f,this.data=g}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=this.params.pipe(ot(a=>Xu(a))),this._paramMap}get queryParamMap(){return this._queryParamMap??=this.queryParams.pipe(ot(a=>Xu(a))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}};function iC(s,a,d="emptyOnly"){let c,{routeConfig:f}=s;return a!==null&&(d==="always"||f?.path===""||!a.component&&!a.routeConfig?.loadComponent)?c={params:rt(rt({},a.params),s.params),data:rt(rt({},a.data),s.data),resolve:rt(rt(rt(rt({},s.data),a.data),f?.data),s._resolvedData)}:c={params:rt({},s.params),data:rt({},s.data),resolve:rt(rt({},s.data),s._resolvedData??{})},f&&HF(f)&&(c.resolve[hf]=f.title),c}var cf=class{get title(){return this.data?.[hf]}constructor(a,d,c,f,g,x,T,P,O){this.url=a,this.params=d,this.queryParams=c,this.fragment=f,this.data=g,this.outlet=x,this.component=T,this.routeConfig=P,this._resolve=O}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap??=Xu(this.params),this._paramMap}get queryParamMap(){return this._queryParamMap??=Xu(this.queryParams),this._queryParamMap}toString(){let a=this.url.map(c=>c.toString()).join("/"),d=this.routeConfig?this.routeConfig.path:"";return`Route(url:'${a}', path:'${d}')`}},$_=class extends j_{constructor(a,d){super(d),this.url=a,rC(this,d)}toString(){return GF(this._root)}};function rC(s,a){a.value._routerState=s,a.children.forEach(d=>rC(s,d))}function GF(s){let a=s.children.length>0?` { ${s.children.map(GF).join(", ")} } `:"";return`${s.value}${a}`}function Mw(s){if(s.snapshot){let a=s.snapshot,d=s._futureSnapshot;s.snapshot=d,Ls(a.queryParams,d.queryParams)||s.queryParamsSubject.next(d.queryParams),a.fragment!==d.fragment&&s.fragmentSubject.next(d.fragment),Ls(a.params,d.params)||s.paramsSubject.next(d.params),kq(a.url,d.url)||s.urlSubject.next(d.url),Ls(a.data,d.data)||s.dataSubject.next(d.data)}else s.snapshot=s._futureSnapshot,s.dataSubject.next(s._futureSnapshot.data)}function Zw(s,a){let d=Ls(s.params,a.params)&&Bq(s.url,a.url),c=!s.parent!=!a.parent;return d&&!c&&(!s.parent||Zw(s.parent,a.parent))}function HF(s){return typeof s.title=="string"||s.title===null}var oC=(()=>{let a=class a{constructor(){this.activated=null,this._activatedRoute=null,this.name=fn,this.activateEvents=new br,this.deactivateEvents=new br,this.attachEvents=new br,this.detachEvents=new br,this.parentContexts=ut(q_),this.location=ut(jh),this.changeDetector=ut(Bh),this.environmentInjector=ut(to),this.inputBinder=ut(W_,{optional:!0}),this.supportsBindingToComponentInputs=!0}get activatedComponentRef(){return this.activated}ngOnChanges(c){if(c.name){let{firstChange:f,previousValue:g}=c.name;if(f)return;this.isTrackedInParentContexts(g)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(g)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name),this.inputBinder?.unsubscribeFromRouteData(this)}isTrackedInParentContexts(c){return this.parentContexts.getContext(c)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;let c=this.parentContexts.getContext(this.name);c?.route&&(c.attachRef?this.attach(c.attachRef,c.route):this.activateWith(c.route,c.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new $t(4012,!1);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new $t(4012,!1);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new $t(4012,!1);this.location.detach();let c=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(c.instance),c}attach(c,f){this.activated=c,this._activatedRoute=f,this.location.insert(c.hostView),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.attachEvents.emit(c.instance)}deactivate(){if(this.activated){let c=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(c)}}activateWith(c,f){if(this.isActivated)throw new $t(4013,!1);this._activatedRoute=c;let g=this.location,T=c.snapshot.component,P=this.parentContexts.getOrCreateContext(this.name).children,O=new Xw(c,P,g.injector);this.activated=g.createComponent(T,{index:g.length,injector:O,environmentInjector:f??this.environmentInjector}),this.changeDetector.markForCheck(),this.inputBinder?.bindActivatedRouteToOutletComponent(this),this.activateEvents.emit(this.activated.instance)}};a.\u0275fac=function(f){return new(f||a)},a.\u0275dir=_i({type:a,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[ol]});let s=a;return s})(),Xw=class{constructor(a,d,c){this.route=a,this.childContexts=d,this.parent=c}get(a,d){return a===Ku?this.route:a===q_?this.childContexts:this.parent.get(a,d)}},W_=new zt(""),MF=(()=>{let a=class a{constructor(){this.outletDataSubscriptions=new Map}bindActivatedRouteToOutletComponent(c){this.unsubscribeFromRouteData(c),this.subscribeToRouteData(c)}unsubscribeFromRouteData(c){this.outletDataSubscriptions.get(c)?.unsubscribe(),this.outletDataSubscriptions.delete(c)}subscribeToRouteData(c){let{activatedRoute:f}=c,g=_h([f.queryParams,f.params,f.data]).pipe(Jr(([x,T,P],O)=>(P=rt(rt(rt({},x),T),P),O===0?Yt(P):Promise.resolve(P)))).subscribe(x=>{if(!c.isActivated||!c.activatedComponentRef||c.activatedRoute!==f||f.component===null){this.unsubscribeFromRouteData(c);return}let T=HO(f.component);if(!T){this.unsubscribeFromRouteData(c);return}for(let{templateName:P}of T.inputs)c.activatedComponentRef.setInput(P,x[P])});this.outletDataSubscriptions.set(c,g)}};a.\u0275fac=function(f){return new(f||a)},a.\u0275prov=gt({token:a,factory:a.\u0275fac});let s=a;return s})();function a7(s,a,d){let c=uf(s,a._root,d?d._root:void 0);return new U_(c,a)}function uf(s,a,d){if(d&&s.shouldReuseRoute(a.value,d.value.snapshot)){let c=d.value;c._futureSnapshot=a.value;let f=l7(s,a,d);return new yo(c,f)}else{if(s.shouldAttach(a.value)){let g=s.retrieve(a.value);if(g!==null){let x=g.route;return x.value._futureSnapshot=a.value,x.children=a.children.map(T=>uf(s,T)),x}}let c=c7(a.value),f=a.children.map(g=>uf(s,g));return new yo(c,f)}}function l7(s,a,d){return a.children.map(c=>{for(let f of d.children)if(s.shouldReuseRoute(c.value,f.value.snapshot))return uf(s,c,f);return uf(s,c)})}function c7(s){return new Ku(new pr(s.url),new pr(s.params),new pr(s.queryParams),new pr(s.fragment),new pr(s.data),s.outlet,s.component,s)}var qF="ngNavigationCancelingError";function WF(s,a){let{redirectTo:d,navigationBehaviorOptions:c}=Yu(a)?{redirectTo:a,navigationBehaviorOptions:void 0}:a,f=ZF(!1,Bo.Redirect,a);return f.url=d,f.navigationBehaviorOptions=c,f}function ZF(s,a,d){let c=new Error("NavigationCancelingError: "+(s||""));return c[qF]=!0,c.cancellationCode=a,d&&(c.url=d),c}function u7(s){return XF(s)&&Yu(s.url)}function XF(s){return s&&s[qF]}var d7=(()=>{let a=class a{};a.\u0275fac=function(f){return new(f||a)},a.\u0275cmp=tn({type:a,selectors:[["ng-component"]],standalone:!0,features:[nn],decls:1,vars:0,template:function(f,g){f&1&&De(0,"router-outlet")},dependencies:[oC],encapsulation:2});let s=a;return s})();function h7(s,a){return s.providers&&!s._injector&&(s._injector=ew(s.providers,a,`Route: ${s.path}`)),s._injector??a}function sC(s){let a=s.children&&s.children.map(sC),d=a?Qn(rt({},s),{children:a}):rt({},s);return!d.component&&!d.loadComponent&&(a||d.loadChildren)&&d.outlet&&d.outlet!==fn&&(d.component=d7),d}function Ns(s){return s.outlet||fn}function f7(s,a){let d=s.filter(c=>Ns(c)===a);return d.push(...s.filter(c=>Ns(c)!==a)),d}function ff(s){if(!s)return null;if(s.routeConfig?._injector)return s.routeConfig._injector;for(let a=s.parent;a;a=a.parent){let d=a.routeConfig;if(d?._loadedInjector)return d._loadedInjector;if(d?._injector)return d._injector}return null}var p7=(s,a,d,c)=>ot(f=>(new Yw(a,f.targetRouterState,f.currentRouterState,d,c).activate(s),f)),Yw=class{constructor(a,d,c,f,g){this.routeReuseStrategy=a,this.futureState=d,this.currState=c,this.forwardEvent=f,this.inputBindingEnabled=g}activate(a){let d=this.futureState._root,c=this.currState?this.currState._root:null;this.deactivateChildRoutes(d,c,a),Mw(this.futureState.root),this.activateChildRoutes(d,c,a)}deactivateChildRoutes(a,d,c){let f=qu(d);a.children.forEach(g=>{let x=g.value.outlet;this.deactivateRoutes(g,f[x],c),delete f[x]}),Object.values(f).forEach(g=>{this.deactivateRouteAndItsChildren(g,c)})}deactivateRoutes(a,d,c){let f=a.value,g=d?d.value:null;if(f===g)if(f.component){let x=c.getContext(f.outlet);x&&this.deactivateChildRoutes(a,d,x.children)}else this.deactivateChildRoutes(a,d,c);else g&&this.deactivateRouteAndItsChildren(d,c)}deactivateRouteAndItsChildren(a,d){a.value.component&&this.routeReuseStrategy.shouldDetach(a.value.snapshot)?this.detachAndStoreRouteSubtree(a,d):this.deactivateRouteAndOutlet(a,d)}detachAndStoreRouteSubtree(a,d){let c=d.getContext(a.value.outlet),f=c&&a.value.component?c.children:d,g=qu(a);for(let x of Object.values(g))this.deactivateRouteAndItsChildren(x,f);if(c&&c.outlet){let x=c.outlet.detach(),T=c.children.onOutletDeactivated();this.routeReuseStrategy.store(a.value.snapshot,{componentRef:x,route:a,contexts:T})}}deactivateRouteAndOutlet(a,d){let c=d.getContext(a.value.outlet),f=c&&a.value.component?c.children:d,g=qu(a);for(let x of Object.values(g))this.deactivateRouteAndItsChildren(x,f);c&&(c.outlet&&(c.outlet.deactivate(),c.children.onOutletDeactivated()),c.attachRef=null,c.route=null)}activateChildRoutes(a,d,c){let f=qu(d);a.children.forEach(g=>{this.activateRoutes(g,f[g.value.outlet],c),this.forwardEvent(new Gw(g.value.snapshot))}),a.children.length&&this.forwardEvent(new Uw(a.value.snapshot))}activateRoutes(a,d,c){let f=a.value,g=d?d.value:null;if(Mw(f),f===g)if(f.component){let x=c.getOrCreateContext(f.outlet);this.activateChildRoutes(a,d,x.children)}else this.activateChildRoutes(a,d,c);else if(f.component){let x=c.getOrCreateContext(f.outlet);if(this.routeReuseStrategy.shouldAttach(f.snapshot)){let T=this.routeReuseStrategy.retrieve(f.snapshot);this.routeReuseStrategy.store(f.snapshot,null),x.children.onOutletReAttached(T.contexts),x.attachRef=T.componentRef,x.route=T.route.value,x.outlet&&x.outlet.attach(T.componentRef,T.route.value),Mw(T.route.value),this.activateChildRoutes(a,null,x.children)}else{let T=ff(f.snapshot);x.attachRef=null,x.route=f,x.injector=T,x.outlet&&x.outlet.activateWith(f,x.injector),this.activateChildRoutes(a,null,x.children)}}else this.activateChildRoutes(a,null,c)}},G_=class{constructor(a){this.path=a,this.route=this.path[this.path.length-1]}},Zu=class{constructor(a,d){this.component=a,this.route=d}};function m7(s,a,d){let c=s._root,f=a?a._root:null;return Jh(c,f,d,[c.value])}function g7(s){let a=s.routeConfig?s.routeConfig.canActivateChild:null;return!a||a.length===0?null:{node:s,guards:a}}function Qu(s,a){let d=Symbol(),c=a.get(s,d);return c===d?typeof s=="function"&&!UP(s)?s:a.get(s):c}function Jh(s,a,d,c,f={canDeactivateChecks:[],canActivateChecks:[]}){let g=qu(a);return s.children.forEach(x=>{_7(x,g[x.value.outlet],d,c.concat([x.value]),f),delete g[x.value.outlet]}),Object.entries(g).forEach(([x,T])=>nf(T,d.getContext(x),f)),f}function _7(s,a,d,c,f={canDeactivateChecks:[],canActivateChecks:[]}){let g=s.value,x=a?a.value:null,T=d?d.getContext(s.value.outlet):null;if(x&&g.routeConfig===x.routeConfig){let P=y7(x,g,g.routeConfig.runGuardsAndResolvers);P?f.canActivateChecks.push(new G_(c)):(g.data=x.data,g._resolvedData=x._resolvedData),g.component?Jh(s,a,T?T.children:null,c,f):Jh(s,a,d,c,f),P&&T&&T.outlet&&T.outlet.isActivated&&f.canDeactivateChecks.push(new Zu(T.outlet.component,x))}else x&&nf(a,T,f),f.canActivateChecks.push(new G_(c)),g.component?Jh(s,null,T?T.children:null,c,f):Jh(s,null,d,c,f);return f}function y7(s,a,d){if(typeof d=="function")return d(s,a);switch(d){case"pathParamsChange":return!pc(s.url,a.url);case"pathParamsOrQueryParamsChange":return!pc(s.url,a.url)||!Ls(s.queryParams,a.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Zw(s,a)||!Ls(s.queryParams,a.queryParams);case"paramsChange":default:return!Zw(s,a)}}function nf(s,a,d){let c=qu(s),f=s.value;Object.entries(c).forEach(([g,x])=>{f.component?a?nf(x,a.children.getContext(g),d):nf(x,null,d):nf(x,a,d)}),f.component?a&&a.outlet&&a.outlet.isActivated?d.canDeactivateChecks.push(new Zu(a.outlet.component,f)):d.canDeactivateChecks.push(new Zu(null,f)):d.canDeactivateChecks.push(new Zu(null,f))}function pf(s){return typeof s=="function"}function v7(s){return typeof s=="boolean"}function x7(s){return s&&pf(s.canLoad)}function b7(s){return s&&pf(s.canActivate)}function w7(s){return s&&pf(s.canActivateChild)}function C7(s){return s&&pf(s.canDeactivate)}function E7(s){return s&&pf(s.canMatch)}function YF(s){return s instanceof ra||s?.name==="EmptyError"}var O_=Symbol("INITIAL_VALUE");function Ju(){return Jr(s=>_h(s.map(a=>a.pipe(oa(1),y1(O_)))).pipe(ot(a=>{for(let d of a)if(d!==!0){if(d===O_)return O_;if(d===!1||d instanceof dl)return d}return!0}),uo(a=>a!==O_),oa(1)))}function T7(s,a){return Ki(d=>{let{targetSnapshot:c,currentSnapshot:f,guards:{canActivateChecks:g,canDeactivateChecks:x}}=d;return x.length===0&&g.length===0?Yt(Qn(rt({},d),{guardsResult:!0})):I7(x,c,f,s).pipe(Ki(T=>T&&v7(T)?M7(c,g,s,a):Yt(T)),ot(T=>Qn(rt({},d),{guardsResult:T})))})}function I7(s,a,d,c){return Di(s).pipe(Ki(f=>R7(f.component,f.route,d,a,c)),Ds(f=>f!==!0,!0))}function M7(s,a,d,c){return Di(a).pipe(Ja(f=>Tu(S7(f.route.parent,c),D7(f.route,c),P7(s,f.path,d),A7(s,f.route,d))),Ds(f=>f!==!0,!0))}function D7(s,a){return s!==null&&a&&a(new $w(s)),Yt(!0)}function S7(s,a){return s!==null&&a&&a(new jw(s)),Yt(!0)}function A7(s,a,d){let c=a.routeConfig?a.routeConfig.canActivate:null;if(!c||c.length===0)return Yt(!0);let f=c.map(g=>dg(()=>{let x=ff(a)??d,T=Qu(g,x),P=b7(T)?T.canActivate(a,s):fa(x,()=>T(a,s));return fl(P).pipe(Ds())}));return Yt(f).pipe(Ju())}function P7(s,a,d){let c=a[a.length-1],g=a.slice(0,a.length-1).reverse().map(x=>g7(x)).filter(x=>x!==null).map(x=>dg(()=>{let T=x.guards.map(P=>{let O=ff(x.node)??d,Z=Qu(P,O),ee=w7(Z)?Z.canActivateChild(c,s):fa(O,()=>Z(c,s));return fl(ee).pipe(Ds())});return Yt(T).pipe(Ju())}));return Yt(g).pipe(Ju())}function R7(s,a,d,c,f){let g=a&&a.routeConfig?a.routeConfig.canDeactivate:null;if(!g||g.length===0)return Yt(!0);let x=g.map(T=>{let P=ff(a)??f,O=Qu(T,P),Z=C7(O)?O.canDeactivate(s,a,d,c):fa(P,()=>O(s,a,d,c));return fl(Z).pipe(Ds())});return Yt(x).pipe(Ju())}function O7(s,a,d,c){let f=a.canLoad;if(f===void 0||f.length===0)return Yt(!0);let g=f.map(x=>{let T=Qu(x,s),P=x7(T)?T.canLoad(a,d):fa(s,()=>T(a,d));return fl(P)});return Yt(g).pipe(Ju(),KF(c))}function KF(s){return l1(Ji(a=>{if(Yu(a))throw WF(s,a)}),ot(a=>a===!0))}function F7(s,a,d,c){let f=a.canMatch;if(!f||f.length===0)return Yt(!0);let g=f.map(x=>{let T=Qu(x,s),P=E7(T)?T.canMatch(a,d):fa(s,()=>T(a,d));return fl(P)});return Yt(g).pipe(Ju(),KF(c))}var df=class{constructor(a){this.segmentGroup=a||null}},H_=class extends Error{constructor(a){super(),this.urlTree=a}};function Hu(s){return Eu(new df(s))}function k7(s){return Eu(new $t(4e3,!1))}function L7(s){return Eu(ZF(!1,Bo.GuardRejected))}var Kw=class{constructor(a,d){this.urlSerializer=a,this.urlTree=d}lineralizeSegments(a,d){let c=[],f=d.root;for(;;){if(c=c.concat(f.segments),f.numberOfChildren===0)return Yt(c);if(f.numberOfChildren>1||!f.children[fn])return k7(a.redirectTo);f=f.children[fn]}}applyRedirectCommands(a,d,c){let f=this.applyRedirectCreateUrlTree(d,this.urlSerializer.parse(d),a,c);if(d.startsWith("/"))throw new H_(f);return f}applyRedirectCreateUrlTree(a,d,c,f){let g=this.createSegmentGroup(a,d.root,c,f);return new dl(g,this.createQueryParams(d.queryParams,this.urlTree.queryParams),d.fragment)}createQueryParams(a,d){let c={};return Object.entries(a).forEach(([f,g])=>{if(typeof g=="string"&&g.startsWith(":")){let T=g.substring(1);c[f]=d[T]}else c[f]=g}),c}createSegmentGroup(a,d,c,f){let g=this.createSegments(a,d.segments,c,f),x={};return Object.entries(d.children).forEach(([T,P])=>{x[T]=this.createSegmentGroup(a,P,c,f)}),new Kn(g,x)}createSegments(a,d,c,f){return d.map(g=>g.path.startsWith(":")?this.findPosParam(a,g,f):this.findOrReturn(g,c))}findPosParam(a,d,c){let f=c[d.path.substring(1)];if(!f)throw new $t(4001,!1);return f}findOrReturn(a,d){let c=0;for(let f of d){if(f.path===a.path)return d.splice(c),f;c++}return a}},Jw={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function N7(s,a,d,c,f){let g=aC(s,a,d);return g.matched?(c=h7(a,c),F7(c,a,d,f).pipe(ot(x=>x===!0?g:rt({},Jw)))):Yt(g)}function aC(s,a,d){if(a.path==="**")return z7(d);if(a.path==="")return a.pathMatch==="full"&&(s.hasChildren()||d.length>0)?rt({},Jw):{matched:!0,consumedSegments:[],remainingSegments:d,parameters:{},positionalParamSegments:{}};let f=(a.matcher||Fq)(d,s,a);if(!f)return rt({},Jw);let g={};Object.entries(f.posParams??{}).forEach(([T,P])=>{g[T]=P.path});let x=f.consumed.length>0?rt(rt({},g),f.consumed[f.consumed.length-1].parameters):g;return{matched:!0,consumedSegments:f.consumed,remainingSegments:d.slice(f.consumed.length),parameters:x,positionalParamSegments:f.posParams??{}}}function z7(s){return{matched:!0,parameters:s.length>0?AF(s).parameters:{},consumedSegments:s,remainingSegments:[],positionalParamSegments:{}}}function DF(s,a,d,c){return d.length>0&&j7(s,d,c)?{segmentGroup:new Kn(a,V7(c,new Kn(d,s.children))),slicedSegments:[]}:d.length===0&&U7(s,d,c)?{segmentGroup:new Kn(s.segments,B7(s,d,c,s.children)),slicedSegments:d}:{segmentGroup:new Kn(s.segments,s.children),slicedSegments:d}}function B7(s,a,d,c){let f={};for(let g of d)if(Z_(s,a,g)&&!c[Ns(g)]){let x=new Kn([],{});f[Ns(g)]=x}return rt(rt({},c),f)}function V7(s,a){let d={};d[fn]=a;for(let c of s)if(c.path===""&&Ns(c)!==fn){let f=new Kn([],{});d[Ns(c)]=f}return d}function j7(s,a,d){return d.some(c=>Z_(s,a,c)&&Ns(c)!==fn)}function U7(s,a,d){return d.some(c=>Z_(s,a,c))}function Z_(s,a,d){return(s.hasChildren()||a.length>0)&&d.pathMatch==="full"?!1:d.path===""}function $7(s,a,d,c){return Ns(s)!==c&&(c===fn||!Z_(a,d,s))?!1:aC(a,s,d).matched}function G7(s,a,d){return a.length===0&&!s.children[d]}var Qw=class{};function H7(s,a,d,c,f,g,x="emptyOnly"){return new eC(s,a,d,c,f,x,g).recognize()}var q7=31,eC=class{constructor(a,d,c,f,g,x,T){this.injector=a,this.configLoader=d,this.rootComponentType=c,this.config=f,this.urlTree=g,this.paramsInheritanceStrategy=x,this.urlSerializer=T,this.applyRedirects=new Kw(this.urlSerializer,this.urlTree),this.absoluteRedirectCount=0,this.allowRedirects=!0}noMatchError(a){return new $t(4002,`'${a.segmentGroup}'`)}recognize(){let a=DF(this.urlTree.root,[],[],this.config).segmentGroup;return this.match(a).pipe(ot(d=>{let c=new cf([],Object.freeze({}),Object.freeze(rt({},this.urlTree.queryParams)),this.urlTree.fragment,{},fn,this.rootComponentType,null,{}),f=new yo(c,d),g=new $_("",f),x=Qq(c,[],this.urlTree.queryParams,this.urlTree.fragment);return x.queryParams=this.urlTree.queryParams,g.url=this.urlSerializer.serialize(x),this.inheritParamsAndData(g._root,null),{state:g,tree:x}}))}match(a){return this.processSegmentGroup(this.injector,this.config,a,fn).pipe(Ka(c=>{if(c instanceof H_)return this.urlTree=c.urlTree,this.match(c.urlTree.root);throw c instanceof df?this.noMatchError(c):c}))}inheritParamsAndData(a,d){let c=a.value,f=iC(c,d,this.paramsInheritanceStrategy);c.params=Object.freeze(f.params),c.data=Object.freeze(f.data),a.children.forEach(g=>this.inheritParamsAndData(g,c))}processSegmentGroup(a,d,c,f){return c.segments.length===0&&c.hasChildren()?this.processChildren(a,d,c):this.processSegment(a,d,c,c.segments,f,!0).pipe(ot(g=>g instanceof yo?[g]:[]))}processChildren(a,d,c){let f=[];for(let g of Object.keys(c.children))g==="primary"?f.unshift(g):f.push(g);return Di(f).pipe(Ja(g=>{let x=c.children[g],T=f7(d,g);return this.processSegmentGroup(a,T,x,g)}),_1((g,x)=>(g.push(...x),g)),Qa(null),g1(),Ki(g=>{if(g===null)return Hu(c);let x=JF(g);return W7(x),Yt(x)}))}processSegment(a,d,c,f,g,x){return Di(d).pipe(Ja(T=>this.processSegmentAgainstRoute(T._injector??a,d,T,c,f,g,x).pipe(Ka(P=>{if(P instanceof df)return Yt(null);throw P}))),Ds(T=>!!T),Ka(T=>{if(YF(T))return G7(c,f,g)?Yt(new Qw):Hu(c);throw T}))}processSegmentAgainstRoute(a,d,c,f,g,x,T){return $7(c,f,g,x)?c.redirectTo===void 0?this.matchSegmentAgainstRoute(a,f,c,g,x):this.allowRedirects&&T?this.expandSegmentAgainstRouteUsingRedirect(a,f,d,c,g,x):Hu(f):Hu(f)}expandSegmentAgainstRouteUsingRedirect(a,d,c,f,g,x){let{matched:T,consumedSegments:P,positionalParamSegments:O,remainingSegments:Z}=aC(d,f,g);if(!T)return Hu(d);f.redirectTo.startsWith("/")&&(this.absoluteRedirectCount++,this.absoluteRedirectCount>q7&&(this.allowRedirects=!1));let ee=this.applyRedirects.applyRedirectCommands(P,f.redirectTo,O);return this.applyRedirects.lineralizeSegments(f,ee).pipe(Ki(ce=>this.processSegment(a,c,d,ce.concat(Z),x,!1)))}matchSegmentAgainstRoute(a,d,c,f,g){let x=N7(d,c,f,a,this.urlSerializer);return c.path==="**"&&(d.children={}),x.pipe(Jr(T=>T.matched?(a=c._injector??a,this.getChildConfig(a,c,f).pipe(Jr(({routes:P})=>{let O=c._loadedInjector??a,{consumedSegments:Z,remainingSegments:ee,parameters:ce}=T,Ee=new cf(Z,ce,Object.freeze(rt({},this.urlTree.queryParams)),this.urlTree.fragment,X7(c),Ns(c),c.component??c._loadedComponent??null,c,Y7(c)),{segmentGroup:Ze,slicedSegments:Vt}=DF(d,Z,ee,P);if(Vt.length===0&&Ze.hasChildren())return this.processChildren(O,P,Ze).pipe(ot(tt=>tt===null?null:new yo(Ee,tt)));if(P.length===0&&Vt.length===0)return Yt(new yo(Ee,[]));let dt=Ns(c)===g;return this.processSegment(O,P,Ze,Vt,dt?fn:g,!0).pipe(ot(tt=>new yo(Ee,tt instanceof yo?[tt]:[])))}))):Hu(d)))}getChildConfig(a,d,c){return d.children?Yt({routes:d.children,injector:a}):d.loadChildren?d._loadedRoutes!==void 0?Yt({routes:d._loadedRoutes,injector:d._loadedInjector}):O7(a,d,c,this.urlSerializer).pipe(Ki(f=>f?this.configLoader.loadChildren(a,d).pipe(Ji(g=>{d._loadedRoutes=g.routes,d._loadedInjector=g.injector})):L7(d))):Yt({routes:[],injector:a})}};function W7(s){s.sort((a,d)=>a.value.outlet===fn?-1:d.value.outlet===fn?1:a.value.outlet.localeCompare(d.value.outlet))}function Z7(s){let a=s.value.routeConfig;return a&&a.path===""}function JF(s){let a=[],d=new Set;for(let c of s){if(!Z7(c)){a.push(c);continue}let f=a.find(g=>c.value.routeConfig===g.value.routeConfig);f!==void 0?(f.children.push(...c.children),d.add(f)):a.push(c)}for(let c of d){let f=JF(c.children);a.push(new yo(c.value,f))}return a.filter(c=>!d.has(c))}function X7(s){return s.data||{}}function Y7(s){return s.resolve||{}}function K7(s,a,d,c,f,g){return Ki(x=>H7(s,a,d,c,x.extractedUrl,f,g).pipe(ot(({state:T,tree:P})=>Qn(rt({},x),{targetSnapshot:T,urlAfterRedirects:P}))))}function J7(s,a){return Ki(d=>{let{targetSnapshot:c,guards:{canActivateChecks:f}}=d;if(!f.length)return Yt(d);let g=new Set(f.map(P=>P.route)),x=new Set;for(let P of g)if(!x.has(P))for(let O of QF(P))x.add(O);let T=0;return Di(x).pipe(Ja(P=>g.has(P)?Q7(P,c,s,a):(P.data=iC(P,P.parent,s).resolve,Yt(void 0))),Ji(()=>T++),Iu(1),Ki(P=>T===x.size?Yt(d):Po))})}function QF(s){let a=s.children.map(d=>QF(d)).flat();return[s,...a]}function Q7(s,a,d,c){let f=s.routeConfig,g=s._resolve;return f?.title!==void 0&&!HF(f)&&(g[hf]=f.title),e9(g,s,a,c).pipe(ot(x=>(s._resolvedData=x,s.data=iC(s,s.parent,d).resolve,null)))}function e9(s,a,d,c){let f=Aw(s);if(f.length===0)return Yt({});let g={};return Di(f).pipe(Ki(x=>t9(s[x],a,d,c).pipe(Ds(),Ji(T=>{g[x]=T}))),Iu(1),m1(g),Ka(x=>YF(x)?Po:Eu(x)))}function t9(s,a,d,c){let f=ff(a)??c,g=Qu(s,f),x=g.resolve?g.resolve(a,d):fa(f,()=>g(a,d));return fl(x)}function Dw(s){return Jr(a=>{let d=s(a);return d?Di(d).pipe(ot(()=>a)):Yt(a)})}var ek=(()=>{let a=class a{buildTitle(c){let f,g=c.root;for(;g!==void 0;)f=this.getResolvedTitleForRoute(g)??f,g=g.children.find(x=>x.outlet===fn);return f}getResolvedTitleForRoute(c){return c.data[hf]}};a.\u0275fac=function(f){return new(f||a)},a.\u0275prov=gt({token:a,factory:()=>ut(n9),providedIn:"root"});let s=a;return s})(),n9=(()=>{let a=class a extends ek{constructor(c){super(),this.title=c}updateTitle(c){let f=this.buildTitle(c);f!==void 0&&this.title.setTitle(f)}};a.\u0275fac=function(f){return new(f||a)(vt(Ew))},a.\u0275prov=gt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})(),lC=new zt("",{providedIn:"root",factory:()=>({})}),cC=new zt("ROUTES"),i9=(()=>{let a=class a{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=ut(tw)}loadComponent(c){if(this.componentLoaders.get(c))return this.componentLoaders.get(c);if(c._loadedComponent)return Yt(c._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(c);let f=fl(c.loadComponent()).pipe(ot(tk),Ji(x=>{this.onLoadEndListener&&this.onLoadEndListener(c),c._loadedComponent=x}),el(()=>{this.componentLoaders.delete(c)})),g=new Cu(f,()=>new co).pipe(wu());return this.componentLoaders.set(c,g),g}loadChildren(c,f){if(this.childrenLoaders.get(f))return this.childrenLoaders.get(f);if(f._loadedRoutes)return Yt({routes:f._loadedRoutes,injector:f._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(f);let x=r9(f,this.compiler,c,this.onLoadEndListener).pipe(el(()=>{this.childrenLoaders.delete(f)})),T=new Cu(x,()=>new co).pipe(wu());return this.childrenLoaders.set(f,T),T}};a.\u0275fac=function(f){return new(f||a)},a.\u0275prov=gt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();function r9(s,a,d,c){return fl(s.loadChildren()).pipe(ot(tk),Ki(f=>f instanceof kh||Array.isArray(f)?Yt(f):Di(a.compileModuleAsync(f))),ot(f=>{c&&c(s);let g,x,T=!1;return Array.isArray(f)?(x=f,T=!0):(g=f.create(d).injector,x=g.get(cC,[],{optional:!0,self:!0}).flat()),{routes:x.map(sC),injector:g}}))}function o9(s){return s&&typeof s=="object"&&"default"in s}function tk(s){return o9(s)?s.default:s}var uC=(()=>{let a=class a{};a.\u0275fac=function(f){return new(f||a)},a.\u0275prov=gt({token:a,factory:()=>ut(s9),providedIn:"root"});let s=a;return s})(),s9=(()=>{let a=class a{shouldProcessUrl(c){return!0}extract(c){return c}merge(c,f){return c}};a.\u0275fac=function(f){return new(f||a)},a.\u0275prov=gt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})(),a9=new zt("");var l9=(()=>{let a=class a{get hasRequestedNavigation(){return this.navigationId!==0}constructor(){this.currentNavigation=null,this.currentTransition=null,this.lastSuccessfulNavigation=null,this.events=new co,this.transitionAbortSubject=new co,this.configLoader=ut(i9),this.environmentInjector=ut(to),this.urlSerializer=ut(nC),this.rootContexts=ut(q_),this.location=ut(_r),this.inputBindingEnabled=ut(W_,{optional:!0})!==null,this.titleStrategy=ut(ek),this.options=ut(lC,{optional:!0})||{},this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlHandlingStrategy=ut(uC),this.createViewTransition=ut(a9,{optional:!0}),this.navigationId=0,this.afterPreactivation=()=>Yt(void 0),this.rootComponentType=null;let c=g=>this.events.next(new Bw(g)),f=g=>this.events.next(new Vw(g));this.configLoader.onLoadEndListener=f,this.configLoader.onLoadStartListener=c}complete(){this.transitions?.complete()}handleNavigationRequest(c){let f=++this.navigationId;this.transitions?.next(Qn(rt(rt({},this.transitions.value),c),{id:f}))}setupNavigations(c,f,g){return this.transitions=new pr({id:0,currentUrlTree:f,currentRawUrl:f,extractedUrl:this.urlHandlingStrategy.extract(f),urlAfterRedirects:this.urlHandlingStrategy.extract(f),rawUrl:f,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:tf,restoredState:null,currentSnapshot:g.snapshot,targetSnapshot:null,currentRouterState:g,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe(uo(x=>x.id!==0),ot(x=>Qn(rt({},x),{extractedUrl:this.urlHandlingStrategy.extract(x.rawUrl)})),Jr(x=>{this.currentTransition=x;let T=!1,P=!1;return Yt(x).pipe(Ji(O=>{this.currentNavigation={id:O.id,initialUrl:O.rawUrl,extractedUrl:O.extractedUrl,trigger:O.source,extras:O.extras,previousNavigation:this.lastSuccessfulNavigation?Qn(rt({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),Jr(O=>{let Z=!c.navigated||this.isUpdatingInternalState()||this.isUpdatedBrowserUrl(),ee=O.extras.onSameUrlNavigation??c.onSameUrlNavigation;if(!Z&&ee!=="reload"){let ce="";return this.events.next(new gc(O.id,this.urlSerializer.serialize(O.rawUrl),ce,Fw.IgnoredSameUrlNavigation)),O.resolve(null),Po}if(this.urlHandlingStrategy.shouldProcessUrl(O.rawUrl))return Yt(O).pipe(Jr(ce=>{let Ee=this.transitions?.getValue();return this.events.next(new of(ce.id,this.urlSerializer.serialize(ce.extractedUrl),ce.source,ce.restoredState)),Ee!==this.transitions?.getValue()?Po:Promise.resolve(ce)}),K7(this.environmentInjector,this.configLoader,this.rootComponentType,c.config,this.urlSerializer,this.paramsInheritanceStrategy),Ji(ce=>{x.targetSnapshot=ce.targetSnapshot,x.urlAfterRedirects=ce.urlAfterRedirects,this.currentNavigation=Qn(rt({},this.currentNavigation),{finalUrl:ce.urlAfterRedirects});let Ee=new V_(ce.id,this.urlSerializer.serialize(ce.extractedUrl),this.urlSerializer.serialize(ce.urlAfterRedirects),ce.targetSnapshot);this.events.next(Ee)}));if(Z&&this.urlHandlingStrategy.shouldProcessUrl(O.currentRawUrl)){let{id:ce,extractedUrl:Ee,source:Ze,restoredState:Vt,extras:dt}=O,tt=new of(ce,this.urlSerializer.serialize(Ee),Ze,Vt);this.events.next(tt);let Ln=$F(this.rootComponentType).snapshot;return this.currentTransition=x=Qn(rt({},O),{targetSnapshot:Ln,urlAfterRedirects:Ee,extras:Qn(rt({},dt),{skipLocationChange:!1,replaceUrl:!1})}),this.currentNavigation.finalUrl=Ee,Yt(x)}else{let ce="";return this.events.next(new gc(O.id,this.urlSerializer.serialize(O.extractedUrl),ce,Fw.IgnoredByUrlHandlingStrategy)),O.resolve(null),Po}}),Ji(O=>{let Z=new kw(O.id,this.urlSerializer.serialize(O.extractedUrl),this.urlSerializer.serialize(O.urlAfterRedirects),O.targetSnapshot);this.events.next(Z)}),ot(O=>(this.currentTransition=x=Qn(rt({},O),{guards:m7(O.targetSnapshot,O.currentSnapshot,this.rootContexts)}),x)),T7(this.environmentInjector,O=>this.events.next(O)),Ji(O=>{if(x.guardsResult=O.guardsResult,Yu(O.guardsResult))throw WF(this.urlSerializer,O.guardsResult);let Z=new Lw(O.id,this.urlSerializer.serialize(O.extractedUrl),this.urlSerializer.serialize(O.urlAfterRedirects),O.targetSnapshot,!!O.guardsResult);this.events.next(Z)}),uo(O=>O.guardsResult?!0:(this.cancelNavigationTransition(O,"",Bo.GuardRejected),!1)),Dw(O=>{if(O.guards.canActivateChecks.length)return Yt(O).pipe(Ji(Z=>{let ee=new Nw(Z.id,this.urlSerializer.serialize(Z.extractedUrl),this.urlSerializer.serialize(Z.urlAfterRedirects),Z.targetSnapshot);this.events.next(ee)}),Jr(Z=>{let ee=!1;return Yt(Z).pipe(J7(this.paramsInheritanceStrategy,this.environmentInjector),Ji({next:()=>ee=!0,complete:()=>{ee||this.cancelNavigationTransition(Z,"",Bo.NoDataFromResolver)}}))}),Ji(Z=>{let ee=new zw(Z.id,this.urlSerializer.serialize(Z.extractedUrl),this.urlSerializer.serialize(Z.urlAfterRedirects),Z.targetSnapshot);this.events.next(ee)}))}),Dw(O=>{let Z=ee=>{let ce=[];ee.routeConfig?.loadComponent&&!ee.routeConfig._loadedComponent&&ce.push(this.configLoader.loadComponent(ee.routeConfig).pipe(Ji(Ee=>{ee.component=Ee}),ot(()=>{})));for(let Ee of ee.children)ce.push(...Z(Ee));return ce};return _h(Z(O.targetSnapshot.root)).pipe(Qa(null),oa(1))}),Dw(()=>this.afterPreactivation()),Jr(()=>{let{currentSnapshot:O,targetSnapshot:Z}=x,ee=this.createViewTransition?.(this.environmentInjector,O.root,Z.root);return ee?Di(ee).pipe(ot(()=>x)):Yt(x)}),ot(O=>{let Z=a7(c.routeReuseStrategy,O.targetSnapshot,O.currentRouterState);return this.currentTransition=x=Qn(rt({},O),{targetRouterState:Z}),this.currentNavigation.targetRouterState=Z,x}),Ji(()=>{this.events.next(new af)}),p7(this.rootContexts,c.routeReuseStrategy,O=>this.events.next(O),this.inputBindingEnabled),oa(1),Ji({next:O=>{T=!0,this.lastSuccessfulNavigation=this.currentNavigation,this.events.next(new mc(O.id,this.urlSerializer.serialize(O.extractedUrl),this.urlSerializer.serialize(O.urlAfterRedirects))),this.titleStrategy?.updateTitle(O.targetRouterState.snapshot),O.resolve(!0)},complete:()=>{T=!0}}),v1(this.transitionAbortSubject.pipe(Ji(O=>{throw O}))),el(()=>{!T&&!P&&this.cancelNavigationTransition(x,"",Bo.SupersededByNewNavigation),this.currentNavigation?.id===x.id&&(this.currentNavigation=null)}),Ka(O=>{if(P=!0,XF(O))this.events.next(new hl(x.id,this.urlSerializer.serialize(x.extractedUrl),O.message,O.cancellationCode)),u7(O)?this.events.next(new lf(O.url)):x.resolve(!1);else{this.events.next(new sf(x.id,this.urlSerializer.serialize(x.extractedUrl),O,x.targetSnapshot??void 0));try{x.resolve(c.errorHandler(O))}catch(Z){this.options.resolveNavigationPromiseOnError?x.resolve(!1):x.reject(Z)}}return Po}))}))}cancelNavigationTransition(c,f,g){let x=new hl(c.id,this.urlSerializer.serialize(c.extractedUrl),f,g);this.events.next(x),c.resolve(!1)}isUpdatingInternalState(){return this.currentTransition?.extractedUrl.toString()!==this.currentTransition?.currentUrlTree.toString()}isUpdatedBrowserUrl(){return this.urlHandlingStrategy.extract(this.urlSerializer.parse(this.location.path(!0))).toString()!==this.currentTransition?.extractedUrl.toString()&&!this.currentTransition?.extras.skipLocationChange}};a.\u0275fac=function(f){return new(f||a)},a.\u0275prov=gt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();function c9(s){return s!==tf}var u9=(()=>{let a=class a{};a.\u0275fac=function(f){return new(f||a)},a.\u0275prov=gt({token:a,factory:()=>ut(d9),providedIn:"root"});let s=a;return s})(),tC=class{shouldDetach(a){return!1}store(a,d){}shouldAttach(a){return!1}retrieve(a){return null}shouldReuseRoute(a,d){return a.routeConfig===d.routeConfig}},d9=(()=>{let a=class a extends tC{};a.\u0275fac=(()=>{let c;return function(g){return(c||(c=fo(a)))(g||a)}})(),a.\u0275prov=gt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})(),nk=(()=>{let a=class a{};a.\u0275fac=function(f){return new(f||a)},a.\u0275prov=gt({token:a,factory:()=>ut(h9),providedIn:"root"});let s=a;return s})(),h9=(()=>{let a=class a extends nk{constructor(){super(...arguments),this.location=ut(_r),this.urlSerializer=ut(nC),this.options=ut(lC,{optional:!0})||{},this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.urlHandlingStrategy=ut(uC),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.currentUrlTree=new dl,this.rawUrlTree=this.currentUrlTree,this.currentPageId=0,this.lastSuccessfulId=-1,this.routerState=$F(null),this.stateMemento=this.createStateMemento()}getCurrentUrlTree(){return this.currentUrlTree}getRawUrlTree(){return this.rawUrlTree}restoredState(){return this.location.getState()}get browserPageId(){return this.canceledNavigationResolution!=="computed"?this.currentPageId:this.restoredState()?.\u0275routerPageId??this.currentPageId}getRouterState(){return this.routerState}createStateMemento(){return{rawUrlTree:this.rawUrlTree,currentUrlTree:this.currentUrlTree,routerState:this.routerState}}registerNonRouterCurrentEntryChangeListener(c){return this.location.subscribe(f=>{f.type==="popstate"&&c(f.url,f.state)})}handleRouterEvent(c,f){if(c instanceof of)this.stateMemento=this.createStateMemento();else if(c instanceof gc)this.rawUrlTree=f.initialUrl;else if(c instanceof V_){if(this.urlUpdateStrategy==="eager"&&!f.extras.skipLocationChange){let g=this.urlHandlingStrategy.merge(f.finalUrl,f.initialUrl);this.setBrowserUrl(g,f)}}else c instanceof af?(this.currentUrlTree=f.finalUrl,this.rawUrlTree=this.urlHandlingStrategy.merge(f.finalUrl,f.initialUrl),this.routerState=f.targetRouterState,this.urlUpdateStrategy==="deferred"&&(f.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,f))):c instanceof hl&&(c.code===Bo.GuardRejected||c.code===Bo.NoDataFromResolver)?this.restoreHistory(f):c instanceof sf?this.restoreHistory(f,!0):c instanceof mc&&(this.lastSuccessfulId=c.id,this.currentPageId=this.browserPageId)}setBrowserUrl(c,f){let g=this.urlSerializer.serialize(c);if(this.location.isCurrentPathEqualTo(g)||f.extras.replaceUrl){let x=this.browserPageId,T=rt(rt({},f.extras.state),this.generateNgRouterState(f.id,x));this.location.replaceState(g,"",T)}else{let x=rt(rt({},f.extras.state),this.generateNgRouterState(f.id,this.browserPageId+1));this.location.go(g,"",x)}}restoreHistory(c,f=!1){if(this.canceledNavigationResolution==="computed"){let g=this.browserPageId,x=this.currentPageId-g;x!==0?this.location.historyGo(x):this.currentUrlTree===c.finalUrl&&x===0&&(this.resetState(c),this.resetUrlToCurrentUrlTree())}else this.canceledNavigationResolution==="replace"&&(f&&this.resetState(c),this.resetUrlToCurrentUrlTree())}resetState(c){this.routerState=this.stateMemento.routerState,this.currentUrlTree=this.stateMemento.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,c.finalUrl??this.rawUrlTree)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(c,f){return this.canceledNavigationResolution==="computed"?{navigationId:c,\u0275routerPageId:f}:{navigationId:c}}};a.\u0275fac=(()=>{let c;return function(g){return(c||(c=fo(a)))(g||a)}})(),a.\u0275prov=gt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})(),Qh=function(s){return s[s.COMPLETE=0]="COMPLETE",s[s.FAILED=1]="FAILED",s[s.REDIRECTING=2]="REDIRECTING",s}(Qh||{});function f9(s,a){s.events.pipe(uo(d=>d instanceof mc||d instanceof hl||d instanceof sf||d instanceof gc),ot(d=>d instanceof mc||d instanceof gc?Qh.COMPLETE:(d instanceof hl?d.code===Bo.Redirect||d.code===Bo.SupersededByNewNavigation:!1)?Qh.REDIRECTING:Qh.FAILED),uo(d=>d!==Qh.REDIRECTING),oa(1)).subscribe(()=>{a()})}function p9(s){throw s}var m9={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},g9={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"},jo=(()=>{let a=class a{get currentUrlTree(){return this.stateManager.getCurrentUrlTree()}get rawUrlTree(){return this.stateManager.getRawUrlTree()}get events(){return this._events}get routerState(){return this.stateManager.getRouterState()}constructor(){this.disposed=!1,this.isNgZoneEnabled=!1,this.console=ut(a_),this.stateManager=ut(nk),this.options=ut(lC,{optional:!0})||{},this.pendingTasks=ut(uc),this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.navigationTransitions=ut(l9),this.urlSerializer=ut(nC),this.location=ut(_r),this.urlHandlingStrategy=ut(uC),this._events=new co,this.errorHandler=this.options.errorHandler||p9,this.navigated=!1,this.routeReuseStrategy=ut(u9),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.config=ut(cC,{optional:!0})?.flat()??[],this.componentInputBindingEnabled=!!ut(W_,{optional:!0}),this.eventsSubscription=new Yi,this.isNgZoneEnabled=ut(Bi)instanceof Bi&&Bi.isInAngularZone(),this.resetConfig(this.config),this.navigationTransitions.setupNavigations(this,this.currentUrlTree,this.routerState).subscribe({error:c=>{this.console.warn(c)}}),this.subscribeToNavigationEvents()}subscribeToNavigationEvents(){let c=this.navigationTransitions.events.subscribe(f=>{try{let g=this.navigationTransitions.currentTransition,x=this.navigationTransitions.currentNavigation;if(g!==null&&x!==null){if(this.stateManager.handleRouterEvent(f,x),f instanceof hl&&f.code!==Bo.Redirect&&f.code!==Bo.SupersededByNewNavigation)this.navigated=!0;else if(f instanceof mc)this.navigated=!0;else if(f instanceof lf){let T=this.urlHandlingStrategy.merge(f.url,g.currentRawUrl),P={info:g.extras.info,skipLocationChange:g.extras.skipLocationChange,replaceUrl:this.urlUpdateStrategy==="eager"||c9(g.source)};this.scheduleNavigation(T,tf,null,P,{resolve:g.resolve,reject:g.reject,promise:g.promise})}}y9(f)&&this._events.next(f)}catch(g){this.navigationTransitions.transitionAbortSubject.next(g)}});this.eventsSubscription.add(c)}resetRootComponentType(c){this.routerState.root.component=c,this.navigationTransitions.rootComponentType=c}initialNavigation(){this.setUpLocationChangeListener(),this.navigationTransitions.hasRequestedNavigation||this.navigateToSyncWithBrowser(this.location.path(!0),tf,this.stateManager.restoredState())}setUpLocationChangeListener(){this.nonRouterCurrentEntryChangeSubscription??=this.stateManager.registerNonRouterCurrentEntryChangeListener((c,f)=>{setTimeout(()=>{this.navigateToSyncWithBrowser(c,"popstate",f)},0)})}navigateToSyncWithBrowser(c,f,g){let x={replaceUrl:!0},T=g?.navigationId?g:null;if(g){let O=rt({},g);delete O.navigationId,delete O.\u0275routerPageId,Object.keys(O).length!==0&&(x.state=O)}let P=this.parseUrl(c);this.scheduleNavigation(P,f,T,x)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}get lastSuccessfulNavigation(){return this.navigationTransitions.lastSuccessfulNavigation}resetConfig(c){this.config=c.map(sC),this.navigated=!1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.nonRouterCurrentEntryChangeSubscription&&(this.nonRouterCurrentEntryChangeSubscription.unsubscribe(),this.nonRouterCurrentEntryChangeSubscription=void 0),this.disposed=!0,this.eventsSubscription.unsubscribe()}createUrlTree(c,f={}){let{relativeTo:g,queryParams:x,fragment:T,queryParamsHandling:P,preserveFragment:O}=f,Z=O?this.currentUrlTree.fragment:T,ee=null;switch(P){case"merge":ee=rt(rt({},this.currentUrlTree.queryParams),x);break;case"preserve":ee=this.currentUrlTree.queryParams;break;default:ee=x||null}ee!==null&&(ee=this.removeEmptyProps(ee));let ce;try{let Ee=g?g.snapshot:this.routerState.snapshot.root;ce=BF(Ee)}catch{(typeof c[0]!="string"||!c[0].startsWith("/"))&&(c=[]),ce=this.currentUrlTree.root}return VF(ce,c,ee,Z??null)}navigateByUrl(c,f={skipLocationChange:!1}){let g=Yu(c)?c:this.parseUrl(c),x=this.urlHandlingStrategy.merge(g,this.rawUrlTree);return this.scheduleNavigation(x,tf,null,f)}navigate(c,f={skipLocationChange:!1}){return _9(c),this.navigateByUrl(this.createUrlTree(c,f),f)}serializeUrl(c){return this.urlSerializer.serialize(c)}parseUrl(c){try{return this.urlSerializer.parse(c)}catch{return this.urlSerializer.parse("/")}}isActive(c,f){let g;if(f===!0?g=rt({},m9):f===!1?g=rt({},g9):g=f,Yu(c))return CF(this.currentUrlTree,c,g);let x=this.parseUrl(c);return CF(this.currentUrlTree,x,g)}removeEmptyProps(c){return Object.entries(c).reduce((f,[g,x])=>(x!=null&&(f[g]=x),f),{})}scheduleNavigation(c,f,g,x,T){if(this.disposed)return Promise.resolve(!1);let P,O,Z;T?(P=T.resolve,O=T.reject,Z=T.promise):Z=new Promise((ce,Ee)=>{P=ce,O=Ee});let ee=this.pendingTasks.add();return f9(this,()=>{queueMicrotask(()=>this.pendingTasks.remove(ee))}),this.navigationTransitions.handleNavigationRequest({source:f,restoredState:g,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:c,extras:x,resolve:P,reject:O,promise:Z,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),Z.catch(ce=>Promise.reject(ce))}};a.\u0275fac=function(f){return new(f||a)},a.\u0275prov=gt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();function _9(s){for(let a=0;a<s.length;a++)if(s[a]==null)throw new $t(4008,!1)}function y9(s){return!(s instanceof af)&&!(s instanceof lf)}var v9=new zt("");function ik(s,...a){return Vu([{provide:cC,multi:!0,useValue:s},[],{provide:Ku,useFactory:x9,deps:[jo]},{provide:l_,multi:!0,useFactory:w9},a.map(d=>d.\u0275providers)])}function x9(s){return s.routerState.root}function b9(s,a){return{\u0275kind:s,\u0275providers:a}}function w9(){let s=ut(ac);return a=>{let d=s.get(ju);if(a!==d.components[0])return;let c=s.get(jo),f=s.get(C9);s.get(E9)===1&&c.initialNavigation(),s.get(T9,null,Tn.Optional)?.setUpPreloading(),s.get(v9,null,Tn.Optional)?.init(),c.resetRootComponentType(d.componentTypes[0]),f.closed||(f.next(),f.complete(),f.unsubscribe())}}var C9=new zt("",{factory:()=>new co}),E9=new zt("",{providedIn:"root",factory:()=>1});var T9=new zt("");function rk(){return b9(8,[MF,{provide:W_,useExisting:MF}])}var pk=(()=>{let a=class a{constructor(c,f){this._renderer=c,this._elementRef=f,this.onChange=g=>{},this.onTouched=()=>{}}setProperty(c,f){this._renderer.setProperty(this._elementRef.nativeElement,c,f)}registerOnTouched(c){this.onTouched=c}registerOnChange(c){this.onChange=c}setDisabledState(c){this.setProperty("disabled",c)}};a.\u0275fac=function(f){return new(f||a)(qe(ls),qe(Fs))},a.\u0275dir=_i({type:a});let s=a;return s})(),ny=(()=>{let a=class a extends pk{};a.\u0275fac=(()=>{let c;return function(g){return(c||(c=fo(a)))(g||a)}})(),a.\u0275dir=_i({type:a,features:[Tr]});let s=a;return s})(),vf=new zt("NgValueAccessor");var I9={provide:vf,useExisting:no(()=>Wi),multi:!0};function M9(){let s=_a()?_a().getUserAgent():"";return/android (\d+)/.test(s.toLowerCase())}var D9=new zt("CompositionEventMode"),Wi=(()=>{let a=class a extends pk{constructor(c,f,g){super(c,f),this._compositionMode=g,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!M9())}writeValue(c){let f=c??"";this.setProperty("value",f)}_handleInput(c){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(c)}_compositionStart(){this._composing=!0}_compositionEnd(c){this._composing=!1,this._compositionMode&&this.onChange(c)}};a.\u0275fac=function(f){return new(f||a)(qe(ls),qe(Fs),qe(D9,8))},a.\u0275dir=_i({type:a,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(f,g){f&1&&je("input",function(T){return g._handleInput(T.target.value)})("blur",function(){return g.onTouched()})("compositionstart",function(){return g._compositionStart()})("compositionend",function(T){return g._compositionEnd(T.target.value)})},features:[cn([I9]),Tr]});let s=a;return s})();function pl(s){return s==null||(typeof s=="string"||Array.isArray(s))&&s.length===0}function mk(s){return s!=null&&typeof s.length=="number"}var _c=new zt("NgValidators"),gk=new zt("NgAsyncValidators"),S9=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/,un=class{static min(a){return _k(a)}static max(a){return A9(a)}static required(a){return yk(a)}static requiredTrue(a){return P9(a)}static email(a){return R9(a)}static minLength(a){return vk(a)}static maxLength(a){return xk(a)}static pattern(a){return bk(a)}static nullValidator(a){return Y_(a)}static compose(a){return Mk(a)}static composeAsync(a){return Sk(a)}};function _k(s){return a=>{if(pl(a.value)||pl(s))return null;let d=parseFloat(a.value);return!isNaN(d)&&d<s?{min:{min:s,actual:a.value}}:null}}function A9(s){return a=>{if(pl(a.value)||pl(s))return null;let d=parseFloat(a.value);return!isNaN(d)&&d>s?{max:{max:s,actual:a.value}}:null}}function yk(s){return pl(s.value)?{required:!0}:null}function P9(s){return s.value===!0?null:{required:!0}}function R9(s){return pl(s.value)||S9.test(s.value)?null:{email:!0}}function vk(s){return a=>pl(a.value)||!mk(a.value)?null:a.value.length<s?{minlength:{requiredLength:s,actualLength:a.value.length}}:null}function xk(s){return a=>mk(a.value)&&a.value.length>s?{maxlength:{requiredLength:s,actualLength:a.value.length}}:null}function bk(s){if(!s)return Y_;let a,d;return typeof s=="string"?(d="",s.charAt(0)!=="^"&&(d+="^"),d+=s,s.charAt(s.length-1)!=="$"&&(d+="$"),a=new RegExp(d)):(d=s.toString(),a=s),c=>{if(pl(c.value))return null;let f=c.value;return a.test(f)?null:{pattern:{requiredPattern:d,actualValue:f}}}}function Y_(s){return null}function wk(s){return s!=null}function Ck(s){return lc(s)?Di(s):s}function Ek(s){let a={};return s.forEach(d=>{a=d!=null?rt(rt({},a),d):a}),Object.keys(a).length===0?null:a}function Tk(s,a){return a.map(d=>d(s))}function O9(s){return!s.validate}function Ik(s){return s.map(a=>O9(a)?a:d=>a.validate(d))}function Mk(s){if(!s)return null;let a=s.filter(wk);return a.length==0?null:function(d){return Ek(Tk(d,a))}}function Dk(s){return s!=null?Mk(Ik(s)):null}function Sk(s){if(!s)return null;let a=s.filter(wk);return a.length==0?null:function(d){let c=Tk(d,a).map(Ck);return p1(c).pipe(ot(Ek))}}function Ak(s){return s!=null?Sk(Ik(s)):null}function ok(s,a){return s===null?[a]:Array.isArray(s)?[...s,a]:[s,a]}function Pk(s){return s._rawValidators}function Rk(s){return s._rawAsyncValidators}function dC(s){return s?Array.isArray(s)?s:[s]:[]}function K_(s,a){return Array.isArray(s)?s.includes(a):s===a}function sk(s,a){let d=dC(a);return dC(s).forEach(f=>{K_(d,f)||d.push(f)}),d}function ak(s,a){return dC(a).filter(d=>!K_(s,d))}var J_=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(a){this._rawValidators=a||[],this._composedValidatorFn=Dk(this._rawValidators)}_setAsyncValidators(a){this._rawAsyncValidators=a||[],this._composedAsyncValidatorFn=Ak(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(a){this._onDestroyCallbacks.push(a)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(a=>a()),this._onDestroyCallbacks=[]}reset(a=void 0){this.control&&this.control.reset(a)}hasError(a,d){return this.control?this.control.hasError(a,d):!1}getError(a,d){return this.control?this.control.getError(a,d):null}},td=class extends J_{get formDirective(){return null}get path(){return null}},yf=class extends J_{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},Q_=class{constructor(a){this._cd=a}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}},F9={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},mie=Qn(rt({},F9),{"[class.ng-submitted]":"isSubmitted"}),or=(()=>{let a=class a extends Q_{constructor(c){super(c)}};a.\u0275fac=function(f){return new(f||a)(qe(yf,2))},a.\u0275dir=_i({type:a,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(f,g){f&2&&r_("ng-untouched",g.isUntouched)("ng-touched",g.isTouched)("ng-pristine",g.isPristine)("ng-dirty",g.isDirty)("ng-valid",g.isValid)("ng-invalid",g.isInvalid)("ng-pending",g.isPending)},features:[Tr]});let s=a;return s})(),sr=(()=>{let a=class a extends Q_{constructor(c){super(c)}};a.\u0275fac=function(f){return new(f||a)(qe(td,10))},a.\u0275dir=_i({type:a,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(f,g){f&2&&r_("ng-untouched",g.isUntouched)("ng-touched",g.isTouched)("ng-pristine",g.isPristine)("ng-dirty",g.isDirty)("ng-valid",g.isValid)("ng-invalid",g.isInvalid)("ng-pending",g.isPending)("ng-submitted",g.isSubmitted)},features:[Tr]});let s=a;return s})();var gf="VALID",X_="INVALID",ed="PENDING",_f="DISABLED";function pC(s){return(iy(s)?s.validators:s)||null}function k9(s){return Array.isArray(s)?Dk(s):s||null}function mC(s,a){return(iy(a)?a.asyncValidators:s)||null}function L9(s){return Array.isArray(s)?Ak(s):s||null}function iy(s){return s!=null&&!Array.isArray(s)&&typeof s=="object"}function Ok(s,a,d){let c=s.controls;if(!(a?Object.keys(c):c).length)throw new $t(1e3,"");if(!c[d])throw new $t(1001,"")}function Fk(s,a,d){s._forEachChild((c,f)=>{if(d[f]===void 0)throw new $t(1002,"")})}var nd=class{constructor(a,d){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(a),this._assignAsyncValidators(d)}get validator(){return this._composedValidatorFn}set validator(a){this._rawValidators=this._composedValidatorFn=a}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(a){this._rawAsyncValidators=this._composedAsyncValidatorFn=a}get parent(){return this._parent}get valid(){return this.status===gf}get invalid(){return this.status===X_}get pending(){return this.status==ed}get disabled(){return this.status===_f}get enabled(){return this.status!==_f}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(a){this._assignValidators(a)}setAsyncValidators(a){this._assignAsyncValidators(a)}addValidators(a){this.setValidators(sk(a,this._rawValidators))}addAsyncValidators(a){this.setAsyncValidators(sk(a,this._rawAsyncValidators))}removeValidators(a){this.setValidators(ak(a,this._rawValidators))}removeAsyncValidators(a){this.setAsyncValidators(ak(a,this._rawAsyncValidators))}hasValidator(a){return K_(this._rawValidators,a)}hasAsyncValidator(a){return K_(this._rawAsyncValidators,a)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(a={}){this.touched=!0,this._parent&&!a.onlySelf&&this._parent.markAsTouched(a)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(a=>a.markAllAsTouched())}markAsUntouched(a={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(d=>{d.markAsUntouched({onlySelf:!0})}),this._parent&&!a.onlySelf&&this._parent._updateTouched(a)}markAsDirty(a={}){this.pristine=!1,this._parent&&!a.onlySelf&&this._parent.markAsDirty(a)}markAsPristine(a={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(d=>{d.markAsPristine({onlySelf:!0})}),this._parent&&!a.onlySelf&&this._parent._updatePristine(a)}markAsPending(a={}){this.status=ed,a.emitEvent!==!1&&this.statusChanges.emit(this.status),this._parent&&!a.onlySelf&&this._parent.markAsPending(a)}disable(a={}){let d=this._parentMarkedDirty(a.onlySelf);this.status=_f,this.errors=null,this._forEachChild(c=>{c.disable(Qn(rt({},a),{onlySelf:!0}))}),this._updateValue(),a.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Qn(rt({},a),{skipPristineCheck:d})),this._onDisabledChange.forEach(c=>c(!0))}enable(a={}){let d=this._parentMarkedDirty(a.onlySelf);this.status=gf,this._forEachChild(c=>{c.enable(Qn(rt({},a),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:a.emitEvent}),this._updateAncestors(Qn(rt({},a),{skipPristineCheck:d})),this._onDisabledChange.forEach(c=>c(!1))}_updateAncestors(a){this._parent&&!a.onlySelf&&(this._parent.updateValueAndValidity(a),a.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(a){this._parent=a}getRawValue(){return this.value}updateValueAndValidity(a={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===gf||this.status===ed)&&this._runAsyncValidator(a.emitEvent)),a.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!a.onlySelf&&this._parent.updateValueAndValidity(a)}_updateTreeValidity(a={emitEvent:!0}){this._forEachChild(d=>d._updateTreeValidity(a)),this.updateValueAndValidity({onlySelf:!0,emitEvent:a.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?_f:gf}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(a){if(this.asyncValidator){this.status=ed,this._hasOwnPendingAsyncValidator=!0;let d=Ck(this.asyncValidator(this));this._asyncValidationSubscription=d.subscribe(c=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(c,{emitEvent:a})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(a,d={}){this.errors=a,this._updateControlsErrors(d.emitEvent!==!1)}get(a){let d=a;return d==null||(Array.isArray(d)||(d=d.split(".")),d.length===0)?null:d.reduce((c,f)=>c&&c._find(f),this)}getError(a,d){let c=d?this.get(d):this;return c&&c.errors?c.errors[a]:null}hasError(a,d){return!!this.getError(a,d)}get root(){let a=this;for(;a._parent;)a=a._parent;return a}_updateControlsErrors(a){this.status=this._calculateStatus(),a&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(a)}_initObservables(){this.valueChanges=new br,this.statusChanges=new br}_calculateStatus(){return this._allControlsDisabled()?_f:this.errors?X_:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(ed)?ed:this._anyControlsHaveStatus(X_)?X_:gf}_anyControlsHaveStatus(a){return this._anyControls(d=>d.status===a)}_anyControlsDirty(){return this._anyControls(a=>a.dirty)}_anyControlsTouched(){return this._anyControls(a=>a.touched)}_updatePristine(a={}){this.pristine=!this._anyControlsDirty(),this._parent&&!a.onlySelf&&this._parent._updatePristine(a)}_updateTouched(a={}){this.touched=this._anyControlsTouched(),this._parent&&!a.onlySelf&&this._parent._updateTouched(a)}_registerOnCollectionChange(a){this._onCollectionChange=a}_setUpdateStrategy(a){iy(a)&&a.updateOn!=null&&(this._updateOn=a.updateOn)}_parentMarkedDirty(a){let d=this._parent&&this._parent.dirty;return!a&&!!d&&!this._parent._anyControlsDirty()}_find(a){return null}_assignValidators(a){this._rawValidators=Array.isArray(a)?a.slice():a,this._composedValidatorFn=k9(this._rawValidators)}_assignAsyncValidators(a){this._rawAsyncValidators=Array.isArray(a)?a.slice():a,this._composedAsyncValidatorFn=L9(this._rawAsyncValidators)}},vr=class extends nd{constructor(a,d,c){super(pC(d),mC(c,d)),this.controls=a,this._initObservables(),this._setUpdateStrategy(d),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(a,d){return this.controls[a]?this.controls[a]:(this.controls[a]=d,d.setParent(this),d._registerOnCollectionChange(this._onCollectionChange),d)}addControl(a,d,c={}){this.registerControl(a,d),this.updateValueAndValidity({emitEvent:c.emitEvent}),this._onCollectionChange()}removeControl(a,d={}){this.controls[a]&&this.controls[a]._registerOnCollectionChange(()=>{}),delete this.controls[a],this.updateValueAndValidity({emitEvent:d.emitEvent}),this._onCollectionChange()}setControl(a,d,c={}){this.controls[a]&&this.controls[a]._registerOnCollectionChange(()=>{}),delete this.controls[a],d&&this.registerControl(a,d),this.updateValueAndValidity({emitEvent:c.emitEvent}),this._onCollectionChange()}contains(a){return this.controls.hasOwnProperty(a)&&this.controls[a].enabled}setValue(a,d={}){Fk(this,!0,a),Object.keys(a).forEach(c=>{Ok(this,!0,c),this.controls[c].setValue(a[c],{onlySelf:!0,emitEvent:d.emitEvent})}),this.updateValueAndValidity(d)}patchValue(a,d={}){a!=null&&(Object.keys(a).forEach(c=>{let f=this.controls[c];f&&f.patchValue(a[c],{onlySelf:!0,emitEvent:d.emitEvent})}),this.updateValueAndValidity(d))}reset(a={},d={}){this._forEachChild((c,f)=>{c.reset(a?a[f]:null,{onlySelf:!0,emitEvent:d.emitEvent})}),this._updatePristine(d),this._updateTouched(d),this.updateValueAndValidity(d)}getRawValue(){return this._reduceChildren({},(a,d,c)=>(a[c]=d.getRawValue(),a))}_syncPendingControls(){let a=this._reduceChildren(!1,(d,c)=>c._syncPendingControls()?!0:d);return a&&this.updateValueAndValidity({onlySelf:!0}),a}_forEachChild(a){Object.keys(this.controls).forEach(d=>{let c=this.controls[d];c&&a(c,d)})}_setUpControls(){this._forEachChild(a=>{a.setParent(this),a._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(a){for(let[d,c]of Object.entries(this.controls))if(this.contains(d)&&a(c))return!0;return!1}_reduceValue(){let a={};return this._reduceChildren(a,(d,c,f)=>((c.enabled||this.disabled)&&(d[f]=c.value),d))}_reduceChildren(a,d){let c=a;return this._forEachChild((f,g)=>{c=d(c,f,g)}),c}_allControlsDisabled(){for(let a of Object.keys(this.controls))if(this.controls[a].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(a){return this.controls.hasOwnProperty(a)?this.controls[a]:null}};var hC=class extends vr{};var kk=new zt("CallSetDisabledState",{providedIn:"root",factory:()=>gC}),gC="always";function N9(s,a){return[...a.path,s]}function lk(s,a,d=gC){_C(s,a),a.valueAccessor.writeValue(s.value),(s.disabled||d==="always")&&a.valueAccessor.setDisabledState?.(s.disabled),B9(s,a),j9(s,a),V9(s,a),z9(s,a)}function ck(s,a,d=!0){let c=()=>{};a.valueAccessor&&(a.valueAccessor.registerOnChange(c),a.valueAccessor.registerOnTouched(c)),ty(s,a),s&&(a._invokeOnDestroyCallbacks(),s._registerOnCollectionChange(()=>{}))}function ey(s,a){s.forEach(d=>{d.registerOnValidatorChange&&d.registerOnValidatorChange(a)})}function z9(s,a){if(a.valueAccessor.setDisabledState){let d=c=>{a.valueAccessor.setDisabledState(c)};s.registerOnDisabledChange(d),a._registerOnDestroy(()=>{s._unregisterOnDisabledChange(d)})}}function _C(s,a){let d=Pk(s);a.validator!==null?s.setValidators(ok(d,a.validator)):typeof d=="function"&&s.setValidators([d]);let c=Rk(s);a.asyncValidator!==null?s.setAsyncValidators(ok(c,a.asyncValidator)):typeof c=="function"&&s.setAsyncValidators([c]);let f=()=>s.updateValueAndValidity();ey(a._rawValidators,f),ey(a._rawAsyncValidators,f)}function ty(s,a){let d=!1;if(s!==null){if(a.validator!==null){let f=Pk(s);if(Array.isArray(f)&&f.length>0){let g=f.filter(x=>x!==a.validator);g.length!==f.length&&(d=!0,s.setValidators(g))}}if(a.asyncValidator!==null){let f=Rk(s);if(Array.isArray(f)&&f.length>0){let g=f.filter(x=>x!==a.asyncValidator);g.length!==f.length&&(d=!0,s.setAsyncValidators(g))}}}let c=()=>{};return ey(a._rawValidators,c),ey(a._rawAsyncValidators,c),d}function B9(s,a){a.valueAccessor.registerOnChange(d=>{s._pendingValue=d,s._pendingChange=!0,s._pendingDirty=!0,s.updateOn==="change"&&Lk(s,a)})}function V9(s,a){a.valueAccessor.registerOnTouched(()=>{s._pendingTouched=!0,s.updateOn==="blur"&&s._pendingChange&&Lk(s,a),s.updateOn!=="submit"&&s.markAsTouched()})}function Lk(s,a){s._pendingDirty&&s.markAsDirty(),s.setValue(s._pendingValue,{emitModelToViewChange:!1}),a.viewToModelUpdate(s._pendingValue),s._pendingChange=!1}function j9(s,a){let d=(c,f)=>{a.valueAccessor.writeValue(c),f&&a.viewToModelUpdate(c)};s.registerOnChange(d),a._registerOnDestroy(()=>{s._unregisterOnChange(d)})}function U9(s,a){s==null,_C(s,a)}function $9(s,a){return ty(s,a)}function G9(s,a){if(!s.hasOwnProperty("model"))return!1;let d=s.model;return d.isFirstChange()?!0:!Object.is(a,d.currentValue)}function H9(s){return Object.getPrototypeOf(s.constructor)===ny}function q9(s,a){s._syncPendingControls(),a.forEach(d=>{let c=d.control;c.updateOn==="submit"&&c._pendingChange&&(d.viewToModelUpdate(c._pendingValue),c._pendingChange=!1)})}function W9(s,a){if(!a)return null;Array.isArray(a);let d,c,f;return a.forEach(g=>{g.constructor===Wi?d=g:H9(g)?c=g:f=g}),f||c||d||null}function Z9(s,a){let d=s.indexOf(a);d>-1&&s.splice(d,1)}function uk(s,a){let d=s.indexOf(a);d>-1&&s.splice(d,1)}function dk(s){return typeof s=="object"&&s!==null&&Object.keys(s).length===2&&"value"in s&&"disabled"in s}var wt=class extends nd{constructor(a=null,d,c){super(pC(d),mC(c,d)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(a),this._setUpdateStrategy(d),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),iy(d)&&(d.nonNullable||d.initialValueIsDefault)&&(dk(a)?this.defaultValue=a.value:this.defaultValue=a)}setValue(a,d={}){this.value=this._pendingValue=a,this._onChange.length&&d.emitModelToViewChange!==!1&&this._onChange.forEach(c=>c(this.value,d.emitViewToModelChange!==!1)),this.updateValueAndValidity(d)}patchValue(a,d={}){this.setValue(a,d)}reset(a=this.defaultValue,d={}){this._applyFormState(a),this.markAsPristine(d),this.markAsUntouched(d),this.setValue(this.value,d),this._pendingChange=!1}_updateValue(){}_anyControls(a){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(a){this._onChange.push(a)}_unregisterOnChange(a){uk(this._onChange,a)}registerOnDisabledChange(a){this._onDisabledChange.push(a)}_unregisterOnDisabledChange(a){uk(this._onDisabledChange,a)}_forEachChild(a){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(a){dk(a)?(this.value=this._pendingValue=a.value,a.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=a}};var X9=s=>s instanceof wt;var ar=(()=>{let a=class a{};a.\u0275fac=function(f){return new(f||a)},a.\u0275dir=_i({type:a,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]});let s=a;return s})(),Y9={provide:vf,useExisting:no(()=>yC),multi:!0},yC=(()=>{let a=class a extends ny{writeValue(c){let f=c??"";this.setProperty("value",f)}registerOnChange(c){this.onChange=f=>{c(f==""?null:parseFloat(f))}}};a.\u0275fac=(()=>{let c;return function(g){return(c||(c=fo(a)))(g||a)}})(),a.\u0275dir=_i({type:a,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(f,g){f&1&&je("input",function(T){return g.onChange(T.target.value)})("blur",function(){return g.onTouched()})},features:[cn([Y9]),Tr]});let s=a;return s})();var K9=(()=>{let a=class a{};a.\u0275fac=function(f){return new(f||a)},a.\u0275mod=ss({type:a}),a.\u0275inj=os({});let s=a;return s})();var Nk=new zt("NgModelWithFormControlWarning");var J9={provide:td,useExisting:no(()=>Qi)},Qi=(()=>{let a=class a extends td{constructor(c,f,g){super(),this.callSetDisabledState=g,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new br,this._setValidators(c),this._setAsyncValidators(f)}ngOnChanges(c){this._checkFormPresent(),c.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(ty(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(c){let f=this.form.get(c.path);return lk(f,c,this.callSetDisabledState),f.updateValueAndValidity({emitEvent:!1}),this.directives.push(c),f}getControl(c){return this.form.get(c.path)}removeControl(c){ck(c.control||null,c,!1),Z9(this.directives,c)}addFormGroup(c){this._setUpFormContainer(c)}removeFormGroup(c){this._cleanUpFormContainer(c)}getFormGroup(c){return this.form.get(c.path)}addFormArray(c){this._setUpFormContainer(c)}removeFormArray(c){this._cleanUpFormContainer(c)}getFormArray(c){return this.form.get(c.path)}updateModel(c,f){this.form.get(c.path).setValue(f)}onSubmit(c){return this.submitted=!0,q9(this.form,this.directives),this.ngSubmit.emit(c),c?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(c=void 0){this.form.reset(c),this.submitted=!1}_updateDomValue(){this.directives.forEach(c=>{let f=c.control,g=this.form.get(c.path);f!==g&&(ck(f||null,c),X9(g)&&(lk(g,c,this.callSetDisabledState),c.control=g))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(c){let f=this.form.get(c.path);U9(f,c),f.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(c){if(this.form){let f=this.form.get(c.path);f&&$9(f,c)&&f.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){_C(this.form,this),this._oldForm&&ty(this._oldForm,this)}_checkFormPresent(){this.form}};a.\u0275fac=function(f){return new(f||a)(qe(_c,10),qe(gk,10),qe(kk,8))},a.\u0275dir=_i({type:a,selectors:[["","formGroup",""]],hostBindings:function(f,g){f&1&&je("submit",function(T){return g.onSubmit(T)})("reset",function(){return g.onReset()})},inputs:{form:[Cr.None,"formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[cn([J9]),Tr,ol]});let s=a;return s})();var Q9={provide:yf,useExisting:no(()=>er)},er=(()=>{let a=class a extends yf{set isDisabled(c){}constructor(c,f,g,x,T){super(),this._ngModelWarningConfig=T,this._added=!1,this.name=null,this.update=new br,this._ngModelWarningSent=!1,this._parent=c,this._setValidators(f),this._setAsyncValidators(g),this.valueAccessor=W9(this,x)}ngOnChanges(c){this._added||this._setUpControl(),G9(c,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(c){this.viewModel=c,this.update.emit(c)}get path(){return N9(this.name==null?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this._added=!0}};a._ngModelWarningSentOnce=!1,a.\u0275fac=function(f){return new(f||a)(qe(td,13),qe(_c,10),qe(gk,10),qe(vf,10),qe(Nk,8))},a.\u0275dir=_i({type:a,selectors:[["","formControlName",""]],inputs:{name:[Cr.None,"formControlName","name"],isDisabled:[Cr.None,"disabled","isDisabled"],model:[Cr.None,"ngModel","model"]},outputs:{update:"ngModelChange"},features:[cn([Q9]),Tr,ol]});let s=a;return s})(),eW={provide:vf,useExisting:no(()=>Bk),multi:!0};function zk(s,a){return s==null?`${a}`:(a&&typeof a=="object"&&(a="Object"),`${s}: ${a}`.slice(0,50))}function tW(s){return s.split(":")[0]}var Bk=(()=>{let a=class a extends ny{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(c){this._compareWith=c}writeValue(c){this.value=c;let f=this._getOptionId(c),g=zk(f,c);this.setProperty("value",g)}registerOnChange(c){this.onChange=f=>{this.value=this._getOptionValue(f),c(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(c){for(let f of this._optionMap.keys())if(this._compareWith(this._optionMap.get(f),c))return f;return null}_getOptionValue(c){let f=tW(c);return this._optionMap.has(f)?this._optionMap.get(f):c}};a.\u0275fac=(()=>{let c;return function(g){return(c||(c=fo(a)))(g||a)}})(),a.\u0275dir=_i({type:a,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(f,g){f&1&&je("change",function(T){return g.onChange(T.target.value)})("blur",function(){return g.onTouched()})},inputs:{compareWith:"compareWith"},features:[cn([eW]),Tr]});let s=a;return s})(),ry=(()=>{let a=class a{constructor(c,f,g){this._element=c,this._renderer=f,this._select=g,this._select&&(this.id=this._select._registerOption())}set ngValue(c){this._select!=null&&(this._select._optionMap.set(this.id,c),this._setElementValue(zk(this.id,c)),this._select.writeValue(this._select.value))}set value(c){this._setElementValue(c),this._select&&this._select.writeValue(this._select.value)}_setElementValue(c){this._renderer.setProperty(this._element.nativeElement,"value",c)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}};a.\u0275fac=function(f){return new(f||a)(qe(Fs),qe(ls),qe(Bk,9))},a.\u0275dir=_i({type:a,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}});let s=a;return s})(),nW={provide:vf,useExisting:no(()=>Vk),multi:!0};function hk(s,a){return s==null?`${a}`:(typeof a=="string"&&(a=`'${a}'`),a&&typeof a=="object"&&(a="Object"),`${s}: ${a}`.slice(0,50))}function iW(s){return s.split(":")[0]}var Vk=(()=>{let a=class a extends ny{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(c){this._compareWith=c}writeValue(c){this.value=c;let f;if(Array.isArray(c)){let g=c.map(x=>this._getOptionId(x));f=(x,T)=>{x._setSelected(g.indexOf(T.toString())>-1)}}else f=(g,x)=>{g._setSelected(!1)};this._optionMap.forEach(f)}registerOnChange(c){this.onChange=f=>{let g=[],x=f.selectedOptions;if(x!==void 0){let T=x;for(let P=0;P<T.length;P++){let O=T[P],Z=this._getOptionValue(O.value);g.push(Z)}}else{let T=f.options;for(let P=0;P<T.length;P++){let O=T[P];if(O.selected){let Z=this._getOptionValue(O.value);g.push(Z)}}}this.value=g,c(g)}}_registerOption(c){let f=(this._idCounter++).toString();return this._optionMap.set(f,c),f}_getOptionId(c){for(let f of this._optionMap.keys())if(this._compareWith(this._optionMap.get(f)._value,c))return f;return null}_getOptionValue(c){let f=iW(c);return this._optionMap.has(f)?this._optionMap.get(f)._value:c}};a.\u0275fac=(()=>{let c;return function(g){return(c||(c=fo(a)))(g||a)}})(),a.\u0275dir=_i({type:a,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(f,g){f&1&&je("change",function(T){return g.onChange(T.target)})("blur",function(){return g.onTouched()})},inputs:{compareWith:"compareWith"},features:[cn([nW]),Tr]});let s=a;return s})(),oy=(()=>{let a=class a{constructor(c,f,g){this._element=c,this._renderer=f,this._select=g,this._select&&(this.id=this._select._registerOption(this))}set ngValue(c){this._select!=null&&(this._value=c,this._setElementValue(hk(this.id,c)),this._select.writeValue(this._select.value))}set value(c){this._select?(this._value=c,this._setElementValue(hk(this.id,c)),this._select.writeValue(this._select.value)):this._setElementValue(c)}_setElementValue(c){this._renderer.setProperty(this._element.nativeElement,"value",c)}_setSelected(c){this._renderer.setProperty(this._element.nativeElement,"selected",c)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}};a.\u0275fac=function(f){return new(f||a)(qe(Fs),qe(ls),qe(Vk,9))},a.\u0275dir=_i({type:a,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}});let s=a;return s})();function jk(s){return typeof s=="number"?s:parseInt(s,10)}function rW(s){return typeof s=="number"?s:parseFloat(s)}var xf=(()=>{let a=class a{constructor(){this._validator=Y_}ngOnChanges(c){if(this.inputName in c){let f=this.normalizeInput(c[this.inputName].currentValue);this._enabled=this.enabled(f),this._validator=this._enabled?this.createValidator(f):Y_,this._onChange&&this._onChange()}}validate(c){return this._validator(c)}registerOnValidatorChange(c){this._onChange=c}enabled(c){return c!=null}};a.\u0275fac=function(f){return new(f||a)},a.\u0275dir=_i({type:a,features:[ol]});let s=a;return s})();var oW={provide:_c,useExisting:no(()=>vC),multi:!0},vC=(()=>{let a=class a extends xf{constructor(){super(...arguments),this.inputName="min",this.normalizeInput=c=>rW(c),this.createValidator=c=>_k(c)}};a.\u0275fac=(()=>{let c;return function(g){return(c||(c=fo(a)))(g||a)}})(),a.\u0275dir=_i({type:a,selectors:[["input","type","number","min","","formControlName",""],["input","type","number","min","","formControl",""],["input","type","number","min","","ngModel",""]],hostVars:1,hostBindings:function(f,g){f&2&&ll("min",g._enabled?g.min:null)},inputs:{min:"min"},features:[cn([oW]),Tr]});let s=a;return s})(),sW={provide:_c,useExisting:no(()=>va),multi:!0};var va=(()=>{let a=class a extends xf{constructor(){super(...arguments),this.inputName="required",this.normalizeInput=u_,this.createValidator=c=>yk}enabled(c){return c}};a.\u0275fac=(()=>{let c;return function(g){return(c||(c=fo(a)))(g||a)}})(),a.\u0275dir=_i({type:a,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(f,g){f&2&&ll("required",g._enabled?"":null)},inputs:{required:"required"},features:[cn([sW]),Tr]});let s=a;return s})();var aW={provide:_c,useExisting:no(()=>bf),multi:!0},bf=(()=>{let a=class a extends xf{constructor(){super(...arguments),this.inputName="minlength",this.normalizeInput=c=>jk(c),this.createValidator=c=>vk(c)}};a.\u0275fac=(()=>{let c;return function(g){return(c||(c=fo(a)))(g||a)}})(),a.\u0275dir=_i({type:a,selectors:[["","minlength","","formControlName",""],["","minlength","","formControl",""],["","minlength","","ngModel",""]],hostVars:1,hostBindings:function(f,g){f&2&&ll("minlength",g._enabled?g.minlength:null)},inputs:{minlength:"minlength"},features:[cn([aW]),Tr]});let s=a;return s})(),lW={provide:_c,useExisting:no(()=>wf),multi:!0},wf=(()=>{let a=class a extends xf{constructor(){super(...arguments),this.inputName="maxlength",this.normalizeInput=c=>jk(c),this.createValidator=c=>xk(c)}};a.\u0275fac=(()=>{let c;return function(g){return(c||(c=fo(a)))(g||a)}})(),a.\u0275dir=_i({type:a,selectors:[["","maxlength","","formControlName",""],["","maxlength","","formControl",""],["","maxlength","","ngModel",""]],hostVars:1,hostBindings:function(f,g){f&2&&ll("maxlength",g._enabled?g.maxlength:null)},inputs:{maxlength:"maxlength"},features:[cn([lW]),Tr]});let s=a;return s})(),cW={provide:_c,useExisting:no(()=>Cf),multi:!0},Cf=(()=>{let a=class a extends xf{constructor(){super(...arguments),this.inputName="pattern",this.normalizeInput=c=>c,this.createValidator=c=>bk(c)}};a.\u0275fac=(()=>{let c;return function(g){return(c||(c=fo(a)))(g||a)}})(),a.\u0275dir=_i({type:a,selectors:[["","pattern","","formControlName",""],["","pattern","","formControl",""],["","pattern","","ngModel",""]],hostVars:1,hostBindings:function(f,g){f&2&&ll("pattern",g._enabled?g.pattern:null)},inputs:{pattern:"pattern"},features:[cn([cW]),Tr]});let s=a;return s})();var uW=(()=>{let a=class a{};a.\u0275fac=function(f){return new(f||a)},a.\u0275mod=ss({type:a}),a.\u0275inj=os({imports:[K9]});let s=a;return s})(),fC=class extends nd{constructor(a,d,c){super(pC(d),mC(c,d)),this.controls=a,this._initObservables(),this._setUpdateStrategy(d),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(a){return this.controls[this._adjustIndex(a)]}push(a,d={}){this.controls.push(a),this._registerControl(a),this.updateValueAndValidity({emitEvent:d.emitEvent}),this._onCollectionChange()}insert(a,d,c={}){this.controls.splice(a,0,d),this._registerControl(d),this.updateValueAndValidity({emitEvent:c.emitEvent})}removeAt(a,d={}){let c=this._adjustIndex(a);c<0&&(c=0),this.controls[c]&&this.controls[c]._registerOnCollectionChange(()=>{}),this.controls.splice(c,1),this.updateValueAndValidity({emitEvent:d.emitEvent})}setControl(a,d,c={}){let f=this._adjustIndex(a);f<0&&(f=0),this.controls[f]&&this.controls[f]._registerOnCollectionChange(()=>{}),this.controls.splice(f,1),d&&(this.controls.splice(f,0,d),this._registerControl(d)),this.updateValueAndValidity({emitEvent:c.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(a,d={}){Fk(this,!1,a),a.forEach((c,f)=>{Ok(this,!1,f),this.at(f).setValue(c,{onlySelf:!0,emitEvent:d.emitEvent})}),this.updateValueAndValidity(d)}patchValue(a,d={}){a!=null&&(a.forEach((c,f)=>{this.at(f)&&this.at(f).patchValue(c,{onlySelf:!0,emitEvent:d.emitEvent})}),this.updateValueAndValidity(d))}reset(a=[],d={}){this._forEachChild((c,f)=>{c.reset(a[f],{onlySelf:!0,emitEvent:d.emitEvent})}),this._updatePristine(d),this._updateTouched(d),this.updateValueAndValidity(d)}getRawValue(){return this.controls.map(a=>a.getRawValue())}clear(a={}){this.controls.length<1||(this._forEachChild(d=>d._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:a.emitEvent}))}_adjustIndex(a){return a<0?a+this.length:a}_syncPendingControls(){let a=this.controls.reduce((d,c)=>c._syncPendingControls()?!0:d,!1);return a&&this.updateValueAndValidity({onlySelf:!0}),a}_forEachChild(a){this.controls.forEach((d,c)=>{a(d,c)})}_updateValue(){this.value=this.controls.filter(a=>a.enabled||this.disabled).map(a=>a.value)}_anyControls(a){return this.controls.some(d=>d.enabled&&a(d))}_setUpControls(){this._forEachChild(a=>this._registerControl(a))}_allControlsDisabled(){for(let a of this.controls)if(a.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(a){a.setParent(this),a._registerOnCollectionChange(this._onCollectionChange)}_find(a){return this.at(a)??null}};function fk(s){return!!s&&(s.asyncValidators!==void 0||s.validators!==void 0||s.updateOn!==void 0)}var ml=(()=>{let a=class a{constructor(){this.useNonNullable=!1}get nonNullable(){let c=new a;return c.useNonNullable=!0,c}group(c,f=null){let g=this._reduceControls(c),x={};return fk(f)?x=f:f!==null&&(x.validators=f.validator,x.asyncValidators=f.asyncValidator),new vr(g,x)}record(c,f=null){let g=this._reduceControls(c);return new hC(g,f)}control(c,f,g){let x={};return this.useNonNullable?(fk(f)?x=f:(x.validators=f,x.asyncValidators=g),new wt(c,Qn(rt({},x),{nonNullable:!0}))):new wt(c,f,g)}array(c,f,g){let x=c.map(T=>this._createControl(T));return new fC(x,f,g)}_reduceControls(c){let f={};return Object.keys(c).forEach(g=>{f[g]=this._createControl(c[g])}),f}_createControl(c){if(c instanceof wt)return c;if(c instanceof nd)return c;if(Array.isArray(c)){let f=c[0],g=c.length>1?c[1]:null,x=c.length>2?c[2]:null;return this.control(f,g,x)}else return this.control(c)}};a.\u0275fac=function(f){return new(f||a)},a.\u0275prov=gt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();var lr=(()=>{let a=class a{static withConfig(c){return{ngModule:a,providers:[{provide:Nk,useValue:c.warnOnNgModelWithFormControl??"always"},{provide:kk,useValue:c.callSetDisabledState??gC}]}}};a.\u0275fac=function(f){return new(f||a)},a.\u0275mod=ss({type:a}),a.\u0275inj=os({imports:[uW]});let s=a;return s})();var id=(()=>{let a=class a{constructor(c,f){this.document=c,this.platformId=f,this.documentIsAccessible=rF(this.platformId)}static getCookieRegExp(c){let f=c.replace(/([\[\]{}()|=;+?,.*^$])/gi,"\\$1");return new RegExp("(?:^"+f+"|;\\s*"+f+")=(.*?)(?:;|$)","g")}static safeDecodeURIComponent(c){try{return decodeURIComponent(c)}catch{return c}}check(c){return this.documentIsAccessible?(c=encodeURIComponent(c),a.getCookieRegExp(c).test(this.document.cookie)):!1}get(c){if(this.documentIsAccessible&&this.check(c)){c=encodeURIComponent(c);let g=a.getCookieRegExp(c).exec(this.document.cookie);return g[1]?a.safeDecodeURIComponent(g[1]):""}else return""}getAll(){if(!this.documentIsAccessible)return{};let c={},f=this.document;return f.cookie&&f.cookie!==""&&f.cookie.split(";").forEach(g=>{let[x,T]=g.split("=");c[a.safeDecodeURIComponent(x.replace(/^ /,""))]=a.safeDecodeURIComponent(T)}),c}set(c,f,g,x,T,P,O,Z){if(!this.documentIsAccessible)return;if(typeof g=="number"||g instanceof Date||x||T||P||O){let Ee={expires:g,path:x,domain:T,secure:P,sameSite:O||"Lax",partitioned:Z};this.set(c,f,Ee);return}let ee=encodeURIComponent(c)+"="+encodeURIComponent(f)+";",ce=g||{};if(ce.expires)if(typeof ce.expires=="number"){let Ee=new Date(new Date().getTime()+ce.expires*1e3*60*60*24);ee+="expires="+Ee.toUTCString()+";"}else ee+="expires="+ce.expires.toUTCString()+";";ce.path&&(ee+="path="+ce.path+";"),ce.domain&&(ee+="domain="+ce.domain+";"),ce.secure===!1&&ce.sameSite==="None"&&(ce.secure=!0,console.warn(`[ngx-cookie-service] Cookie ${c} was forced with secure flag because sameSite=None.More details : https://github.com/stevermeister/ngx-cookie-service/issues/86#issuecomment-597720130`)),ce.secure&&(ee+="secure;"),ce.sameSite||(ce.sameSite="Lax"),ee+="sameSite="+ce.sameSite+";",ce.partitioned&&(ee+="Partitioned;"),this.document.cookie=ee}delete(c,f,g,x,T="Lax"){if(!this.documentIsAccessible)return;let P=new Date("Thu, 01 Jan 1970 00:00:01 GMT");this.set(c,"",{expires:P,path:f,domain:g,secure:x,sameSite:T})}deleteAll(c,f,g,x="Lax"){if(!this.documentIsAccessible)return;let T=this.getAll();for(let P in T)T.hasOwnProperty(P)&&this.delete(P,c,f,g,x)}};a.\u0275fac=function(f){return new(f||a)(vt(gr),vt(Os))},a.\u0275prov=gt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();var dW=new zt("JWT_OPTIONS"),Ef=(()=>{class s{constructor(d=null){this.tokenGetter=d&&d.tokenGetter||function(){}}urlBase64Decode(d){let c=d.replace(/-/g,"+").replace(/_/g,"/");switch(c.length%4){case 0:break;case 2:{c+="==";break}case 3:{c+="=";break}default:throw new Error("Illegal base64url string!")}return this.b64DecodeUnicode(c)}b64decode(d){let c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",f="";if(d=String(d).replace(/=+$/,""),d.length%4===1)throw new Error("'atob' failed: The string to be decoded is not correctly encoded.");for(let g=0,x,T,P=0;T=d.charAt(P++);~T&&(x=g%4?x*64+T:T,g++%4)?f+=String.fromCharCode(255&x>>(-2*g&6)):0)T=c.indexOf(T);return f}b64DecodeUnicode(d){return decodeURIComponent(Array.prototype.map.call(this.b64decode(d),c=>"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2)).join(""))}decodeToken(d=this.tokenGetter()){return d instanceof Promise?d.then(c=>this._decodeToken(c)):this._decodeToken(d)}_decodeToken(d){if(!d||d==="")return null;let c=d.split(".");if(c.length!==3)throw new Error("The inspected token doesn't appear to be a JWT. Check to make sure it has three parts and see https://jwt.io for more.");let f=this.urlBase64Decode(c[1]);if(!f)throw new Error("Cannot decode the token.");return JSON.parse(f)}getTokenExpirationDate(d=this.tokenGetter()){return d instanceof Promise?d.then(c=>this._getTokenExpirationDate(c)):this._getTokenExpirationDate(d)}_getTokenExpirationDate(d){let c;if(c=this.decodeToken(d),!c||!c.hasOwnProperty("exp"))return null;let f=new Date(0);return f.setUTCSeconds(c.exp),f}isTokenExpired(d=this.tokenGetter(),c){return d instanceof Promise?d.then(f=>this._isTokenExpired(f,c)):this._isTokenExpired(d,c)}_isTokenExpired(d,c){if(!d||d==="")return!0;let f=this.getTokenExpirationDate(d);return c=c||0,f===null?!1:!(f.valueOf()>new Date().valueOf()+c*1e3)}getAuthScheme(d,c){return typeof d=="function"?d(c):d}}return s.\u0275fac=function(d){return new(d||s)(vt(dW))},s.\u0275prov=gt({token:s,factory:s.\u0275fac}),s})();var tr={mapbox:{accessToken:"pk.eyJ1Ijoibm9lbGJhbG1pcyIsImEiOiJjbHNhZTNqbmswMnVlMmpvMWxiYTIwN2xwIn0.S0Cho6IO0XV7wvhE7v68sQ"},server:{ip:"http://localhost",port:"9000"}};var rn=(()=>{let a=class a{constructor(c,f){this.cookieService=c,this.http=f,this.baseUrl=tr.server.ip+":"+tr.server.port}login(c){return this.http.post(`${this.baseUrl}/login`,c)}register(c){return this.http.post(`${this.baseUrl}/usuarios`,c)}edit(c,f){return this.http.put(`${this.baseUrl}/usuarios/${c}`,f).pipe(ot(g=>g))}logout(){this.cookieService.delete("token")}getUserIdFromToken(){let c=this.cookieService.get("token");return c?new Ef().decodeToken(c).sub:-1}getUserTypeFromToken(){let c=this.cookieService.get("token");return c?new Ef().decodeToken(c).Tipo:"Error"}isAdmin(){let c=this.cookieService.get("token");return c?new Ef().decodeToken(c).Rol==="Admin":!1}isLogged(){let c=this.cookieService.get("token");if(c){let f=new Ef,g=f.decodeToken(c);return!f.isTokenExpired(c)&&g.sub!==void 0}return!1}getUserById(c){return this.http.get(`${this.baseUrl}/usuarios/${c}`).pipe(ot(f=>f))}sendRegisterCompleteEmail(c){let f=`${this.baseUrl}/contacto/enviarRegistro`;return this.http.post(f,c)}isEmailInDB(c){let f=new rr().set("email",c);return this.http.get(`${this.baseUrl}/usuarios/username`,{params:f}).pipe(ot(g=>g))}passwordRecovery(c){let f=`${this.baseUrl}/contacto/passwordRecovery`;return this.http.post(f,c)}editPasswordByEmail(c,f){let g=`${this.baseUrl}/usuarios/password/${c}`,x={password:f};return this.http.put(g,x).pipe(ot(T=>T))}};a.\u0275fac=function(f){return new(f||a)(vt(id),vt(_o))},a.\u0275prov=gt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();function hW(s,a){s&1&&(U(0,"span",14),K(1," Introduce un correo electr\xF3nico v\xE1lido. "),j())}function fW(s,a){s&1&&(U(0,"span",14),K(1," Introduce la contrase\xF1a. "),j())}function pW(s,a){if(s&1&&(U(0,"span",15),K(1),j()),s&2){let d=Re();he(),Yn(d.errorMensaje)}}var $k=s=>({"is-invalid":s}),Gk=(()=>{let a=class a{constructor(c,f,g,x){this.userService=c,this.cookieService=f,this.location=g,this.router=x,this.institucion="",this.errorMensaje="",this.form=new vr({username:new wt("",[un.required,un.pattern("^[a-zA-Z0-9._%+-]+@[a-z0-9.-]+\\.[a-z]{2,4}$")]),password:new wt("",un.required)})}back(){this.location.back()}loguearUsuario(){this.form.value.username=this.form.value.username?.toLowerCase(),this.userService.login(this.form.value).subscribe(c=>{this.cookieService.set("token",c.token),this.router.navigate(["/"],{queryParams:{reload:"true"}})},c=>{console.error("Error al iniciar sesi\xF3n:",c),this.errorMensaje="Error al iniciar sesi\xF3n. Por favor, verifica tus credenciales."})}};a.\u0275fac=function(f){return new(f||a)(qe(rn),qe(id),qe(_r),qe(jo))},a.\u0275cmp=tn({type:a,selectors:[["app-login"]],standalone:!0,features:[cn([rn,id]),nn],decls:21,vars:11,consts:[[1,"container","d-flex","flex-col","vh-100","justify-content-center","align-items-center"],[1,"login-card"],[1,"top"],["src","/assets/banner.png","alt","VoluntApp banner"],[1,"form",3,"formGroup","submit"],["type","email","placeholder","Correo electr\xF3nico","formControlName","username",3,"ngClass"],["class","invalid-feedback",4,"ngIf"],["type","password","placeholder","Contrase\xF1a","formControlName","password",3,"ngClass"],["class","error-message",4,"ngIf"],["href","/register"],["href","/forgetpassword"],[1,"d-flex","gap-2","mt-auto"],["type","button",1,"px-4","btn","btn-outline-primary",3,"click"],["type","submit",1,"btn","btn-secondary","derecha",3,"disabled"],[1,"invalid-feedback"],[1,"error-message"]],template:function(f,g){if(f&1&&(U(0,"main",0)(1,"div",1)(2,"div",2),De(3,"img",3),j(),U(4,"form",4),je("submit",function(){return g.loguearUsuario()}),U(5,"h1"),K(6,"Iniciar sesi\xF3n"),j(),De(7,"input",5),Je(8,hW,2,0,"span",6),De(9,"input",7),Je(10,fW,2,0,"span",6)(11,pW,2,1,"span",8),U(12,"a",9),K(13,"\xBFNo tienes una cuenta?"),j(),U(14,"a",10),K(15,"\xBFHas olvidado tu contrase\xF1a?"),j(),U(16,"div",11)(17,"button",12),je("click",function(){return g.back()}),K(18,"\u2190"),j(),U(19,"button",13),K(20,"Entrar"),j()()()()()),f&2){let x,T,P,O;he(4),ke("formGroup",g.form),he(3),ke("ngClass",Un(7,$k,((x=g.form.get("username"))==null?null:x.invalid)&&(((x=g.form.get("username"))==null?null:x.touched)||((x=g.form.get("username"))==null?null:x.dirty)))),he(),ke("ngIf",((T=g.form.get("username"))==null?null:T.invalid)&&(((T=g.form.get("username"))==null?null:T.touched)||((T=g.form.get("username"))==null?null:T.dirty))),he(),ke("ngClass",Un(9,$k,((P=g.form.get("password"))==null?null:P.invalid)&&(((P=g.form.get("password"))==null?null:P.touched)||((P=g.form.get("password"))==null?null:P.dirty)))),he(),ke("ngIf",((O=g.form.get("password"))==null?null:O.invalid)&&(((O=g.form.get("password"))==null?null:O.touched)||((O=g.form.get("password"))==null?null:O.dirty))),he(),ke("ngIf",g.errorMensaje),he(8),ke("disabled",g.form.invalid)}},dependencies:[lr,ar,Wi,or,sr,Qi,er,ul,cl],styles:["main[_ngcontent-%COMP%]{margin-top:0;margin-bottom:0}.login-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem;width:25rem;border-radius:10px;background-color:#fff;padding:2rem 4rem;box-shadow:#00000059 0 5px 15px}.login-card[_ngcontent-%COMP%]   .top[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.login-card[_ngcontent-%COMP%]   .top[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:14rem}.login-card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.login-card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:20px;font-weight:700}.login-card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:.5rem 1rem;font-size:14px;border:1px solid #966DAF;border-radius:5px}.login-card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{border:1px solid #A4C957;outline:none}.login-card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{font-size:12px;color:#343434}.login-card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#966daf}.login-card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border:none;border-radius:5px;background-color:#7d4e99;padding:.5rem 0rem;color:#fff;margin-top:1.5rem}.login-card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .derecha[_ngcontent-%COMP%]{width:100%}.login-card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:red;font-size:12px}is-invalid[_ngcontent-%COMP%]{border:1px solid red}.invalid-feedback[_ngcontent-%COMP%]{color:red;font-size:12px;margin-top:0}"]});let s=a;return s})();var Uo=(()=>{let a=class a{constructor(c){this.http=c,this.baseUrl=tr.server.ip+":"+tr.server.port}register(c){return this.http.post(`${this.baseUrl}/instituciones`,c)}sendRegisterCompleteEmail(c){let f=`${this.baseUrl}/contacto/enviarRegistro`;return this.http.post(f,c)}getInstitucionById(c){return this.http.get(`${this.baseUrl}/instituciones/${c}`).pipe(ot(f=>f))}};a.\u0275fac=function(f){return new(f||a)(vt(_o))},a.\u0275prov=gt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();function mW(s,a){s&1&&(U(0,"span",19),K(1," Este campo no puede estar en blanco. "),j())}function gW(s,a){s&1&&(U(0,"span",19),K(1," Este campo no puede estar en blanco. "),j())}var Ir=s=>({"is-invalid":s});function _W(s,a){if(s&1&&(De(0,"input",16),Je(1,mW,2,0,"span",17),De(2,"input",18),Je(3,gW,2,0,"span",17)),s&2){let d=Re(2),c,f,g,x;ke("ngClass",Un(4,Ir,((c=d.formInstitucion.get("nombre"))==null?null:c.invalid)&&(((c=d.formInstitucion.get("nombre"))==null?null:c.touched)||((c=d.formInstitucion.get("nombre"))==null?null:c.dirty)))),he(),ke("ngIf",((f=d.formInstitucion.get("nombre"))==null?null:f.invalid)&&(((f=d.formInstitucion.get("nombre"))==null?null:f.touched)||((f=d.formInstitucion.get("nombre"))==null?null:f.dirty))),he(),ke("ngClass",Un(6,Ir,((g=d.formInstitucion.get("nombreLegal"))==null?null:g.invalid)&&(((g=d.formInstitucion.get("nombreLegal"))==null?null:g.touched)||((g=d.formInstitucion.get("nombreLegal"))==null?null:g.dirty)))),he(),ke("ngIf",((x=d.formInstitucion.get("nombreLegal"))==null?null:x.invalid)&&(((x=d.formInstitucion.get("nombreLegal"))==null?null:x.touched)||((x=d.formInstitucion.get("nombreLegal"))==null?null:x.dirty)))}}function yW(s,a){s&1&&(U(0,"span",19),K(1," Este campo no puede estar en blanco. "),j())}function vW(s,a){s&1&&(U(0,"span",19),K(1," Este campo no puede estar en blanco. "),j())}function xW(s,a){if(s&1&&(De(0,"input",20),Je(1,yW,2,0,"span",17),De(2,"input",21),Je(3,vW,2,0,"span",17)),s&2){let d=Re(2),c,f,g,x;ke("ngClass",Un(4,Ir,((c=d.formUsuario.get("nombre"))==null?null:c.invalid)&&(((c=d.formUsuario.get("nombre"))==null?null:c.touched)||((c=d.formUsuario.get("nombre"))==null?null:c.dirty)))),he(),ke("ngIf",((f=d.formUsuario.get("nombre"))==null?null:f.invalid)&&(((f=d.formUsuario.get("nombre"))==null?null:f.touched)||((f=d.formUsuario.get("nombre"))==null?null:f.dirty))),he(),ke("ngClass",Un(6,Ir,((g=d.formUsuario.get("apellidos"))==null?null:g.invalid)&&(((g=d.formUsuario.get("apellidos"))==null?null:g.touched)||((g=d.formUsuario.get("apellidos"))==null?null:g.dirty)))),he(),ke("ngIf",((x=d.formUsuario.get("apellidos"))==null?null:x.invalid)&&(((x=d.formUsuario.get("apellidos"))==null?null:x.touched)||((x=d.formUsuario.get("apellidos"))==null?null:x.dirty)))}}function bW(s,a){if(s&1){let d=Dn();U(0,"header",5)(1,"h1"),K(2,"Reg\xEDstrate"),j(),U(3,"ul",6)(4,"a",7),je("click",function(){xt(d);let f=Re();return bt(f.primeraPagina())}),K(5,"1"),j(),U(6,"a",8),je("click",function(){xt(d);let f=Re();return bt(f.segundaPagina())}),K(7,"2"),j(),U(8,"a",8),je("click",function(){xt(d);let f=Re();return bt(f.terceraPagina())}),K(9,"3"),j()()(),U(10,"select",9,10),je("change",function(){xt(d);let f=s_(11),g=Re();return bt(g.cambiarform(f.value))}),U(12,"option",11),K(13,"Voluntario"),j(),U(14,"option",12),K(15,"Institucion"),j()(),Je(16,_W,4,8)(17,xW,4,8),U(18,"div",13)(19,"button",14),je("click",function(){xt(d);let f=Re();return bt(f.back())}),K(20,"\u2190"),j(),U(21,"button",15),je("click",function(){xt(d);let f=Re();return bt(f.siguientePagina())}),K(22,"Siguiente"),j()()}if(s&2){let d=Re();he(12),ke("selected",!d.institucion),he(2),ke("selected",d.institucion),he(2),Pt(16,d.institucion===!0?16:17)}}function wW(s,a){s&1&&(U(0,"span",19),K(1," El CIF debe tener un formato v\xE1lido. "),j())}function CW(s,a){s&1&&(U(0,"span",19),K(1," Este campo no puede estar vac\xEDo. "),j())}function EW(s,a){s&1&&(U(0,"span",19),K(1," Este campo no puede estar vac\xEDo. "),j())}function TW(s,a){if(s&1){let d=Dn();U(0,"input",22),je("input",function(){xt(d);let f=Re(2);return bt(f.convertirAMayusculas(f))}),j(),Je(1,wW,2,0,"span",17),De(2,"input",23),Je(3,CW,2,0,"span",17),De(4,"input",24),Je(5,EW,2,0,"span",17)}if(s&2){let d=Re(2),c,f,g,x,T,P;ke("ngClass",Un(6,Ir,((c=d.formInstitucion.get("cif"))==null?null:c.invalid)&&(((c=d.formInstitucion.get("cif"))==null?null:c.touched)||((c=d.formInstitucion.get("cif"))==null?null:c.dirty)))),he(),ke("ngIf",((f=d.formInstitucion.get("cif"))==null?null:f.invalid)&&(((f=d.formInstitucion.get("cif"))==null?null:f.touched)||((f=d.formInstitucion.get("cif"))==null?null:f.dirty))),he(),ke("ngClass",Un(8,Ir,((g=d.formInstitucion.get("personaCargo"))==null?null:g.invalid)&&(((g=d.formInstitucion.get("personaCargo"))==null?null:g.touched)||((g=d.formInstitucion.get("personaCargo"))==null?null:g.dirty)))),he(),ke("ngIf",((x=d.formInstitucion.get("personaCargo"))==null?null:x.invalid)&&(((x=d.formInstitucion.get("personaCargo"))==null?null:x.touched)||((x=d.formInstitucion.get("personaCargo"))==null?null:x.dirty))),he(),ke("ngClass",Un(10,Ir,((T=d.formInstitucion.get("telefono"))==null?null:T.invalid)&&(((T=d.formInstitucion.get("telefono"))==null?null:T.touched)||((T=d.formInstitucion.get("telefono"))==null?null:T.dirty)))),he(),ke("ngIf",((P=d.formInstitucion.get("telefono"))==null?null:P.invalid)&&(((P=d.formInstitucion.get("telefono"))==null?null:P.touched)||((P=d.formInstitucion.get("telefono"))==null?null:P.dirty)))}}function IW(s,a){s&1&&(U(0,"span",19),K(1," El DNI debe tener un formato v\xE1lido. "),j())}function MW(s,a){s&1&&(U(0,"span",19),K(1," Este campo no puede estar vac\xEDo. "),j())}function DW(s,a){s&1&&(U(0,"span",19),K(1," Este campo no puede estar vac\xEDo. "),j())}function SW(s,a){if(s&1){let d=Dn();U(0,"input",25),je("input",function(){xt(d);let f=Re(2);return bt(f.convertirAMayusculas(f))}),j(),Je(1,IW,2,0,"span",17),De(2,"input",26),Je(3,MW,2,0,"span",17),De(4,"input",27),Je(5,DW,2,0,"span",17)}if(s&2){let d=Re(2),c,f,g,x,T,P;ke("ngClass",Un(6,Ir,((c=d.formUsuario.get("dni"))==null?null:c.invalid)&&(((c=d.formUsuario.get("dni"))==null?null:c.touched)||((c=d.formUsuario.get("dni"))==null?null:c.dirty)))),he(),ke("ngIf",((f=d.formUsuario.get("dni"))==null?null:f.invalid)&&(((f=d.formUsuario.get("dni"))==null?null:f.touched)||((f=d.formUsuario.get("dni"))==null?null:f.dirty))),he(),ke("ngClass",Un(8,Ir,((g=d.formUsuario.get("telefono"))==null?null:g.invalid)&&(((g=d.formUsuario.get("telefono"))==null?null:g.touched)||((g=d.formUsuario.get("telefono"))==null?null:g.dirty)))),he(),ke("ngIf",((x=d.formUsuario.get("telefono"))==null?null:x.invalid)&&(((x=d.formUsuario.get("telefono"))==null?null:x.touched)||((x=d.formUsuario.get("telefono"))==null?null:x.dirty))),he(),ke("ngClass",Un(10,Ir,((T=d.formUsuario.get("direccion"))==null?null:T.invalid)&&(((T=d.formUsuario.get("direccion"))==null?null:T.touched)||((T=d.formUsuario.get("direccion"))==null?null:T.dirty)))),he(),ke("ngIf",((P=d.formUsuario.get("direccion"))==null?null:P.invalid)&&(((P=d.formUsuario.get("direccion"))==null?null:P.touched)||((P=d.formUsuario.get("direccion"))==null?null:P.dirty)))}}function AW(s,a){if(s&1){let d=Dn();U(0,"header",5)(1,"h1"),K(2,"Reg\xEDstrate"),j(),U(3,"ul",6)(4,"a",8),je("click",function(){xt(d);let f=Re();return bt(f.primeraPagina())}),K(5,"1"),j(),U(6,"a",7),je("click",function(){xt(d);let f=Re();return bt(f.segundaPagina())}),K(7,"2"),j(),U(8,"a",8),je("click",function(){xt(d);let f=Re();return bt(f.terceraPagina())}),K(9,"3"),j()()(),Je(10,TW,6,12)(11,SW,6,12),U(12,"div",13)(13,"button",14),je("click",function(){xt(d);let f=Re();return bt(f.anteriorPagina())}),K(14,"\u2190"),j(),U(15,"button",15),je("click",function(){xt(d);let f=Re();return bt(f.siguientePagina())}),K(16,"Siguiente"),j()()}if(s&2){let d=Re();he(10),Pt(10,d.institucion===!0?10:11)}}function PW(s,a){s&1&&(U(0,"span",19),K(1," Introduce un correo electr\xF3nico v\xE1lido. "),j())}function RW(s,a){s&1&&(U(0,"span",19),K(1," Este campo no puede estar vac\xEDo. "),j())}function OW(s,a){s&1&&(U(0,"span",19),K(1," Las contrase\xF1as no coinciden. "),j())}function FW(s,a){if(s&1){let d=Dn();De(0,"input",29),Je(1,PW,2,0,"span",17),U(2,"input",30),je("input",function(){xt(d);let f=Re(2);return bt(f.validarConfirmacion())}),j(),Je(3,RW,2,0,"span",17),U(4,"input",31),je("input",function(){xt(d);let f=Re(2);return bt(f.validarConfirmacion())})("blur",function(){xt(d);let f=Re(2);return bt(f.validarConfirmacion())}),j(),Je(5,OW,2,0,"span",17)}if(s&2){let d=Re(2),c,f,g,x,T;ke("ngClass",Un(6,Ir,((c=d.formInstitucion.get("email"))==null?null:c.invalid)&&(((c=d.formInstitucion.get("email"))==null?null:c.touched)||((c=d.formInstitucion.get("email"))==null?null:c.dirty)))),he(),ke("ngIf",((f=d.formInstitucion.get("email"))==null?null:f.invalid)&&(((f=d.formInstitucion.get("email"))==null?null:f.touched)||((f=d.formInstitucion.get("email"))==null?null:f.dirty))),he(),ke("ngClass",Un(8,Ir,((g=d.formInstitucion.get("password"))==null?null:g.invalid)&&(((g=d.formInstitucion.get("password"))==null?null:g.touched)||((g=d.formInstitucion.get("password"))==null?null:g.dirty)))),he(),ke("ngIf",((x=d.formInstitucion.get("password"))==null?null:x.invalid)&&(((x=d.formInstitucion.get("password"))==null?null:x.touched)||((x=d.formInstitucion.get("password"))==null?null:x.dirty))),he(),ke("ngClass",Un(10,Ir,d.contrasenaConfirmadaInvalida)),he(),ke("ngIf",d.contrasenaConfirmadaInvalida&&((T=d.formInstitucion.get("password"))==null?null:T.touched))}}function kW(s,a){s&1&&(U(0,"span",19),K(1," Introduce un correo electr\xF3nico v\xE1lido. "),j())}function LW(s,a){s&1&&(U(0,"span",19),K(1," Este campo no puede estar vac\xEDo. "),j())}function NW(s,a){s&1&&(U(0,"span",19),K(1," Las contrase\xF1as no coinciden. "),j())}function zW(s,a){if(s&1){let d=Dn();De(0,"input",32),Je(1,kW,2,0,"span",17),U(2,"input",33),je("input",function(){xt(d);let f=Re(2);return bt(f.validarConfirmacion())}),j(),Je(3,LW,2,0,"span",17),U(4,"input",31),je("input",function(){xt(d);let f=Re(2);return bt(f.validarConfirmacion())})("blur",function(){xt(d);let f=Re(2);return bt(f.validarConfirmacion())}),j(),Je(5,NW,2,0,"span",17)}if(s&2){let d=Re(2),c,f,g,x,T;ke("ngClass",Un(6,Ir,((c=d.formUsuario.get("email"))==null?null:c.invalid)&&(((c=d.formUsuario.get("email"))==null?null:c.touched)||((c=d.formUsuario.get("email"))==null?null:c.dirty)))),he(),ke("ngIf",((f=d.formUsuario.get("email"))==null?null:f.invalid)&&(((f=d.formUsuario.get("email"))==null?null:f.touched)||((f=d.formUsuario.get("email"))==null?null:f.dirty))),he(),ke("ngClass",Un(8,Ir,((g=d.formUsuario.get("contrase\xF1a"))==null?null:g.invalid)&&(((g=d.formUsuario.get("contrase\xF1a"))==null?null:g.touched)||((g=d.formUsuario.get("contrase\xF1a"))==null?null:g.dirty)))),he(),ke("ngIf",((x=d.formUsuario.get("contrase\xF1a"))==null?null:x.invalid)&&(((x=d.formUsuario.get("contrase\xF1a"))==null?null:x.touched)||((x=d.formUsuario.get("contrase\xF1a"))==null?null:x.dirty))),he(),ke("ngClass",Un(10,Ir,d.contrasenaConfirmadaInvalida)),he(),ke("ngIf",d.contrasenaConfirmadaInvalida&&((T=d.formUsuario.get("contrase\xF1a"))==null?null:T.touched))}}function BW(s,a){if(s&1){let d=Dn();U(0,"header",5)(1,"h1"),K(2,"Reg\xEDstrate"),j(),U(3,"ul",6)(4,"a",8),je("click",function(){xt(d);let f=Re();return bt(f.primeraPagina())}),K(5,"1"),j(),U(6,"a",8),je("click",function(){xt(d);let f=Re();return bt(f.segundaPagina())}),K(7,"2"),j(),U(8,"a",7),je("click",function(){xt(d);let f=Re();return bt(f.terceraPagina())}),K(9,"3"),j()()(),Je(10,FW,6,12)(11,zW,6,12),U(12,"div",13)(13,"button",14),je("click",function(){xt(d);let f=Re();return bt(f.anteriorPagina())}),K(14,"\u2190"),j(),U(15,"button",28),K(16,"Registrarse"),j()()}if(s&2){let d=Re();he(10),Pt(10,d.institucion===!0?10:11),he(5),ke("disabled",d.formInstitucion.invalid&&d.formUsuario.invalid||d.contrasenaConfirmadaInvalida==!0)}}var Hk=(()=>{let a=class a{constructor(c,f,g,x){this.userService=c,this.institucionService=f,this.location=g,this.router=x,this.cifPattern=/^[A-Z]{1}[0-9]{8}$/,this.contrasenaConfirmadaInvalida=!1,this.institucion=!1,this.formUsuario=new vr({nombre:new wt("",un.required),apellidos:new wt("",un.required),dni:new wt("",un.required),telefono:new wt("",un.required),direccion:new wt("",un.required),email:new wt("",un.required),contrase\u00F1a:new wt("",un.required)}),this.formInstitucion=new vr({nombre:new wt("",un.required),cif:new wt("",[un.required,un.pattern(this.cifPattern)]),personaCargo:new wt("",un.required),email:new wt("",un.required),password:new wt("",un.required),telefono:new wt("",un.required),nombreLegal:new wt("",un.required)}),this.pagina=1}back(){this.location.back()}siguientePagina(){this.pagina++}anteriorPagina(){this.pagina--}primeraPagina(){this.pagina=1}segundaPagina(){this.pagina=2}terceraPagina(){this.pagina=3}cambiarform(c){this.institucion=!0,c==="institucion"?(this.institucion=!0,this.formUsuario.reset()):(this.institucion=!1,this.formInstitucion.reset())}convertirAMayusculas(c){c.target.value=c.target.value.toUpperCase()}validarConfirmacion(){if(this.institucion){let c=this.formInstitucion.get("password")?.value,f=document.querySelector('[placeholder="Confirmar contrase\xF1a"]').value;c!==f?this.contrasenaConfirmadaInvalida=!0:this.contrasenaConfirmadaInvalida=!1}else{let c=this.formUsuario.get("contrase\xF1a")?.value,f=document.querySelector('[placeholder="Confirmar contrase\xF1a"]').value;c!==f?this.contrasenaConfirmadaInvalida=!0:this.contrasenaConfirmadaInvalida=!1}}handleSubmit(){this.institucion?(this.crearInstitucion(),this.router.navigate(["/login"])):(this.crearUsuario(),this.router.navigate(["/login"]))}crearUsuario(){this.userService.register(this.formUsuario.value).subscribe(()=>{let c=this.formUsuario.value.email;this.userService.sendRegisterCompleteEmail({email:c,asunto:"\xA1Registro completado! \u{1F389}",mensaje:"\xA1Bienvenido a Voluntapp!\u{1F604}\u{1F389} Tu registro se ha completado con \xE9xito."}).subscribe(f=>{alert("Registro exitoso\u{1F389}, revisa tu correo para confirmar tu cuenta."),console.log(f)})})}crearInstitucion(){console.log(this.formInstitucion.value),this.institucionService.register(this.formInstitucion.value).subscribe()}};a.\u0275fac=function(f){return new(f||a)(qe(rn),qe(Uo),qe(_r),qe(jo))},a.\u0275cmp=tn({type:a,selectors:[["app-register"]],standalone:!0,features:[cn([rn,Uo]),nn],decls:8,vars:4,consts:[[1,"d-flex","flex-col","vh-100","justify-content-center","align-items-center"],[1,"login-card"],[1,"top"],["src","/assets/banner.png","alt","VoluntApp banner"],[1,"form",3,"formGroup","submit"],[1,"d-flex","justify-content-between"],[1,"paginas"],[1,"select",3,"click"],[3,"click"],[3,"change"],["opcion",""],["value","voluntario",3,"selected"],["value","institucion",3,"selected"],[1,"d-flex","gap-2","mt-auto"],[1,"px-4","btn","btn-outline-primary",3,"click"],[1,"w-100",3,"click"],["type","text","placeholder","Nombre a mostrar","formControlName","nombre",3,"ngClass"],["class","invalid-feedback",4,"ngIf"],["type","text","placeholder","Nombre legal","formControlName","nombreLegal",3,"ngClass"],[1,"invalid-feedback"],["type","text","formControlName","nombre","placeholder","Nombre",3,"ngClass"],["type","text","formControlName","apellidos","placeholder","Apellidos",3,"ngClass"],["type","text","placeholder","CIF instituci\xF3n","formControlName","cif","maxlength","9",3,"ngClass","input"],["type","text","placeholder","Nombre de la persona a cargo","formControlName","personaCargo",3,"ngClass"],["type","text","placeholder","Tel\xE9fono de la persona a cargo","formControlName","telefono","minlength","9","maxlength","9","pattern","[0-9]*","inputmode","numeric",3,"ngClass"],["type","text","formControlName","dni","placeholder","DNI","pattern","[0-9]{8}[a-zA-Z]","maxlength","9",3,"ngClass","input"],["type","text","formControlName","telefono","placeholder","Tel\xE9fono","minlength","9","maxlength","9","pattern","[0-9]*","inputmode","numeric",3,"ngClass"],["type","text","formControlName","direccion","placeholder","Direcci\xF3n",3,"ngClass"],["type","submit",1,"btn","btn-secondary","derecha",3,"disabled"],["type","email","placeholder","email","formControlName","email","pattern","[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,4}",3,"ngClass"],["type","password","placeholder","Contrase\xF1a","formControlName","password",3,"ngClass","input"],["type","password","placeholder","Confirmar contrase\xF1a","required","",3,"ngClass","input","blur"],["type","text","formControlName","email","placeholder","Correo electr\xF3nico","pattern","[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,4}",3,"ngClass"],["type","password","formControlName","contrase\xF1a","placeholder","Contrase\xF1a",3,"ngClass","input"]],template:function(f,g){f&1&&(U(0,"main",0)(1,"div",1)(2,"div",2),De(3,"img",3),j(),U(4,"form",4),je("submit",function(){return g.handleSubmit()}),Je(5,bW,23,3)(6,AW,17,1)(7,BW,17,2),j()()()),f&2&&(he(4),ke("formGroup",g.institucion?g.formInstitucion:g.formUsuario),he(),Pt(5,g.pagina===1?5:-1),he(),Pt(6,g.pagina===2?6:-1),he(),Pt(7,g.pagina===3?7:-1))},dependencies:[lr,ar,ry,oy,Wi,or,sr,bf,wf,Cf,Qi,er,ul,cl],styles:["main[_ngcontent-%COMP%]{margin-top:0;margin-bottom:0}.login-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem;width:25rem;border-radius:10px;background-color:#fff;padding:2rem 4rem;box-shadow:#00000059 0 5px 15px}.login-card[_ngcontent-%COMP%]   .top[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.login-card[_ngcontent-%COMP%]   .top[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:14rem}.login-card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]{display:flex;flex-direction:column;height:100%;gap:.5rem}.login-card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .paginas[_ngcontent-%COMP%]{display:flex;gap:.75rem;list-style:none}.login-card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .paginas[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;border:1px solid #7D4E99;border-radius:50%;width:1.5rem;height:1.5rem;font-size:smaller;color:#966daf;text-decoration:none}.login-card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .paginas[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{background-color:#966daf;color:#fff;cursor:pointer}.login-card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .paginas[_ngcontent-%COMP%]   .select[_ngcontent-%COMP%]{background-color:#7d4e99;color:#fff}.login-card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:20px;font-weight:700}.login-card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]{padding:.5rem 1rem;font-size:14px;border:1px solid #966DAF;border-radius:5px;color:#343434}.login-card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   select[_ngcontent-%COMP%]:focus{border:1px solid #A4C957;outline:none}.login-card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:.5rem 1rem;font-size:14px;border:1px solid #966DAF;border-radius:5px}.login-card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{border:1px solid #A4C957;outline:none}.login-card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border:none;border-radius:5px;background-color:#7d4e99;padding:.5rem 0rem;color:#fff;transition:all .2s linear}.login-card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]:hover{background-color:#523066}.login-card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .derecha[_ngcontent-%COMP%]{width:100%}.login-card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:red;font-size:12px}is-invalid[_ngcontent-%COMP%]{border:1px solid red}.invalid-feedback[_ngcontent-%COMP%]{color:red;font-size:12px;margin-top:0}"]});let s=a;return s})();var mi=(()=>{let a=class a{constructor(c){this.http=c,this.baseUrl=tr.server.ip+":"+tr.server.port}createEvent(c){return this.http.post(`${this.baseUrl}/eventos`,c)}getEvents(c){let f=new rr;return c!==void 0&&(f=f.set("page",c.toString())),this.http.get(`${this.baseUrl}/eventos`,{params:f}).pipe(ot(g=>g))}getEventsBySearchQuery(c,f){let g=new rr;return f!==void 0&&(g=g.set("page",f.toString())),this.http.get(`${this.baseUrl}/eventos/buscar/${c}`,{params:g}).pipe(ot(x=>x))}getEventsByState(c,f){let g=new rr;return f!==void 0&&(g=g.set("page",f.toString())),this.http.get(`${this.baseUrl}/eventos/buscaporestado/${c}`,{params:g}).pipe(ot(x=>(console.log(x),x)))}getEventsOrderByDate(c){let f=new rr;return c!==void 0&&(f=f.set("page",c.toString())),this.http.get(`${this.baseUrl}/eventos/ordenarporfecha`,{params:f}).pipe(ot(g=>g))}getEventsByDateFilter(c,f,g){let x=new rr;return g!==void 0&&(x=x.set("page",g.toString())),this.http.get(`${this.baseUrl}/eventos/disponibles-entre-fechas/${c}T00:00/${f}T00:00`,{params:x}).pipe(ot(T=>T))}getEventsByLocationFilter(c,f){let g=new rr;return f!==void 0&&(g=g.set("page",f.toString())),this.http.get(`${this.baseUrl}/eventos/ubicacion/disponibles/${c}`,{params:g}).pipe(ot(x=>x))}getEventByDateAndLocationFilter(c,f,g,x){let T=new rr;return x!==void 0&&(T=T.set("page",x.toString())),this.http.get(`${this.baseUrl}/eventos/disponibles-entre-fechas-y-ubicacion/${c}T00:00/${f}T00:00/${g}`,{params:T}).pipe(ot(P=>P))}updateEventState(c,f){let g=f;return this.http.put(`${this.baseUrl}/eventos/${c}/estado`,g)}getEventsByUser(c){return this.http.get(`${this.baseUrl}/eventos/usuario/${c}`).pipe(ot(f=>f))}getEventsByInstitution(c){return this.http.get(`${this.baseUrl}/eventos/institucion/${c}`).pipe(ot(f=>f))}getEventsCreatedByUser(c){return this.http.get(`${this.baseUrl}/eventos/creadoPorUsuario/${c}`).pipe(ot(f=>f))}getEventsCreatedByInstitution(c){return this.http.get(`${this.baseUrl}/eventos/creadoPorInstitucion/${c}`).pipe(ot(f=>f))}getEventById(c){return this.http.get(`${this.baseUrl}/eventos/${c}`).pipe(ot(f=>f))}getEventDTOById(c){return this.http.get(`${this.baseUrl}/eventosDTO/${c}`).pipe(ot(f=>f))}isUserInEvent(c,f){let g={id_usuario:c,id_evento:f};return this.http.post(`${this.baseUrl}/eventos/isUserInEvento`,g).pipe(ot(x=>x))}isInstitucionInEvent(c,f){let g={id_institucion:c,id_evento:f};return this.http.post(`${this.baseUrl}/eventos/isInstitutionInEvento`,g).pipe(ot(x=>x))}addUserToEvent(c,f){let g={id_usuario:c,id_evento:f};return this.http.post(`${this.baseUrl}/eventos/apuntar-usuario`,g)}addInstitutionToEvent(c,f){console.log("La id del evento es la siguiente: "+f+" y la de la institucion: "+c);let g={id_institucion:c,id_evento:f};return this.http.post(`${this.baseUrl}/eventos/apuntar-institucion`,g)}removeUserFromEvent(c,f){let g={id_usuario:c,id_evento:f};return this.http.post(`${this.baseUrl}/eventos/desapuntar-usuario`,g)}removeInstitutionFromEvent(c,f){let g={id_institucion:c,id_evento:f};return this.http.post(`${this.baseUrl}/eventos/desapuntar-institucion`,g)}isUserCreator(c,f){return this.http.get(`${this.baseUrl}/eventos/esCreador/${c}/${f}`)}sendDeleteRequest(c){let f=`${this.baseUrl}/contacto/enviarSolicitud`;return this.http.post(f,c)}sendDeniedRequest(c){let f=`${this.baseUrl}/contacto/enviarRespuestaDenegada`;return this.http.post(f,c)}obtenerEventosPerfil(c){return this.http.get(`${this.baseUrl}/eventos/profile/${c}`).pipe(ot(f=>f))}ordenarporvoluntarios(){return this.http.get(`${this.baseUrl}/eventos/ordenarporvoluntarios`)}ordenarporfechaProxima(){return this.http.get(`${this.baseUrl}/eventos/ordenarporfechaProxima`)}ordenarporfechaAntigua(){return this.http.get(`${this.baseUrl}/eventos/ordenarporfechaAntigua`)}};a.\u0275fac=function(f){return new(f||a)(vt(_o))},a.\u0275prov=gt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();function VW(s,a){s&1&&(U(0,"a",9),K(1,"Mis eventos"),j(),U(2,"a",10),K(3,"Crear evento"),j())}function jW(s,a){if(s&1){let d=Dn();U(0,"div",11)(1,"a",12),K(2," Admin "),Ab(),U(3,"svg",13),De(4,"path",14),j()(),Pb(),U(5,"ul",15)(6,"li")(7,"a",16),K(8,"Gestionar noticias"),j()(),U(9,"li")(10,"a",17),K(11,"Validar eventos"),j()(),U(12,"li")(13,"a",18),je("click",function(){xt(d);let f=Re();return bt(f.logout())}),K(14,"Salir"),j()()()()}}function UW(s,a){s&1&&(U(0,"div",20)(1,"a",21),K(2,"Iniciar sesion"),j(),U(3,"a",22),K(4,"Registrarse"),j()())}function $W(s,a){if(s&1){let d=Dn();U(0,"div",23)(1,"a",24),De(2,"img",25),Ab(),U(3,"svg",13),De(4,"path",14),j()(),Pb(),U(5,"ul",26)(6,"li")(7,"a",27),K(8,"Perfil"),j()(),U(9,"li")(10,"a",18),je("click",function(){xt(d);let f=Re(2);return bt(f.logout())}),K(11,"Cerrar sesi\xF3n"),j()()()()}if(s&2){let d=Re(2);he(2),ke("src",d.userProfilePicture,ir)}}function GW(s,a){if(s&1&&Je(0,UW,5,0,"div",19)(1,$W,12,1),s&2){let d=Re();Pt(0,d.isLogged===!1?0:1)}}var wi=(()=>{let a=class a{constructor(c,f,g){this.userService=c,this.institutionService=f,this.renderer=g,this.isLogged=!1,this.isAdmin=!1,this.muestraMenu=!1,this.userProfilePicture=""}menu(){this.muestraMenu=!this.muestraMenu}logout(){this.userService.logout()}mostrarMenu(){this.muestraMenu=!this.muestraMenu}ngOnInit(){this.isAdmin=this.userService.isAdmin(),this.isLogged=this.userService.isLogged();let c=this.userService.getUserTypeFromToken(),f=this.userService.getUserIdFromToken();c=="Usuario"?this.userService.getUserById(f).subscribe(g=>{this.userProfilePicture=g.fotoPerfil}):this.institutionService.getInstitucionById(f).subscribe(g=>{this.userProfilePicture=g.fotoPerfil}),this.renderer.listen("document","DOMContentLoaded",()=>{let g=document.querySelector("#menu-icon"),x=document.querySelector(".navbar");g&&x&&(g.onclick=()=>{g.classList.toggle("bx-x"),x.classList.toggle("active")})})}};a.\u0275fac=function(f){return new(f||a)(qe(rn),qe(Uo),qe(ls))},a.\u0275cmp=tn({type:a,selectors:[["app-header"]],standalone:!0,features:[cn([mi,rn,Uo]),nn],decls:13,vars:2,consts:[[1,"header"],["href","/",1,"d-flex","align-items-center","ms-2","me-5","mb-2","mb-lg-0","mb-md-0","mb-sm-0","text-white","text-decoration-none"],["src","/assets/banner.png","alt","VoluntApp banner","width","180px"],[1,"contenedor"],["id","menu-icon",1,"bx","bx-menu",3,"click"],[1,"navbar"],["href","/","id","home"],["href","/news","id","search"],["class","dropdown gap-2 profile me-2"],["href","/myevents","id","events"],["href","/create-event",1,"btn","btn-primary","text-white","p-2","fw-medium"],[1,"dropdown","gap-2","profile","me-2"],["href","#","role","button","data-bs-toggle","dropdown","aria-expanded","false",1,"d-flex","justify-content-center","align-items-center","gap-1","text-black","fw-bold"],["xmlns","http://www.w3.org/2000/svg","width","24","height","24","viewBox","0 0 24 24",2,"fill","rgba(0, 0, 0, 1)","transform","msFilter"],["d","M16.293 9.293 12 13.586 7.707 9.293l-1.414 1.414L12 16.414l5.707-5.707z"],[1,"dropdown-menu","menuperfil","dropdown-menu-end","mt-4"],["href","/create-new",1,"dropdown-item","seleccionado"],["href","/validations",1,"dropdown-item","seleccionado"],["href","/login",1,"dropdown-item","seleccionado",3,"click"],["class",""],[1,""],["href","/login",1,"btn","btn-outline-primary","me-1","btn-izquierda"],["href","/register",1,"btn","btn-primary","btn-derecha"],[1,"dropdown","gap-2","profile"],["href","#","role","button","data-bs-toggle","dropdown","aria-expanded","false",1,"d-flex","align-items-center","gap-1"],["alt","Imagen de perfil",1,"rounded-circle","img-perfil",3,"src"],[1,"dropdown-menu","dropdown-menu-end","mt-3"],["href","/profile",1,"dropdown-item","seleccionado"]],template:function(f,g){f&1&&(U(0,"header",0)(1,"a",1),De(2,"img",2),j(),U(3,"div",3)(4,"a",4),je("click",function(){return g.mostrarMenu()}),j(),U(5,"nav",5)(6,"a",6),K(7,"Voluntariados"),j(),U(8,"a",7),K(9,"Noticias"),j(),Je(10,VW,4,0),j(),Je(11,jW,15,0,"div",8)(12,GW,2,1),j()()),f&2&&(he(10),Pt(10,g.isLogged===!0&&g.isAdmin!==!0?10:-1),he(),Pt(11,g.isAdmin===!0?11:12))},styles:[".btn-izquierda[_ngcontent-%COMP%]{border-radius:5px 0 0 5px;transition:.3s linear}.btn-derecha[_ngcontent-%COMP%]{border-radius:0 5px 5px 0;transition:.3s linear}.img-perfil[_ngcontent-%COMP%]{width:40px;height:40px}.profile[_ngcontent-%COMP%]:hover{cursor:pointer}.menuperfil[_ngcontent-%COMP%]{border-radius:0 0 10px 10px;position:absolute;top:60px}.filamenu[_ngcontent-%COMP%]{display:fixed}.contenedor[_ngcontent-%COMP%]{display:flex;align-items:center;gap:1rem}.header[_ngcontent-%COMP%]{position:fixed;top:0;width:100%;padding:1rem;background-color:#f8fcf8;display:flex;justify-content:space-between;align-items:center;z-index:100;box-shadow:#64646f33 0 7px 29px}.header.sticky[_ngcontent-%COMP%]{box-shadow:#64646f33 0 7px 29px}.navbar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{font-size:1.1rem;color:#202020;margin-right:2rem;padding:.2rem;transition:.2s;font-weight:700}.navbar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover, .navbar[_ngcontent-%COMP%]   a.active[_ngcontent-%COMP%]{color:#7d4e99}#menu-icon[_ngcontent-%COMP%]{font-size:2rem;color:#202020;display:none}#menu-icon[_ngcontent-%COMP%]:hover{cursor:pointer}@media (max-width: 980px){#menu-icon[_ngcontent-%COMP%]{display:block}.navbar[_ngcontent-%COMP%]{position:absolute;top:100%;left:0;width:100%;background-color:#e1e1e1;border-top:.1rem solid rgba(0,0,0,.2);box-shadow:0 .5rem 1rem #0003;display:none}.navbar.active[_ngcontent-%COMP%]{display:block}.navbar[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{display:block;font-size:1rem}#nav-icon[_ngcontent-%COMP%]{display:none;font-size:3rem;margin:3rem 0}}"]});let s=a;return s})();var Ci=(()=>{let a=class a{};a.\u0275fac=function(f){return new(f||a)},a.\u0275cmp=tn({type:a,selectors:[["app-footer"]],standalone:!0,features:[nn],decls:14,vars:0,consts:[[1,"py-1","bg-white",2,"height","80px","width","100%"],[1,"container","text-center","bg-white"],[1,"row","border-bottom","border-primary","mb-1","py-1"],[1,"col"],["href","/about",1,"enlace","nav-link","px-2","enlace"],["href","/terms",1,"nav-link","px-2","enlace"],["href","/contact",1,"nav-link","px-2","enlace"],[1,"text-body-primary","fw-bold","mb-2"]],template:function(f,g){f&1&&(U(0,"footer",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"a",4),K(5,"Sobre nosotros"),j()(),U(6,"div",3)(7,"a",5),K(8,"Terminos"),j()(),U(9,"div",3)(10,"a",6),K(11,"Contacto"),j()()(),U(12,"p",7),K(13,"\xA9 2024 VoluntApp"),j()()())},styles:[".enlace[_ngcontent-%COMP%]{transition:.3s linear;color:#343434}.enlace[_ngcontent-%COMP%]:hover{color:#7d4e99}.marca[_ngcontent-%COMP%]{cursor:default}"]});let s=a;return s})();var qk=(()=>{let a=class a{};a.\u0275fac=function(f){return new(f||a)},a.\u0275cmp=tn({type:a,selectors:[["app-terms"]],standalone:!0,features:[nn],decls:50,vars:0,consts:[[1,"container","text-white","p-4"],[1,"fw-900","fw-bolder"]],template:function(f,g){f&1&&(De(0,"app-header"),U(1,"main",0)(2,"h1",1),K(3,"T\xE9rminos y condiciones"),j(),U(4,"p"),K(5,'Por favor, lee detenidamente estos T\xE9rminos y Condiciones antes de utilizar la aplicaci\xF3n m\xF3vil y plataforma web VolutApp (en adelante, "nosotros", "nuestra" o "la aplicaci\xF3n"). Al acceder o utilizar VolutApp, aceptas estar'),j(),U(6,"ol")(7,"li")(8,"strong"),K(9,"Uso Aceptable"),j(),U(10,"ol")(11,"li"),K(12,"Registro: Para aprovechar plenamente los servicios de VolutApp, debes completar el proceso de registro proporcionando informaci\xF3n precisa y actualizada. Eres responsable de mantener la confidencialidad de tu cuenta y contrase\xF1a."),j(),U(13,"li"),K(14,"Conducta del Usuario: Al utilizar VolutApp, te comprometes a no realizar acciones que puedan da\xF1ar, deshabilitar, sobrecargar o perjudicar la plataforma. No debes intentar acceder a \xE1reas no autorizadas o interferir con el buen funcionamiento de la aplicaci\xF3n."),j()()(),U(15,"li")(16,"strong"),K(17,"Voluntariado y Eventos"),j(),U(18,"ol")(19,"li"),K(20,"Propuestas y Participaci\xF3n: Las instituciones y personas voluntarias son responsables de la veracidad de la informaci\xF3n proporcionada al proponer o participar en eventos de voluntariado. Nos reservamos el derecho de retirar cualquier contenido que considere inapropiado o que viole estos T\xE9rminos y Condiciones."),j(),U(21,"li"),K(22,"Seguridad y Responsabilidad: Los usuarios son responsables de su propia seguridad al participar en eventos de voluntariado. VolutApp no se hace responsable de incidentes durante las actividades propuestas."),j()()(),U(23,"li")(24,"strong"),K(25,"Propiedad intelectual"),j(),U(26,"ol")(27,"li"),K(28,"Derechos de Autor: Todos los derechos de propiedad intelectual de la aplicaci\xF3n, su contenido y cualquier material relacionado son propiedad exclusiva de VolutApp. No se permite la reproducci\xF3n, distribuci\xF3n o modificaci\xF3n sin autorizaci\xF3n."),j()()(),U(29,"li")(30,"strong"),K(31,"Privacidad"),j(),U(32,"ol")(33,"li"),K(34,"Pol\xEDtica de Privacidad: Nuestra pol\xEDtica de privacidad describe c\xF3mo recopilamos, utilizamos y compartimos la informaci\xF3n que nos proporcionas. Al utilizar VolutApp, aceptas nuestras pr\xE1cticas de privacidad."),j()()(),U(35,"li")(36,"strong"),K(37,"Modificaciones y Terminaci\xF3n"),j(),U(38,"ol")(39,"li"),K(40,"Cambios en los T\xE9rminos: Nos reservamos el derecho de modificar estos T\xE9rminos y Condiciones en cualquier momento. Las modificaciones entrar\xE1n en vigencia tan pronto como se publiquen en la aplicaci\xF3n."),j(),U(41,"li"),K(42,"Terminaci\xF3n del Servicio: Nos reservamos el derecho de suspender o terminar tu acceso a VolutApp en caso de incumplimiento de estos T\xE9rminos y Condiciones."),j()()(),U(43,"li")(44,"strong"),K(45,"Ley Aplicable"),j(),U(46,"ol")(47,"li"),K(48,"Estos T\xE9rminos y Condiciones se rigen por las leyes del lugar donde opera VolutApp. Cualquier disputa que surja en relaci\xF3n con estos t\xE9rminos estar\xE1 sujeta a la jurisdicci\xF3n exclusiva de los tribunales competentes en esa \xE1rea."),j()()()()(),De(49,"app-footer"))},dependencies:[wi,Ci],styles:["main[_ngcontent-%COMP%]{text-wrap:pretty}"]});let s=a;return s})();var $o=(()=>{let a=class a{constructor(c){this.http=c,this.baseUrl=tr.server.ip+":"+tr.server.port}getNews(){return this.http.get(`${this.baseUrl}/noticias`).pipe(ot(c=>c))}createNews(c){return this.http.post(`${this.baseUrl}/noticias/crearNoticia`,c).pipe(ot(f=>f))}getNewByTitle(c){return this.http.get(`${this.baseUrl}/noticias/${c}`).pipe(ot(f=>f))}deleteNews(c){return this.http.delete(`${this.baseUrl}/noticias/eliminarNoticia/${c}`)}editNews(c,f){return this.http.put(`${this.baseUrl}/noticias/editarNoticia/${c}`,f).pipe(ot(g=>g))}};a.\u0275fac=function(f){return new(f||a)(vt(_o))},a.\u0275prov=gt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();var Wk=(()=>{let a=class a{constructor(c,f){this.newsService=c,this.router=f,this.news=[],this.images=[],this.currentImage=0}ngOnInit(){this.newsService.getNews().subscribe(c=>{this.news=c.content,this.images=this.news.map(f=>f.imagen)})}nextImage(){this.currentImage=(this.currentImage+1)%this.images.length}prevImage(){this.currentImage=(this.currentImage-1+this.images.length)%this.images.length}goToNew(){let c=this.news[this.currentImage].id;this.router.navigate(["/news"])}};a.\u0275fac=function(f){return new(f||a)(qe($o),qe(jo))},a.\u0275cmp=tn({type:a,selectors:[["app-news-slider"]],standalone:!0,features:[cn([$o]),nn],decls:8,vars:1,consts:[[1,"carousel"],[1,"carousel-inner","rounded"],[1,"carousel-item","active"],["alt","Slide 1",3,"src","click"],[1,"carousel-control-prev",3,"click"],[1,"carousel-control-prev-icon"],[1,"carousel-control-next",3,"click"],[1,"carousel-control-next-icon"]],template:function(f,g){f&1&&(U(0,"div",0)(1,"div",1)(2,"div",2)(3,"img",3),je("click",function(){return g.goToNew()}),j()()(),U(4,"button",4),je("click",function(){return g.prevImage()}),De(5,"span",5),j(),U(6,"button",6),je("click",function(){return g.nextImage()}),De(7,"span",7),j()()),f&2&&(he(3),ke("src",g.images[g.currentImage],ir))},styles:["img[_ngcontent-%COMP%]{object-fit:cover;width:100%;height:20rem}"]});let s=a;return s})();var Zk=(()=>{let a=class a{};a.\u0275fac=function(f){return new(f||a)},a.\u0275cmp=tn({type:a,selectors:[["app-about"]],standalone:!0,features:[nn],decls:26,vars:0,consts:[[1,"container","d-flex","flex-column","p-4","gap-4","text-white"],[1,"fw-bold"],[1,"w-100"],[1,"fw-semibold"],[1,"fw-bold","d-block"]],template:function(f,g){f&1&&(De(0,"app-header"),U(1,"main",0)(2,"div")(3,"h1",1),K(4,"Sobre nosotros"),j(),De(5,"app-news-slider",2),j(),U(6,"section")(7,"h2",3),K(8,"\xA1Bienvenido a VoluntApp!"),j(),U(9,"p"),K(10,"En VoluntApp, creemos firmemente en la construcci\xF3n de un mundo mejor, impulsado por la solidaridad y la acci\xF3n comunitaria. Nos enorgullece presentar esta plataforma donde tanto instituciones comprometidas como personas altruistas pueden unirse para marcar la diferencia a trav\xE9s del voluntariado."),j(),U(11,"p"),K(12,"Nuestra Inspiraci\xF3n En el coraz\xF3n de VoluntApp est\xE1 la creencia en el poder transformador del voluntariado. Nos inspira la idea de que cada peque\xF1a acci\xF3n puede tener un impacto significativo en la construcci\xF3n de comunidades m\xE1s fuertes y en la mejora de nuestro entorno."),j(),U(13,"p")(14,"span",4),K(15,"\xBFC\xF3mo Funciona?"),j(),K(16," Para Instituciones: Organizaciones no gubernamentales, fundaciones y entidades sin fines de lucro pueden proponer eventos de voluntariado, describiendo las actividades espec\xEDficas que necesitan apoyo. Estamos comprometidos a conectar estas instituciones con individuos comprometidos que deseen hacer una diferencia real."),j(),U(17,"p"),K(18,"Para Personas Voluntarias: Si eres una persona con ganas de contribuir, \xA1te damos la bienvenida! Explora los eventos propuestos, elige aquellos que resuenen contigo y reg\xEDstrate para participar. Juntos, podemos marcar la diferencia en \xE1reas que van desde la preservaci\xF3n del medio ambiente hasta el apoyo comunitario."),j(),U(19,"p"),K(20,"Nuestro Compromiso En VoluntApp, nos esforzamos por fomentar una cultura de servicio y colaboraci\xF3n. Creemos que el voluntariado no solo mejora las vidas de aquellos a quienes ayudamos, sino que tambi\xE9n enriquece nuestras propias vidas al construir conexiones significativas y cultivar un sentido de prop\xF3sito compartido."),j(),U(21,"p"),K(22,"\xDAnete a Nosotros \xBFEst\xE1s listo para ser parte de algo m\xE1s grande? \xDAnete a VoluntApp y s\xE9 parte de la comunidad de cambio positivo. Explora nuestros eventos de voluntariado, \xFAnete a proyectos significativos y contribuye a un mundo m\xE1s solidario y sostenible."),j(),U(23,"p"),K(24,"\xA1Gracias por ser parte de nuestra misi\xF3n en VoluntApp, donde cada acto de voluntariado cuenta!"),j()()(),De(25,"app-footer"))},dependencies:[Wk,wi,Ci],styles:["p[_ngcontent-%COMP%]{text-wrap:pretty}.carousel-contaier[_ngcontent-%COMP%]{width:100%}"]});let s=a;return s})();function HW(s,a){if(s&1&&(U(0,"span",9),K(1,"Apoyado por "),U(2,"b"),K(3),j(),K(4," \u{1F91D}"),j()),s&2){let d=Re();he(3),Yn(d.currentInstitution)}}var od=(()=>{let a=class a{constructor(){this.id=null,this.image=null,this.title=null,this.startDate=null,this.endDate=null,this.location=null,this.numVolunteers=null,this.createdByUser=null,this.createdByInstitution=null,this.nombreInstituciones=null,this.currentIndex=0,this.currentInstitution=""}stringFunction(){this.nombreInstituciones&&(this.currentInstitution=this.nombreInstituciones[0])}intervalFunction(){this.nombreInstituciones&&(this.currentIndex=(this.currentIndex+1)%this.nombreInstituciones.length,this.currentInstitution=this.nombreInstituciones[this.currentIndex])}ngOnInit(){this.stringFunction(),setInterval(()=>{this.intervalFunction()},2e3)}};a.\u0275fac=function(f){return new(f||a)},a.\u0275cmp=tn({type:a,selectors:[["app-event-card"]],inputs:{id:"id",image:"image",title:"title",startDate:"startDate",endDate:"endDate",location:"location",numVolunteers:"numVolunteers",createdByUser:"createdByUser",createdByInstitution:"createdByInstitution",nombreInstituciones:"nombreInstituciones"},standalone:!0,features:[nn],decls:18,vars:14,consts:[[1,"card","shadow-sm","border-0"],["class","position-absolute bg-secondary w-100 text-white text-center py-1 rounded-top"],["alt","",1,"bd-placeholder-img","card-img-top",3,"src"],[1,"card-body"],[1,"fw-bold","fs-4","rotura"],[1,"d-flex","justify-content-between","flex-column"],[1,"rotura2"],[1,"d-flex","justify-content-between"],[1,"text-white","btn","btn-secondary","h-50",3,"href"],[1,"position-absolute","bg-secondary","w-100","text-white","text-center","py-1","rounded-top"]],template:function(f,g){f&1&&(U(0,"article",0),Je(1,HW,5,1,"span",1),De(2,"img",2),U(3,"section",3)(4,"h1",4),K(5),j(),U(6,"div",5)(7,"span"),K(8),Lo(9,"date"),Lo(10,"date"),j(),U(11,"span",6),K(12),j(),U(13,"div",7)(14,"span"),K(15),j(),U(16,"a",8),K(17,"Ver m\xE1s"),j()()()()()),f&2&&(he(),Pt(1,(g.nombreInstituciones==null?null:g.nombreInstituciones.length)!=0?1:-1),he(),ke("src",g.image,ir),he(3),Yn(g.title),he(3),Uh("\u{1F4C5} ",No(9,8,g.startDate,"dd/MM/yyyy")," - ",No(10,11,g.endDate,"dd/MM/yyyy"),""),he(4),mr("\u{1F4CC} ",g.location,""),he(3),mr("\u{1F464} ",g.numVolunteers,""),he(),ke("href","/event/"+g.id,ir))},dependencies:[ya],styles:['@charset "UTF-8";img[_ngcontent-%COMP%]{height:250px;object-fit:cover}.texto-superpuesto[_ngcontent-%COMP%]{position:absolute;top:10px;left:10px;color:#fff;font-size:24px;background-color:#00000080;padding:10px}.rotura[_ngcontent-%COMP%], .rotura2[_ngcontent-%COMP%]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis;max-width:100%}']});let s=a;return s})();function qW(s,a){if(s&1&&De(0,"input",40),s&2){let d=Re(2),c;ke("min",(c=d.filtersForm.get("finicio"))==null?null:c.value)}}function WW(s,a){if(s&1&&De(0,"input",41),s&2){let d=Re(2),c;ke("min",(c=d.filtersForm.get("finicio"))==null?null:c.value)}}function ZW(s,a){if(s&1){let d=Dn();U(0,"form",28),je("submit",function(){xt(d);let f=Re();return bt(f.applyFilters())}),U(1,"div",29)(2,"label",30),K(3,"Inicio"),j(),De(4,"input",31),j(),U(5,"div",29)(6,"label",32),K(7,"Fin"),j(),Je(8,qW,1,1,"input",33)(9,WW,1,1),j(),U(10,"div",34)(11,"label",35),K(12,"Ubicaci\xF3n"),j(),De(13,"input",36),j(),U(14,"div",37)(15,"button",38),je("click",function(){xt(d);let f=Re();return bt(f.clearFilters())}),K(16," Limpiar filtros "),j(),U(17,"button",39),K(18," Aplicar filtros "),j()()()}if(s&2){let d=Re(),c;ke("formGroup",d.filtersForm),he(4),ke("min",d.obtenerFechaActual()),he(4),Pt(8,((c=d.filtersForm.get("finicio"))==null?null:c.value)==null?8:9)}}var XW=(s,a)=>a.id;function YW(s,a){if(s&1&&(U(0,"div",43),De(1,"app-event-card",44),j()),s&2){let d=a.$implicit;he(),ke("image",d.imagen)("id",d.id)("title",d.titulo)("startDate",d.finicio)("endDate",d.ffin)("location",d.ubicacion.nombre)("numVolunteers",d.numVoluntarios)("createdByUser",d.creadoPorUsuario)("createdByInstitution",d.creadoPorInstitucion)("nombreInstituciones",d.nombreInstituciones)}}function KW(s,a){if(s&1&&(U(0,"section",42),po(1,YW,2,10,"div",45,XW),j()),s&2){let d=Re();he(),mo(d.events)}}function JW(s,a){s&1&&(U(0,"h1",46),K(1," No hay eventos disponibles "),j(),U(2,"h4",47)(3,"a",48),K(4,"Crea un evento aqu\xED"),j()())}function QW(s,a){s&1&&(U(0,"li",52)(1,"a",53),K(2,"Anterior"),j()())}function eZ(s,a){if(s&1){let d=Dn();U(0,"li",54)(1,"a",55),je("click",function(){xt(d);let f=Re(2);return bt(f.goToPage(f.currentPage-1))}),K(2,"Anterior"),j()()}}function tZ(s,a){if(s&1&&(U(0,"li",57)(1,"a",58),K(2),j()()),s&2){let d=Re().$implicit;he(2),Yn(d)}}function nZ(s,a){if(s&1){let d=Dn();U(0,"li",59),je("click",function(){xt(d);let f=Re().$implicit,g=Re(2);return bt(g.goToPage(f-1))}),U(1,"a",58),K(2),j()()}if(s&2){let d=Re().$implicit;he(2),Yn(d)}}function iZ(s,a){if(s&1&&Je(0,tZ,3,1,"li",56)(1,nZ,3,1),s&2){let d=a.$index,c=Re(2);Pt(0,d===c.currentPage?0:1)}}function rZ(s,a){s&1&&(U(0,"li",52)(1,"a",53),K(2,"Siguiente"),j()())}function oZ(s,a){if(s&1){let d=Dn();U(0,"li",54)(1,"a",55),je("click",function(){xt(d);let f=Re(2);return bt(f.goToPage(f.currentPage+1))}),K(2,"Siguiente"),j()()}}function sZ(s,a){if(s&1&&(U(0,"nav",49)(1,"ul",50),Je(2,QW,3,0,"li",51)(3,eZ,3,0),po(4,iZ,2,1,null,null,o_),Je(6,rZ,3,0,"li",51)(7,oZ,3,0),j()()),s&2){let d=Re();he(2),Pt(2,d.currentPage===0?2:3),he(2),mo(d.pages),he(2),Pt(6,d.currentPage===d.pages.length-1?6:7)}}var Xk=(()=>{let a=class a{constructor(c){this.eventService=c,this.events=[],this.pages=[],this.currentPage=0,this.muestraFiltros=!1,this.filtersForm=new vr({finicio:new wt(""),ffin:new wt(""),ubicacion:new wt("")}),this.selectedOption="Reciente"}showFilters(){this.muestraFiltros=!this.muestraFiltros}orderByTimeOrPeople(c){switch(c.target.value){case"reciente":this.eventService.ordenarporfechaProxima().subscribe(g=>{this.events=g.content,this.currentPage=g.pageable.pageNumber},g=>{console.error("Error fetching events:",g)});break;case"Popular":this.eventService.ordenarporvoluntarios().subscribe(g=>{this.events=g.content,this.currentPage=g.pageable.pageNumber},g=>{console.error("Error fetching events:",g)});break;case"antiguos":this.eventService.ordenarporfechaAntigua().subscribe(g=>{this.events=g.content,this.currentPage=g.pageable.pageNumber},g=>{console.error("Error fetching events:",g)});break}}clearFilters(){this.filtersForm.reset(),this.eventService.getEventsByState("disponible").subscribe(c=>{this.events=c.content,this.currentPage=c.pageable.pageNumber},c=>{console.error("Error fetching events:",c)})}obtenerFechaActual(){let c=new Date,f=c.getMonth()+1,g=c.getDate(),x=c.getHours(),T=c.getMinutes(),P=f<10?`0${f}`:f,O=g<10?`0${g}`:g;return`${c.getFullYear()}-${P}-${O}`}applyFilters(){let c=this.filtersForm.value.finicio,f=this.filtersForm.value.ffin,g=this.filtersForm.value.ubicacion;c&&f&&!g?this.eventService.getEventsByDateFilter(c,f).subscribe(x=>{this.events=x.content,this.currentPage=x.pageable.pageNumber},x=>{console.error("Error fetching events:",x)}):g&&!c&&!f?this.eventService.getEventsByLocationFilter(this.filtersForm.value.ubicacion).subscribe(x=>{this.events=x.content,this.currentPage=x.pageable.pageNumber},x=>{console.error("Error fetching events:",x)}):c&&f&&g&&this.eventService.getEventByDateAndLocationFilter(c,f,g).subscribe(x=>{this.events=x.content,this.currentPage=x.pageable.pageNumber},x=>{console.error("Error fetching events:",x)})}filterEventsBySearch(c){c?this.eventService.getEventsBySearchQuery(c).subscribe(f=>{this.events=f.content,this.currentPage=f.pageable.pageNumber},f=>{console.error("Error fetching events:",f)}):this.eventService.getEventsByState("disponible").subscribe(f=>{this.events=f.content,this.currentPage=f.pageable.pageNumber},f=>{console.error("Error fetching events:",f)})}goToPage(c){this.eventService.getEventsByState("disponible",c).subscribe(f=>{this.events=f.content,this.currentPage=f.pageable.pageNumber},f=>{console.error("Error fetching events:",f)})}ngOnInit(){this.eventService.getEventsByState("disponible").subscribe(c=>{this.events=c.content,console.log(this.events);for(let f=0;f<c.totalPages;f++)this.pages.push(f+1);this.currentPage=c.pageable.pageNumber},c=>{console.error("Error fetching events:",c)})}};a.\u0275fac=function(f){return new(f||a)(qe(mi))},a.\u0275cmp=tn({type:a,selectors:[["app-home"]],standalone:!0,features:[cn([mi]),nn],decls:43,vars:3,consts:[[1,"hero"],[1,"container-fluid"],[1,"d-flex","flex-row-reverse","align-items-center","justify-content-center","gap"],[1,""],["src","https://voluntapp.blob.core.windows.net/images/noticias/new3.webp","alt","Bootstrap Themes","loading","lazy",1,"foto",2,"height","70vh"],[1,"text-start"],[1,"fw-bold","text-body-emphasis","size"],[1,"lead"],[1,"d-grid","gap-2","d-md-flex","justify-content-md-start"],["href","/about",1,"btn","btn-outline-primary"],["href","#voluntariados",1,"btn","btn-primary"],["id","voluntariados",1,"separador"],[1,"container-fluid","px-5","d-flex","flex-column","align-items-center"],[1,"w-100"],[1,"bg-top","d-flex","py-3","w-100","gap-3","justify-content-between"],[1,"dropdown"],["aria-label","Default select example",1,"form-select","btn","btn-primary","text-start",3,"change"],["selected","","value","Popular"],["value","reciente"],["value","antiguos"],[1,"input-group","w-50"],["type","text","placeholder","Buscar...",1,"p-1","form-control","shadow-none"],["seachInput",""],["type","button","id","btn-buscar",1,"btn","btn-primary",3,"click"],["type","button",1,"btn","btn-primary",3,"click"],["class","mb-3 despuescontenedor text-white rounded d-flex gap-3 py-2 align-items-end",3,"formGroup"],["class","row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3"],["class","d-flex justify-content-center mt-5"],[1,"mb-3","despuescontenedor","text-white","rounded","d-flex","gap-3","py-2","align-items-end",3,"formGroup","submit"],[1,"form-group"],["for","finicio"],["formControlName","finicio","type","date","id","finicio",1,"form-control",3,"min"],["for","ffin"],["readonly","","formControlName","ffin","type","date","class","form-control","id","ffin",3,"min"],[1,"form-group","d-block"],["for","ubicacion"],["formControlName","ubicacion","type","text","id","ubicacion",1,"form-control"],[1,"ms-auto","d-flex","gap-3"],["type","submit",1,"btn","btn-primary","h-50",3,"click"],["type","submit",1,"btn","btn-primary","h-50"],["readonly","","formControlName","ffin","type","date","id","ffin",1,"form-control",3,"min"],["formControlName","ffin","type","date","id","ffin",1,"form-control",3,"min"],[1,"row","row-cols-1","row-cols-sm-2","row-cols-md-3","g-3"],[1,"col"],[3,"image","id","title","startDate","endDate","location","numVolunteers","createdByUser","createdByInstitution","nombreInstituciones"],["class","col"],[1,"text-center","text-white","fw-bold","mt-5"],[1,"text-center","text-white"],["href","/create-event"],[1,"d-flex","justify-content-center","mt-5"],[1,"pagination"],["class","page-item disabled"],[1,"page-item","disabled"],[1,"page-link"],[1,"page-item"],["href","#",1,"page-link",3,"click"],["class","page-item active"],[1,"page-item","active"],["href","#",1,"page-link"],[1,"page-item",3,"click"]],template:function(f,g){if(f&1){let x=Dn();De(0,"app-header"),U(1,"main")(2,"section",0)(3,"div",1)(4,"div",2)(5,"div",3),De(6,"img",4),j(),U(7,"div",5)(8,"h1",6),K(9,"Ayuda a crear "),De(10,"br"),K(11," un futuro solidario"),j(),U(12,"p",7),K(13," Creemos en el poder de trabajar juntos para lograr un cambio significativo. Fomentamos la colaboraci\xF3n entre individuos, organizaciones y comunidades para abordar desaf\xEDos sociales de manera efectiva."),j(),U(14,"div",8)(15,"a",9),K(16,"Sobre nosotros"),j(),U(17,"a",10),K(18,"Ver voluntariados"),j()()()()()(),De(19,"div",11),U(20,"section",12)(21,"div",13)(22,"nav",14)(23,"div",15)(24,"select",16),je("change",function(P){return g.orderByTimeOrPeople(P)}),U(25,"option",17),K(26,"Popular"),j(),U(27,"option",18),K(28,"Eventos pr\xF3ximos"),j(),U(29,"option",19),K(30,"Eventos lejanos"),j()()(),U(31,"div",20),De(32,"input",21,22),U(34,"button",23),je("click",function(){xt(x);let P=s_(33);return bt(g.filterEventsBySearch(P.value))}),K(35," Buscar "),j()(),U(36,"button",24),je("click",function(){return g.showFilters()}),K(37," Filtros "),j()(),Je(38,ZW,19,3,"form",25)(39,KW,3,0,"section",26)(40,JW,5,0),j(),Je(41,sZ,8,2,"nav",27),j()(),De(42,"app-footer")}f&2&&(he(38),Pt(38,g.muestraFiltros?38:-1),he(),Pt(39,g.events.length!==0?39:40),he(2),Pt(41,g.events.length!==0?41:-1))},dependencies:[wi,Ci,od,lr,ar,ry,oy,Wi,or,sr,Qi,er],styles:["main[_ngcontent-%COMP%]{margin-top:0;width:100%}.separador[_ngcontent-%COMP%]{width:100%;height:6rem}.hero[_ngcontent-%COMP%]{background-image:url(/assets/home.jpg);background-size:cover;background-position:center;padding:8rem;height:100vh;filter:brightness(1)}.hero[_ngcontent-%COMP%]   .size[_ngcontent-%COMP%]{font-size:72px}.hero[_ngcontent-%COMP%]   .gap[_ngcontent-%COMP%]{gap:5rem}.hero[_ngcontent-%COMP%]   .foto[_ngcontent-%COMP%]{height:500px;width:700px;margin-top:5vh;border-radius:1rem;display:block}.hero[_ngcontent-%COMP%]   .lead[_ngcontent-%COMP%]{width:80%}@media screen and (max-width: 994px){.hero[_ngcontent-%COMP%]   .foto[_ngcontent-%COMP%]{display:none}.hero[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin-top:15vh}.hero[_ngcontent-%COMP%]   .gap[_ngcontent-%COMP%]{gap:0rem}.hero[_ngcontent-%COMP%]   .size[_ngcontent-%COMP%]{font-size:52px}}@media screen and (max-width: 766px){.hero[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin-top:15vh}.hero[_ngcontent-%COMP%]   .size[_ngcontent-%COMP%]{font-size:52px}}@media screen and (max-width: 724px){.hero[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin-top:10vh}.hero[_ngcontent-%COMP%]   .size[_ngcontent-%COMP%]{font-size:52px}}@media screen and (max-width: 600px){.hero[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin-top:3vh}.hero[_ngcontent-%COMP%]   .size[_ngcontent-%COMP%]{font-size:48px}}@media screen and (max-width: 568px){.hero[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{margin-top:3vh}.hero[_ngcontent-%COMP%]   .size[_ngcontent-%COMP%]{font-size:42px}}"]});let s=a;return s})();var aZ=(s,a)=>a.id;function lZ(s,a){if(s&1&&(U(0,"div",2)(1,"div",3)(2,"div",4),De(3,"img",5),j(),U(4,"div",6)(5,"div",7)(6,"h3",8),K(7),j(),U(8,"p",9),K(9),j()(),U(10,"div",10)(11,"small",11)(12,"b"),K(13),j(),K(14),Lo(15,"date"),j()()()()()),s&2){let d=a.$implicit;he(3),ke("src",d.imagen,ir),he(4),Yn(d.titulo),he(2),Yn(d.contenido),he(4),Yn(d.autor),he(),mr(" - ",No(15,5,d.fecha,"dd/MM/yyyy"),"")}}function cZ(s,a){if(s&1&&po(0,lZ,16,8,"div",12,aZ),s&2){let d=Re();mo(d.news)}}function uZ(s,a){s&1&&(U(0,"h1",13),K(1,"No hay noticias"),j())}var Yk=(()=>{let a=class a{constructor(c){this.newsService=c,this.news=[]}ngOnInit(){this.newsService.getNews().subscribe(c=>{this.news=c.content})}};a.\u0275fac=function(f){return new(f||a)(qe($o))},a.\u0275cmp=tn({type:a,selectors:[["app-news-list"]],standalone:!0,features:[cn([$o,ya]),nn],decls:7,vars:1,consts:[[1,"container-fluid","px-5","py-4","flex-column","gap-2","text-white"],[1,"fw-bold"],[1,"card","mb-3"],[1,"row","g-0"],[1,"col-md-4"],["alt","...",1,"img-fluid","rounded-start",3,"src"],[1,"col-md-8","d-flex","flex-column"],[1,"card-body"],[1,"card-title","m-3"],[1,"card-text","m-3"],[1,"card-footer","text-end"],[1,"text-body-secondary"],["class","card mb-3"],[1,"text-center","text-white","fw-bold","mt-5"]],template:function(f,g){f&1&&(De(0,"app-header"),U(1,"main",0)(2,"h1",1),K(3,"Noticias"),j(),Je(4,cZ,2,0)(5,uZ,2,0),j(),De(6,"app-footer")),f&2&&(he(4),Pt(4,g.news.length>0?4:5))},dependencies:[wi,Ci,ya],styles:["p[_ngcontent-%COMP%]{text-wrap:pretty}.noticia-img[_ngcontent-%COMP%]{width:100%;height:500px;object-fit:cover}"]});let s=a;return s})();var Qk=Vj(Jk());var eL=(()=>{let a=class a{constructor(){this.style="mapbox://styles/mapbox/streets-v11",this.lat=40.4168,this.lon=-3.7038}ngOnInit(){setTimeout(()=>{this.map=new Qk.Map({accessToken:tr.mapbox.accessToken,container:"map",style:this.style,zoom:15,center:[this.lat,this.lon],attributionControl:!1})},50)}};a.\u0275fac=function(f){return new(f||a)},a.\u0275cmp=tn({type:a,selectors:[["app-map"]],inputs:{lat:"lat",lon:"lon"},standalone:!0,features:[nn],decls:1,vars:0,consts:[["id","map",1,"match-parent"]],template:function(f,g){f&1&&De(0,"div",0)},styles:["#map[_ngcontent-%COMP%]{width:100%;height:100%}"]});let s=a;return s})();function dZ(s,a){s&1&&(U(0,"span",15),K(1,"En revisi\xF3n"),j())}function hZ(s,a){s&1&&(U(0,"span",15),K(1,"Finalizado"),j())}function fZ(s,a){if(s&1&&De(0,"app-map",8),s&2){let d=Re();ke("lat",d.event.ubicacion.lat)("lon",d.event.ubicacion.lon)}}function pZ(s,a){if(s&1&&(U(0,"span",12),K(1),j()),s&2){let d=Re();he(),mr("\u{1F4CD} ",d.event.ubicacion.nombre,"")}}function mZ(s,a){if(s&1){let d=Dn();U(0,"div",17)(1,"button",18),je("click",function(){xt(d);let f=Re(2);return bt(f.acceptEvent())}),K(2,"Aprobar"),j(),U(3,"button",19),je("click",function(){xt(d);let f=Re(2);return bt(f.declineEvent())}),K(4,"Rechazar"),j()()}}function gZ(s,a){if(s&1){let d=Dn();U(0,"div",17)(1,"button",20),je("click",function(){xt(d);let f=Re(2);return bt(f.declineElimination())}),K(2,"Mantener"),j(),U(3,"button",21),je("click",function(){xt(d);let f=Re(2);return bt(f.acceptElimination())}),K(4,"Eliminar"),j()()}}function _Z(s,a){if(s&1&&Je(0,mZ,5,0,"div",16)(1,gZ,5,0),s&2){let d=Re();Pt(0,d.event.estado==="revision"?0:d.event.estado=="en-eliminacion"?1:-1)}}function yZ(s,a){if(s&1){let d=Dn();U(0,"button",21),je("click",function(){xt(d);let f=Re(5);return bt(f.requestEventElimination())}),K(1,"Solicitar eliminaci\xF3n"),j()}}function vZ(s,a){if(s&1){let d=Dn();U(0,"button",21),je("click",function(){xt(d);let f=Re(5);return bt(f.deleteEvent())}),K(1,"Eliminar"),j()}}function xZ(s,a){if(s&1&&Je(0,yZ,2,0,"button",23)(1,vZ,2,0),s&2){let d=Re(4);Pt(0,d.event.estado==="disponible"?0:d.event.estado==="revision"?1:-1)}}function bZ(s,a){if(s&1){let d=Dn();U(0,"button",24),je("click",function(){xt(d);let f=Re(4);return bt(f.removeUserFromEvent())}),K(1,"Desapuntarse"),j()}}function wZ(s,a){if(s&1&&Je(0,xZ,2,1)(1,bZ,2,0),s&2){let d=Re(3);Pt(0,d.isCreator&&d.tipo=="Usuario"||d.tipo=="Admin"?0:d.tipo=="Usuario"?1:-1)}}function CZ(s,a){if(s&1){let d=Dn();U(0,"button",25),je("click",function(){xt(d);let f=Re(3);return bt(f.addUserToEvent())}),K(1,"Ap\xFAntate"),j()}}function EZ(s,a){if(s&1){let d=Dn();U(0,"button",24),je("click",function(){xt(d);let f=Re(3);return bt(f.removeInstitucionFromEvent())}),K(1,"Dejar de apoyar"),j()}}function TZ(s,a){if(s&1){let d=Dn();U(0,"button",25),je("click",function(){xt(d);let f=Re(3);return bt(f.addInstitucionToEvent())}),K(1,"Apoyar Evento"),j()}}function IZ(s,a){if(s&1&&Je(0,wZ,2,1)(1,CZ,2,0)(2,EZ,2,0,"button",22)(3,TZ,2,0),s&2){let d=Re(2);Pt(0,d.isUserInEvent?0:d.tipo=="Usuario"?1:-1),he(2),Pt(2,d.isInstitucionInEvent?2:d.tipo=="Institucion"?3:-1)}}function MZ(s,a){s&1&&(U(0,"a",26),K(1,"Inicia sesi\xF3n para apuntarte"),j())}function DZ(s,a){if(s&1&&Je(0,IZ,4,2)(1,MZ,2,0),s&2){let d=Re();Pt(0,d.isLogged?0:1)}}function SZ(s,a){s&1&&K(0," \xA1Enhorabuena! \u{1F389} ")}function AZ(s,a){s&1&&K(0," Te has desapuntado del evento \u{1F61E} ")}function PZ(s,a){s&1&&K(0," Has dejado de apoyar al evento \u{1F61E} ")}function RZ(s,a){s&1&&K(0," Error al unirte al evento \u274C ")}function OZ(s,a){s&1&&K(0," Te has unido al evento correctamente. ")}function FZ(s,a){s&1&&K(0," Has dejado de formar parte del evento correctamente. ")}function kZ(s,a){s&1&&K(0," Has dejado de formar parte del evento correctamente. ")}function LZ(s,a){if(s&1&&K(0),s&2){let d=Re(2);mr(" ",d.errorMessage," ")}}function NZ(s,a){if(s&1){let d=Dn();U(0,"div",27)(1,"div",28)(2,"div",29)(3,"div",30)(4,"h1",31),Je(5,SZ,1,0)(6,AZ,1,0)(7,PZ,1,0)(8,RZ,1,0),j(),U(9,"button",32),je("click",function(){xt(d);let f=Re();return bt(f.closeAlert())}),j()(),U(10,"div",33),Je(11,OZ,1,0)(12,FZ,1,0)(13,kZ,1,0)(14,LZ,1,1),j(),U(15,"div",34)(16,"button",35),je("click",function(){xt(d);let f=Re();return bt(f.closeAlert())}),K(17,"Cerrar"),j()()()()()}if(s&2){let d=Re();he(5),Pt(5,d.createdSuccessfully===!0&&d.desapuntarseUsuario===!1&&d.desapuntarseInstitucion===!1?5:d.desapuntarseUsuario===!0&&d.desapuntarseInstitucion===!1?6:d.desapuntarseInstitucion===!0&&d.desapuntarseUsuario===!1?7:d.createdSuccessfully===!1?8:-1),he(6),Pt(11,d.createdSuccessfully===!0&&d.desapuntarseUsuario===!1&&d.desapuntarseInstitucion===!1?11:d.desapuntarseUsuario===!0&&d.desapuntarseInstitucion===!1?12:d.desapuntarseUsuario===!1&&d.desapuntarseInstitucion===!0?13:d.createdSuccessfully===!1?14:-1)}}var tL=(()=>{let a=class a{constructor(c,f,g){this.eventService=c,this.userService=f,this.router=g,this.eventId=-1,this.tipo="",this.userId=-1,this.isUserInEvent=!1,this.isInstitucionInEvent=!1,this.isLogged=!1,this.isAdmin=!1,this.isCreator=!1,this.showAlert=!1,this.createdSuccessfully=null,this.errorMessage="",this.desapuntarseUsuario=null,this.desapuntarseInstitucion=null,this.event={}}addUserToEvent(){this.eventService.addUserToEvent(this.userId,this.eventId).subscribe(c=>c,c=>{this.createdSuccessfully=!1,this.errorMessage=c.error,console.error("Error fetching events:",c)},()=>{this.desapuntarseInstitucion=!1,this.desapuntarseUsuario=!1,this.createdSuccessfully=!0,this.isUserInEvent=!0,this.showAlert=!0})}closeAlert(){this.showAlert=!1}addInstitucionToEvent(){this.eventService.addInstitutionToEvent(this.userId,this.eventId).subscribe(c=>c,c=>{console.error("Error fetching events:",c)},()=>{this.createdSuccessfully=!0,this.desapuntarseInstitucion=!1,this.desapuntarseUsuario=!1,this.isInstitucionInEvent=!0,this.showAlert=!0})}removeUserFromEvent(){this.eventService.removeUserFromEvent(this.userId,this.eventId).subscribe(c=>c,c=>{this.createdSuccessfully=!1,this.errorMessage=c.error,console.error("Error fetching events:",c)},()=>{this.desapuntarseInstitucion=!1,this.desapuntarseUsuario=!0,this.isUserInEvent=!1,this.showAlert=!0})}removeInstitucionFromEvent(){this.eventService.removeInstitutionFromEvent(this.userId,this.eventId).subscribe(c=>c,c=>{console.error("Error fetching events:",c)},()=>{this.desapuntarseInstitucion=!0,this.desapuntarseUsuario=!1,this.isInstitucionInEvent=!1,this.showAlert=!0}),this.isInstitucionInEvent=!1}deleteEvent(){this.eventService.updateEventState(this.eventId,"eliminado").subscribe(),this.router.navigate(["/myevents"])}requestEventElimination(){let c=document.createElement("div");c.style.position="fixed",c.style.top="50%",c.style.left="50%",c.style.transform="translate(-50%, -50%)",c.style.borderRadius="5px",c.style.textAlign="right",c.classList.add("bg-white","rounded","p-4");let f=document.createElement("h3");f.textContent="\xBFEst\xE1s seguro de solicitar la eliminaci\xF3n?",f.style.marginBottom="15px",f.classList.add("fw-semibold","text-black"),c.appendChild(f);let g=document.createElement("textarea");g.placeholder="Ingrese los motivos aqu\xED...",g.style.width="100%",g.style.height="100px",g.style.marginBottom="10px",c.appendChild(g);let x=document.createElement("button");x.textContent="Cancelar",x.style.backgroundColor="#890101",x.style.color="#fff",x.style.padding="8px 15px",x.style.border="none",x.style.borderRadius="3px",x.style.cursor="pointer",x.addEventListener("click",()=>{document.body.removeChild(c)}),c.appendChild(x);let T=document.createElement("button");T.textContent="Confirmar",T.style.backgroundColor="#386641",T.style.color="#fff",T.style.padding="8px 15px",T.style.border="none",T.style.cursor="pointer",T.style.marginLeft="10px",T.classList.add("bg-secondary","rounded"),T.addEventListener("click",()=>{let P=g.value,O;this.userService.getUserById(this.userId).subscribe(Z=>{O=Z,this.eventService.sendDeleteRequest({email:O.email,asunto:"Motivos de eliminacion: ",mensaje:P+" - Evento: "+this.eventId}).subscribe(ee=>{alert("Solicitud de eliminaci\xF3n enviada correctamente")})}),this.eventService.updateEventState(this.eventId,"en-eliminacion").subscribe(()=>{document.body.removeChild(c)},Z=>{console.error("Error al actualizar el estado del evento:",Z),document.body.removeChild(c)})}),c.appendChild(T),document.body.appendChild(c)}acceptEvent(){this.eventService.getEventById(this.eventId).subscribe(c=>{console.log(c);let f=c.creadoPorUsuarios.username;this.eventService.sendDeniedRequest({email:f,asunto:"\xA1Evento aprobado! \u{1F389}",mensaje:`Tu event ${c.titulo} ha sido aprobado. \xA1Felicidades!`}).subscribe(g=>{alert("Evento aprobado con \xE9xito"),console.log(g)})}),this.eventService.updateEventState(this.eventId,"disponible").subscribe(c=>c,c=>{console.error("Error fetching events:",c)})}declineEvent(){let c=prompt("Ingrese los motivos por los que se debe mantener el evento: ");if(c==null||c==""){alert("Debe ingresar los motivos de rechazo");return}this.eventService.getEventById(this.eventId).subscribe(f=>{console.log(f);let g=f.creadoPorUsuarios.username;this.eventService.sendDeniedRequest({email:g,asunto:"Evento rechazado \u274C",mensaje:"El evento "+f.titulo+" ha sido rechazado por los siguientes motivos : "+c}).subscribe(x=>{alert("Decision de mantener el evento enviada correctamente"),console.log(x)})}),this.eventService.updateEventState(this.eventId,"denegado").subscribe(f=>f,f=>{console.error("Error fetching events:",f)})}acceptElimination(){this.eventService.getEventById(this.eventId).subscribe(c=>{console.log(c);let f=c.creadoPorUsuarios.username;this.eventService.sendDeniedRequest({email:f,asunto:"Eliminaci\xF3n aceptada \u2714\uFE0F",mensaje:`Hemos aceptado tu solicitud de eliminaci\xF3n. Tu evento ${c.titulo} ha sido eliminado.`}).subscribe(g=>{alert("El evento ha sid oeliminado correctamente"),console.log(g)})}),this.eventService.updateEventState(this.eventId,"eliminado").subscribe(c=>c,c=>{console.error("Error fetching events:",c)})}declineElimination(){let c=prompt("Ingrese los motivos de rechazo: ");if(c==null||c==""){alert("Debe ingresar los motivos de rechazo");return}this.eventService.getEventById(this.eventId).subscribe(f=>{console.log(f);let g=f.creadoPorUsuarios.username;this.eventService.sendDeniedRequest({email:g,asunto:"Eliminaci\xF3n rechazada \u274C",mensaje:"El evento "+f.titulo+" no puede ser eliminado por los siguientes motivos : "+c}).subscribe(x=>{alert("Decision de rechazo enviada correctamente"),console.log(x)})}),this.eventService.updateEventState(this.eventId,"disponible").subscribe(f=>f,f=>{console.error("Error fetching events:",f)})}ngOnInit(){this.isAdmin=this.userService.isAdmin(),this.userId=this.userService.getUserIdFromToken(),this.tipo=this.userService.getUserTypeFromToken(),console.log(this.tipo),this.eventService.getEventDTOById(this.eventId).subscribe(c=>{this.event=c},c=>{console.error("Error fetching events:",c)}),this.isLogged=this.userService.isLogged(),this.isLogged&&(!this.isAdmin&&this.tipo=="Usuario"?(this.eventService.isUserInEvent(this.userId,this.eventId).subscribe(c=>{this.isUserInEvent=c},c=>{console.error("Error fetching events:",c)}),this.eventService.isUserCreator(this.userId,this.eventId).subscribe(c=>{c==!0&&(this.isCreator=!0)},c=>{console.error("Error fetching events:",c)})):this.eventService.isInstitucionInEvent(this.userId,this.eventId).subscribe(c=>{this.isInstitucionInEvent=c},c=>{console.log("Error fetching events: ",c)}))}};a.\u0275fac=function(f){return new(f||a)(qe(mi),qe(rn),qe(jo))},a.\u0275cmp=tn({type:a,selectors:[["app-event-details"]],inputs:{eventId:[Cr.None,"id","eventId"]},standalone:!0,features:[cn([mi,rn]),nn],decls:58,vars:27,consts:[[1,"container","p-4","text-white"],[1,"fw-bold","d-flex","align-items-center","gap-3"],[1,"badge","bg-secondary-dark","fs-5"],["class","badge bg-error-light fs-5"],[1,"grid-container"],[1,"area1"],["alt","",1,"rounded","w-100",3,"src"],[1,"area2"],[3,"lat","lon"],[1,"area3","d-flex","flex-column","justify-content-between"],[1,"d-flex","flex-column","gap-3"],[1,"fw-semibold"],[1,"d-block"],["class","d-block"],["class","modal fade show d-block","id","alertModal","tabindex","-1","aria-labelledby","modalLabel","aria-hidden","true"],[1,"badge","bg-error-light","fs-5"],["class","d-flex align-items-center gap-2"],[1,"d-flex","align-items-center","gap-2"],[1,"btn","bg-success-dark","text-white","w-50",3,"click"],[1,"btn","bg-error-dark","text-white","w-50",3,"click"],[1,"btn","bg-success-dark","text-white","w-100",3,"click"],[1,"btn","bg-error-dark","text-white","w-100",3,"click"],["class","btn bg-error-light text-white w-100"],["class","btn bg-error-dark text-white w-100"],[1,"btn","bg-error-light","text-white","w-100",3,"click"],[1,"btn","bg-secondary","text-white","w-100",3,"click"],["href","/login",1,"btn","bg-secondary","text-white","w-100"],["id","alertModal","tabindex","-1","aria-labelledby","modalLabel","aria-hidden","true",1,"modal","fade","show","d-block"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],["id","modalLabel",1,"modal-title","fs-5"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"modal-footer"],["type","button",1,"btn","btn-error-light",3,"click"]],template:function(f,g){f&1&&(De(0,"app-header"),U(1,"main",0)(2,"h1",1),K(3),U(4,"span",2),K(5),j(),Je(6,dZ,2,0,"span",3)(7,hZ,2,0),j(),U(8,"section",4)(9,"div",5),De(10,"img",6),j(),U(11,"div",7),Je(12,fZ,1,2,"app-map",8),j(),U(13,"div",9)(14,"article",10)(15,"section")(16,"h2",11),K(17,"Descripci\xF3n"),j(),U(18,"p"),K(19),j()(),U(20,"section")(21,"h2",11),K(22,"Informaci\xF3n"),j(),U(23,"span",12),K(24,"\u{1F4C5} Inicia el "),U(25,"b"),K(26),Lo(27,"date"),j(),K(28," a las "),U(29,"b"),K(30),Lo(31,"date"),j()(),U(32,"span",12),K(33,"\u{1F4C5} Acaba el "),U(34,"b"),K(35),Lo(36,"date"),j(),K(37," a las "),U(38,"b"),K(39),Lo(40,"date"),j()(),U(41,"span",12),K(42,"\u{1F64C} Se necesitan "),U(43,"b"),K(44),j()()(),U(45,"section")(46,"h2",11),K(47,"Organizador"),j(),U(48,"span",12),K(49),j()(),U(50,"section")(51,"h2",11),K(52,"Ubicaci\xF3n"),j(),Je(53,pZ,2,1,"span",13),j()(),Je(54,_Z,2,1)(55,DZ,2,1),j()()(),Je(56,NZ,18,2,"div",14),De(57,"app-footer")),f&2&&(he(3),Yn(g.event.titulo),he(2),mr("",g.event.numVoluntarios," \u{1F64B}\u200D\u2642\uFE0F"),he(),Pt(6,g.event.estado=="revision"?6:g.event.estado=="finalizado"?7:-1),he(4),ke("src",g.event.imagen,ir),he(2),Pt(12,g.event.ubicacion?12:-1),he(7),Yn(g.event.descripcion),he(7),Yn(No(27,15,g.event.finicio,"dd/MM/yyyy")),he(4),Yn(No(31,18,g.event.finicio,"shortTime")),he(5),Yn(No(36,21,g.event.ffin,"dd/MM/yyyy")),he(4),Yn(No(40,24,g.event.ffin,"shortTime")),he(5),mr("",g.event.maxVoluntarios," voluntarios"),he(5),mr("\u{1F464} ",g.event.creadoPorUsuario||g.event.creadoPorInstitucion,""),he(4),Pt(53,g.event.ubicacion?53:-1),he(),Pt(54,g.isAdmin?54:55),he(2),Pt(56,g.showAlert?56:-1))},dependencies:[wi,Ci,ya,eL],styles:['main[_ngcontent-%COMP%]{min-height:auto}.grid-container[_ngcontent-%COMP%]{display:grid;grid-template-columns:1fr 1fr;grid-template-rows:1fr 1fr;gap:1rem 1rem;grid-template-areas:"area1 area3" "area2 area3"}.area1[_ngcontent-%COMP%]{grid-area:area1}.area1[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{height:100%}.area2[_ngcontent-%COMP%]{grid-area:area2}.area3[_ngcontent-%COMP%]{grid-area:area3}p[_ngcontent-%COMP%]{margin:0}']});let s=a;return s})();function zZ(s,a){if(s&1){let d=Dn();U(0,"button",12),je("click",function(){xt(d);let f=Re();return bt(f.mostrarContenedor())}),K(1," Editar perfil "),j(),U(2,"a",13)(3,"button",14),K(4,"Cambiar contrase\xF1a"),j()()}}function BZ(s,a){s&1&&(U(0,"span",34),K(1," Introduce un tel\xE9fono v\xE1lido. "),j())}function VZ(s,a){s&1&&(U(0,"span",34),K(1," El correo electr\xF3nico ya est\xE1 en uso. "),j())}function jZ(s,a){s&1&&(U(0,"span",34),K(1," Introduce un correo electr\xF3nico v\xE1lido. "),j())}var nL=s=>({"is-invalid":s});function UZ(s,a){if(s&1){let d=Dn();U(0,"div",15)(1,"form",16),je("submit",function(){xt(d);let f=Re();return bt(f.submitEditar())}),U(2,"div",17)(3,"label",18),K(4,"Nombre"),j(),De(5,"input",19),j(),U(6,"div",17)(7,"label",20),K(8,"Apellidos"),j(),De(9,"input",21),j(),U(10,"div",17)(11,"label",22),K(12,"Tel\xE9fono"),j(),De(13,"input",23),Je(14,BZ,2,0,"span",24),j(),U(15,"div",25)(16,"label",26),K(17,"Correo electr\xF3nico"),j(),De(18,"input",27),Je(19,VZ,2,0,"span",28)(20,jZ,2,0),j(),U(21,"div",25)(22,"label",26),K(23,"Direcci\xF3n"),j(),De(24,"input",29),j(),U(25,"div",25)(26,"label",26),K(27,"Imagen de perfil"),j(),U(28,"input",30),je("change",function(f){xt(d);let g=Re();return bt(g.onProfileImageSelected(f))}),j()(),U(29,"div",25)(30,"label",26),K(31,"Imagen de banner"),j(),U(32,"input",31),je("change",function(f){xt(d);let g=Re();return bt(g.onBannerImageSelected(f))}),j()(),U(33,"div",32)(34,"button",33),K(35,"Guardar cambios"),j()()()()}if(s&2){let d=Re(),c,f,g,x,T;he(),ke("formGroup",d.profileForm),he(4),cc("placeholder",d.user.nombre),he(4),cc("placeholder",d.user.apellidos),he(4),cc("placeholder",d.user.telefono),ke("ngClass",Un(11,nL,((c=d.profileForm.get("telefono"))==null?null:c.invalid)&&(((c=d.profileForm.get("telefono"))==null?null:c.touched)||((c=d.profileForm.get("telefono"))==null?null:c.dirty)))),he(),ke("ngIf",((f=d.profileForm.get("telefono"))==null?null:f.invalid)&&(((f=d.profileForm.get("telefono"))==null?null:f.touched)||((f=d.profileForm.get("telefono"))==null?null:f.dirty))),he(4),cc("placeholder",d.user.email),ke("ngClass",Un(13,nL,((g=d.profileForm.get("email"))==null?null:g.invalid)&&(((g=d.profileForm.get("email"))==null?null:g.touched)||((g=d.profileForm.get("email"))==null?null:g.dirty)))),he(),Pt(19,(x=d.profileForm.get("email"))!=null&&x.hasError("emailInUse")?19:(T=d.profileForm.get("email"))!=null&&T.invalid&&((T=d.profileForm.get("email"))!=null&&T.touched||(T=d.profileForm.get("email"))!=null&&T.dirty)?20:-1),he(5),cc("placeholder",d.user.direccion),he(10),ke("disabled",d.profileForm.invalid)}}var iL=(()=>{let a=class a{constructor(c,f,g){this.fb=c,this.userService=f,this.eventoService=g,this.selectedProfileImage=null,this.selectedBannerImage=null,this.userId=-1,this.tipo="",this.editarperfil=!1,this.user={},this.event=[],this.editedUser=null,this.eventosPerfil={}}ngOnInit(){this.tipo=this.userService.getUserTypeFromToken(),console.log(this.tipo),this.tipo=="Usuario"&&(this.userId=this.userService.getUserIdFromToken(),this.eventoService.obtenerEventosPerfil(this.userId).subscribe(c=>{console.log(c),this.eventosPerfil=c},c=>{console.error("Error fetching events:",c)}),this.userService.getUserById(this.userId).subscribe(c=>{console.log(c),this.user=c},c=>{console.error("Error fetching user data:",c)}),this.eventoService.getEventsCreatedByUser(this.userId).subscribe(c=>{console.log(c),this.event=c,this.initializeForm(),console.log("Este es el formulario "+this.profileForm.value)},c=>{console.error("Error fetching events:",c)}))}initializeForm(){this.profileForm=this.fb.group({nombre:new wt(""),apellidos:new wt(""),dni:new wt(this.user.dni),telefono:new wt(""),direccion:new wt(""),email:new wt(""),fotoBanner:new wt(""),fotoPerfil:new wt(""),eventosNombre:new wt(this.user.eventosNombre)})}mostrarContenedor(){this.editarperfil=!this.editarperfil}onProfileImageSelected(c){let f=c.target.files[0];if(f){let g=new FileReader;g.onload=x=>{this.selectedProfileImage=x.target.result},g.readAsDataURL(f)}}onBannerImageSelected(c){let f=c.target.files[0];if(f){let g=new FileReader;g.onload=x=>{this.selectedBannerImage=x.target.result},g.readAsDataURL(f)}}submitEditar(){if(this.editedUser=this.user,this.editedUser){let c=this.profileForm.get("nombre")?.value??"",f=this.profileForm.get("apellidos")?.value??"",g=this.profileForm.get("telefono")?.value??"",x=this.profileForm.get("direccion")?.value??"",T=this.profileForm.get("email")?.value??"";c.trim()!==""&&(this.editedUser.nombre=c),f.trim()!==""&&(this.editedUser.apellidos=f),g.trim()!==""&&(this.editedUser.telefono=g),x.trim()!==""&&(this.editedUser.direccion=x),T.trim()!==""&&(this.editedUser.email=T),this.editedUser.fotoPerfil=this.selectedProfileImage,this.editedUser.fotoBanner=this.selectedBannerImage,this.userService.edit(this.userId,this.editedUser).subscribe(()=>{window.location.reload()},P=>{this.profileForm.get("email")?.setErrors({emailInUse:!0})})}}};a.\u0275fac=function(f){return new(f||a)(qe(ml),qe(rn),qe(mi))},a.\u0275cmp=tn({type:a,selectors:[["app-profile"]],standalone:!0,features:[cn([rn,mi]),nn],decls:28,vars:9,consts:[[1,"text-white","text-center","d-flex","flex-column","align-items-center"],[1,"d-flex","flex-column","align-items-center"],["alt","Imagen de banner",1,"img-fluid","imagenbanner",3,"src"],[1,"editarperfil","text-center","d-flex","align-items-center","flex-column"],["alt","Imagen de perfil",1,"rounded-circle","img-perfil",2,"position","absolute","transform","translateY(-70%)",3,"src"],[1,"margen","text-center","w-50"],[1,"text-center","sombras","fw-bold","mb-3"],[1,"row"],[1,"col-lg-4","col-md-12"],[1,"text-center","text-primary","fw-bold"],[1,"text-center"],["class","container py-5"],[1,"btn","btn-primary","btn-block","text-center","mt-4",3,"click"],["href","/newpassword"],[1,"btn","btn-primary","btn-block","text-center","mt-4","ms-3"],[1,"container","py-5"],[1,"row","g-3","form",3,"formGroup","submit"],[1,"col-lg-4"],["for","inputEmail4",1,"form-label"],["type","email","id","inputEmail4","formControlName","nombre",1,"form-control",3,"placeholder"],["for","inputPassword4",1,"form-label"],["type","text","id","inputPassword4","formControlName","apellidos",1,"form-control",3,"placeholder"],["for","inputAddress2",1,"form-label"],["type","tel","id","inputAddress2","formControlName","telefono","minlength","9","maxlength","9","pattern","[0-9]*",1,"form-control",3,"placeholder","ngClass"],["class","invalid-feedback",4,"ngIf"],[1,"col-lg-6"],["for","inputAddress",1,"form-label"],["type","email","id","inputAddress","formControlName","email","pattern","[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,4}",1,"form-control",3,"placeholder","ngClass"],["class","invalid-feedback"],["type","text","id","inputAddress","formControlName","direccion",1,"form-control",3,"placeholder"],["type","file","accept","image/jpg, image/jpeg, image/webp","formControlName","fotoPerfil",1,"form-control",3,"change"],["type","file","accept","image/jpg, image/jpeg, image/webp","formControlName","fotoBanner",1,"form-control",3,"change"],[1,"col-12","mt-4"],["type","submit",1,"btn","btn-primary","w-100",3,"disabled"],[1,"invalid-feedback"]],template:function(f,g){f&1&&(De(0,"app-header"),U(1,"main",0)(2,"div",1),De(3,"img",2),U(4,"div",3),De(5,"img",4),j()(),U(6,"div",5)(7,"h1",6),K(8),j(),U(9,"div",7)(10,"div",8)(11,"h5",9),K(12),j(),U(13,"h5",10),K(14,"Creados"),j()(),U(15,"div",8)(16,"h5",9),K(17),j(),U(18,"h5",10),K(19,"Apuntados"),j()(),U(20,"div",8)(21,"h5",9),K(22),j(),U(23,"h5",10),K(24,"Realizados"),j()()(),Je(25,zZ,5,0),j(),Je(26,UZ,36,15,"div",11),j(),De(27,"app-footer")),f&2&&(he(3),ke("src",g.user.fotoBanner,ir),he(2),ke("src",g.user.fotoPerfil,ir),he(3),Uh("",g.user.nombre," ",g.user.apellidos,""),he(4),Yn(g.eventosPerfil.creados),he(5),Yn(g.eventosPerfil.apuntados),he(5),Yn(g.eventosPerfil.realizados),he(3),Pt(25,g.tipo=="Usuario"?25:-1),he(),Pt(26,g.editarperfil&&g.tipo=="Usuario"?26:-1))},dependencies:[wi,Ci,S_,lr,ar,Wi,or,sr,bf,wf,Cf,Qi,er,cl,ul],styles:["main[_ngcontent-%COMP%]{margin-top:0}.margen[_ngcontent-%COMP%]{margin-top:5rem}.imagenbanner[_ngcontent-%COMP%]{width:100vw;height:300px;object-fit:cover}.img-perfil[_ngcontent-%COMP%]{width:180px;height:180px;border:10px solid #241c24}.sombras[_ngcontent-%COMP%]{text-shadow:0 0 10px rgba(0,0,0,.8)}main[_ngcontent-%COMP%]{cursor:default}is-invalid[_ngcontent-%COMP%]{border:1px solid red}.invalid-feedback[_ngcontent-%COMP%]{color:red;font-size:12px;margin-top:0}"]});let s=a;return s})();function $Z(s,a){s&1&&(U(0,"option",4),K(1,"Apuntados"),j())}function GZ(s,a){s&1&&(U(0,"option",4),K(1,"Apoyados"),j())}var HZ=(s,a)=>a.id;function qZ(s,a){if(s&1&&(U(0,"div",9),De(1,"app-event-card",10),j()),s&2){let d=Re().$implicit;he(),ke("image",d.imagen)("id",d.id)("title",d.titulo)("startDate",d.finicio)("endDate",d.ffin)("location",d.ubicacion.nombre)("numVolunteers",d.numVoluntarios)("createdByUser",d.creadoPorUsuario)("createdByInstitution",d.creadoPorInstitucion)("nombreInstituciones",d.nombreInstituciones)}}function WZ(s,a){if(s&1&&Je(0,qZ,2,10,"div",8),s&2){let d=a.$implicit;Pt(0,d.estado!=="eliminado"&&d.estado!=="denegado"?0:-1)}}function ZZ(s,a){if(s&1&&(U(0,"section",7),po(1,WZ,1,1,null,null,HZ),j()),s&2){let d=Re();he(),mo(d.events)}}function XZ(s,a){s&1&&(U(0,"h1",11),K(1,"No hay eventos disponibles"),j(),U(2,"h4",12)(3,"a",13),K(4,"Crea un evento aqu\xED"),j()())}var rL=(()=>{let a=class a{constructor(c,f){this.eventService=c,this.userService=f,this.events=[],this.userId=-1,this.tipo=""}handleChange(c){switch(c.target.value){case"apuntados":this.tipo=="Usuario"?this.eventService.getEventsByUser(this.userId).subscribe(g=>{this.events=g},g=>{console.error("Error fetching events:",g)}):this.tipo=="Institucion"&&this.eventService.getEventsByInstitution(this.userId).subscribe(g=>{this.events=g},g=>{console.error("Error fetching events:",g)});break;case"creados":this.tipo=="Usuario"?this.eventService.getEventsCreatedByUser(this.userId).subscribe(g=>{this.events=g},g=>{console.error("Error fetching events:",g)}):this.tipo=="Institucion"&&this.eventService.getEventsCreatedByInstitution(this.userId).subscribe(g=>{this.events=g},g=>{console.error("Error fetching events:",g)});break}}ngOnInit(){this.userId=this.userService.getUserIdFromToken(),this.tipo=this.userService.getUserTypeFromToken(),this.tipo=="Usuario"?this.eventService.getEventsByUser(this.userId).subscribe(c=>{this.events=c},c=>{console.error("Error fetching events:",c)}):this.tipo=="Institucion"&&this.eventService.getEventsByInstitution(this.userId).subscribe(c=>{this.events=c},c=>{console.error("Error fetching events:",c)})}};a.\u0275fac=function(f){return new(f||a)(qe(mi),qe(rn))},a.\u0275cmp=tn({type:a,selectors:[["app-event-management"]],standalone:!0,features:[cn([mi,rn]),nn],decls:13,vars:2,consts:[[1,"container-fluid","px-5","text-white","py-4"],[1,"d-flex","gap-4","mb-3"],[1,"fw-bold"],["aria-label","Default select example",1,"form-select",3,"change"],["selected","","value","apuntados"],["value","creados"],["class","row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3"],[1,"row","row-cols-1","row-cols-sm-2","row-cols-md-3","g-3"],["class","col"],[1,"col"],[3,"image","id","title","startDate","endDate","location","numVolunteers","createdByUser","createdByInstitution","nombreInstituciones"],[1,"text-center","text-white","fw-bold","mt-5"],[1,"text-center","text-white"],["href","/create-event"]],template:function(f,g){f&1&&(De(0,"app-header"),U(1,"main",0)(2,"div",1)(3,"h1",2),K(4,"Mis eventos"),j(),U(5,"select",3),je("change",function(T){return g.handleChange(T)}),Je(6,$Z,2,0,"option",4)(7,GZ,2,0),U(8,"option",5),K(9,"Creados"),j()()(),Je(10,ZZ,3,0,"section",6)(11,XZ,5,0),j(),De(12,"app-footer")),f&2&&(he(6),Pt(6,g.tipo==="Usuario"?6:g.tipo==="Institucion"?7:-1),he(4),Pt(10,g.events.length!==0?10:11))},dependencies:[Ci,wi,od],styles:["select[_ngcontent-%COMP%]{width:fit-content}"]});let s=a;return s})();var sy=(()=>{let a=class a{constructor(c){this.http=c,this.baseUrl=tr.server.ip+":"+tr.server.port}enviarConsulta(c){let f=`${this.baseUrl}/contacto/enviarCorreo`;return this.http.post(f,c)}};a.\u0275fac=function(f){return new(f||a)(vt(_o))},a.\u0275prov=gt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();var oL=(()=>{let a=class a{constructor(c,f){this.contactService=c,this.userService=f,this.contactForm=new vr({email:new wt(""),nombre:new wt(""),apellidos:new wt(""),mensaje:new wt("")})}hacerConsulta(){let c={email:this.contactForm.value.email,asunto:"ID usuario: "+this.userService.isLogged()?this.userService.getUserIdFromToken().toString():"Consulta de invitado",mensaje:this.contactForm.value.nombre+" "+this.contactForm.value.apellidos+`
Consulta: `+this.contactForm.value.mensaje};this.contactService.enviarConsulta(c).subscribe(f=>{console.log(f)})}};a.\u0275fac=function(f){return new(f||a)(qe(sy),qe(rn))},a.\u0275cmp=tn({type:a,selectors:[["app-contact"]],standalone:!0,features:[cn([sy,rn]),nn],decls:33,vars:1,consts:[[1,"container","d-flex","py-4","flex-column","gap-2","text-white","align-items-center"],[1,"d-flex","flex-column","w-75"],[1,"border-bottom"],[1,"fw-bold","text-start"],[1,"text-start"],[1,"w-100","text-start"],[1,"fw-bold","mt-4","text-center","mb-4"],[1,"w-100"],[1,"form",3,"formGroup","ngSubmit"],[1,"form-floating","mb-4","text-black"],["type","email","id","email","formControlName","email","placeholder","name@example.com","required","",1,"form-control"],["for","email"],["type","text","id","nombre","formControlName","nombre","placeholder","Nombre","required","",1,"form-control"],["for","nombre"],["type","text","id","apellidos","formControlName","apellidos","placeholder","Apellidos",1,"form-control"],["for","apellidos"],["id","mensaje","formControlName","mensaje","placeholder","Deja aqu\xED tu consulta",1,"form-control",2,"min-height","125px"],["for","consulta"],["type","submit",1,"btn","btn-primary","w-100"]],template:function(f,g){f&1&&(De(0,"app-header"),U(1,"main",0)(2,"div",1)(3,"div",2)(4,"h1",3),K(5,"Contacto"),j(),U(6,"h2",4),K(7,"\xBFEn qu\xE9 podemos ayudarte?"),j(),U(8,"p",5),K(9,"Si tienes cualquier duda sobre algun evento, o sobre apuntarse o crear un evento de voluntariado, puede contactar con nuestro equipo de administraci\xF3n de las siguientes maneras:"),j()(),U(10,"h2",6),K(11,"Rellena el formulario para realizar tu consulta"),j(),U(12,"div",7)(13,"form",8),je("ngSubmit",function(){return g.hacerConsulta()}),U(14,"div",9),De(15,"input",10),U(16,"label",11),K(17,"Correo electr\xF3nico"),j()(),U(18,"div",9),De(19,"input",12),U(20,"label",13),K(21,"Nombre"),j()(),U(22,"div",9),De(23,"input",14),U(24,"label",15),K(25,"Apellidos"),j()(),U(26,"div",9),De(27,"textarea",16),U(28,"label",17),K(29,"Escribe aqu\xED tu consulta"),j()(),U(30,"button",18),K(31,"Enviar"),j()()()()(),De(32,"app-footer")),f&2&&(he(13),ke("formGroup",g.contactForm))},dependencies:[wi,Ci,lr,ar,Wi,or,sr,va,Qi,er]});let s=a;return s})();var KZ=(s,a)=>a.id;function JZ(s,a){if(s&1&&(U(0,"div",8),De(1,"app-event-card",9),j()),s&2){let d=a.$implicit;he(),ke("image",d.imagen)("id",d.id)("title",d.titulo)("startDate",d.finicio)("endDate",d.ffin)("location",d.ubicacion.nombre)("numVolunteers",d.numVoluntarios)("createdByUser",d.creadoPorUsuario)("createdByInstitution",d.creadoPorInstitucion)("nombreInstituciones",d.nombreInstituciones)}}function QZ(s,a){if(s&1&&(U(0,"section",7),po(1,JZ,2,10,"div",10,KZ),j()),s&2){let d=Re();he(),mo(d.events)}}function eX(s,a){s&1&&(U(0,"h1",11),K(1,"No hay eventos por validar"),j())}var sL=(()=>{let a=class a{constructor(c){this.eventService=c,this.events=[]}handleChange(c){switch(c.target.value){case"crear":this.eventService.getEventsByState("revision").subscribe(g=>{this.events=g.content},g=>{console.error("Error fetching events:",g)});break;case"eliminar":this.eventService.getEventsByState("en-eliminacion").subscribe(g=>{this.events=g.content},g=>{console.error("Error fetching events:",g)});break}}ngOnInit(){this.eventService.getEventsByState("revision").subscribe(c=>{this.events=c.content},c=>{console.error("Error fetching events por aprobar:",c)})}};a.\u0275fac=function(f){return new(f||a)(qe(mi))},a.\u0275cmp=tn({type:a,selectors:[["app-event-validation"]],standalone:!0,features:[cn([mi]),nn],decls:13,vars:1,consts:[[1,"container","text-white","py-4"],[1,"d-flex","flex-column","gap-4","mb-3"],[1,"fw-bold"],["aria-label","Default select example",1,"form-select",3,"change"],["selected","","value","crear"],["value","eliminar"],["class","row row-cols-1 row-cols-sm-2 row-cols-md-3 g-3"],[1,"row","row-cols-1","row-cols-sm-2","row-cols-md-3","g-3"],[1,"col"],[3,"image","id","title","startDate","endDate","location","numVolunteers","createdByUser","createdByInstitution","nombreInstituciones"],["class","col"],[1,"text-center","text-white","fw-bold","mt-5"]],template:function(f,g){f&1&&(De(0,"app-header"),U(1,"main",0)(2,"div",1)(3,"h1",2),K(4,"Validaciones de eventos"),j(),U(5,"select",3),je("change",function(T){return g.handleChange(T)}),U(6,"option",4),K(7,"Solicitudes de subida"),j(),U(8,"option",5),K(9,"Solicitudes de eliminaci\xF3n"),j()()(),Je(10,QZ,3,0,"section",6)(11,eX,2,0),j(),De(12,"app-footer")),f&2&&(he(10),Pt(10,g.events.length!==0?10:11))},dependencies:[wi,Ci,od],styles:["select[_ngcontent-%COMP%]{width:fit-content}"]});let s=a;return s})();var tX=(s,a)=>a.id;function nX(s,a){if(s&1){let d=Dn();U(0,"h2",3),K(1,"Editar noticia"),j(),U(2,"div",28)(3,"form",29),je("submit",function(){xt(d);let f=Re(3);return bt(f.submitEdit())}),U(4,"div",6),De(5,"input",30),U(6,"label",8),K(7,"Titulo de noticia"),j()(),U(8,"div",9),De(9,"input",31),j(),U(10,"div",6),De(11,"textarea",11),U(12,"label",12),K(13,"Contenido"),j()(),U(14,"div",32)(15,"button",33),K(16,"Guardar cambios"),j(),U(17,"button",34),je("click",function(){xt(d);let f=Re(3);return bt(f.cancelEdit())}),K(18,"Cancelar"),j()()()()}if(s&2){let d=Re(3);he(3),ke("formGroup",d.newsForm)}}function iX(s,a){if(s&1){let d=Dn();U(0,"article")(1,"div",15)(2,"div",16)(3,"div",17),De(4,"img",18),j(),U(5,"div",19)(6,"div",20)(7,"h3",21),K(8),j(),U(9,"p",22),K(10),j()(),U(11,"div",23)(12,"small",24)(13,"b"),K(14),j(),K(15),Lo(16,"date"),j()()()()(),U(17,"div",25)(18,"button",26),je("click",function(){let g=xt(d).$implicit,x=Re(2);return bt(x.editNews(g.id))}),K(19,"Editar"),j(),U(20,"button",27),je("click",function(){let g=xt(d).$implicit,x=Re(2);return bt(x.deleteNews(g.id))}),K(21,"Eliminar"),j()(),Je(22,nX,19,1),j()}if(s&2){let d=a.$implicit,c=Re(2);he(4),ke("src",d.imagen,ir),he(4),Yn(d.titulo),he(2),Yn(d.contenido),he(4),Yn(d.autor),he(),mr(" - ",No(16,6,d.fecha,"dd/MM/yyyy"),""),he(7),Pt(22,c.isEditing?22:-1)}}function rX(s,a){if(s&1&&(U(0,"div",2),po(1,iX,23,9,"article",null,tX),j()),s&2){let d=Re();he(),mo(d.newsMostrar)}}function oX(s,a){s&1&&(U(0,"h3",3),K(1,"No hay noticias"),j())}var aL=(()=>{let a=class a{constructor(c,f,g){this.fb=c,this.newsService=f,this.userService=g,this.newsForm=new vr({titulo:new wt("",un.required),contenido:new wt("",un.required),imagen:new wt("",un.required),fecha:new wt(new Date),autor:new wt("")}),this.newsMostrar=[],this.editingNews=null,this.isEditing=!1,this.selectedImage=null}onFileSelected(c){let f=c.target.files[0];if(f){let g=new FileReader;g.onload=x=>{this.selectedImage=x.target.result},g.readAsDataURL(f)}}submitNew(){let c=this.userService.getUserIdFromToken();this.userService.getUserById(c).subscribe(f=>{console.log(f),this.newsForm.value.autor=f.nombre+" "+f.apellidos,this.newsForm.value.imagen=this.selectedImage,this.newsService.createNews(this.newsForm.value).subscribe(g=>{console.log("Noticia creada:",g),this.updateNewsList()},g=>{console.error("Error al crear noticia:",g)})})}ngOnInit(){this.updateNewsList()}deleteNews(c){this.newsService.deleteNews(c).subscribe(()=>{console.log("Noticia eliminada con \xE9xito"),this.updateNewsList()},f=>{console.error("Error al eliminar noticia:",f)})}updateNewsList(){this.newsService.getNews().subscribe(c=>{c&&c.content?this.newsMostrar=c.content:this.newsMostrar=[]},c=>{console.error("Error al obtener noticias:",c)})}editNews(c){this.editingNews=this.newsMostrar.find(f=>f.id===c)||null,this.isEditing=!0}cancelEdit(){this.editingNews=null,this.isEditing=!1,this.newsForm.reset()}submitEdit(){if(this.editingNews){let c=this.newsForm.get("titulo")?.value??"",f=this.newsForm.get("contenido")?.value??"",g=this.newsForm.get("imagen")?.value??"";c.trim()!==""&&(this.editingNews.titulo=c),f.trim()!==""&&(this.editingNews.contenido=f),g.trim()!==""&&(this.editingNews.imagen=g),this.newsService.editNews(this.editingNews.id,this.editingNews).subscribe(()=>{console.log("Noticia editada con \xE9xito"),this.updateNewsList(),this.editingNews=null,this.isEditing=!1,this.newsForm.reset()},x=>{console.error("Error al editar noticia:",x)})}}};a.\u0275fac=function(f){return new(f||a)(qe(ml),qe($o),qe(rn))},a.\u0275cmp=tn({type:a,selectors:[["app-new-create"]],standalone:!0,features:[cn([$o,rn]),nn],decls:25,vars:2,consts:[[1,"container-fluid","gap-2","text-white","px-5"],[1,"row"],[1,"d-flex","flex-column","w-100"],[1,"fw-bold","mt-4","mb-4"],[1,"w-100"],[1,"form",3,"formGroup","submit"],[1,"form-floating","mb-4","text-black"],["type","text","id","titulo","formControlName","titulo","placeholder","Titulo de noticia","required","",1,"form-control"],["for","noticia"],[1,"formFile","mb-4","text-black","text-center"],["type","file","accept","image/png, image/jpg, image/jpeg, image/webp","formControlName","imagen","id","formFile",1,"form-control","py-3",3,"change"],["formControlName","contenido","placeholder","Contenido","id","consulta",1,"form-control",2,"min-height","125px"],["for","consulta"],["type","submit",1,"btn","btn-primary","w-100"],["class","d-flex flex-column w-100"],[1,"card","mb-3"],[1,"row","g-0"],[1,"col-md-4"],["alt","...",1,"img-fluid","rounded-start",3,"src"],[1,"col-md-8","d-flex","flex-column"],[1,"card-body"],[1,"card-title","m-3"],[1,"card-text","m-3"],[1,"card-footer","text-end"],[1,"text-body-secondary"],[1,"d-flex","justify-content-end","gap-2","mt-3","pb-4"],["type","submit",1,"btn","btn-primary",3,"click"],[1,"btn","btn-error-dark",3,"click"],[1,"d-flex","align-items-center"],[1,"form","w-100",3,"formGroup","submit"],["type","text","id","titulo","formControlName","titulo","placeholder","Titulo de noticia",1,"form-control"],["type","file","formControlName","imagen","id","formFile",1,"form-control","py-3"],[1,"d-flex","justify-content-end","align-items-center","pb-4","gap-2"],["type","submit",1,"btn","btn-primary"],["type","button",1,"btn","btn-error-dark",3,"click"]],template:function(f,g){f&1&&(De(0,"app-header"),U(1,"main",0)(2,"div",1)(3,"div",2)(4,"h2",3),K(5,"Crear noticia"),j(),U(6,"div",4)(7,"form",5),je("submit",function(){return g.submitNew()}),U(8,"div",6),De(9,"input",7),U(10,"label",8),K(11,"Titulo de noticia"),j()(),U(12,"div",9)(13,"input",10),je("change",function(T){return g.onFileSelected(T)}),j()(),U(14,"div",6),De(15,"textarea",11),U(16,"label",12),K(17,"Contenido"),j()(),U(18,"button",13),K(19," Crear noticia "),j()()()()(),U(20,"h2",3),K(21,"Lista de Noticias"),j(),Je(22,rX,3,0,"div",14)(23,oX,2,0),j(),De(24,"app-footer")),f&2&&(he(7),ke("formGroup",g.newsForm),he(15),Pt(22,g.newsMostrar.length!==0?22:23))},dependencies:[wi,Ci,lr,ar,Wi,or,sr,va,Qi,er,ya]});let s=a;return s})();var ay=(()=>{let a=class a{constructor(c){this.http=c}searchWord(c){return this.http.get("https://api.mapbox.com/geocoding/v5/mapbox.places/"+c+".json?types=address&country="+"ES"+"&access_token="+tr.mapbox.accessToken).pipe(ot(x=>x.features))}};a.\u0275fac=function(f){return new(f||a)(vt(_o))},a.\u0275prov=gt({token:a,factory:a.\u0275fac,providedIn:"root"});let s=a;return s})();function aX(s,a){s&1&&(U(0,"div",30),K(1," El nombre es requerido y debe tener al menos 5 car\xE1cteres. "),j())}function lX(s,a){s&1&&(U(0,"div",30),K(1," Se requiere de una breve descripci\xF3n del evento. "),j())}function cX(s,a){if(s&1){let d=Dn();U(0,"li",31),je("click",function(){let g=xt(d).$implicit,x=Re(2);return bt(x.onSelect(g))}),K(1),j()}if(s&2){let d=a.$implicit;he(),Yn(d.place_name)}}function uX(s,a){if(s&1&&(U(0,"ul"),po(1,cX,2,1,"li",null,o_),j()),s&2){let d=Re();he(),mo(d.addresses)}}function dX(s,a){s&1&&(U(0,"div",30),K(1," Se necesita una ubicaci\xF3n para el evento. "),j())}function hX(s,a){s&1&&(U(0,"div",30),K(1," Es necesario establecer la fecha de inicio del evento. "),j())}function fX(s,a){s&1&&(U(0,"div",30),K(1," Es necesario establecer la fecha posterior a la fecha de inicio del evento. "),j())}function pX(s,a){s&1&&(U(0,"div",30),K(1," Se requiere establecer un l\xEDmite de voluntarios, no puede ser negativo ni menor de 10. "),j())}function mX(s,a){s&1&&(U(0,"div",30),K(1," La imagen es requerida. "),j())}function gX(s,a){if(s&1&&De(0,"img",32),s&2){let d=Re();ke("src",d.selectedImage,ir)}}function _X(s,a){s&1&&K(0," Evento creado \u{1F389} ")}function yX(s,a){s&1&&K(0," Error al crear el evento \u274C ")}function vX(s,a){s&1&&K(0," El siguiente evento pasar\xE1 por un proceso de validaci\xF3n antes de ser publicado, se le notificar\xE1 de este en caso de haber pasado la revisi\xF3n. ")}function xX(s,a){if(s&1&&K(0),s&2){let d=Re(2);mr(" ",d.errorMessage," ")}}function bX(s,a){if(s&1){let d=Dn();U(0,"div",33)(1,"div",34)(2,"div",35)(3,"div",36)(4,"h1",37),Je(5,_X,1,0)(6,yX,1,0),j(),U(7,"button",38),je("click",function(){xt(d);let f=Re();return bt(f.closeAlert())}),j()(),U(8,"div",39),Je(9,vX,1,0)(10,xX,1,1),j(),U(11,"div",40)(12,"button",41),je("click",function(){xt(d);let f=Re();return bt(f.goToMyEvents())}),K(13,"Mis eventos"),j(),U(14,"button",42),je("click",function(){xt(d);let f=Re();return bt(f.closeAlert())}),K(15,"Cerrar"),j()()()()()}if(s&2){let d=Re();he(5),Pt(5,d.createdSuccessfully===!0?5:d.createdSuccessfully===!1?6:-1),he(4),Pt(9,d.createdSuccessfully===!0?9:d.createdSuccessfully===!1?10:-1)}}var yc=s=>({"is-invalid":s}),lL=(()=>{let a=class a{constructor(c,f,g,x,T){this.eventService=c,this.userService=f,this.mapboxService=g,this.institutionService=x,this.router=T,this.userId=-1,this.user={},this.institution={},this.selectedImage=null,this.addresses=[],this.selectedAddressName=null,this.selectedAddress=null,this.tipo="",this.createdSuccessfully=null,this.errorMessage="",this.showAlert=!1,this.inputFecha=document.getElementById("finicio"),this.inputFecha&&(this.inputFecha.addEventListener("keydown",P=>{P.preventDefault()}),this.inputFecha.addEventListener("mousedown",P=>{P.preventDefault()}))}ngOnInit(){this.initializeForm(),this.userId=this.userService.getUserIdFromToken(),this.tipo=this.userService.getUserTypeFromToken(),this.tipo=="Usuario"?this.userService.getUserById(this.userId).subscribe(c=>{this.user=c,this.initializeForm()},c=>{console.error("Error fetching events:",c)}):this.tipo=="Institucion"&&this.institutionService.getInstitucionById(this.userId).subscribe(c=>{this.institution=c,this.initializeForm()},c=>{console.error("Error fetching events:",c)})}initializeForm(){this.eventForm=new vr({id:new wt(""),finicio:new wt("",un.required),ffin:new wt("",un.required),titulo:new wt("",un.required),descripcion:new wt("",un.required),nombreUbicacion:new wt("",un.required),lat:new wt(""),lon:new wt(""),imagen:new wt(null,un.required),estado:new wt(""),usuarioNombre:new wt(null),usuarioId:new wt(this.userId),institucionNombre:new wt(null),maxVoluntarios:new wt("",un.required)}),this.tipo=="Usuario"?this.eventForm&&(this.eventForm.get("usuarioNombre")?.setValue(this.user.nombre),this.eventForm.get("usuarioId")?.setValue(this.user.id)):this.tipo=="Institucion"&&this.eventForm&&this.eventForm.get("institucionNombre")?.setValue(this.institution.nombre)}closeAlert(){this.showAlert=!1}goToMyEvents(){this.router.navigate(["/myevents"])}validarFechas(c){let f=c.get("finicio"),g=c.get("ffin");if(f&&g&&f.value&&g.value){let x=new Date(f.value);new Date(g.value)<x?g.setErrors({fechaInvalida:!0}):g.setErrors(null)}}obtenerFechaActual(){let c=new Date,f=c.getMonth()+1,g=c.getDate(),x=c.getHours(),T=c.getMinutes(),P=f<10?`0${f}`:f,O=g<10?`0${g}`:g,Z=x<10?`0${x}`:x,ee=T<10?`0${T}`:T;return`${c.getFullYear()}-${P}-${O}T${Z}:${ee}`}onFileSelected(c){let f=c.target.files[0];if(f){let g=new FileReader;g.onload=x=>{this.selectedImage=x.target.result},g.readAsDataURL(f)}}search(c){let f=c.target.value.toLowerCase();f&&f.length>0?this.mapboxService.searchWord(f).subscribe(g=>{this.addresses=g.map(x=>({place_name:x.place_name,center:x.center}))}):this.addresses=[]}onSelect(c){this.selectedAddress=c,this.selectedAddressName=c.place_name,this.eventForm.patchValue({nombreUbicacion:c.place_name});let f=document.getElementById("searchLocationInput");f&&(f.value=""),this.addresses=[]}submitEvent(){if(this.eventForm.valid){let c=this.eventForm.value;c.nombreUbicacion=this.selectedAddress?.place_name,c.lat=this.selectedAddress?.center[0],c.lon=this.selectedAddress?.center[1],c.imagen=this.selectedImage,this.eventService.createEvent(c).subscribe(f=>{this.tipo==="Usuario"?this.eventService.addUserToEvent(this.userId,Number(f.id)).subscribe():this.tipo==="Institucion"&&this.eventService.addInstitutionToEvent(this.userId,Number(f.id)).subscribe(),this.createdSuccessfully=!0},f=>{this.createdSuccessfully=!1,this.errorMessage=f.error},()=>{this.eventForm.reset(),this.initializeForm(),this.selectedImage=null,this.showAlert=!0})}}};a.\u0275fac=function(f){return new(f||a)(qe(mi),qe(rn),qe(ay),qe(Uo),qe(jo))},a.\u0275cmp=tn({type:a,selectors:[["app-event-create"]],standalone:!0,features:[cn([mi,rn,Uo,ay]),nn],decls:53,vars:36,consts:[[1,"container"],[1,"card","mx-auto","p-4"],[1,"card-header"],[1,"fw-bold"],[1,"form",3,"formGroup","submit"],[1,"card-body"],[1,"d-grid","mb-3","mb-3"],["for","titulo"],["type","text","placeholder","Titulo","name","titulo","formControlName","titulo",1,"rounded","form-control",3,"ngClass"],["class","invalid-feedback",4,"ngIf"],[1,"d-grid","mb-3"],["for","descripcion"],["rows","6","cols","30","placeholder","Descripci\xF3n","name","descripcion","formControlName","descripcion",1,"rounded","form-control",3,"ngClass"],["for","ubicaci\xF3n"],["type","text","id","searchLocationInput","placeholder","Busca la direcci\xF3n deseada",1,"w-100","rounded","form-control",3,"input"],["type","text","readonly","","formControlName","nombreUbicacion",1,"w-100","rounded","form-control",3,"value","ngClass"],[1,"d-flex"],[1,"d-grid","mb-3","w-100"],["for","finicio"],["type","datetime-local","name","finicio","formControlName","finicio",1,"rounded","form-control",3,"min","ngClass"],["for","ffin"],["type","datetime-local","name","ffin","formControlName","ffin",1,"rounded","form-control",3,"ngClass","min"],["for","maxVoluntarios"],["type","number","min","10","name","maxVoluntarios","formControlName","maxVoluntarios",1,"rounded","form-control",3,"ngClass"],["for","imagen"],["type","file","accept","image/jpg, image/jpeg, image/webp","name","imagen","formControlName","imagen",3,"ngClass","change"],["alt","Imagen seleccionada",3,"src",4,"ngIf"],[1,"card-footer","text-end"],[1,"btn","btn-secondary","mt-4",3,"disabled"],["class","modal fade show d-block","id","alertModal","tabindex","-1","aria-labelledby","modalLabel","aria-hidden","true"],[1,"invalid-feedback"],[3,"click"],["alt","Imagen seleccionada",3,"src"],["id","alertModal","tabindex","-1","aria-labelledby","modalLabel","aria-hidden","true",1,"modal","fade","show","d-block"],[1,"modal-dialog"],[1,"modal-content"],[1,"modal-header"],["id","modalLabel",1,"modal-title","fs-5"],["type","button","aria-label","Close",1,"btn-close",3,"click"],[1,"modal-body"],[1,"modal-footer"],["type","button",1,"btn","btn-secondary",3,"click"],["type","button",1,"btn","btn-error-light",3,"click"]],template:function(f,g){if(f&1&&(De(0,"app-header"),U(1,"main",0)(2,"div",1)(3,"div",2)(4,"h1",3),K(5,"Crea tu evento"),j()(),U(6,"form",4),je("submit",function(){return g.submitEvent()}),U(7,"div",5)(8,"div",6)(9,"label",7),K(10,"Nombre del evento: "),j(),De(11,"input",8),Je(12,aX,2,0,"div",9),j(),U(13,"div",10)(14,"label",11),K(15,"Descripci\xF3n del evento: "),j(),U(16,"textarea",12),K(17,"                    "),j(),Je(18,lX,2,0,"div",9),j(),U(19,"div",10)(20,"label",13),K(21,"Ubicaci\xF3n del evento: "),j(),U(22,"input",14),je("input",function(T){return g.search(T)}),j(),Je(23,uX,3,0,"ul"),De(24,"input",15),Je(25,dX,2,0,"div",9),j(),U(26,"div",16)(27,"div",17)(28,"label",18),K(29,"Fecha de inicio: "),j(),De(30,"input",19),Je(31,hX,2,0,"div",9),j(),U(32,"div",17)(33,"label",20),K(34,"Fecha de fin: "),j(),De(35,"input",21),Je(36,fX,2,0,"div",9),j()(),U(37,"div",10)(38,"label",22),K(39,"M\xE1ximo de voluntarios: "),j(),De(40,"input",23),Je(41,pX,2,0,"div",9),j(),U(42,"div",10)(43,"label",24),K(44,"Introduzca la imagen del evento:"),j(),U(45,"input",25),je("change",function(T){return g.onFileSelected(T)}),j(),Je(46,mX,2,0,"div",9)(47,gX,1,1,"img",26),j()(),U(48,"div",27)(49,"button",28),K(50,"Crear"),j()()()(),Je(51,bX,16,2,"div",29),j(),De(52,"app-footer")),f&2){let x,T,P,O,Z,ee,ce,Ee,Ze,Vt,dt,tt,Ln,ri,bn;he(6),ke("formGroup",g.eventForm),he(5),ke("ngClass",Un(22,yc,((x=g.eventForm.get("titulo"))==null?null:x.invalid)&&(((x=g.eventForm.get("titulo"))==null?null:x.touched)||((x=g.eventForm.get("titulo"))==null?null:x.dirty)))),he(),ke("ngIf",((T=g.eventForm.get("titulo"))==null?null:T.invalid)&&(((T=g.eventForm.get("titulo"))==null?null:T.touched)||((T=g.eventForm.get("titulo"))==null?null:T.dirty))),he(4),ke("ngClass",Un(24,yc,((P=g.eventForm.get("descripcion"))==null?null:P.invalid)&&(((P=g.eventForm.get("descripcion"))==null?null:P.touched)||((P=g.eventForm.get("descripcion"))==null?null:P.dirty)))),he(2),ke("ngIf",((O=g.eventForm.get("descripcion"))==null?null:O.invalid)&&(((O=g.eventForm.get("descripcion"))==null?null:O.touched)||((O=g.eventForm.get("descripcion"))==null?null:O.dirty))),he(5),Pt(23,g.addresses.length>0?23:-1),he(),ke("value",g.selectedAddressName)("ngClass",Un(26,yc,((Z=g.eventForm.get("nombreUbicacion"))==null?null:Z.invalid)&&(((Z=g.eventForm.get("nombreUbicacion"))==null?null:Z.touched)||((Z=g.eventForm.get("nombreUbicacion"))==null?null:Z.dirty)))),he(),ke("ngIf",((ee=g.eventForm.get("nombreUbicacion"))==null?null:ee.invalid)&&(((ee=g.eventForm.get("nombreUbicacion"))==null?null:ee.touched)||((ee=g.eventForm.get("nombreUbicacion"))==null?null:ee.dirty))),he(5),ke("min",g.obtenerFechaActual())("ngClass",Un(28,yc,((ce=g.eventForm.get("finicio"))==null?null:ce.invalid)&&(((ce=g.eventForm.get("finicio"))==null?null:ce.touched)||((ce=g.eventForm.get("finicio"))==null?null:ce.dirty)))),he(),ke("ngIf",((Ee=g.eventForm.get("finicio"))==null?null:Ee.invalid)&&(((Ee=g.eventForm.get("finicio"))==null?null:Ee.touched)||((Ee=g.eventForm.get("finicio"))==null?null:Ee.dirty))),he(4),ke("ngClass",Un(30,yc,((Ze=g.eventForm.get("ffin"))==null?null:Ze.invalid)&&(((Ze=g.eventForm.get("ffin"))==null?null:Ze.touched)||((Ze=g.eventForm.get("ffin"))==null?null:Ze.dirty))))("min",(Vt=g.eventForm.get("finicio"))==null?null:Vt.value),he(),ke("ngIf",((dt=g.eventForm.get("ffin"))==null?null:dt.invalid)&&(((dt=g.eventForm.get("ffin"))==null?null:dt.touched)||((dt=g.eventForm.get("ffin"))==null?null:dt.dirty))),he(4),ke("ngClass",Un(32,yc,((tt=g.eventForm.get("maxVoluntarios"))==null?null:tt.invalid)&&(((tt=g.eventForm.get("maxVoluntarios"))==null?null:tt.touched)||((tt=g.eventForm.get("maxVoluntarios"))==null?null:tt.dirty)))),he(),ke("ngIf",((Ln=g.eventForm.get("maxVoluntarios"))==null?null:Ln.invalid)&&(((Ln=g.eventForm.get("maxVoluntarios"))==null?null:Ln.touched)||((Ln=g.eventForm.get("maxVoluntarios"))==null?null:Ln.dirty))),he(4),ke("ngClass",Un(34,yc,((ri=g.eventForm.get("imagen"))==null?null:ri.invalid)&&(((ri=g.eventForm.get("imagen"))==null?null:ri.touched)||((ri=g.eventForm.get("imagen"))==null?null:ri.dirty)))),he(),ke("ngIf",((bn=g.eventForm.get("imagen"))==null?null:bn.invalid)&&(((bn=g.eventForm.get("imagen"))==null?null:bn.touched)||((bn=g.eventForm.get("imagen"))==null?null:bn.dirty))),he(),ke("ngIf",g.selectedImage),he(2),ke("disabled",g.eventForm.invalid),he(2),Pt(51,g.showAlert?51:-1)}},dependencies:[wi,Ci,lr,ar,Wi,yC,or,sr,vC,Qi,er,ul,cl],styles:["is-invalid[_ngcontent-%COMP%]{border:1px solid red}.invalid-feedback[_ngcontent-%COMP%]{color:red;font-size:12px}li[_ngcontent-%COMP%]{cursor:pointer}"]});let s=a;return s})();var cL=(()=>{let a=class a{constructor(c,f,g){this.userService=c,this.location=f,this.fb=g,this.resetPasswordForm=this.fb.group({email:["",[un.required,un.email]]}),this.newPassword=this.randomPassword(15)}back(){this.location.back()}resetPassword(){let c=this.resetPasswordForm.value.email;this.userService.isEmailInDB(c).subscribe(f=>{console.log(f),f===!0?(this.sendPasswordRecoveryEmail(c),this.userService.editPasswordByEmail(c,this.newPassword).subscribe()):alert("El correo no est\xE1 en la base de datos.")},f=>{console.error("Error al verificar el correo electr\xF3nico:",f)})}randomPassword(c){let f="",g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",x=g.length;for(let T=0;T<c;T++)f+=g.charAt(Math.floor(Math.random()*x));return f}sendPasswordRecoveryEmail(c){this.userService.passwordRecovery({email:c,asunto:"Contrase\xF1a generada autom\xE1ticamente",mensaje:"Contrase\xF1a nueva: "+this.newPassword}).subscribe(f=>{alert("Solicitud de restablecimiento de contrase\xF1a enviada correctamente")},f=>{console.error("Error al enviar el correo electr\xF3nico de recuperaci\xF3n de contrase\xF1a:",f)})}};a.\u0275fac=function(f){return new(f||a)(qe(rn),qe(_r),qe(ml))},a.\u0275cmp=tn({type:a,selectors:[["app-forgetpassword"]],standalone:!0,features:[cn([_r,rn]),nn],decls:13,vars:1,consts:[[1,"container","d-flex","flex-col","vh-100","justify-content-center","align-items-center"],[1,"login-card"],[1,"top"],["src","/assets/banner.png","alt","VoluntApp banner"],[1,"form",3,"formGroup","submit"],["for","email"],["type","email","id","email","name","email","formControlName","email","placeholder","Correo electr\xF3nico","required",""],[1,"d-flex","gap-2","mt-auto"],[1,"px-4","btn","btn-outline-primary",3,"click"],["type","submit",1,"w-100","btn","btn-secondary","derecha"]],template:function(f,g){f&1&&(U(0,"main",0)(1,"div",1)(2,"div",2),De(3,"img",3),j(),U(4,"form",4),je("submit",function(){return g.resetPassword()}),U(5,"label",5),K(6,"Introduce tu correo para restablecer la contrase\xF1a"),j(),De(7,"input",6),U(8,"div",7)(9,"button",8),je("click",function(){return g.back()}),K(10,"\u2190"),j(),U(11,"button",9),K(12,"Restablecer"),j()()()()()),f&2&&(he(4),ke("formGroup",g.resetPasswordForm))},dependencies:[lr,ar,Wi,or,sr,va,Qi,er],styles:["main[_ngcontent-%COMP%]{margin-top:0;margin-bottom:0}.login-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem;width:25rem;border-radius:10px;background-color:#fff;padding:2rem 4rem;box-shadow:#00000059 0 5px 15px}.login-card[_ngcontent-%COMP%]   .top[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.login-card[_ngcontent-%COMP%]   .top[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:14rem}.login-card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.login-card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:20px;font-weight:700}.login-card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:.5rem 1rem;font-size:14px;border:1px solid #966DAF;border-radius:5px}.login-card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{border:1px solid #A4C957;outline:none}.login-card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{font-size:12px;color:#343434}.login-card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#966daf}.login-card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border:none;border-radius:5px;background-color:#7d4e99;padding:.5rem 0rem;color:#fff;margin-top:1.5rem}.login-card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .derecha[_ngcontent-%COMP%]{width:100%}.login-card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:red;font-size:12px}"]});let s=a;return s})();function wX(s,a){s&1&&(U(0,"div",13)(1,"p",14),K(2,"Las contrase\xF1as no coinciden."),j()())}var uL=(()=>{let a=class a{constructor(c,f,g){this.userService=c,this.location=f,this.fb=g,this.changePasswordForm=this.fb.group({password:["",[un.required,un.email]],password2:["",[un.required,un.email]]}),this.passwordsMatch=!0}changePassword(){let c=this.changePasswordForm.value.password,f=this.changePasswordForm.value.password2;if(c===f&&c!==""){let g=this.userService.getUserIdFromToken();g!==-1&&this.userService.getUserById(g).subscribe(x=>{let T=x.email;this.userService.editPasswordByEmail(T,c).subscribe(()=>{this.passwordsMatch=!0,alert("Contrase\xF1a cambiada con \xE9xito.")},P=>{console.error("Error al cambiar la contrase\xF1a:",P)})},x=>{console.error("Error al obtener informaci\xF3n del usuario:",x)})}else this.passwordsMatch=!1}back(){this.location.back()}};a.\u0275fac=function(f){return new(f||a)(qe(rn),qe(_r),qe(ml))},a.\u0275cmp=tn({type:a,selectors:[["app-newpassword"]],standalone:!0,features:[cn([_r,rn]),nn],decls:19,vars:2,consts:[[1,"container","d-flex","flex-col","vh-100","justify-content-center","align-items-center"],[1,"login-card"],[1,"top"],["src","/assets/banner.png","alt","VoluntApp banner"],[1,"form",3,"formGroup","submit"],["for","password"],["type","password","id","password","name","password","formControlName","password","placeholder","**********","required",""],["for","password2"],["type","password","id","password2","name","password2","formControlName","password2","placeholder","**********","required",""],["class","text-error-dark m-0"],[1,"d-flex","gap-2","mt-auto"],[1,"px-4","btn","btn-outline-primary",3,"click"],["type","submit",1,"w-100","btn","btn-secondary","derecha"],[1,"text-error-dark","m-0"],[1,"fs-6"]],template:function(f,g){f&1&&(De(0,"app-header"),U(1,"main",0)(2,"div",1)(3,"div",2),De(4,"img",3),j(),U(5,"form",4),je("submit",function(){return g.changePassword()}),U(6,"label",5),K(7,"Introduce la nueva contrase\xF1a"),j(),De(8,"input",6),U(9,"label",7),K(10,"Repite la contrase\xF1a"),j(),De(11,"input",8),Je(12,wX,3,0,"div",9),U(13,"div",10)(14,"button",11),je("click",function(){return g.back()}),K(15,"\u2190"),j(),U(16,"button",12),K(17,"Cambiar contrase\xF1a"),j()()()()(),De(18,"app-footer")),f&2&&(he(5),ke("formGroup",g.changePasswordForm),he(7),Pt(12,g.passwordsMatch!=!0?12:-1))},dependencies:[wi,Ci,lr,ar,Wi,or,sr,va,Qi,er],styles:["main[_ngcontent-%COMP%]{margin-top:0;margin-bottom:0}.login-card[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:2rem;width:25rem;border-radius:10px;background-color:#fff;padding:2rem 4rem;box-shadow:#00000059 0 5px 15px}.login-card[_ngcontent-%COMP%]   .top[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center}.login-card[_ngcontent-%COMP%]   .top[_ngcontent-%COMP%]   img[_ngcontent-%COMP%]{width:14rem}.login-card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]{display:flex;flex-direction:column;gap:.5rem}.login-card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:20px;font-weight:700}.login-card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]{padding:.5rem 1rem;font-size:14px;border:1px solid #966DAF;border-radius:5px}.login-card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   input[_ngcontent-%COMP%]:focus{border:1px solid #A4C957;outline:none}.login-card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{font-size:12px;color:#343434}.login-card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{color:#966daf}.login-card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   button[_ngcontent-%COMP%]{border:none;border-radius:5px;background-color:#7d4e99;padding:.5rem 0rem;color:#fff;margin-top:1.5rem}.login-card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   .derecha[_ngcontent-%COMP%]{width:100%}.login-card[_ngcontent-%COMP%]   .form[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:red;font-size:12px}"]});let s=a;return s})();var dL=[{path:"login",component:Gk},{path:"register",component:Hk},{path:"terms",component:qk},{path:"about",component:Zk},{path:"",component:Xk},{path:"news",component:Yk},{path:"event/:id",component:tL},{path:"profile",component:iL},{path:"myevents",component:rL},{path:"contact",component:oL},{path:"validations",component:sL},{path:"create-new",component:aL},{path:"create-event",component:lL},{path:"forgetpassword",component:cL},{path:"newpassword",component:uL}];var hL={providers:[ik(dL,rk())]};var fL=(()=>{let a=class a{constructor(){this.title="VoluntApp"}};a.\u0275fac=function(f){return new(f||a)},a.\u0275cmp=tn({type:a,selectors:[["app-root"]],standalone:!0,features:[nn],decls:1,vars:0,template:function(f,g){f&1&&De(0,"router-outlet")},dependencies:[cw,oC,S_]});let s=a;return s})();wF(fL,hL).catch(s=>console.error(s));
